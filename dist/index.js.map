{"version":3,"sources":["webpack://cui-light/webpack/universalModuleDefinition","webpack://cui-light/webpack/bootstrap","webpack://cui-light/./src/core/utils/functions.ts","webpack://cui-light/./src/core/index.ts","webpack://cui-light/./src/core/utils/statics.ts","webpack://cui-light/./src/core/models/errors.ts","webpack://cui-light/./src/core/utils/actions.ts","webpack://cui-light/./src/core/factories/logger.ts","webpack://cui-light/./src/app/builders/element.ts","webpack://cui-light/./src/core/models/setup.ts","webpack://cui-light/./src/app/managers/cache.ts","webpack://cui-light/./src/app/handlers/colors.ts","webpack://cui-light/./src/app/observers/resize.ts","webpack://cui-light/./src/core/models/utils.ts","webpack://cui-light/./src/core/listeners/media.ts","webpack://cui-light/./src/core/listeners/scroll.ts","webpack://cui-light/./src/core/listeners/move.ts","webpack://cui-light/./src/core/utils/interactions.ts","webpack://cui-light/./src/core/bus/handlers.ts","webpack://cui-light/./src/core/bus/executors.ts","webpack://cui-light/./src/core/utils/logger.ts","webpack://cui-light/./src/core/helpers/helpers.ts","webpack://cui-light/./src/core/factories/interactions.ts","webpack://cui-light/./src/core/utils/dictionary.ts","webpack://cui-light/./src/core/bus/bus.ts","webpack://cui-light/./src/core/styles/appender.ts","webpack://cui-light/./src/core/listeners/keys.ts","webpack://cui-light/./src/plugins/light/light.ts","webpack://cui-light/./src/core/utils/aria.ts","webpack://cui-light/./src/app/handlers/base.ts","webpack://cui-light/./src/app/builders/icon.ts","webpack://cui-light/./src/components/icon/icon.ts","webpack://cui-light/./src/components/circle/circle.ts","webpack://cui-light/./src/components/spinner/spinner.ts","webpack://cui-light/./src/components/dummy/dummy.ts","webpack://cui-light/./src/components/scroll/scroll.ts","webpack://cui-light/./src/components/scrollspy/scrollspy.ts","webpack://cui-light/./src/plugins/print/print.ts","webpack://cui-light/./src/app/observers/intersection.ts","webpack://cui-light/./src/components/intersection/intersection.ts","webpack://cui-light/./src/components/open/open.ts","webpack://cui-light/./src/components/close/close.ts","webpack://cui-light/./src/components/toggle/toggle.ts","webpack://cui-light/./src/components/resize/resize.ts","webpack://cui-light/./src/plugins/keys/observer.ts","webpack://cui-light/./src/plugins/keys/keys.ts","webpack://cui-light/./src/components/dialog/dialog.ts","webpack://cui-light/./src/components/offcanvas/offcanvas.ts","webpack://cui-light/./src/components/accordion/accordion.ts","webpack://cui-light/./src/core/listeners/hover.ts","webpack://cui-light/./src/components/drop/drop.ts","webpack://cui-light/./src/plugins/click/click.ts","webpack://cui-light/./src/components/offset/modes.ts","webpack://cui-light/./src/components/offset/offset.ts","webpack://cui-light/./src/core/utils/task.ts","webpack://cui-light/./src/components/switch/switch.ts","webpack://cui-light/./src/components/switch/switcher.ts","webpack://cui-light/./src/components/float/helpers.ts","webpack://cui-light/./src/components/float/float.ts","webpack://cui-light/./src/core/animation/animators.ts","webpack://cui-light/./src/core/animation/engine.ts","webpack://cui-light/./src/app/animation/definitions.ts","webpack://cui-light/./src/components/switch/slider.ts","webpack://cui-light/./src/components/banner/banner.ts","webpack://cui-light/./src/components/cover/cover.ts","webpack://cui-light/./src/app/handlers/drag/detectors.ts","webpack://cui-light/./src/app/handlers/drag/drag.ts","webpack://cui-light/./src/components/sortable/sortable.ts","webpack://cui-light/./src/app/initializer.ts","webpack://cui-light/./src/app/managers/element.ts","webpack://cui-light/./src/app/managers/toast.ts","webpack://cui-light/./src/app/helpers/collection.ts","webpack://cui-light/./src/app/managers/collection.ts","webpack://cui-light/./src/app/managers/plugins.ts","webpack://cui-light/./src/app/builders/dialog.ts","webpack://cui-light/./src/app/handlers/alert.ts","webpack://cui-light/./src/app/observers/move.ts","webpack://cui-light/./src/app/instance.ts","webpack://cui-light/./src/app/observers/mutations.ts","webpack://cui-light/./src/index.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","is","val","typecheck","length","Array","isArray","isEmpty","getName","prefix","sleep","timeout","Promise","resolve","setTimeout","createElementFromString","htmlString","template","document","createElement","innerHTML","content","children","getRangeValue","min","max","getRangeValueOrDefault","def","isNaN","increaseValue","amount","decreaseValue","joinAttributesForQuery","attributes","join","getSystemLightMode","matchMedia","matches","getSystemPrintMode","are","calcWindowSize","width","parseAttributeString","attribute","ret","out","startsWith","endsWith","JSON","parse","jsonify","e","console","error","message","component","functionName","Date","toLocaleString","parseJsonString","trim","includes","split","forEach","sp","getOffsetTop","element","offsetTop","parseInt","getStyleValue","getOffsetLeft","offsetLeft","getIntOrDefault","integer","target","currentStyle","getComputedStyle","getPropertyValue","isInRange","getActiveClass","parseAttribute","getAttribute","isStringTrue","toLowerCase","boolStringOrDefault","prop","getStringOrDefault","isString","replacePrefix","replace","generateRandomString","rand","getRandomInt","rand2","Math","floor","random","ceil","registerCuiElement","node","components","utils","$handlers","matching","hasAttribute","filter","a","getMatchingAttributes","$cuid","next","generateCUID","tagName","setAttribute","match","find","styleAppender","append","getStyle","handler","handle","attr","counter","idx","getParentCuiElement","parent","parentElement","getChildrenHeight","height","from","child","offsetHeight","enumerateObject","callback","calculateNextIndex","currentIndex","totalLength","getFirstMatching","array","count","CUID_ATTRIBUTE","CLASSES","dark","animProgress","print","active","swipingOn","selectionOff","ICONS","close","accordion","special_menu","special_fail","special_success","CSS_APP_BACKGROUND_COLORS","light","CSS_COMPONENT_BACKGROUND_COLORS","CSS_COMPONENT_BORDER_COLORS","CSS_THEMES","base","muted","accent","secondary","success","warning","SCOPE_SELECTOR","CSS_VARIABLES","fontSize","lineHeight","animationTime","animationTimeLong","animationTimeShort","colorLightAppBackground","colorLightBackground","colorLightBorder","colorLightBase","colorLightActive","colorLightMuted","colorDarkAppBackground","colorDarkBackground","colorDarkBorder","colorDarkBase","colorDarkActive","colorDarkMuted","colorAccent","colorAccentActive","colorAccentMuted","colorAccentShade","colorAccentShadeDark","colorSecondary","colorSecondaryActive","colorSecondaryMuted","colorSecondaryShade","colorSecondaryShadeDark","colorWarning","colorWarningActive","colorWarningMuted","colorWarningShade","colorWarningShadeDark","colorSuccess","colorSuccessActive","colorSuccessMuted","colorSuccessShade","colorSuccessShadeDark","colorError","colorErrorActive","colorErrorMuted","colorErrorShade","colorErrorShadeDark","inputBackground","colorShade","colorShadeDarker","colorShadeLight","colorShadeLighter","outline","borderRadius","padding","margin","scrollbarWidth","componentSpace","STATICS","logLevel","EVENTS","INSTANCE_INITIALIZED","INSTANCE_FINISHED","RESIZE","OPEN","OPENED","CLOSE","CLOSED","TOGGLE","TOGGLED","SWITCH","SWITCHED","ON_SCROLL","TARGET_CHANGE","INTERSECTION","KEYDOWN","SCROLLBY","WINDOW_CLICK","OFFSET","PROGRESS_CHANGE","PROGRESS_CHANGED","CHANGE","CHANGED","GLOBAL_MOVE","MOVE_LOCK","PAUSE","PAUSED","COMPONENTS_COUNTER","ErrorBase","Error","super","setPrototypeOf","this","ItemNotFoundError","ArgumentError","CuiInstanceInitError","CuiScrollSpyOutOfRangeError","RegisterElementError","AnimatorError","CuiClassAction","className","classList","contains","add","remove","CuiInboundAction","setLightMode","setDarkMode","getLightMode","AttributeAction","removeAttribute","DummyAction","CuiActionsFatory","substring","CuiActionsListFactory","map","single","CuiLoggerFactory","ElementBuilder","tag","id","CuiSetup","autoLightMode","scrollThreshold","resizeThreshold","plugins","init","cacheSize","CuiSetupInit","app","interaction","body","busSetup","undefined","maxSize","has","update","clean","item","refresh","containsKey","clear","keys","interactions","documentElement","setPropertyIn","toCssString","type","set","colors","baseColor","mutedColor","clone","lighten","activeColor","darken","mutate","setProperty","factor","propertyName","style","bus","threshold","innerWidth","findIndex","x","push","splice","addEventListener","listener","removeEventListener","ev","diff","abs","currentSize","resizeData","current","previous","innerHeight","timestamp","now","emit","resize","all","initialSetup","setup","fromInit","cache","connect","classes","flag","CuiMediaQueryListener","mediaQuery","event","CuiScrollListener","Window","left","getLeft","top","getTop","passedThreshold","requestAnimationFrame","pageYOffset","scrollTop","pageXOffset","scrollLeft","CuiMoveEventListener","onMouseDown","onMouseUp","onMouseMove","onTouchStart","onTouchEnd","onTouchMove","log","publishMouseEvent","publishTouchEvent","clientX","y","clientY","moveX","movementX","moveY","movementY","touch","touches","changedTouches","FastDom","isScheduled","raf","writes","reads","ctx","args","createTask","schedule","tasks","task","shift","recursion","flush","rec","run","SyncInteractions","isRunning","EmitHandlerBase","queue","isBusy","emitId","handleId","SimpleEventEmitHandler","executor","events","cuid","perform","idMatches","execute","TaskedEventEmitHandler","promises","CuiEventEmitHandlerFactory","CuiCallbackExecutor","CuiLogger","level","prepString","warn","stack","start","CuiActionsHelper","action","actions","inTarget","outTarget","inAction","outAction","onFinish","CuiInteractionsFactory","CuiDictionary","throwOnEmptyKey","index","indexOf","CuiEventBus","emitHandler","cui","isAttached","debug","getCuid","callbacks","evId","evValue","CuiEventExtBus","sort","first","second","priority","initBusInstance","mapEvents","eventsDef","on","detach","detachAll","isSubscribing","detachByCuid","busName","handlerName","reduce","result","CuiEventBusFactory","CuiDocumentStyleAppender","head","getElementsByTagName","text","createTextNode","appendChild","CuiKeyPressListener","singleEmit","onKeyDown","onKeyUp","code","autoLightInit","description","autoLight","setCallback","onChange","attach","autoLightSetup","AriaAttributes","label","cls","setClasses","removeClasses","attributeName","componentName","_log","isLocked","setId","activeClassName","helper","fetch","data","fName","actionsHelper","prevArgs","isInitialized","onHandle","onRefresh","onRemove","detachEmiitedEvents","CuiHandler","onInit","onUpdate","onDestroy","performActions","onEvent","openFromEvent","closeFromEvent","openAct","closeAct","detachEvent","checkLockAndWarn","isActive","escClose","keyClose","onKeyClose","onBeforeOpen","performAction","onActionFinish","onAfterOpen","setClass","setAria","onBeforeClose","onAfterClose","removeClass","open","emitEvent","state","onMutation","mutation","observe","unobserve","records","addedNodes","added","removedNodes","removed","svgString","IconScaleAppender","scale","created","toString","icon","CuiIconComponent","addIcon","svg","querySelector","iconStr","iconSvg","setScale","build","childNodes","insertBefore","iconElement","firstChild","progress","getTotalLength","readStyle","onSetProgress","strokeDashoffset","updateStyle","spinner","onPause","removeIfAnyExisists","svgIcon","addSpinner","existing","hasClass","setClassesAs","removeClassesAs","CuiDummyComponent","behavior","onClick","setTargets","to","by","scrollBy","preventDefault","offset","selector","link","linkAction","CuiScrollspyComponent","calculateCurrent","setCurrent","setCurrentLink","onScroll","calculateCurrentLeft","newTarget","querySelectorAll","scroll","ratio","clientHeight","clientWidth","prev","autoPrintInit","autoPrint","setPrintMode","CuiIntersectionObserver","observer","IntersectionObserver","rootMargin","disconnect","CuiIntersectionComponent","parseArguments","onIntersection","entries","entry","getAction","isIntersecting","intersectionRatio","emitIntersection","prevent","CuiOpenComponent","onOpen","getTarget","then","activateTarget","catch","exception","finally","cuiId","setActiveClass","setActiveClassAsync","shouldEmit","emitOpen","el","CuiCloseComponent","onClose","removeActiveClass","removeActiveClassAsync","emitClose","CuiToggleComponent","toggle","CuiResizeArgs","CuiResizeComponent","keySetup","defTimeout","outClose","CuiDialogComponent","isAnyActive","onWindowClick","scrollTo","container","position","getDefaultOpenClass","getDefaultCloseClass","CuiOffCanvasComponent","setPositionLeft","scrollY","items","animation","CuiAccordionComponent","isValid","initTargets","onSwitch","mutations","queryItems","closeAllExcept","currentTarget","switch","setListener","onMouseOver","onMouseOut","mouseEvent","force","invoke","isHovering","trigger","autoClose","CuiDropComponenet","onTargetHover","onTriggerClick","setTriggerEvent","findAndCloseOpenedDrop","onEscClose","runAutoCloseTask","clearTimeout","opened","onHoverEvent","CuiOffsetStaticMode","offsetX","offsetY","CuiOffsetDynamicMode","fitsOffsetY","fitsOffsetX","diffX","diffY","CuiOffsetComponent","checkAndPerformActions","getRoot","matchesOffset","act","callEvent","isOnEdge","exceededThreshold","limitX","limitY","scrollHeight","scrollWidth","autoRenew","canRun","stop","targets","in","links","autoTimeout","CuiSwitchComponent","onPushSwitch","getTargets","getLinks","getActiveIndex","getSwitches","setSwitchesActive","setLinkActive","setStyle","getElementHeight","startTask","record","nextIdx","nextItem","performSwitchAction","sw","setLinkSwitch","CuiSwitcherComponent","onClickEvent","setEvents","removeEvents","list","onListItemClick","BasePositionCalculator","BaseResizeCalculator","CuiFloatComponent","move","onMove","peform","newWidth","newHeight","calculate","fitsWindow","newX","newY","offsetWidth","rtl","opacity","unit","createValue","props","cur","buildSingle","transform","CuiAnimationEngine","cleanOnFinish","animators","revert","reportError","animationProgress","shouldCalcRevert","animateAsync","initialProgress","pr","currProgress","callUpdate","endAnimation","reverted","animator","shouldCleanOnFinish","setOnError","setElement","setAnimators","animate","SWIPE_ANIMATIONS_DEFINITIONS","translateX","right","fade","loop","CuiSliderComponent","setOnFinish","onAnimationFinish","absRatio","back","finish","newRatio","adjustMoveRatio","setProps","errorOccured","swipe","CuiBanerComponent","onSwipeFinish","CuiCoverComponent","CuiDragOverDetector","elements","reduced","closest","currentId","box","getBoundingClientRect","Number","NEGATIVE_INFINITY","CuiSortableComponent","sutils","onDragStart","onDragOver","onDragEnd","stopMovementPrep","getTargetsAndTrggers","setLongPressTimeout","setElements","getPressedElementIdx","startMovementPrep","getFinishAnimation","createPreview","createShadow","insertElement","removePreview","removeShadow","movePreview","moveShadow","detected","detect","source","destination","settings","appPrefix","icons","swipeAnimations","initializer","pluginList","componentList","attributeValue","eventName","lock","unlock","delay","change","openClass","animationClass","closeClass","ids","cuiElement","toastElement","textContent","currentElement","nextElement","animIn","animOut","newIndex","animClassIn","animClassOut","duration","addAnimationClass","setFinalClasses","len","setToggle","check","newIdx","getCurrentIndex","verifyIndex","setCurrentWithAnimation","plugin","reverse","switches","title","headerBuilder","titleElement","getPrefixedString","appendChildrens","dialog","setAttributes","str","onYes","onNo","onCancel","onOk","closeStr","getElementById","updateElement","arg","dialogBuilder","createHeader","createBody","createFooter","onMoveLock","MutationObserver","mutatedAttributes","initElements","setComponents","setPlugins","show","nodes","CuiMutationObserver","subtree","childList","attributeFilter","mutationCallback","handleChildListMutation","addedLen","removedLen","handleAddedNodes","handleRemovedNodes","childrens","hasChildNodes","destroySingleElement","destroy","CuiComponentMutationHandler","CUI_LIGHT_VERSION","cuiInit"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,YAAa,GAAIH,GACE,iBAAZC,QACdA,QAAQ,aAAeD,IAEvBD,EAAK,aAAeC,IARtB,CASGK,QAAQ,WACX,O,YCTE,IAAIC,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUP,QAGnC,IAAIC,EAASI,EAAiBE,GAAY,CACzCC,EAAGD,EACHE,GAAG,EACHT,QAAS,IAUV,OANAU,EAAQH,GAAUI,KAAKV,EAAOD,QAASC,EAAQA,EAAOD,QAASM,GAG/DL,EAAOQ,GAAI,EAGJR,EAAOD,QA0Df,OArDAM,EAAoBM,EAAIF,EAGxBJ,EAAoBO,EAAIR,EAGxBC,EAAoBQ,EAAI,SAASd,EAASe,EAAMC,GAC3CV,EAAoBW,EAAEjB,EAASe,IAClCG,OAAOC,eAAenB,EAASe,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEV,EAAoBgB,EAAI,SAAStB,GACX,oBAAXuB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAenB,EAASuB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAenB,EAAS,aAAc,CAAEyB,OAAO,KAQvDnB,EAAoBoB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQnB,EAAoBmB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFAxB,EAAoBgB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOnB,EAAoBQ,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRvB,EAAoB2B,EAAI,SAAShC,GAChC,IAAIe,EAASf,GAAUA,EAAO2B,WAC7B,WAAwB,OAAO3B,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAK,EAAoBQ,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRV,EAAoBW,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG7B,EAAoBgC,EAAI,GAIjBhC,EAAoBA,EAAoBiC,EAAI,I,+BCjFrD,klCAaO,SAASC,EAAGC,EAAUC,GAAqB,GAC9C,OAAI,MAAOD,KACFC,IAgBN,SAAiBD,GACpB,GAAmB,iBAARA,EACP,OAAsB,IAAfA,EAAIE,OAEf,GAAmB,kBAARF,EACP,OAAOA,EAEN,GAAIG,MAAMC,QAAQJ,GACnB,OAAsB,IAAfA,EAAIE,OAEf,OAAO,EAvBSG,CAAQL,IA0BrB,SAASM,EAAQC,EAAgBjC,GACpC,IAAKyB,EAAGQ,KAAYR,EAAGzB,GACnB,MAAM,IAAI,IAAc,0BAE5B,MAAO,GAAGiC,KAAUjC,IAGjB,SAASkC,EAAMC,GAClB,OAAO,IAAIC,QAAQC,GAAWC,WAAW,KACrCD,GAAQ,IACTF,IAOA,SAASI,EAAwBC,GACpC,IAAKf,EAAGe,GACJ,OAAO,KAEX,IAAIC,EAAWC,SAASC,cAAc,YAEtC,OADAF,EAASG,UAAYJ,EACdC,EAASI,QAAQC,SAASlB,OAAS,EAAIa,EAASI,QAAQC,SAAS,GAAK,KAyB1E,SAASC,EAAcrC,EAAesC,EAAaC,GACtD,OAAIvC,EAAQsC,EACDA,EACAtC,EAAQuC,EACRA,EAEJvC,EAGJ,SAASwC,EAAuBxC,EAAesC,EAAaC,EAAaE,GAC5E,OAAIzC,SAAkD0C,MAAM1C,GACjDyC,EAEJJ,EAAcrC,EAAOsC,EAAKC,GAG9B,SAASI,EAAc3C,EAAe4C,GACzC,OAAOA,EAAS,GAAKA,EAAS,EAAI,EAAI5C,EAASA,EAAQ4C,EAGpD,SAASC,EAAc7C,EAAe4C,GACzC,OAAOA,EAAS,GAAKA,EAAS,EAAI,EAAI5C,EAASA,EAAQ4C,EAkBpD,SAASE,EAAuBC,GACnC,OAAKhC,EAAGgC,GAGD,IAAIA,EAAWC,KAAK,UAFhB,GASR,SAASC,IACZ,OAAOtE,OAAOuE,YACVvE,OAAOuE,WAAW,gCAAgCC,QAAU,OAAS,QAOtE,SAASC,IACZ,OAAOzE,OAAOuE,YACVvE,OAAOuE,WAAW,SAASC,QAO5B,SAASE,KAAON,GACnB,IAAKhC,EAAGgC,GACJ,OAAO,EAEX,IAAI3D,EAAI2D,EAAW7B,OACnB,IAAK,IAAInC,EAAI,EAAGA,EAAIK,EAAGL,IACnB,IAAKgC,EAAGgC,EAAWhE,IACf,OAAO,EAGf,OAAO,EAGJ,SAASuE,EAAeC,GAC3B,OAAIA,GAAS,IACF,QACAA,EAAQ,KAAOA,GAAS,IACxB,SACAA,EAAQ,KAAOA,GAAS,KACxB,QAEJ,SAYJ,SAASC,EAAqBC,GACjC,IAAIC,EA0BD,SAAyBD,GAC5B,IAAIE,EAAM,KACV,GAAI5C,EAAG0C,IAAcA,EAAUG,WAAW,MAAQH,EAAUI,SAAS,KAAM,CACvE,IACIF,EAaL,SAAiBF,GACpB,OAAOA,GAAaA,EAAUvC,OAAS,EAAI4C,KAAKC,MAAMN,GAAa,GAdrDO,CAAQP,GAChB,MAAOQ,GACLC,QAAQC,OAgDUC,EAhDU,uBAgDOC,EAhDiB,YAgDEC,EAhDW,kBAiDlE,KAAI,IAAIC,MAAOC,qBAAqBH,UAAa,QAAQC,UAAgB,QAAQF,MAjDKH,GAEzF,OAAON,EA8CR,IAAuBS,EAAiBC,EAAmBC,EA5C9D,OAAO,KApCQG,CAAgBhB,EAAUiB,QAezC,OAbK3D,EAAG2C,KACCD,EAAUkB,SAAS,MAASlB,EAAUkB,SAAS,MAGhDjB,EAAM,GACND,EAAUmB,MAAM,KAAKC,QAAQ7D,IACzB,IAAI8D,EAAK9D,EAAI4D,MAAM,KACD,IAAdE,EAAG5D,SACHwC,EAAIoB,EAAG,GAAGJ,QAAUI,EAAG,GAAGJ,WANlChB,EAAMD,GAWPC,EAgCJ,SAASqB,EAAaC,GACzB,IAAKjE,EAAGiE,GACJ,OAAQ,EAEZ,IAAIhE,EAAMgE,EAAQC,UAAYC,SAASC,EAAcH,EAAS,eAAiBE,SAASC,EAAcH,EAAS,gBAAkBE,SAASC,EAAcH,EAAS,qBACjK,OAAOhE,EAAM,EAAIgE,EAAQC,UAAYjE,EAGlC,SAASoE,EAAcJ,GAC1B,IAAKjE,EAAGiE,GACJ,OAAQ,EAEZ,IAAIhE,EAAMgE,EAAQK,WAAaH,SAASC,EAAcH,EAAS,gBAAkBE,SAASC,EAAcH,EAAS,iBAAmBE,SAASC,EAAcH,EAAS,sBACpK,OAAOhE,EAAM,EAAIgE,EAAQK,WAAarE,EAGnC,SAASsE,EAAgBtF,EAAYyC,GACxC,IAAI8C,EAAUL,SAASlF,GACvB,OAAO0C,MAAM6C,GAAW9C,EAAM8C,EAG3B,SAASJ,EAAcK,EAAa9E,GACvC,OAAKK,EAAGyE,IAAYzE,EAAGL,GAGnB8E,EAAOC,aACAD,EAAOC,aAAa/E,GACpB/B,OAAO+G,iBACP/G,OAAO+G,iBAAiBF,EAAQ,MAAMG,iBAAiBjF,GAE3D,KAPI,KAcR,SAASkF,EAAU5F,EAAesC,EAAaC,GAClD,OAAOxB,EAAGf,IAAUA,GAASsC,GAAOtC,GAASuC,EAG1C,SAASsD,EAAetE,GAC3B,OAAUA,UAAU,IAAb,UAGJ,SAASuE,EAAed,EAAkBvB,GAC7C,OAAOJ,EAAI2B,EAASvB,GAAaD,EAAqBwB,EAAQe,aAAatC,IAAc,KAQtF,SAASuC,EAAahG,GACzB,QAAOe,EAAGf,IAAS,CAAC,IAAK,IAAK,OAAQ,OAAO2E,SAAS3E,EAAMiG,eAGzD,SAASC,EAAoBC,EAAW1D,GAC3C,OAAO1B,EAAGoF,GAAQH,EAAaG,GAAQ1D,EAGpC,SAAS2D,EAAmBpG,EAAYyC,GAC3C,OAAO1B,EAAGf,GAASA,EAAMiG,cAAgBxD,EAgBtC,SAAS4D,EAASrG,GACrB,MAAwB,iBAAVA,EASX,SAASsG,EAActG,EAAeuB,GACzC,OAAQR,EAAGf,GAAiBA,EAAMuG,QAAQ,WAAYhF,UAAU,IAA5CvB,EAiBjB,SAASwG,IACZ,IAAIC,EAAOC,EAAa,EAAG,KACvBC,EAAQD,EAAa,EAAG,KAC5B,MAAO,GAAGE,KAAKC,MAAMD,KAAKE,SAAWH,MAAUC,KAAKC,MAAMJ,KAQvD,SAASC,EAAapE,EAAaC,GAGtC,OAFAD,EAAMsE,KAAKG,KAAKzE,GAChBC,EAAMqE,KAAKC,MAAMtE,GACVqE,KAAKC,MAAMD,KAAKE,UAAYvE,EAAMD,EAAM,IAAMA,EAUlD,SAAS0E,EAAmBC,EAAWC,EAA6BnE,EAAsBoE,GAC7F,IAAInC,EAAUiC,EACdjC,EAAQoC,UAAY,GACpB,IAAIC,EApSD,SAA+BrC,EAAcjC,GAChD,OAAKiC,GAAYjE,EAAGiE,EAAQsC,cAGrBvE,EAAWwE,OAAOC,GACdxC,EAAQsC,aAAaE,IAHrB,KAkScC,CAAsBR,EAAMlE,GACjDhC,EAAGsG,KACHrC,EAAQ0C,MAAQT,EAAKK,aAAa,KAAkBL,EAAKlB,aAAa,KArCvE,SAAsBf,GAEzB,MAAO,GADOjE,EAAGiE,GAAWA,EAAU,iBACjB,IAAmB2C,OAAO3H,QAmC6C4H,CAAaX,EAAKY,SAC1GZ,EAAKa,aAAa,IAAgB9C,EAAQ0C,OAC1CL,EAASxC,QAAQkD,IACb,IAAI1D,EAAY6C,EAAWc,KAAK5I,GAAcA,EAAEqE,YAAcsE,GAC9D,GAAIhH,EAAGsD,GACH,IACI8C,EAAMc,cAAcC,OAAO7D,EAAU8D,YACrC,IAAIC,EAAU/D,EAAUzE,IAAIqH,EAAME,GAClCnC,EAAQoC,UAAU/C,EAAUZ,WAAa2E,EACzCpD,EAAQoC,UAAU/C,EAAUZ,WAAW4E,OAAOvC,EAAemB,EAAM5C,EAAUZ,YAC/E,MAAOQ,GACL,IAAIqE,EAAOjB,EAAWA,EAASrE,KAAK,MAAQ,GAC5C,MAAM,IAAI,IAAqB,4BAA4BsF,sBAAyBrE,EAAEG,eAQnG,SAAUmE,IACb,IAAIC,EAAM,EACV,OAAa,SACSA,MACLA,EAAM,OACfA,EAAM,IAkCX,SAASC,EAAoBzD,GAChC,IAAKjE,EAAGiE,GACJ,OAEJ,IAAI0D,EAAS1D,EAAQ2D,cACrB,OAAO5H,EAAG2H,IAAW3H,EAAG2H,EAAOhB,OAASgB,EAASD,EAAoBC,GAOlE,SAASE,EAAkB5D,GAC9B,IAAI6D,EAAiB,EACrB,OAAK7D,GAGL7D,MAAM2H,KAAK9D,EAAQ5C,UAAUyC,QAASkE,IAClCF,GAAUE,EAAMC,eAEbH,EAAS,EAAIA,EAAS,EAAIA,IALrB,EAQT,SAASI,EAAmBxI,EAAWyI,GAC1C,GAAK7F,EAAI5C,EAAQyI,GAGjB,IAAK,IAAI/C,KAAQ1F,EACTA,EAAOG,eAAeuF,IACtB+C,EAAS/C,EAAM1F,EAAO0F,IAW3B,SAASgD,EAAmBnI,EAAUoI,EAAsBC,GAC/D,IAAIb,GAAO,EACX,OAAQxH,GACJ,IAAK,OACDwH,EAAMY,GAAgB,EAAIC,EAAc,EAAID,EAAe,EAC3D,MACJ,IAAK,OACDZ,EAAMY,EAAeC,EAAc,EAAID,EAAe,EAAI,EAC1D,MACJ,IAAK,QACDZ,EAAM,EACN,MACJ,IAAK,OACDA,EAAMa,EAAc,EACxB,QACIb,EAAMlD,EAAgBtE,GAAM,GAGpC,OAAOwH,EAGJ,SAASc,EAAoBC,EAAYL,GAC5C,IAAIM,EAAQD,EAAMrI,OAClB,GAAKqI,GAAmB,IAAVC,EAId,IAAK,IAAIhB,EAAM,EAAGA,EAAMgB,EAAOhB,IAC3B,GAAIU,EAASK,EAAMf,GAAMA,GACrB,OAAOe,EAAMf,K,6BC1fzB,mlJ,6BCEA,maACO,MAAMiB,EAAiB,OAEjBC,EAAU,CACnBC,KAAM,OACNC,aAAc,qBACdC,MAAO,QACPC,OAAQ,SACRC,UAAW,aACXC,aAAc,iBAGLC,EAAa,CACtBC,MAAO,sLACPC,UAAW,oKACXC,aAAc,oQACdC,aAAc,4ZACdC,gBAAiB,oUAKRC,EAA0C,CACnDC,MAAO,mCACPb,KAAM,mCAGGc,EAAgD,CACzDD,MAAO,+BACPb,KAAM,gCAGGe,EAA4C,CACrDF,MAAO,2BACPb,KAAM,2BAGGgB,EAAa,CACtBH,MAAO,CACHI,KAAM,yBACNC,MAAO,0BACPf,OAAQ,4BAEZH,KAAM,CACFiB,KAAM,wBACNC,MAAO,yBACPf,OAAQ,2BAEZgB,OAAQ,CACJF,KAAM,sBACNC,MAAO,4BACPf,OAAQ,8BAEZiB,UAAW,CACPH,KAAM,wBACNC,MAAO,8BACPf,OAAQ,gCAEZkB,QAAS,CACLJ,KAAM,sBACNC,MAAO,4BACPf,OAAQ,8BAEZmB,QAAS,CACLL,KAAM,sBACNC,MAAO,4BACPf,OAAQ,8BAEZ3F,MAAO,CACHyG,KAAM,oBACNC,MAAO,0BACPf,OAAQ,6BAIHoB,EAAiB,UAEjBC,EAAqB,CAC9BC,SAAU,uBACVC,WAAY,yBACZC,cAAe,4BACfC,kBAAmB,iCACnBC,mBAAoB,kCACpBC,wBAAyB,wCACzBC,qBAAsB,oCACtBC,iBAAkB,gCAClBC,eAAgB,8BAChBC,iBAAkB,gCAClBC,gBAAiB,+BACjBC,uBAAwB,uCACxBC,oBAAqB,mCACrBC,gBAAiB,+BACjBC,cAAe,6BACfC,gBAAiB,+BACjBC,eAAgB,8BAChBC,YAAa,2BACbC,kBAAmB,kCACnBC,iBAAkB,iCAClBC,iBAAkB,iCAClBC,qBAAsB,sCACtBC,eAAgB,6BAChBC,qBAAsB,oCACtBC,oBAAqB,mCACrBC,oBAAqB,mCACrBC,wBAAyB,wCACzBC,aAAc,2BACdC,mBAAoB,kCACpBC,kBAAmB,iCACnBC,kBAAmB,iCACnBC,sBAAuB,sCACvBC,aAAc,2BACdC,mBAAoB,kCACpBC,kBAAmB,iCACnBC,kBAAmB,iCACnBC,sBAAuB,sCACvBC,WAAY,yBACZC,iBAAkB,gCAClBC,gBAAiB,+BACjBC,gBAAiB,+BACjBC,oBAAqB,oCACrBC,gBAAiB,oCACjBC,WAAY,yBACZC,iBAAkB,gCAClBC,gBAAiB,+BACjBC,kBAAmB,uCACnBC,QAAS,qBACTC,aAAc,2BACdC,QAAS,qBACTC,OAAQ,oBACRC,eAAgB,6BAChBC,eAAgB,8BAIb,MAAMC,GACF,EAAAC,SAAwB,OACxB,EAAAnN,OAAiB,MAGrB,MAAMoN,EAAS,CAClBC,qBAAsB,uBACtBC,kBAAmB,oBACnBC,OAAQ,SACRC,KAAM,OACNC,OAAQ,SACRC,MAAO,QACPC,OAAQ,SACRC,OAAQ,SACRC,QAAS,UACTC,OAAQ,SACRC,SAAU,WACVC,UAAW,SACXC,cAAe,eACfC,aAAc,eACdC,QAAS,UACTC,SAAU,WACVC,aAAc,cACdC,OAAQ,SACRC,gBAAiB,iBACjBC,iBAAkB,kBAClBC,OAAQ,SACRC,QAAS,UACTC,YAAa,aACbC,UAAW,WACXC,MAAO,QACPC,OAAQ,UAKCC,EAAqB,e,6BC5KlC,4MAAO,MAAMC,UAAkBC,MAC3B,YAAYlR,EAAc8E,GACtBqM,MAAMrM,GACN3E,OAAOiR,eAAeC,gBAAiBhQ,WACvCgQ,KAAKrR,KAAOA,GAIb,MAAMsR,UAA0BL,EACnC,YAAYnM,GACRqM,MAAM,oBAAqBrM,IAI5B,MAAMyM,UAAsBN,EAC/B,YAAYnM,GACRqM,MAAM,gBAAiBrM,IAUxB,MAAM0M,UAA6BP,EACtC,YAAYnM,GACRqM,MAAM,uBAAwBrM,IAI/B,MAAM2M,UAAoCR,EAC7C,YAAYnM,GACRqM,MAAM,8BAA+BrM,IAKtC,MAAM4M,UAA6BT,EACtC,YAAYnM,GACRqM,MAAM,uBAAwBrM,IAI/B,MAAM6M,UAAsBV,EAC/B,YAAYnM,GACRqM,MAAM,gBAAiBrM,M,oYCtCxB,MAAM8M,EAGT,YAAYC,GAFZ,mBAGI,EAAAR,KAAI,EAAUQ,GAGlB,IAAInM,EAAkBmC,GACd,YAAInC,EAAS,EAAF,WAAmBA,EAAQoM,UAAUC,SAAS,EAAD,UACxDrM,EAAQoM,UAAUE,IAAI,EAAD,SAI7B,OAAOtM,EAAkBmC,GACjB,YAAInC,EAAS,EAAF,UAAkBA,EAAQoM,UAAUC,SAAS,EAAD,UACvDrM,EAAQoM,UAAUG,OAAO,EAAD,SAIhC,OAAOvM,EAAkBmC,GACjB,YAAInC,EAAS,EAAF,WACPA,EAAQoM,UAAUC,SAAS,EAAD,SAC1BrM,EAAQoM,UAAUG,OAAO,EAAD,SAExBvM,EAAQoM,UAAUE,IAAI,EAAD,W,cAM9B,MAAME,EAGT,YAAYlS,GAFZ,mBAGI,EAAAqR,KAAI,EAASrR,GAEjB,IAAI0F,EAAkBmC,GAClB,OAAQ,EAAR,SACI,IAAK,YACDA,EAAMsK,aAAa,QACnB,MACJ,IAAK,aACDtK,EAAMsK,aAAa,UAK/B,OAAOzM,EAAkBmC,GACrB,OAAQ,EAAR,SACI,IAAK,YACDA,EAAMsK,aAAa,SACnB,MACJ,IAAK,aACDtK,EAAMsK,aAAa,SAK/B,OAAOzM,EAAkBmC,GACrB,OAAQ,EAAR,SACI,IAAK,YAGL,IAAK,aACDwJ,KAAKe,YAAYvK,IAKrB,YAAYA,GACa,SAAzBA,EAAMwK,eACNxK,EAAMsK,aAAa,SAEnBtK,EAAMsK,aAAa,S,cAKxB,MAAMG,EAGT,YAAYnO,G,QAFZ,mBACA,mBAEI,EAACkN,KAAI,EAAiBA,MAArB,CAAD,8DAA8ClN,EAAUmB,MAAM,KAGlE,IAAII,EAAkBmC,GACb,YAAInC,EAAS,EAAF,oBAGhBA,EAAQ8C,aAAa,EAAD,mBAGxB,OAAO9C,EAAkBmC,GAChB,YAAInC,EAAS,EAAF,oBAGZA,EAAQsC,aAAa,EAAD,UACpBtC,EAAQ6M,gBAAgB,EAAD,SAK/B,OAAO7M,EAAkBmC,GAChB,YAAInC,EAAS,EAAF,qBAGZA,EAAQsC,aAAa,EAAD,SACpBtC,EAAQ6M,gBAAgB,EAAD,SAEvB7M,EAAQ8C,aAAa,EAAD,qB,4BAKzB,MAAMgK,EACT,eAGA,IAAI9M,EAAkBmC,IAItB,OAAOnC,EAAkBmC,IAGzB,OAAOnC,EAAkBmC,KAItB,MAAM4K,EACF,WAAW/R,GACd,IAAK,YAAGA,GACJ,OAAO,IAAI8R,EAGf,OADgB9R,EAAM,IAElB,IAAK,IACD,OAAO,IAAIkR,EAAelR,EAAMgS,UAAU,IAC9C,IAAK,IACD,OAAO,IAAIR,EAAiBxR,EAAMgS,UAAU,IAChD,IAAK,IACD,OAAO,IAAIJ,EAAgB5R,EAAMgS,UAAU,IAC/C,QACI,OAAO,IAAId,EAAelR,KAKnC,MAAMiS,EACF,WAAWjS,GACd,IAAK,YAAGA,GACJ,MAAO,GAGX,OADcA,EAAM4E,MAAM,KACbsN,IAAIC,GACNJ,EAAiBnS,IAAIuS,EAAOzN,Y,6BCpK/C,qDAQO,MAAM0N,EAKF,WAAW9S,EAAcoP,GAC5B,OAAO,IAAI,IAAUpP,EAAMoP,UAAY,IAAQA,a,gUCThD,MAAM2D,EAKT,YAAYC,GAJZ,mBACA,mBACA,mBACA,mBAEI,EAAA3B,KAAI,EAAQ2B,GACZ,EAAA3B,KAAI,EAAY,IAChB,EAAAA,KAAI,EAAe,MAEvB,MAAM4B,GAEF,OADA,EAAA5B,KAAI,EAAO4B,GACJ5B,KAGX,cAAcS,GAEV,OADA,EAAAT,KAAI,EAAYS,GACTT,KAGX,cAAc5N,GAEV,OADA,EAAA4N,KAAI,EAAe5N,GACZ4N,KAGX,MAAMzO,GACF,IAAI8C,EAAUhD,SAASC,cAAc,EAAD,SAepC,OAdI,aAAG,EAAD,WACF+C,EAAQuN,GAAK,EAAH,SAEV,aAAG,EAAD,UACFvN,EAAQoM,UAAUE,OAAO,EAAH,SAEtB,aAAG,EAAD,UACF,0BAAgB,EAAD,QAAmB,CAAChJ,EAActI,KAC7CgF,EAAQ8C,aAAaQ,EAAMtI,KAG/B,aAAGkC,KACH8C,EAAQ9C,UAAYA,GAEjB8C,G,sFC/Bf,oEAAO,MAAMwN,EAYT,cACI7B,KAAK8B,eAAgB,EACrB9B,KAAK+B,gBAAkB,GACvB/B,KAAKgC,gBAAkB,GACvBhC,KAAKiC,QAAU,GAGnB,SAASC,GAWL,OAVAlC,KAAKpP,OAASsR,EAAKtR,OACnBoP,KAAKjC,SAAWmE,EAAKnE,SACrBiC,KAAKmC,UAAYD,EAAKC,UACtBnC,KAAK8B,cAAgBI,EAAKJ,cAC1B9B,KAAKrF,cAAgBuH,EAAKvH,cAC1BqF,KAAKnF,mBAAqBqH,EAAKrH,mBAC/BmF,KAAKpF,kBAAoBsH,EAAKtH,kBAC9BoF,KAAK+B,gBAAkBG,EAAKH,gBAC5B/B,KAAKgC,gBAAkBE,EAAKF,gBAErBhC,MAKR,MAAMoC,EAeT,cACIpC,KAAKpP,OAAS,MACdoP,KAAKqC,IAAM,OACXrC,KAAKjC,SAAW,UAChBiC,KAAKsC,YAAc,QACnBtC,KAAKrF,cAAgB,IACrBqF,KAAKnF,mBAAqB,IAC1BmF,KAAKpF,kBAAoB,IACzBoF,KAAKmC,UAAY,IACjBnC,KAAK8B,eAAgB,EACrB9B,KAAK+B,gBAAkB,GACvB/B,KAAKgC,gBAAkB,GACvBhC,KAAKtS,KAAO2D,SAASkR,KACrBvC,KAAKwC,cAAWC,K,mVC1EjB,MAAM,EAGT,YAAYC,GAFZ,mBACA,mBAEI,EAAA1C,KAAI,EAAU,IAAI,KAClB,EAAAA,KAAI,EAAY0C,UAAW,KAE/B,IAAI/S,EAAa0E,GACR,YAAG1E,KACJqQ,KAAK2C,IAAIhT,GACT,EAAAqQ,KAAA,GAAY4C,OAAOjT,EAAK0E,IAG5B2L,KAAK6C,QACL,EAAA7C,KAAA,GAAYW,IAAIhR,EAAK0E,KAGzB,IAAI1E,GACA,IAAK,YAAGA,GAAM,OAAO,KACrB,GAAIqQ,KAAK2C,IAAIhT,GAAM,CACf,IAAImT,EAAO,EAAA9C,KAAA,GAAY/Q,IAAIU,GAC3B,GAAImT,EAAKC,UACL,OAAOD,EAEX,EAAA9C,KAAA,GAAYY,OAAOjR,GAEvB,OAAO,KAGX,IAAIA,GACA,QAAO,YAAGA,IAAO,EAAAqQ,KAAA,GAAYgD,YAAYrT,GAG7C,OAAOA,GACH,QAAK,YAAGA,OACJqQ,KAAK2C,IAAIhT,KACT,EAAAqQ,KAAA,GAAYY,OAAOjR,IACZ,IAKf,QACI,EAAAqQ,KAAA,GAAYiD,QAGR,QACA,EAAAjD,KAAA,GAAYkD,OAAO3S,QAAU,EAAJ,SACzB,EAAAyP,KAAA,GAAYY,OAAO,EAAAZ,KAAA,GAAYkD,OAAO,K,6SC9C3C,MAAM,EAMT,YAAYC,GALZ,mBACA,mBACA,WAA0B,IAC1B,WAAyB,IAGrB,EAAAnD,KAAI,EAAS3O,SAAS+R,iBACtB,EAAApD,KAAI,EAAiBmD,GAGzB,iBAAiBtJ,EAAiBb,GAC9BgH,KAAKqD,cAAc,IAA0BxJ,MAAOA,EAAMyJ,eAC1DtD,KAAKqD,cAAc,IAA0BrK,KAAMA,EAAKsK,eAG5D,uBAAuBzJ,EAAiBb,GACpCgH,KAAKqD,cAAc,IAAgCxJ,MAAOA,EAAMyJ,eAChEtD,KAAKqD,cAAc,IAAgCrK,KAAMA,EAAKsK,eAGlE,iBAAiBzJ,EAAiBb,GAC9BgH,KAAKqD,cAAc,IAA4BxJ,MAAOA,EAAMyJ,eAC5DtD,KAAKqD,cAAc,IAA4BrK,KAAMA,EAAKsK,eAG9D,SAASC,EAAuBC,G,QAC5B,MAAMC,EAAS,IAAWF,GACpBG,EAAYF,EAAIvJ,KACtB,IAAK,YAAGwJ,KAAY,YAAGC,GACnB,OAEJ,MAAMC,EAAsB,QAAZ,EAAGH,EAAItJ,aAAK,QAAIwJ,EAAUE,QAAQC,QAAQ,EAAA7D,KAAA,IACpD8D,EAAwB,QAAb,EAAGN,EAAIrK,cAAM,QAAIuK,EAAUE,QAAQG,OAAO,EAAA/D,KAAA,IAE3D,EAAAA,KAAA,GAAmBgE,OAAO,KACtBhE,KAAKiE,YAAYR,EAAOxJ,KAAMyJ,EAAUJ,eACxCtD,KAAKiE,YAAYR,EAAOtK,OAAQ2K,EAAYR,eAC5CtD,KAAKiE,YAAYR,EAAOvJ,MAAOyJ,EAAWL,gBAC3CtD,MAIP,iBAAiBkE,GACb,EAAAlE,KAAI,EAAmB,YAAckE,EAAQ,EAAG,MAGpD,gBAAgBA,GACZ,EAAAlE,KAAI,EAAkB,YAAckE,EAAQ,EAAG,MAGnD,YAAYC,EAAsB9U,GAC9B,EAAA2Q,KAAA,GAAWoE,MAAMH,YAAYE,EAAc9U,GAG/C,cAAc8U,EAAsB9U,GAC3B,YAAIA,EAAO8U,IAGhB,EAAAnE,KAAA,GAAmBgE,OAAOhE,KAAKiE,YAAajE,KAAMmE,EAAc9U,I,wTCzCjE,MAAM,EAST,YAAYgV,EAAmBC,GAP/B,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBAEI,EAAAtE,KAAI,EAAU,IACd,EAAAA,KAAI,EAAa,IACjB,EAAAA,KAAI,EAAehS,OAAOuW,YAC1B,EAAAvE,KAAI,GAAe,GACnB,EAAAA,KAAI,EAAiB,YAAehS,OAAOuW,aAC3C,EAAAvE,KAAI,EAAcsE,UAAa,GAC/B,EAAAtE,KAAI,EAAQqE,GAGhB,QAAQxP,GACM,EAAAmL,KAAA,GAAYwE,UAAUC,GAAKA,IAAM5P,GACjC,GACN,EAAAmL,KAAA,GAAY0E,KAAK7P,GAIzB,UAAUA,GACN,IAAIgD,EAAM,EAAAmI,KAAA,GAAYwE,UAAUC,GAAKA,IAAM5P,GACvCgD,GAAO,GACP,EAAAmI,KAAA,GAAY2E,OAAO9M,EAAK,GAGhC,UACI7J,OAAO4W,iBAAiB,SAAU5E,KAAK6E,SAASjV,KAAKoQ,OAGzD,aACIhS,OAAO8W,oBAAoB,SAAU9E,KAAK6E,SAASjV,KAAKoQ,OAGpD,SAAS+E,GACb,GAAI,EAAA/E,KAAA,GACA,OAEJ,EAAAA,KAAI,GAAe,GACnB,MAAMgF,EAAOhX,OAAOuW,WAAa,EAAAvE,KAAA,GAEjC,GAAI/J,KAAKgP,IAAID,IAAS,EAAAhF,KAAA,GAAiB,CACnC,MAAMkF,EAAc,YAAelX,OAAOuW,YAC1C,GAAIW,IAAgB,EAAAlF,KAAA,GAAoB,CACpC,MAAMmF,EAA4B,CAC9BC,QAASF,EACTG,SAAU,EAAArF,KAAA,GACVpN,MAAO5E,OAAOuW,WACdrM,OAAQlK,OAAOsX,YACfC,UAAW3R,KAAK4R,OAEpB,EAAAxF,KAAA,GAAUyF,KAAK,IAAOtH,OAAQ,KAAMgH,GAChC,EAAAnF,KAAA,GAAYzP,OAAS,IACrB,EAAAyP,KAAI,EAAa,IACjB,EAAAA,KAAA,GAAY9L,QAAQuQ,IAChB,EAAAzE,KAAA,GAAe0E,KAAKD,EAAEiB,OAAOP,MAEjCpU,QAAQ4U,IAAI,EAAA3F,KAAA,IACZ,EAAAA,KAAI,EAAa,KAGrB,EAAAA,KAAI,EAAiBkF,IAG7B,EAAAlF,KAAI,GAAe,I,sVChFpB,MAAM,EAQT,YAAY4F,GADZ,mBAEI5F,KAAK6F,OAAQ,IAAI,KAAWC,SAASF,GACrC5F,KAAKmD,aAAe,IAAuBlU,IAAI2W,EAAatD,aAC5DtC,KAAK+F,MAAQ,IAAI,EAAgB/F,KAAK6F,MAAM1D,WAC5CnC,KAAKqE,IAAM,IAAmBpV,IAAI2W,EAAapD,UAC/CxC,KAAKyD,OAAS,IAAI,EAAwBzD,KAAKmD,cAC/CnD,KAAK1I,cAAgB,IAAI,IAAyB0I,KAAKmD,cACvD,EAAAnD,KAAI,EAAmB,IAAI,EAAkBA,KAAKqE,IAAKrE,KAAK6F,MAAM7D,kBAClE,EAAAhC,KAAA,GAAqBgG,UAGzB,aAAazW,GACT,MAAMZ,EAAe,YAAQqR,KAAK6F,MAAMjV,OAAQ,IAAQoI,MAClDiN,EAAU5U,SAASkR,KAAK9B,UACjB,SAATlR,GAAoB0W,EAAQvF,SAAS/R,GAKrB,UAATY,GAAoB0W,EAAQvF,SAAS/R,IAC5CqR,KAAKmD,aAAaa,OAAO,KACrBiC,EAAQrF,OAAOjS,IAChBqR,MAPHA,KAAKmD,aAAaa,OAAO,KACrBiC,EAAQtF,IAAIhS,IACbqR,MASX,eACI,MAAMrR,EAAe,YAAQqR,KAAK6F,MAAMjV,OAAQ,IAAQoI,MACxD,OAAO3H,SAASkR,KAAK9B,UAAUC,SAAS/R,GAAQ,OAAS,QAG7D,aAAauX,GACT,MAAMvX,EAAe,YAAQqR,KAAK6F,MAAMjV,OAAQ,IAAQsI,OAClD+M,EAAU5U,SAASkR,KAAK9B,UAC1ByF,IAASD,EAAQvF,SAAS/R,GAC1BsX,EAAQtF,IAAIhS,IAEJuX,GAAQD,EAAQvF,SAAS/R,IACjCsX,EAAQrF,OAAOjS,GAIvB,cACI,MAAMA,EAAe,YAAQqR,KAAK6F,MAAMjV,OAAQ,IAAQsI,OACxD,OAAO7H,SAASkR,KAAK9B,UAAUC,SAAS/R,GAG5C,YAAYA,EAAcU,GACtB,IAAImG,EAAO,YAAc7G,EAAMqR,KAAK6F,MAAMjV,QAC1CS,SAAS+R,gBAAgBgB,MAAMH,YAAYzO,EAAMnG,I,wUCrElD,MAAM8W,EAMT,YAAYC,GAJZ,mBACA,mBACA,mBACA,mBAEI,EAAApG,KAAI,EAAeoG,GACnB,EAAApG,KAAI,GAAkB,GAE1B,YAAYzH,GACR,EAAAyH,KAAI,EAAazH,GAGrB,eACI,OAAO,EAAP,QAEJ,SACSvK,OAAOuE,aAAc,EAAJ,SAA4B,EAAD,UAGjDvE,OAAOuE,WAAW,EAAD,SACZqS,iBAAiB,SAAU5E,KAAKqG,MAAMzW,KAAKoQ,OAChD,EAAAA,KAAI,GAAkB,IAG1B,SACQ,EAAJ,UACIhS,OAAOuE,WAAW,EAAD,SAAmBuS,oBAAoB,SAAU9E,KAAKqG,MAAMzW,KAAKoQ,OAClF,EAAAA,KAAI,GAAkB,IAI9B,aACI,OAAO,EAAP,QAGI,MAAM+E,GACV,IAAI,EAAJ,SAGA,EAAA/E,KAAI,GAAe,GACnB,IACI,EAAAA,KAAA,QAAAA,KAAe+E,GACjB,MAAOzR,GACLC,QAAQC,MAAMF,G,QAEd,EAAA0M,KAAI,GAAe,M,iYCxCxB,MAAMsG,EAST,YAAYzR,EAAiByP,GAR7B,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBAEI,EAAAtE,KAAI,EAAWnL,GACf,EAAAmL,KAAI,GAAe,GACnB,EAAAA,KAAI,EAAc,YAAuBsE,EAAW,EAAG,IAAK,IAC5D,EAAAtE,KAAI,IAAUA,KAAI,EAAU,IAC5B,EAAAA,KAAI,GAAe,GACnB,EAAAA,KAAI,EAAWnL,aAAkB0R,QAGrC,YAAYhO,GACR,EAAAyH,KAAI,EAAazH,GAGrB,SACI,EAAAyH,KAAA,GAAa4E,iBAAiB,SAAU5E,KAAK6E,SAASjV,KAAKoQ,OAC3D,EAAAA,KAAI,GAAe,GAGvB,SACI,EAAAA,KAAA,GAAa8E,oBAAoB,SAAU9E,KAAK6E,SAASjV,KAAKoQ,OAC9D,EAAAA,KAAI,GAAe,GAGvB,eACI,OAAO,EAAP,QAGJ,aACI,OAAO,EAAP,QAGI,SAAS+E,GACb,IAAIyB,EAAOxG,KAAKyG,UACZC,EAAM1G,KAAK2G,SACf,EAAA3G,KAAA,IAAAA,KAAA,GAAewG,GACf,EAAAxG,KAAA,IAAAA,KAAA,GAAe0G,IACX,EAAA1G,KAAA,IAAqBA,KAAK4G,oBAG9B,EAAA5G,KAAI,GAAe,GAEnB6G,sBAAsB,KAClB,EAAA7G,KAAA,QAAAA,KAAe,CACX/F,KAAM8K,EACN2B,IAAKA,EACLF,KAAMA,IAEV,EAAAxG,KAAI,GAAe,GACnB,EAAAA,KAAI,EAAU,GACd,EAAAA,KAAI,EAAU,MAId,kBACJ,OAAO,EAAAA,KAAA,IAAmB,GAAM,EAAAA,KAAA,MAAAA,KAAA,IAAkC,EAAAA,KAAA,MAAAA,KAAA,GAGtE,SACI,OAAO,EAAAA,KAAA,GAAehS,OAAO8Y,YAAc,EAAA9G,KAAA,GAAa+G,UAG5D,UACI,OAAO,EAAA/G,KAAA,GAAehS,OAAOgZ,YAAc,EAAAhH,KAAA,GAAaiH,Y,mbCvDzD,MAAMC,EAMT,YAAY7S,GALZ,mBACA,mBACA,mBACA,mBACA,mBAEI,EAAA2L,KAAI,GAAa,GACjB,EAAAA,KAAI,EAAY3L,UAAWhD,SAASkR,MACpC,EAAAvC,KAAI,GAAe,GACnB,EAAAA,KAAI,GAAmB,GACvBA,KAAKmH,YAAcnH,KAAKmH,YAAYvX,KAAKoQ,MACzCA,KAAKoH,UAAYpH,KAAKoH,UAAUxX,KAAKoQ,MACrCA,KAAKqH,YAAcrH,KAAKqH,YAAYzX,KAAKoQ,MACzCA,KAAKsH,aAAetH,KAAKsH,aAAa1X,KAAKoQ,MAC3CA,KAAKuH,WAAavH,KAAKuH,WAAW3X,KAAKoQ,MACvCA,KAAKwH,YAAcxH,KAAKwH,YAAY5X,KAAKoQ,MAE7C,YAAYzH,GACR,EAAAyH,KAAI,EAAYzH,GAEpB,eACI,OAAO,EAAP,QAEJ,eAAe2N,GACX,EAAAlG,KAAI,EAAmBkG,GAE3B,SACQ,EAAJ,UAGA,EAAAlG,KAAA,GAAc4E,iBAAiB,YAAa5E,KAAKmH,aACjD,EAAAnH,KAAA,GAAc4E,iBAAiB,UAAW5E,KAAKoH,WAC/C,EAAApH,KAAA,GAAc4E,iBAAiB,YAAa5E,KAAKqH,aACjD,EAAArH,KAAA,GAAc4E,iBAAiB,aAAc5E,KAAKsH,cAClD,EAAAtH,KAAA,GAAc4E,iBAAiB,WAAY5E,KAAKuH,YAChD,EAAAvH,KAAA,GAAc4E,iBAAiB,YAAa5E,KAAKwH,aACjD,EAAAxH,KAAI,GAAe,IAEvB,SACIzM,QAAQkU,IAAI,aACP,EAAD,UAIJ,EAAAzH,KAAA,GAAc8E,oBAAoB,YAAa9E,KAAKmH,aACpD,EAAAnH,KAAA,GAAc8E,oBAAoB,UAAW9E,KAAKoH,WAClD,EAAApH,KAAA,GAAc8E,oBAAoB,YAAa9E,KAAKqH,aACpD,EAAArH,KAAA,GAAc8E,oBAAoB,aAAc9E,KAAKsH,cACrD,EAAAtH,KAAA,GAAc8E,oBAAoB,WAAY9E,KAAKuH,YACnD,EAAAvH,KAAA,GAAc8E,oBAAoB,YAAa9E,KAAKwH,aACpD,EAAAxH,KAAI,GAAe,IAGvB,aACI,OAAO,EAAP,QAGJ,YAAY+E,GACJ,EAAJ,UAGA,EAAA/E,KAAI,GAAa,GACjBA,KAAK0H,kBAAkB,OAAQ3C,IAInC,UAAUA,GACD,EAAD,UAGJ,EAAA/E,KAAI,GAAa,GACjBA,KAAK0H,kBAAkB,KAAM3C,IAIjC,YAAYA,GACJ,EAAJ,SACI/E,KAAK0H,kBAAkB,OAAQ3C,GAOvC,aAAaA,GACL,EAAJ,UAGA,EAAA/E,KAAI,GAAa,GACjBA,KAAK2H,kBAAkB,OAAQ5C,IAGnC,WAAWA,GACF,EAAD,UAGJ,EAAA/E,KAAI,GAAa,GACjBA,KAAK2H,kBAAkB,KAAM5C,IAGjC,YAAYA,GACJ,EAAJ,SACI/E,KAAK2H,kBAAkB,OAAQ5C,GAO/B,kBAAkBxB,EAAyBwB,GAI3C,YAAG,EAAD,UACF,EAAA/E,KAAA,QAAAA,KAAc,CACVuD,KAAMA,EACNkB,EAAGM,EAAG6C,QACNC,EAAG9C,EAAG+C,QACNC,MAAOhD,EAAGiD,UACVC,MAAOlD,EAAGmD,UACVrT,OAAQkQ,EAAGlQ,OACXwR,MAAOtB,IAKX,kBAAkBxB,EAAyBwB,GAG/C,GAAI,YAAG,EAAD,SAAiB,CACnB,IAAIoD,EAAQ,KACRpD,EAAGqD,QAAQ7X,OAAS,EACpB4X,EAAQpD,EAAGqD,QAAQ,GACZrD,EAAGsD,eAAe9X,OAAS,IAClC4X,EAAQpD,EAAGsD,eAAe,IAE9B,EAAArI,KAAA,QAAAA,KAAc,CACVqG,MAAOtB,EACPxB,KAAMA,EACN1O,OAAQkQ,EAAGlQ,OACX4P,EAAG,YAAG0D,GAASA,EAAMP,SAAW,EAChCC,EAAG,YAAGM,GAASA,EAAML,SAAW,EAChCC,OAAQ,EACRE,OAAQ,M,4ZCvKjB,MAAMK,EAOT,cAHQ,KAAAC,aAAuB,EAC/B,mBAGIvI,KAAKwI,IAAMxa,OAAO6Y,sBAAsBjX,KAAK5B,QAC7CgS,KAAKyI,OAAS,GACdzI,KAAK0I,MAAQ,GACb,EAAA1I,KAAI,EAAU,GAElB,OAAOzH,EAAeoQ,KAAaC,GAC/B5I,KAAK0I,MAAMhE,KAAK1E,KAAK6I,WAAWtQ,EAAUoQ,KAAQC,IAClD5I,KAAK8I,WAGT,MAAMvQ,EAAeoQ,KAAaC,GAC9B5I,KAAKyI,OAAO/D,KAAK1E,KAAK6I,WAAWtQ,EAAUoQ,KAAQC,IACnD5I,KAAK8I,WAGD,WAAWvQ,EAAeoQ,KAAaC,GAC3C,OAAOD,GAAOC,EAAOrQ,EAAS3I,KAAK+Y,KAAQC,GAAQrQ,EAG/C,IAAIwQ,GACR,IAAIC,EAAO,KACX,KAAOA,EAAOD,EAAME,SAChBD,IAIA,SAASE,GACb,IAAKlJ,KAAKuI,YAAa,CAEnB,GADAvI,KAAKuI,aAAc,EACfW,GAAa,EAAJ,QACT,MAAM,IAAIrJ,MAAM,0BAEhBG,KAAKwI,IAAIxI,KAAKmJ,MAAMvZ,KAAKoQ,KAAMkJ,KAMnC,MAAMA,GACV,IAAIE,EAAcF,UAAa,EAC3B1V,EAAQ,KACRiV,EAASzI,KAAKyI,OACdC,EAAQ1I,KAAK0I,MAEjB,IACI1I,KAAKqJ,IAAIX,GACT1I,KAAKqJ,IAAIZ,GACX,MAAOnV,GACLE,EAAQF,EACRC,QAAQC,MAAMF,GAElB0M,KAAKuI,aAAc,EAEf/U,GACAwM,KAAK8I,SAASM,EAAM,IAEpBpJ,KAAKyI,OAAOlY,QAAUyP,KAAK0I,MAAMnY,SACjCyP,KAAK8I,SAASI,EAAY,I,cAK/B,MAAMI,EAIT,cADA,KAAAC,WAAqB,EAEjBvJ,KAAK+I,MAAQ,GACb/I,KAAKwI,IAAMxa,OAAO6Y,sBAAsBjX,KAAK5B,QAGjD,OAAOuK,EAAeoQ,KAAaC,GAC/B5I,KAAK+I,MAAMrE,KAAK1E,KAAK6I,WAAWtQ,EAAUoQ,KAAQC,IAClD5I,KAAK8I,WAGT,MAAMvQ,EAAeoQ,KAAaC,GAC9B5I,KAAK+I,MAAMrE,KAAK1E,KAAK6I,WAAWtQ,EAAUoQ,KAAQC,IAClD5I,KAAK8I,WAGD,WACC9I,KAAKuJ,YACNvJ,KAAKuJ,WAAY,EACjBvJ,KAAKwI,IAAIxI,KAAKmJ,MAAMvZ,KAAKoQ,QAIzB,QACJ,IAAIgJ,EAAO,KACX,KAAOA,EAAOhJ,KAAK+I,MAAME,SACrB,IACID,IAEJ,MAAO1V,IAGX0M,KAAKuJ,WAAY,EAGb,WAAWhR,EAAeoQ,KAAaC,GAC3C,OAAOD,GAAOC,EAAOrQ,EAAS3I,KAAK+Y,KAAQC,GAAQrQ,K,6oBCrG3D,MAAMiR,EAGF,cACIxJ,KAAKyJ,MAAQ,GACbzJ,KAAK0J,QAAS,EAElB,UAAUC,EAAgBC,GACtB,OAAQ,YAAGD,IAAY,YAAGA,IAAWA,GAAUC,GAIhD,MAAMC,UAA+BL,EAGxC,YAAYM,GACRhK,QAHJ,mBACA,mBAGI,EAAAE,KAAI,EAAa8J,GACjB,EAAA9J,KAAI,EAAQ,IAAiB/Q,IAAI,2BAG/B,OAAO8a,EAA0BC,EAAcpB,G,yCAC5C,YAAGmB,IAIR/J,KAAKyJ,MAAM/E,KAAK,CACZqF,OAAQA,EACRC,KAAMA,EACNpB,KAAMA,IAEL5I,KAAK0J,QACD1J,KAAK0J,SACN1J,KAAK0J,QAAS,EACd1J,KAAKiK,UACDjK,KAAKyJ,MAAMlZ,OAAS,UACdyP,KAAKiK,WAEfjK,KAAK0J,QAAS,IAflB,EAAA1J,KAAA,GAAU1F,QAAQ,yBAqBZ,U,yCACV,IAAI0O,EAAOhJ,KAAKyJ,MAAMR,QACtB,IAAK,IAAIrH,KAAMoH,EAAKe,OAAQ,CACxB,IAAI1D,EAAQ2C,EAAKe,OAAOnI,GACxB,IACQ5B,KAAKkK,UAAUlB,EAAKgB,KAAM3D,EAAMtP,eAC1B,EAAAiJ,KAAA,GAAemK,QAAQ9D,EAAM9N,SAAUyQ,EAAKJ,OAE1D,MAAOtV,GACH,EAAA0M,KAAA,GAAUxM,MAAMF,S,4BAMzB,MAAM8W,UAA+BZ,EAExC,YAAYM,GACRhK,QAFJ,mBAGI,EAAAE,KAAI,EAAa8J,GAGf,OAAOC,EAA0BC,EAAcpB,G,yCAC5C,YAAGmB,KAGR/J,KAAKyJ,MAAM/E,KAAK,CACZqF,OAAQA,EACRC,KAAMA,EACNpB,KAAMA,IAEL5I,KAAK0J,SACN1J,KAAK0J,QAAS,EACd1J,KAAKiK,UACDjK,KAAKyJ,MAAMlZ,OAAS,GACpByP,KAAKiK,UAETjK,KAAK0J,QAAS,OAKR,U,yCACV,IAAIV,EAAOhJ,KAAKyJ,MAAMR,QAClBoB,EAA4B,GAChC,IAAK,IAAIzI,KAAMoH,EAAKe,OAAQ,CACxB,IAAI1D,EAAQ2C,EAAKe,OAAOnI,GACpB5B,KAAKkK,UAAUlB,EAAKgB,KAAM3D,EAAMtP,QAChCsT,EAAS3F,KAAK,EAAA1E,KAAA,GAAemK,QAAQ9D,EAAM9N,SAAUyQ,EAAKJ,OAElE,OAAO7X,QAAQ4U,IAAI0E,O,cAKpB,MAAMC,EACT,WAAW3b,EAAcmb,GACrB,OAAQnb,GACJ,IAAK,SACD,OAAO,IAAIyb,EAAuBN,GACtC,QACI,OAAO,IAAID,EAAuBC,O,yWCjH3C,MAAMS,EACH,QAAQhS,EAAeqQ,G,yCACzBA,EAAOA,UAAQ,GAEfrQ,KAAYqQ,S,6DCHpB,kCAAO,MAAM4B,EAIT,YAAY7b,EAAc8b,GACtBzK,KAAKyK,MAAQA,EACbzK,KAAKtM,UAAY/E,EACjBqR,KAAK4B,GAAK,IAGd,SAAS6I,GACLzK,KAAKyK,MAAQA,EAGjB,MAAM7I,GACF5B,KAAK4B,GAAKA,EAEd,MAAMnO,EAAiBE,GACA,UAAfqM,KAAKyK,OACLlX,QAAQkU,IAAIzH,KAAK0K,WAAWjX,EAAS,QAASE,IAGtD,MAAMF,EAAiBE,GACA,UAAfqM,KAAKyK,OAAoC,UAAfzK,KAAKyK,OAAoC,YAAfzK,KAAKyK,OACzDlX,QAAQC,MAAMwM,KAAK0K,WAAWjX,EAAS,QAASE,IAGxD,QAAQF,EAAiBE,GACF,YAAfqM,KAAKyK,OAAsC,UAAfzK,KAAKyK,OACjClX,QAAQoX,KAAK3K,KAAK0K,WAAWjX,EAAS,UAAWE,IAGzD,UAAUL,EAAUK,GAChBJ,QAAQC,MAAMwM,KAAK0K,WAAW,yBAAyBpX,EAAE3E,SAAS2E,EAAEG,UAAW,YAAaE,IACzE,UAAfqM,KAAKyK,OACLlX,QAAQC,MAAMF,EAAEsX,OAGxB,YAAYrS,EAAsB5E,GAC9B,GAAmB,UAAfqM,KAAKyK,MACL,OAEJ,IAAII,EAAQjX,KAAK4R,MACjBjN,IACAhF,QAAQkU,IAAIzH,KAAK0K,WAAW,wBAAwB9W,KAAK4R,MAAQqF,MAAW,cAAelX,IAGvF,WAAWF,EAAiBgX,EAAe9W,GAC/C,MAAO,KAAI,IAAIC,MAAOC,qBAAqB4W,MAAUzK,KAAKtM,cAAcC,UAAgB,QAAQqM,KAAK4B,OAAOnO,Q,umBC9C7G,MAAMqX,EAET,YAAY3H,GADZ,mBAEI,EAAAnD,KAAI,EAAiBmD,GAGnB,cAActO,EAAiBkW,EAA6Bja,EAAiByH,G,yCAC/E,OAAO,IAAIxH,QAASC,IAChB,EAAAgP,KAAA,GAAmBgE,OAAO,KACtB+G,EAAOpK,IAAI9L,GACXA,EAAO4L,UAAUE,IAAI,IAAQ1H,cAC7BhI,WAAW,KACP,EAAA+O,KAAA,GAAmBgE,OAAO,KACtB+G,EAAOnK,OAAO/L,GACdA,EAAO4L,UAAUG,OAAO,IAAQ3H,cAC5BV,GACAA,IACJvH,GAAQ,IACT,OACJF,IACJ,WAIL,eAAe+D,EAAiBmW,EAAgCla,EAAiByH,G,yCACnF,OAAO,IAAIxH,QAASC,IAChB,EAAAgP,KAAA,GAAmBgE,OAAO,KACtBgH,EAAQ9W,QAAQuQ,GAAKA,EAAE9D,IAAI9L,IAC3BA,EAAO4L,UAAUE,IAAI,IAAQ1H,cAC7BhI,WAAW,KACP,EAAA+O,KAAA,GAAmBgE,OAAO,KACtBgH,EAAQ9W,QAAQuQ,GAAKA,EAAE7D,OAAO/L,IAC9BA,EAAO4L,UAAUG,OAAO,IAAQ3H,cAC5BV,GACAA,IACJvH,GAAQ,IACT,OACJF,IACJ,WAIL,oBAAoBma,EAAmBC,EAAoBC,EAA+BC,EAAgCC,EAAsBva,G,yCAClJ,OAAO,IAAIC,QAASC,IAChB,EAAAgP,KAAA,GAAmBgE,OAAO,KACtBmH,EAASxK,IAAIsK,GACbA,EAASxK,UAAUE,IAAI,IAAQ1H,cAC3B,YAAGiS,KACHE,EAAUzK,IAAIuK,GACdA,EAAUzK,UAAUE,IAAI,IAAQ1H,eAEpChI,WAAW,KACP,EAAA+O,KAAA,GAAmBgE,OAAO,KACtBmH,EAASvK,OAAOqK,GAChBG,EAAUxK,OAAOsK,GACjBD,EAASxK,UAAUG,OAAO,IAAQ3H,cAClCiS,EAAUzK,UAAUG,OAAO,IAAQ3H,cACnCoS,IACAra,GAAQ,IACT,OACJF,IACJ,Y,4CChEf,8CAEO,MAAMwa,EAKF,WAAW/H,GAEd,OADwBA,GAEpB,IAAK,QACD,OAAO,IAAI,IACf,QACI,OAAO,IAAI,Q,mUCXpB,MAAMgI,EAKT,YAAYrJ,GAHZ,mBACA,mBAGI,EAAAlC,KAAI,EAAS,IACb,EAAAA,KAAI,EAAW,IAEXkC,GACAA,EAAKhO,QAAQuQ,IACT,IAAK,YAAGA,EAAE9U,KAGN,MAFA,EAAAqQ,KAAI,EAAS,IACb,EAAAA,KAAI,EAAW,IACT,IAAI,IAAc,gBAE5BA,KAAKW,IAAI8D,EAAE9U,IAAK8U,EAAEpV,SAK9B,IAAIM,EAAaN,GAEb,GADA2Q,KAAKwL,gBAAgB7b,GACjBqQ,KAAKgD,YAAYrT,GACjB,MAAM,IAAIkQ,MAAM,sBACpB,EAAAG,KAAA,GAAW0E,KAAK/U,GAChB,EAAAqQ,KAAA,GAAa0E,KAAKrV,GAGtB,OAAOM,GACH,IAAK,YAAGA,GACJ,OAEJ,IAAI8b,EAAQ,EAAAzL,KAAA,GAAW0L,QAAQ/b,GAC3B8b,GAAS,IACT,EAAAzL,KAAA,GAAW2E,OAAO8G,EAAO,GACzB,EAAAzL,KAAA,GAAa2E,OAAO8G,EAAO,IAGnC,IAAI9b,GACAqQ,KAAKwL,gBAAgB7b,GACrB,IAAI8b,EAAQzL,KAAK0L,QAAQ/b,GACzB,KAAI8b,EAAQ,GAGZ,OAAO,EAAAzL,KAAA,GAAayL,GAExB,YAAY9b,GACR,OAAO,YAAGA,IAAQqQ,KAAK0L,QAAQ/b,IAAQ,EAE3C,OACI,OAAO,EAAP,QAEJ,SACI,OAAO,EAAP,QAGJ,QAAQA,GACJ,OAAO,YAAGA,GAAO,EAAAqQ,KAAA,GAAW0L,QAAQ/b,IAAQ,EAGhD,OAAOA,EAAaN,GAChB2Q,KAAKwL,gBAAgB7b,GACrB,IAAI8b,EAAQzL,KAAK0L,QAAQ/b,GACzB,GAAI8b,EAAQ,EACR,MAAM,IAAI,IAAkB,kBAAkB9b,gBAElD,EAAAqQ,KAAA,GAAayL,GAASpc,EAG1B,QACI,EAAA2Q,KAAI,EAAW,IACf,EAAAA,KAAI,EAAS,IAGT,gBAAgBrQ,GACpB,IAAK,YAAGA,GACJ,MAAM,IAAI,IAAc,iB,yqBClE7B,MAAMgc,EAKT,YAAYC,EAAmCjd,GAJ/C,mBACA,mBACA,mBACA,mBAEI,EAAAqR,KAAI,EAAW,IACf,EAAAA,KAAI,EAAiB4L,GACrB,EAAA5L,KAAI,EAASrR,UAAQ,eACrB,EAAAqR,KAAI,EAAQ,IAAiB/Q,IAAI,EAAD,UAWpC,GAAGN,EAAc4J,EAAesT,GAC5B,IAAK,YAAIld,EAAM4J,GACX,MAAM,IAAI,IAAc,oBAG5B,IAAIqJ,EAAK,EAAA5B,KAAA,GAAa,IAAM,cAM5B,OAHK,EAAAA,KAAA,GAAarR,KACd,EAAAqR,KAAA,GAAarR,GAAQ,IAErBqR,KAAK8L,WAAW,EAAA9L,KAAA,GAAarR,GAAOiT,EAAIiK,GACjC,MAEX,EAAA7L,KAAA,GAAU+L,MAAM,yBAAyBpd,YAAeiT,MAExD,EAAA5B,KAAA,GAAarR,GAAMiT,GAAM,CAAErJ,SAAUA,EAAUxB,MAAOiJ,KAAKgM,QAAQH,IAC5DjK,GAUX,OAAOjT,EAAciT,GACjB,IAAK,YAAIjT,EAAMiT,GACX,MAAM,IAAI,IAAc,oBAE5B,IAAImD,EAAK,EAAA/E,KAAA,GAAarR,GACtB,EAAAqR,KAAA,GAAU+L,MAAM,oBAAoBnK,YAAajT,MAC7CqR,KAAK8L,WAAW/G,EAAInD,WACbmD,EAAGnD,GASlB,UAAUjT,GACF,YAAGA,IAAS,EAAAqR,KAAA,GAAarR,UAClB,EAAAqR,KAAA,GAAarR,GAEpB,EAAAqR,KAAA,GAAUxM,MAAM,qCAAsC,aAWxD,KAAK6S,EAAe2D,KAAiBpB,G,yCACvC,IAAK,YAAGvC,GACJ,MAAM,IAAI,IAAc,2BAG5B,IAAI4F,EAAY,EAAAjM,KAAA,GAAaqG,GAK7B,OAJI,YAAG4F,KACH,EAAAjM,KAAA,GAAU+L,MAAM,UAAU1F,YACpB,EAAArG,KAAA,GAAmBtI,OAAO,EAAAsI,KAAA,GAAaqG,GAAQ2D,EAAMpB,KAExD,KAUX,cAAcja,EAAciT,EAAYiK,GACpC,IAAI9G,EAAK,EAAA/E,KAAA,GAAarR,GACtB,OAAOqR,KAAK8L,WAAW/G,EAAInD,EAAIiK,GAQnC,aAAaxF,EAAe2D,GACxB,IAAK,YAAI3D,EAAO2D,GACZ,OAEJ,IAAIjF,EAAK,EAAA/E,KAAA,GAAaqG,GACjB,YAAGtB,IAGR,YAAgB,OAAD,UAAMA,GAAM,CAACmH,EAAcC,KAClCA,EAAQpV,QAAUiT,UACXjF,EAAGmH,KAKd,WAAWnH,EAAsBnD,EAAYiK,GACjD,OAAI,YAAGA,GACI,YAAG9G,IAAO,YAAGnD,IAAO,YAAGmD,EAAGnD,KAAQmD,EAAGnD,GAAI7K,OAAS8U,EAAI9U,MAE1D,YAAGgO,IAAO,YAAGnD,IAAO,YAAGmD,EAAGnD,IAG7B,QAAQiK,GACZ,OAAO,YAAGA,GAAOA,EAAI9U,MAAQ,M,wDAO9B,MAAMqV,EAKT,YAAYvG,GAGR,GAPJ,mBACA,mBACA,mBACA,mBAEI,EAAA7F,KAAI,EAAQ,IAAiB/Q,IAAI,gBACjC,EAAA+Q,KAAI,EAAU,IACV,YAAG6F,GAAQ,CACX,EAAA7F,KAAA,GAAU+L,MAAM,qBACc,IAAjBlG,EAAMtV,OAAesV,EAAQA,EAAMwG,KAAK,CAACC,EAAOC,IAClDD,EAAME,SAAWD,EAAOC,WAE5BtY,QAAQ,CAAC4O,EAAM2I,KAClB,EAAAzL,KAAA,GAAY0E,KAAK1E,KAAKyM,gBAAgB3J,EAAKnU,KAAMmU,EAAKrL,UACtD,EAAAuI,KAAI,4CAEGA,KAAK0M,UAAU5J,EAAK6J,UAAWlB,KAEtC,EAAAzL,KAAA,GAAU+L,MAAM,OAAOjJ,EAAKnU,0CAA0C8c,OAG1E,EAAAzL,KAAA,GAAY0E,KAAK1E,KAAKyM,gBAAgB,kBAAmB,WACzD,EAAAzM,KAAI,EAAS,EAAAA,KAAA,GAAYzP,OAAS,GAClC,EAAAyP,KAAA,GAAU+L,MAAM,gCAYxB,GAAGpd,EAAc4J,EAAesT,GAE5B,IAAK,YAAIld,EAAM4J,GACX,MAAM,IAAI,IAAc,oBAE5B,OAAOyH,KAAK/Q,IAAIN,GAAMie,GAAGje,EAAM4J,EAAUsT,GAU7C,OAAOld,EAAciT,EAAYiK,GAC7B,IAAK,YAAIld,EAAMiT,GACX,MAAM,IAAI,IAAc,oBAE5B5B,KAAK/Q,IAAIN,GAAMke,OAAOle,EAAMiT,EAAIiK,GAQpC,UAAUld,GACNqR,KAAK/Q,IAAIN,GAAMme,UAAUne,GAUvB,KAAK0X,EAAe2D,KAAiBpB,G,yCACvC,IAAK,YAAGvC,GACJ,MAAM,IAAI,IAAc,2BAE5B,OAAOrG,KAAK/Q,IAAIoX,GAAOZ,KAAKY,EAAO2D,KAASpB,MAUhD,cAAcja,EAAciT,EAAYiK,GACpC,OAAO7L,KAAK/Q,IAAIN,GAAMoe,cAAcpe,EAAMiT,EAAIiK,GAQlD,aAAaxF,EAAe2D,GACnB,YAAI3D,EAAO2D,IAGhBhK,KAAK/Q,IAAIoX,GAAO2G,aAAa3G,EAAO2D,GAShC,gBAAgBiD,EAAiBC,GACrC,IAAK,YAAID,EAASC,GACd,MAAM,IAAI,IAAc,yCAE5B,IAAIpD,EAAW,IAAI,IACfrS,EAAU,IAA2BxI,IAAIie,EAAapD,GAC1D,OAAO,IAAI6B,EAAYlU,EAASwV,GAQ5B,UAAUlD,EAAkB0B,GAChC,OAAO1B,EAAOoD,OAAO,CAACC,EAAwBhI,IACrCgI,EAAOhI,GAMLgI,EALI,OAAP,wBACOA,GAAM,CACT,CAAChI,GAAUqG,IAIpB,IAOC,IAAIpF,GACR,IAAIxO,EAAM,EAAAmI,KAAA,GAAaqG,GACvB,OAAO,EAAArG,KAAA,GAAYnI,UAAG,Y,wDAIvB,MAAMwV,EACT,WAAWxH,GACP,OAAO,YAAGA,GAAS,IAAIuG,EAAevG,GAAS,IAAI8F,EAAY,IAAI,IAAuB,IAAI,O,+NCrS/F,MAAM2B,EAET,YAAYnK,GADZ,mBAEI,EAAAnD,KAAI,EAAiBmD,GAGzB,OAAOiB,GACH,GAAI,YAAGA,GAAQ,CACX,MAAMmJ,EAAOlc,SAASkc,MAAQlc,SAASmc,qBAAqB,QAAQ,GAC9DlX,EAAOjF,SAASC,cAAc,SAC9Bmc,EAAOpc,SAASqc,eAAetJ,GACrC9N,EAAKiN,KAAO,WACZjN,EAAKqX,YAAYF,GACjBF,EAAKI,YAAYrX,GAErB,OAAO,G,iVCpBR,MAAMsX,EAMT,YAAYC,EAAqB3K,GALjC,mBACA,mBACA,mBACA,mBACA,mBAEI,EAAAlD,KAAI,EAASkD,GACb,EAAAlD,KAAI,GAAe,GACnB,EAAAA,KAAI,GAAe,GAGvB,YAAYzH,GACR,EAAAyH,KAAI,EAAazH,GAGrB,eACI,OAAO,EAAP,QAGJ,SACIlH,SAASuT,iBAAiB,UAAW5E,KAAK8N,UAAUle,KAAKoQ,OACrD,EAAJ,SACI3O,SAASuT,iBAAiB,QAAS5E,KAAK+N,QAAQne,KAAKoQ,OAEzD,EAAAA,KAAI,GAAe,GAGvB,SACI3O,SAASyT,oBAAoB,UAAW9E,KAAK8N,UAAUle,KAAKoQ,OACxD,EAAJ,SACI3O,SAASuT,iBAAiB,QAAS5E,KAAK+N,QAAQne,KAAKoQ,OAEzD,EAAAA,KAAI,GAAe,GAGvB,aACI,OAAO,EAAP,QAGJ,UAAU+E,GACN,IAAI,EAAJ,SAGA,EAAA/E,KAAI,GAAe,GACnB,IACS,YAAG,EAAD,WAAgB,EAAAA,KAAA,GAAWhM,SAAS+Q,EAAGiJ,OAC1C,EAAAhO,KAAA,QAAAA,KAAe+E,GAGrB,MAAOzR,GACLC,QAAQC,MAAMF,G,QAET,EAAD,SACA,EAAA0M,KAAI,GAAe,KAI/B,QAAQ+E,GACJ,EAAA/E,KAAI,GAAe,I,ocCrDpB,MAAM,EAMT,YAAYiO,GALZ,KAAAC,YAAsB,mCACtB,KAAAvf,KAAe,aAEf,mBACA,mBAEIqR,KAAKkO,YAAc,yBACnBlO,KAAK6F,MAAQoI,EAGjB,KAAKzX,GACD,EAAAwJ,KAAI,EAAUxJ,GACVwJ,KAAK6F,MAAMsI,WAAsC,SAAzB,eACxB,EAAAnO,KAAA,GAAYc,aAAa,QAE7B,EAAAd,KAAI,EAAa,IAAI,IAAsB,iCAC3C,EAAAA,KAAA,GAAeoO,YAAYpO,KAAKqO,SAASze,KAAKoQ,OAC9C,EAAAA,KAAA,GAAesO,SAGnB,UACI,EAAAtO,KAAA,GAAe6M,SAGnB,SAAS9H,G,MACL,IAAIwJ,EAAiB,EAAAvO,KAAA,GAAY6F,MAAM5D,QAAQjC,KAAKkO,aACX,QAA5B,EAAGK,aAAc,EAAdA,EAAgBJ,iBAAS,WAEjCpJ,EAAGvS,QACH,EAAAwN,KAAA,GAAYc,aAAa,QAEzB,EAAAd,KAAA,GAAYc,aAAa,W,sDCzClC,MAAM0N,EACF,gBAAgBna,EAAkBoa,GAChCpa,EAAQsC,aAAa,eACtBtC,EAAQ8C,aAAa,aAAcsX,GAIpC,eAAepa,EAAkBsD,EAActI,GAC7CgF,EAAQsC,aAAagB,IACtBtD,EAAQ8C,aAAaQ,EAAMtI,GAI5B,kBAAkBgF,EAAkBsD,GACnCtD,EAAQsC,aAAagB,IACrBtD,EAAQ6M,gBAAgBvJ,I,0iBCF7B,MAAM,EAET,YAAYwL,GADZ,mBAEI,EAAAnD,KAAI,EAAiBmD,GAGzB,SAASuL,EAAara,GAClB,OAAOqa,GAAOra,EAAQoM,UAAUC,SAASgO,GAG7C,SAASA,EAAara,GAClB2L,KAAK2O,WAAW,CAACD,GAAMra,GAG3B,WAAW4R,EAAmB5R,GACtBA,GACAA,EAAQoM,UAAUE,OAAOsF,GAIjC,aAAa5R,KAAqB4R,GAC9B,EAAAjG,KAAA,GAAmBgE,OAAOhE,KAAK2O,WAAY3O,KAAMiG,EAAS5R,GAG9D,YAAYqa,EAAara,GACrB2L,KAAK4O,cAAc,CAACF,GAAMra,GAG9B,cAAc4R,EAAmB5R,GACzBA,GACAA,EAAQoM,UAAUG,UAAUqF,GAIpC,gBAAgB5R,KAAqB4R,GACjC,EAAAjG,KAAA,GAAmBgE,OAAOhE,KAAK4O,cAAe5O,KAAMiG,EAAS5R,GAGjE,gBAAgBwa,EAAuBxa,GAC/BA,GAAWA,EAAQsC,aAAakY,IAChCxa,EAAQ6M,gBAAgB2N,GAGhC,SAASxa,EAActE,EAAkBV,GACjCgF,GAAWA,EAAe,OAAK,aAAGhF,KAClCgF,EAAQ+P,MAAMrU,GAAYV,I,cAO/B,MAAM,EAST,YAAYyf,EAAuBza,EAAkBmC,GADrD,mBAEIwJ,KAAK+O,KAAO,IAAiB9f,IAAI6f,GACjC9O,KAAKxJ,MAAQA,EACbwJ,KAAK3L,QAAUA,EACf2L,KAAKgK,KAAa3V,EAAS0C,MAC3BiJ,KAAKgP,UAAW,EAChBhP,KAAK+O,KAAKE,MAAMjP,KAAKgK,MACrBhK,KAAKkP,gBAAkB,yBAAe1Y,EAAMqP,MAAMjV,QAClDoP,KAAKmP,OAAS,IAAI,EAAgB3Y,EAAM2M,cACxC,EAAAnD,KAAI,EAAkB,IAI1B,OAAOzH,KAAkBqQ,GACrB5I,KAAKxJ,MAAM2M,aAAaa,OAAOzL,EAAUyH,QAAS4I,GAGtD,MAAMrQ,KAAkBqQ,GACpB5I,KAAKxJ,MAAM2M,aAAaiM,MAAM7W,EAAUyH,QAAS4I,GAGrD,aAAaja,GACT,MAAO,CAACA,EAAMqR,KAAKgK,MAAM3X,KAAK,KAGlC,UAAUgU,KAAkBgJ,GACnB,EAAArP,KAAA,GAAoBhM,SAASqS,IAC9B,EAAArG,KAAA,GAAoB0E,KAAK2B,GAC7BrG,KAAKxJ,MAAM6N,IAAIoB,KAAKY,EAAOrG,KAAKgK,QAASqF,GAG7C,QAAQhJ,EAAe9N,GACnB,OAAOyH,KAAKxJ,MAAM6N,IAAIuI,GAAGvG,EAAO9N,EAAUyH,KAAK3L,SAGnD,YAAYgS,EAAezE,GACb,MAANA,IACA5B,KAAKxJ,MAAM6N,IAAIwI,OAAOxG,EAAOzE,GAC7BA,EAAK,MAIb,QACI,OAAO5B,KAAKgK,KAGhB,iBAAiBsF,GACb,QAAItP,KAAKgP,WACLhP,KAAK+O,KAAKzU,QAAQ,sBAAuBgV,IAClC,GAQf,WACI,OAAOtP,KAAK3L,QAAQoM,UAAUC,SAASV,KAAKkP,iBAGhD,sBACI,EAAAlP,KAAA,GAAoB9L,QAAQmS,IACxBrG,KAAKxJ,MAAM6N,IAAI2I,aAAa3G,EAAOrG,KAAKgK,MACxChK,KAAK+O,KAAKhD,MAAM,oBAAsB1F,EAAQ,2B,cAO1D,MAAe,UAA+C,EAO1D,YAAYyI,EAAuBza,EAAkBvB,EAAmB8V,EAASpS,GAC7EsJ,MAAMgP,EAAeza,EAASmC,GAFlC,mBAGIwJ,KAAK4I,KAAOA,EAEZ5I,KAAKuP,cAAgB,IAAI,mBAAiB/Y,EAAM2M,cAChDnD,KAAKwP,SAAW,KAChBxP,KAAKyP,eAAgB,EACrB,EAAAzP,KAAI,EAAclN,GAGtB,OAAO8V,GACH5I,KAAK+O,KAAKhD,MAAM,OAAQ,UACpB/L,KAAKyP,cACLzP,KAAK+O,KAAKzU,QAAQ,uCAAwC,WAG9D0F,KAAK4I,KAAKxV,MAAMwV,GACX5I,KAAK3L,QAAQoM,UAAUC,SAAS,EAAAV,KAAA,KACjCA,KAAK3L,QAAQoM,UAAUE,IAAI,EAAAX,KAAA,IAE/BA,KAAK0P,WACL1P,KAAKyP,eAAgB,GAGzB,QAAQ7G,GACJ5I,KAAK+O,KAAKhD,MAAM,SAAU,WACrB/L,KAAKyP,eAIVzP,KAAKwP,SAAW,OAAH,UAAQxP,KAAK4I,MAC1B5I,KAAK4I,KAAKxV,MAAMwV,GAChB5I,KAAK2P,aALD3P,KAAK+O,KAAKvb,MAAM,0CAA2C,WAQnE,UACIwM,KAAK+O,KAAKhD,MAAM,UAAW,WAC3B/L,KAAK4P,WACL5P,KAAK6P,sBACL7P,KAAKyP,eAAgB,G,cAYtB,MAAeK,UAA2C,EAM7D,YAAYhB,EAAuBza,EAAkBvB,EAAmB8V,EAASpS,GAC7EsJ,MAAMgP,EAAeza,EAASvB,EAAW8V,EAAMpS,GAGnD,WACIwJ,KAAK+P,SAIT,YACI/P,KAAKgQ,WAGT,WACIhQ,KAAKiQ,YAWH,cAAcjF,EAAgCla,EAAiBua,EAAsB9S,G,yCACvF,eAAUyH,KAAKuP,cAAcW,eAAelQ,KAAK3L,QAAS2W,EAASla,EAASyH,MACxE8S,KACO,OAmBZ,MAAe,UAA6E,EAW/F,YAAYyD,EAAuBza,EAAkBvB,EAAmB8V,EAASpS,GAC7EsJ,MAAMgP,EAAeza,EAASvB,EAAW8V,EAAMpS,GANnD,mBACA,mBACA,mBACA,mBACA,mBAMA,WACI,EAAAwJ,KAAI,EAAgBA,KAAKmQ,QAAQ,SAAO/R,KAAM4B,KAAKoQ,cAAcxgB,KAAKoQ,QACtE,EAAAA,KAAI,EAAiBA,KAAKmQ,QAAQ,SAAO7R,MAAO0B,KAAKqQ,eAAezgB,KAAKoQ,QACzE,EAAAA,KAAI,EAAY,wBAAsB/Q,IAAI+Q,KAAK4I,KAAK0H,UACpD,EAAAtQ,KAAI,EAAa,wBAAsB/Q,IAAI+Q,KAAK4I,KAAK2H,WACrDvQ,KAAK+P,SAIT,YACQ/P,KAAK4I,KAAK0H,UAAYtQ,KAAKwP,SAASc,SACpC,EAAAtQ,KAAI,EAAY,wBAAsB/Q,IAAI+Q,KAAK4I,KAAK0H,UAEpDtQ,KAAK4I,KAAK2H,WAAavQ,KAAKwP,SAASe,UACrC,EAAAvQ,KAAI,EAAa,wBAAsB/Q,IAAI+Q,KAAK4I,KAAK2H,WAEzDvQ,KAAKgQ,WAGT,WACIhQ,KAAKwQ,YAAY,SAAOlS,MAAO,EAAA0B,KAAA,IAC/BA,KAAKwQ,YAAY,SAAOpS,KAAM,EAAA4B,KAAA,IAC9BA,KAAKiQ,YAGH,KAAKrH,G,yCACP,OAAI5I,KAAKyQ,iBAAiB,UAGtBzQ,KAAK0Q,YACL1Q,KAAK+O,KAAKzU,QAAQ,gCACX,KAEP0F,KAAK4I,KAAK+H,UAAY,aAAG3Q,KAAK4I,KAAKgI,YACnC,EAAA5Q,KAAI,EAAoBA,KAAKmQ,QAAQ,SAAOpR,QAASiB,KAAK6Q,WAAWjhB,KAAKoQ,QAGzEA,KAAK8Q,gBAGV9Q,KAAKgP,UAAW,EACThP,KAAK+Q,cAAc,EAAA/Q,KAAA,GAAeA,KAAK4I,KAAK9X,QAASkP,KAAKgR,eAAephB,KAAKoQ,KAAMA,KAAKiR,YAAYrhB,KAAKoQ,MAAO,SAAO3B,OAAQuK,GAAO,KAC1I5I,KAAKmP,OAAO+B,SAASlR,KAAKkP,gBAAiBlP,KAAK3L,SAChDma,EAAe2C,QAAQnR,KAAK3L,QAAS,gBAAiB,gBAN1D,OAUE,MAAMuU,G,yCACR,OAAI5I,KAAKyQ,iBAAiB,WAGrBzQ,KAAK0Q,YAKV1Q,KAAKwQ,YAAY,SAAOzR,QAAS,EAAAiB,KAAA,IAC5BA,KAAKoR,iBAGVpR,KAAKgP,UAAW,EACThP,KAAK+Q,cAAc,EAAA/Q,KAAA,GAAgBA,KAAK4I,KAAK9X,QAASkP,KAAKgR,eAAephB,KAAKoQ,KAAMA,KAAKqR,aAAazhB,KAAKoQ,MAAO,SAAOzB,OAAQqK,GAAO,KAC5I5I,KAAKmP,OAAOmC,YAAYtR,KAAKkP,gBAAiBlP,KAAK3L,SACnDma,EAAe2C,QAAQnR,KAAK3L,QAAS,gBAAiB,iBAN1D,IALI2L,KAAK+O,KAAKzU,QAAQ,gCACX,OAuBT,cAAc0Q,EAAgCla,EAAiBua,EAAsB9S,G,yCACvF,eAAUyH,KAAKuP,cAAcW,eAAelQ,KAAK3L,QAAS2W,EAASla,EAASyH,MACxE8S,KACO,MAKP,cAAczC,GAClB5I,KAAKuR,KAAK3I,GAGN,eAAeA,GACnB5I,KAAKzG,MAAMqP,GAGP,eAAerQ,EAAsB8N,EAAeuC,GACxDrQ,IACAyH,KAAKwR,UAAUnL,EAAO,CAClBd,UAAW3R,KAAK4R,MAChBiM,MAAO7I,IAEX5I,KAAKgP,UAAW,EAGN,WAAWjK,G,0CACjB/E,KAAK4I,KAAK+H,UAA6B,WAAjB5L,EAAGsB,MAAM1W,KAAoB,aAAGqQ,KAAK4I,KAAKgI,WAAa7L,EAAGsB,MAAM1W,MAAQqQ,KAAK4I,KAAKgI,kBAClG5Q,KAAKzG,MAAM,sB,sEActB,MAAe,UAAkD,EAEpE,YAAYuV,EAAuBza,EAAkBvB,EAAmB8V,EAASpS,GAC7EsJ,MAAMgP,EAAeza,EAASvB,EAAW8V,EAAMpS,GAFnD,mBAGI,EAAAwJ,KAAI,EAAkB,IAAI,IAA4B3L,IACtD,EAAA2L,KAAA,GAAoB0R,WAAW1R,KAAK2R,SAAS/hB,KAAKoQ,OAGtD,WACIA,KAAK+P,SACL,EAAA/P,KAAA,GAAoB4R,UAIxB,YACI,EAAA5R,KAAA,GAAoB6R,YACpB7R,KAAKgQ,WACL,EAAAhQ,KAAA,GAAoB4R,UAGxB,WACI,EAAA5R,KAAA,GAAoB6R,YACpB7R,KAAKiQ,YAQT,SAAS6B,GACL9R,KAAK+O,KAAKhD,MAAM,mBAAoB,YACpC/L,KAAK0R,WAAWI,EAAQ3E,OAAyB,CAACC,EAA0BtK,KACtD,cAAdA,EAAKS,OAGLT,EAAKiP,WAAWxhB,OAAS,GACzB6c,EAAO4E,MAAMtN,QAAQ5B,EAAKiP,YAE1BjP,EAAKmP,aAAa1hB,OAAS,GAC3B6c,EAAO8E,QAAQxN,QAAQ5B,EAAKmP,eANrB7E,GASZ,CACC4E,MAAO,GACPE,QAAS,O,sQChbd,MAAM,EAKT,YAAYC,GAJZ,mBACA,mBACA,mBAGI,EAAAnS,KAAI,EAAYmS,GAChB,EAAAnS,KAAI,EAAU,GACd,EAAAA,KAAI,EAAa,IAAIoS,GAGzB,SAASC,GAEL,OADA,EAAArS,KAAI,EAAUqS,GACPrS,KAGX,QACI,IAAIsS,EAAU,kCAAwB,EAAAtS,KAAA,IAItC,OAHI,aAAGsS,IAAY,EAAAtS,KAAA,IACf,EAAAA,KAAA,GAAezI,OAAO+a,EAAS,EAAAtS,KAAA,IAE5BsS,G,0CAIR,MAAMF,EACT,OAAO/d,EAAkBhF,GACrB,IAAIuD,EAAQyB,EAAQsC,aAAa,SAAWpC,SAASF,EAAQe,aAAa,UAAY,GAClF8C,EAAS7D,EAAQsC,aAAa,UAAYpC,SAASF,EAAQe,aAAa,WAAa,GACzFf,EAAQ8C,aAAa,SAAUvE,EAAQvD,GAAOkjB,YAC9Cle,EAAQ8C,aAAa,UAAWe,EAAS7I,GAAOkjB,a,oPCzBjD,MAAM,EAIT,cACIvS,KAAKwS,KAAO,KACZxS,KAAKqS,MAAQ,EAEjB,MAAMhiB,GACE,YAASA,GACT2P,KAAKwS,KAAO,YAAmBniB,EAAK,KAEpC2P,KAAKwS,KAAO,YAAmBniB,EAAImiB,KAAM,IACzCxS,KAAKqS,MAAQ,YAAgBhiB,EAAIgiB,MAAO,KAM7C,MAAMI,EAET,YAAY7hB,GACRoP,KAAKlN,WAAelC,UAAU,OAAb,QAGrB,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,EAAenC,EAASmC,EAAOwJ,KAAKlN,YAMhD,MAAM,UAAuBgd,EAGhC,YAAYzb,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,iBAAkBzL,EAASvB,EAAW,IAAI,EAAe0D,GAFnE,mBAGI,EAAAwJ,KAAI,EAAgB,MAIxB,SAC8B,OAAtB,EAAAA,KAAA,IAIJA,KAAK0S,QAAQ1S,KAAK4I,KAAK4J,MACvB,EAAAxS,KAAI,EAAgBA,KAAK4I,KAAK4J,OAJ1BxS,KAAK+O,KAAKhD,MAAM,4BAOxB,WACQ/L,KAAK4I,KAAK4J,OAAS,EAAAxS,KAAA,KAGvBA,KAAK0S,QAAQ1S,KAAK4I,KAAK4J,MACvB,EAAAxS,KAAI,EAAgBA,KAAK4I,KAAK4J,OAGlC,YACI,MAAMG,EAAM3S,KAAK3L,QAAQue,cAAc,OACnC,YAAGD,IACHA,EAAI/R,SAER,EAAAZ,KAAI,EAAgB,MAGhB,QAAQwS,GACZ,MAAMK,EAAUL,EAAO,IAAMA,GAAQ,KACrC,IAAKK,EACD,OAEJ,MAAMC,EAAU,IAAI,EAAYD,GAASE,SAAS/S,KAAK4I,KAAKyJ,OAAOW,QAC7DL,EAAM3S,KAAK3L,QAAQue,cAAc,OACnC,YAAGD,IACHA,EAAI/R,SAGJZ,KAAK3L,QAAQ4e,WAAW1iB,OAAS,EACjCyP,KAAKgE,OAAOhE,KAAKkT,aAAcJ,GAE/B9S,KAAKgE,OAAOhE,KAAK2N,YAAamF,GAI9B,aAAaK,GACjBnT,KAAK3L,QAAQ6e,aAAaC,EAAanT,KAAK3L,QAAQ+e,YAGhD,YAAYD,GAChBnT,KAAK3L,QAAQsZ,YAAYwF,I,2QCxF1B,MAAM,GAET,cACInT,KAAKqT,SAAW,EAGpB,MAAMhjB,GACG,YAAGA,GAGC,YAASA,GACd2P,KAAKqT,SAAW,YAAgBhjB,EAAK,GAErC2P,KAAKqT,SAAW,YAAgBhjB,EAAIgjB,SAAU,GAL9CrT,KAAKqT,SAAW,GAYrB,MAAM,GAET,YAAYziB,GACRoP,KAAKlN,WAAalC,UAAU,OAAS,mBACrC,IAA+B,wBAAI,kWAGvC,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,YAIlD,MAAM,WAAyBgd,EAMlC,YAAYzb,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAiB0D,GANvE,mBACA,mBACA,mBACA,mBACA,mBAGI,EAAAwJ,KAAI,IAAWA,KAAI,EAAS,IAC5B,EAAAA,KAAI,EAAS,MACb,EAAAA,KAAI,EAASlN,GACb,EAAAkN,KAAI,EAAoB,MAG5B,SACI,MAAM8S,EAAU,IAAI,EAAY,IAA+B,yBAAGE,QAC5DL,EAAM3S,KAAK3L,QAAQue,cAAc,OACnC,YAAGD,IACHA,EAAI/R,SAERZ,KAAK3L,QAAQsZ,YAAYmF,GACzB,EAAA9S,KAAI,EAASA,KAAK3L,QAAQue,cAAc,0BACxC,EAAA5S,KAAI,EAAS,GAAAA,KAAA,GAAWsT,kBACxB,EAAAtT,KAAI,EAAW,GAAAA,KAAA,GAAa,KAC5BA,KAAKoP,MAAMpP,KAAKuT,WAChB,EAAAvT,KAAI,EAAoBA,KAAKmQ,QAAQ,IAAOhR,gBAAiBa,KAAKwT,cAAc5jB,KAAKoQ,QAGzF,WACIA,KAAKoP,MAAMpP,KAAKuT,WAChBvT,KAAKwR,UAAU,IAAOpS,iBAAkB,CACpCmG,UAAW3R,KAAK4R,MAChB6N,SAAUrT,KAAK4I,KAAKyK,WAI5B,YACIrT,KAAKwQ,YAAY,IAAOrR,gBAAiB,GAAAa,KAAA,IAG7C,cAAc3P,GACN,YAAGA,IACH2P,KAAK3L,QAAQ8C,aAAa,GAAA6I,KAAA,GAAY3P,GAItC,YAAYhB,GAChB,GAAA2Q,KAAA,GAAWoE,MAAMqP,iBAAmBpkB,EAGhC,YACJ,GAAI2Q,KAAKwP,UAAYxP,KAAK4I,KAAKyK,WAAarT,KAAKwP,SAAS6D,SACtD,OAEJ,MAAMA,EAAW,YAAcrT,KAAK4I,KAAKyK,SAAU,EAAG,KAEtDrT,KAAKgE,OAAOhE,KAAK0T,YAAa,GAAA1T,KAAA,GAAa,GAAAA,KAAA,GAAeqT,I,mUCjG3D,MAAM,GAGT,cACIrT,KAAK2T,QAAU,SACf3T,KAAKqS,MAAQ,EAGjB,MAAMzJ,GACE,YAASA,GACT5I,KAAK2T,QAAU,YAAmB/K,EAAM,WAExC5I,KAAK2T,QAAU,YAAmB/K,EAAK+K,QAAS,UAChD3T,KAAKqS,MAAQ,YAAgBzJ,EAAKyJ,MAAO,KAM9C,MAAM,GAGT,YAAYzhB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,WACjB,IAAsB,eAAI,2TAC1B,IAA6B,sBAAI,8cAGrC,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAkBnC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAI9D,MAAM,WAA0B8P,EAGnC,YAAYzb,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,oBAAqBzL,EAASvB,EAAW,IAAI,GAAkB0D,GAHzE,oBACA,oBAGI,GAAAwJ,KAAI,GAAiB,MACrB,GAAAA,KAAI,GAAwB,YAAc,2BAA4BpP,IAG1E,SACI,GAAAoP,KAAI,GAAiBA,KAAKmQ,QAAQ,IAAO1Q,MAAOO,KAAK4T,QAAQhkB,KAAKoQ,QAClEA,KAAKW,MAGT,WACQX,KAAK4I,KAAK+K,UAAY3T,KAAKwP,SAASmE,SACpC3T,KAAKW,MAIb,YACIX,KAAK6T,sBACL7T,KAAKwQ,YAAY,IAAO/Q,MAAO,GAAAO,KAAA,KAG3B,WAAWmT,EAAsBxkB,GACrCqR,KAAK3L,QAAQsZ,YAAYwF,GACzBnT,KAAK3L,QAAQoM,UAAUE,IAAI,qBAAqBhS,GAG5C,MACJ,MAAMmlB,EAAU,YAAG9T,KAAK4I,KAAK+K,SAAW,IAAM,WAAW3T,KAAK4I,KAAK+K,SAAa,KAChF,IAAK,YAAGG,GAEJ,YADA9T,KAAK+O,KAAKzU,QAAQ,2BAA6B0F,KAAK4I,KAAK+K,SAG7D3T,KAAK6T,sBACL,MAAMV,EAAc,IAAI,EAAYW,GAASf,SAAS/S,KAAK4I,KAAKyJ,OAAOW,QACvEhT,KAAKgE,OAAOhE,KAAK+T,WAAYZ,EAAanT,KAAK4I,KAAK+K,SAGhD,sBACJ,IAAIK,EAAWhU,KAAK3L,QAAQue,cAAc,OACtCoB,GACAA,EAASpT,SAKT,QAAQsF,GACZlG,KAAKoP,MAAM,KACHlJ,IAASlG,KAAKmP,OAAO8E,SAAS,GAAAjU,KAAA,IAA2BA,KAAK3L,SAC9D2L,KAAKmP,OAAO+E,aAAalU,KAAK3L,QAAS,GAAA2L,KAAA,KAEvCA,KAAKmP,OAAOgF,gBAAgBnU,KAAK3L,QAAS,GAAA2L,KAAA,OAGlDA,KAAKwR,UAAU,IAAO9R,OAAQwG,I,gKClG/B,MAAMkO,GAET,cACIpU,KAAKlN,UAAY,YAGrB,WACI,OAAO,KAGX,IAAIuB,EAAkBmC,GAClB,OAAO,IAAI,GAAgBnC,EAASmC,EAAOwJ,KAAKlN,YAIjD,MAAM,WAAwB,EAGjC,YAAYuB,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,kBAAmBzL,EAASmC,GAFtC,oBAII,GAAAwJ,KAAI,GAAclN,GAGtB,OAAO8V,IAIP,QAAQA,IAIR,Y,yQCrBG,MAAM,GAET,YAAYhY,GACRoP,KAAKlN,UAAY,YAAGlC,GAAUA,EAAS,SAAW,aAGtD,WACI,OAAO,KAGX,IAAIyD,EAAsBmC,GACtB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,YAUlD,MAAM,GAKT,cACIkN,KAAKnL,OAAS,KACdmL,KAAKjI,OAAS,KACdiI,KAAKqU,SAAW,OAGpB,MAAMhkB,GACF2P,KAAKnL,OAAS,YAAmBxE,EAAIwE,OAAQ,IAC7CmL,KAAKjI,OAAS,YAAmB1H,EAAI0H,OAAQ,IAC7CiI,KAAKqU,SAAW,YAAGhkB,EAAIgkB,WAA4C,WAA/BhkB,EAAIgkB,SAAS/e,cAA6B,SAAW,QAM1F,MAAM,WAAyBwa,EAGlC,YAAYzb,EAAsBmC,EAAiB1D,GAC/CgN,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAiB0D,GAHvE,oBACA,oBAGIwJ,KAAK3L,QAAUA,EACf,GAAA2L,KAAI,GAAW,MACf,GAAAA,KAAI,GAAW,MAGnB,SACIA,KAAK3L,QAAQuQ,iBAAiB,QAAS5E,KAAKsU,QAAQ1kB,KAAKoQ,OACzDA,KAAKuU,aAET,WACIvU,KAAKuU,aAET,YACIvU,KAAK3L,QAAQyQ,oBAAoB,QAAS9E,KAAKsU,QAAQ1kB,KAAKoQ,OAGhE,QAAQ+E,GACJ,IAAK,YAAG,GAAA/E,KAAA,KACJ,OAEJ,IAAIwU,EAAK,YAAa,GAAAxU,KAAA,KAAgB,GAAAA,KAAA,IAAa1L,UAE/CmgB,EAAKD,EADE,GAAAxU,KAAA,IAAa+G,UAExB,GAAA/G,KAAA,IAAa0U,SAAS,CAClBhO,IAAK+N,EACLJ,SAAUrU,KAAK4I,KAAKyL,WAExBrU,KAAKwR,UAAU,IAAO5S,UAAW,CAC7B4V,GAAIA,EACJC,GAAIA,EACJ5f,OAAQ,GAAAmL,KAAA,IACRjI,OAAQ,GAAAiI,KAAA,IACRuF,UAAW3R,KAAK4R,QAEpBT,EAAG4P,iBAGC,aACJ,GAAA3U,KAAI,GAAW3O,SAASuhB,cAAc5S,KAAK4I,KAAK/T,SAC5C,YAAG,GAAAmL,KAAA,MACH,GAAAA,KAAI,GAAW,YAAGA,KAAK4I,KAAK7Q,QAAU1G,SAASuhB,cAAc5S,KAAK4I,KAAK7Q,QAAU,GAAAiI,KAAA,IAAahI,gB,mUCnFnG,MAAM,GAOT,cACIgI,KAAK4U,OAAS,EAElB,MAAMhM,GACF,IAAKA,EAAKiM,SACN,MAAM,IAAIhV,MAAM,uBAEpBG,KAAK6U,SAAWjM,EAAKiM,SACrB7U,KAAK+K,OAAS,KAAiB9b,IAAI2Z,EAAKmC,QACxC/K,KAAK8U,KAAOlM,EAAKkM,KACjB9U,KAAK+U,WAAa,KAAiB9lB,IAAI2Z,EAAKmM,YAC5C/U,KAAK4U,OAAS,YAAuBrgB,SAASqU,EAAKgM,SAAU,EAAG,EAAG,IAGpE,MAAMI,GAET,YAAYpkB,GACRoP,KAAKlN,WAAelC,UAAU,OAAb,aAGrB,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,GAAoBnC,EAASmC,EAAOwJ,KAAKlN,YAIrD,MAAM,WAA4Bgd,EAUrC,YAAYzb,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,sBAAuBzL,EAASvB,EAAW,IAAI,GAAoB0D,GAT7E,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAGIwJ,KAAK3L,QAAUA,EACf,GAAA2L,KAAI,GAAa,IAAI,KAAkBA,KAAK3L,QAAS2L,KAAKxJ,MAAMqP,MAAM9D,kBACtE,GAAA/B,KAAI,GAAU,IACd,GAAAA,KAAI,GAAY,IAChB,GAAAA,KAAI,MAAeA,KAAI,MAAkBA,KAAI,IAAiB,KAGlE,SACI,GAAAA,KAAI,GAAkBA,KAAK3L,QAAQ0S,WACnC,GAAA/G,KAAI,GAAmBA,KAAK3L,QAAQ4S,YACpCjH,KAAK7K,iBACL,IAAIiQ,EAAUpF,KAAKiV,iBAAiB,GAAAjV,KAAA,KACpCA,KAAKkV,WAAW9P,GAChBpF,KAAKmV,eAAe/P,GAAU,GAC9B,GAAApF,KAAI,GAAeoF,GACnB,GAAApF,KAAA,IAAeoO,YAAYpO,KAAKoV,SAASxlB,KAAKoQ,OAC9C,GAAAA,KAAA,IAAesO,SAGnB,WACI,GAAAtO,KAAI,GAAkBA,KAAK3L,QAAQ0S,WACnC,GAAA/G,KAAI,GAAmBA,KAAK3L,QAAQ4S,YACpCjH,KAAK7K,iBACL6K,KAAKiV,iBAAiB,GAAAjV,KAAA,KAG1B,YACI,GAAAA,KAAA,IAAe6M,SAGX,SAAS9H,GACb,IAAIlN,GAAO,EAMX,GAJIA,EADA5B,KAAKgP,IAAIF,EAAGyB,KAAO,GAAAxG,KAAA,KAAwB/J,KAAKgP,IAAIF,EAAG2B,IAAM,GAAA1G,KAAA,KACvDA,KAAKqV,qBAAqBtQ,EAAGyB,MAE7BxG,KAAKiV,iBAAiBlQ,EAAG2B,KAE/B7O,IAAQ,GAAAmI,KAAA,IAAkB,CAC1B,IAAIsV,EAAYtV,KAAKkV,WAAWrd,GAChCmI,KAAKmV,eAAetd,EAAK,GAAAmI,KAAA,KACzB,GAAAA,KAAI,GAAenI,GACnBmI,KAAKwR,UAAU,IAAO3S,cAAe,CACjC6H,IAAK3B,EAAG2B,IACRF,KAAMzB,EAAGyB,KACT3R,OAAQygB,EACR/P,UAAW3R,KAAK4R,QAIxB,GAAAxF,KAAI,GAAkBA,KAAK3L,QAAQ0S,WACnC,GAAA/G,KAAI,GAAmBA,KAAK3L,QAAQ4S,YAGhC,iBACJ,GAAAjH,KAAI,GAAY,IAAIA,KAAK3L,QAAQkhB,iBAAiBvV,KAAK4I,KAAKiM,YAC5D,GAAA7U,KAAI,GAAUA,KAAK4I,KAAKkM,KAAO,IAAIzjB,SAASkkB,iBAAiBvV,KAAK4I,KAAKkM,OAAS,IAChF,GAAA9U,KAAI,GAAkB,GAAAA,KAAA,IAAczP,QACpC,GAAAyP,KAAI,GAAgB,GAAAA,KAAA,IAAYzP,QAG5B,iBAAiBilB,GACrB,OAAO,GAAAxV,KAAA,IAAcwE,UAAW3P,IAC5B,IAAI+f,EAAS,YAAa/f,GAAgBmL,KAAK3L,QAASC,UACpDmhB,EAAQb,EAAS5U,KAAK4I,KAAKgM,OAC/B,OAAOA,EAASa,GAASD,GAAUA,EAASZ,EAAS/f,EAAO6gB,aAAeD,IAI3E,qBAAqBD,GACzB,OAAO,GAAAxV,KAAA,IAAcwE,UAAW3P,IAC5B,IAAI+f,EAAS,YAAc/f,GAAgBmL,KAAK3L,QAASK,WACrD+gB,EAAQb,EAAS5U,KAAK4I,KAAKgM,OAC/B,OAAOA,EAASa,GAASD,GAAUA,EAASZ,EAAS/f,EAAO8gB,YAAcF,IAW1E,WAAW5d,GACf,IAAK,YAAUA,EAAK,EAAG,GAAAmI,KAAA,KACnB,MAAM,IAAI,KAA4B,sCAE1C,IAAIjN,EAAM,GAAAiN,KAAA,IAAcnI,GAGxB,OAFAmI,KAAK4I,KAAKmC,OAAOpK,IAAI5N,GACrBiN,KAAK4I,KAAKmC,OAAOnK,OAAO,GAAAZ,KAAA,OAAAA,KAAA,MACjBjN,EAGH,eAAe8E,EAAa+d,GAC5B,GAAA5V,KAAA,IAAoB,IAChB,YAAUnI,EAAK,EAAG,GAAAmI,KAAA,MAClBA,KAAK4I,KAAKmM,WAAWpU,IAAI,GAAAX,KAAA,IAAYnI,IAErC,YAAU+d,EAAM,EAAG,GAAA5V,KAAA,MACnBA,KAAK4I,KAAKmM,WAAWnU,OAAO,GAAAZ,KAAA,IAAY4V,M,kXC5JjD,MAAM,GAMT,YAAYC,GALZ,KAAA3H,YAAsB,kBACtB,KAAAvf,KAAe,aAEf,oBACA,oBAEIqR,KAAKkO,YAAc,yBACnBlO,KAAK6F,MAAQgQ,EAGjB,KAAKrf,GACD,GAAAwJ,KAAI,GAAUxJ,GACVwJ,KAAK6F,MAAMiQ,WAAa,eACxB,GAAA9V,KAAA,IAAY+V,cAAa,GAE7B,GAAA/V,KAAI,GAAa,IAAI,IAAsB,UAC3C,GAAAA,KAAA,IAAeoO,YAAYpO,KAAKqO,SAASze,KAAKoQ,OAC9C,GAAAA,KAAA,IAAesO,SAGnB,UACI,GAAAtO,KAAA,IAAe6M,SAGnB,SAAS9H,G,QACL/E,KAAK6F,MAAQ,GAAA7F,KAAA,IAAY6F,MAAM5D,QAAQjC,KAAKkO,aACP,QAAxB,EAAa,QAAb,EAAGlO,KAAK6F,aAAK,eAAEiQ,iBAAS,WAEjCviB,QAAQkU,IAAI1C,EAAGvS,SACXuS,EAAGvS,QACH,GAAAwN,KAAA,IAAY+V,cAAa,GAEzB,GAAA/V,KAAA,IAAY+V,cAAa,K,2RCrBlC,MAAMC,GAKT,YAAYtoB,EAAe4W,GAH3B,oBACA,oBACA,oBAEI,GAAAtE,KAAI,GAAStS,GACb,GAAAsS,KAAI,GAAcsE,UAAa,CAAC,EAAG,GAAK,GAAK,GAAK,GAAK,GAAK,GAAK,GAAK,GAAK,GAAK,IAGpF,YAAY/L,GACR,GAAAyH,KAAI,GAAazH,GAGrB,UACIyH,KAAKiW,SAAW,IAAIC,qBAAqB,GAAAlW,KAAA,IAAgB,CACrDtS,KAAM,GAAAsS,KAAA,IACNmW,WAAY,MACZ7R,UAAW,GAAAtE,KAAA,MAInB,QAAQnL,GACJmL,KAAKiW,SAASrE,QAAQ/c,GAG1B,UAAUA,GACNmL,KAAKiW,SAASpE,UAAUhd,GAG5B,aACImL,KAAKiW,SAASG,c,uSClCf,MAAM,GAIT,cACIpW,KAAKnL,OAAS,MACdmL,KAAK+K,OAAS,KAAiB9b,IAAI,SACnC+Q,KAAK4U,OAAS,EAGlB,MAAMhM,GACF5I,KAAKnL,OAAS,YAAG+T,EAAK/T,QAAU+T,EAAK/T,OAAS,MAC9CmL,KAAK+K,OAAS,YAAGnC,EAAKmC,QAAU,KAAiB9b,IAAI2Z,EAAKmC,QAAU,KAAiB9b,IAAI,SACzF+Q,KAAK4U,OAAS,YAAuBrgB,SAASqU,EAAKgM,QAAS,EAAG,EAAG,IAInE,MAAMyB,GAET,YAAYzlB,GACRoP,KAAKlN,WAAelC,UAAU,OAAb,gBAGrB,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,GAAuBnC,EAASmC,EAAOwJ,KAAKlN,YAIxD,MAAM,WAA+Bgd,EAIxC,YAAYzb,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,yBAA0BzL,EAASvB,EAAW,IAAI,GAA6B0D,GAHzF,oBACA,oBAGI,GAAAwJ,KAAI,GAAa,IAAIgW,GAAwBhW,KAAK3L,UAClD,GAAA2L,KAAI,GAAY,IAGpB,SACIA,KAAKsW,iBACL,GAAAtW,KAAA,IAAeoO,YAAYpO,KAAKuW,eAAe3mB,KAAKoQ,OACpD,GAAAA,KAAA,IAAegG,UACf,GAAAhG,KAAA,IAAc9L,QAAQW,IAClB,GAAAmL,KAAA,IAAe4R,QAAQ/c,KAI/B,WACImL,KAAKsW,iBAGT,YACI,GAAAtW,KAAA,IAAeoW,aAGnB,iBAC0B,OAAlBpW,KAAKwP,UAAqBxP,KAAKwP,SAAS3a,SAAWmL,KAAK4I,KAAK/T,QAC7D,GAAAmL,KAAI,GAAY,IAAI3O,SAASkkB,iBAAiBvV,KAAK4I,KAAK/T,UAIhE,eAAe2hB,EAAsCP,GACjD,IAAK,YAAG,GAAAjW,KAAA,KACJ,OAEJ,IAAI+K,EAAS,KACbyL,EAAQtiB,QAAQuiB,IACZ1L,EAAS/K,KAAK0W,UAAUD,EAAM5hB,QAC1B4hB,EAAME,gBAAkBF,EAAMG,mBAAqB5W,KAAK4I,KAAKgM,OAC7D7J,EAAOpK,IAAI8V,EAAM5hB,QAEjBkW,EAAOnK,OAAO6V,EAAM5hB,QAExBmL,KAAK6W,iBAAiBJ,KAI9B,UAAUpiB,GACN,OAAOA,EAAQsC,aAAa,UAAY,KAAiB1H,IAAIoF,EAAQe,aAAa,WAAa4K,KAAK4I,KAAKmC,OAG7G,iBAAiB0L,GACbzW,KAAKwR,UAAU,IAAO1S,aAAc,CAChC2X,MAAOA,EACP7B,OAAQ5U,KAAK4I,KAAKgM,OAClBrP,UAAW3R,KAAK4R,S,kkBCpGrB,MAAM,GAQT,YAAY1U,GADZ,oBAEIkP,KAAKnL,OAAS,GACdmL,KAAK+K,YAAStI,EACdzC,KAAKlP,QAAU,EACfkP,KAAK8W,SAAU,EACf9W,KAAKyR,MAAQ,GACb,GAAAzR,KAAI,GAAelP,GAGvB,MAAM8X,GACF,GAAI,YAAGA,IAAS,YAASA,GAMrB,OALA5I,KAAKnL,OAAS+T,EACd5I,KAAK+K,OAASnC,EAAKoC,QACnBhL,KAAKlP,QAAU,GAAAkP,KAAA,IACfA,KAAK8W,SAAU,OACf9W,KAAKyR,MAAQ,IAGjBzR,KAAKnL,OAAS,YAAmB+T,EAAK/T,OAAQ,MAC9CmL,KAAK+K,OAASnC,EAAKmC,OACnB/K,KAAKlP,QAAU,YAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAK8W,QAAU,YAAalO,EAAKkO,SACjC9W,KAAKyR,MAAQ7I,EAAK6I,O,eAInB,MAAMsF,GAGT,YAAYnmB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,QAGrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAenC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAI3D,MAAM,WAAuB8P,EAEhC,YAAYzb,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,iBAAkBzL,EAASvB,EAAW,IAAI,GAAY0D,EAAMqP,MAAMlL,eAAgBnE,GAF5F,oBAGI,GAAAwJ,KAAI,GAAY,MAChBA,KAAKsU,QAAUtU,KAAKsU,QAAQ1kB,KAAKoQ,MAGrC,SACIA,KAAK3L,QAAQuQ,iBAAiB,QAAS5E,KAAKsU,SAC5C,GAAAtU,KAAI,GAAYA,KAAKmQ,QAAQ,IAAO/R,KAAM4B,KAAKgX,OAAOpnB,KAAKoQ,QAG/D,YAIA,YACIA,KAAK3L,QAAQyQ,oBAAoB,QAAS9E,KAAKsU,SAC/CtU,KAAKwQ,YAAY,IAAOpS,KAAM,GAAA4B,KAAA,KAGlC,QAAQ+E,GACJ/E,KAAKgX,OAAOjS,GACR/E,KAAK4I,KAAKkO,SACV/R,EAAG4P,iBAIX,OAAO5P,GACH,GAAI/E,KAAKgP,SACL,OAEJ,MAAMna,EAASmL,KAAKiX,UAAUjX,KAAK4I,KAAK/T,QACnC,YAAGA,IAIRmL,KAAKgP,UAAW,EAChBhP,KAAKqJ,IAAIxU,GAAQqiB,KAAM9J,IACnBpN,KAAKmX,eAAepS,EAAIlQ,EAAQuY,KACjCgK,MAAO9jB,IACN0M,KAAK+O,KAAKsI,UAAU/jB,KACrBgkB,QAAQ,KACPtX,KAAKgP,UAAW,KAThBhP,KAAK+O,KAAKzU,QAAQ,UAAU0F,KAAK4I,KAAK/T,mBAAoB,WAiBpD,IAAIA,G,0CACd,IAAI0iB,EAAS1iB,EAAekC,MAC5B,GAAI,YAAGwgB,GAGH,OAFAvX,KAAK+O,KAAKhD,MAAM,4BACV/L,KAAKxJ,MAAM6N,IAAIoB,KAAK,IAAOrH,KAAMmZ,EAAOvX,KAAK4I,KAAK6I,QACjD,EAGP,GADAzR,KAAK+O,KAAKhD,MAAM,uBACZ,YAAI/L,KAAK4I,KAAK9X,QAASkP,KAAK4I,KAAKmC,QAAS,CAC1C/K,KAAK+O,KAAKhD,MAAM,qBAChB,IAAIf,EAAU,KAAsB/b,IAAI+Q,KAAK4I,KAAKmC,QAIlD,aAHM/K,KAAKuP,cAAcW,eAAerb,EAAQmW,EAAShL,KAAK4I,KAAK9X,QAAS,KACxEkP,KAAKwX,eAAe3iB,MAEjB,EAGX,OADAmL,KAAKyX,oBAAoB5iB,IAClB,KAIP,eAAeA,GACf,YAAGA,KAAYmL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiBra,IAC1DmL,KAAKmP,OAAO+B,SAASlR,KAAKkP,gBAAiBra,GAI3C,oBAAoBA,GACxBmL,KAAKoP,MAAM,KACH,YAAGva,KAAYmL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiBra,IAC1DmL,KAAKmP,OAAO+E,aAAarf,EAAQmL,KAAKkP,mBAM1C,eAAenK,EAAgBlQ,EAAiB6iB,GAChD,YAAG7iB,KAAYmL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiBra,IAC1DmL,KAAKmP,OAAO+E,aAAarf,EAAQmL,KAAKkP,iBAEtCwI,GACA1X,KAAK2X,SAAS5S,GAGd,SAASA,GACb/E,KAAKwR,UAAU,IAAOnT,OAAQ,CAC1BgI,MAAOtB,EACP0M,MAAOzR,KAAK4I,KAAK6I,MACjBlM,UAAW3R,KAAK4R,QAIhB,UAAU3Q,GACd,GAAI,YAAGA,GACH,OAAOxD,SAASuhB,cAAc/d,GAElC,IAAIkD,EAASiI,KAAK3L,QAAQ2D,cACtBoV,EAAS,YAAGrV,GAAUA,EAAOwd,iBAAiB,IAAI,aAAqB9S,EAC3E,OAAK2K,GAAUA,EAAO7c,OAAS,OAA/B,EAIO,YAAiB,IAAI6c,GAAUwK,GAC3BA,IAAO5X,KAAK3L,U,mjBCrKxB,MAAM,GAQT,YAAYvD,GAFZ,oBAGIkP,KAAKnL,OAAS,GACdmL,KAAK+K,OAAS,KACd/K,KAAKlP,QAAUA,EACfkP,KAAK8W,SAAU,EACf9W,KAAKyR,MAAQ,KACb,GAAAzR,KAAI,GAAelP,GAGvB,MAAM8X,GACF,GAAI,YAAGA,IAAS,YAASA,GAMrB,OALA5I,KAAKnL,OAAS+T,EACd5I,KAAK+K,OAAS,KACd/K,KAAKlP,QAAU,GAAAkP,KAAA,IACfA,KAAK8W,SAAU,OACf9W,KAAKyR,MAAQ,MAGjBzR,KAAKnL,OAAS,YAAmB+T,EAAK/T,OAAQ,MAC9CmL,KAAK+K,OAASnC,EAAKmC,OACnB/K,KAAKlP,QAAU,YAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAK8W,QAAUlO,EAAKkO,SAAW,YAAalO,EAAKkO,SACjD9W,KAAKyR,MAAQ7I,EAAK6I,O,eAInB,MAAMoG,GAIT,YAAYjnB,GAFZ,oBAGI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,SAIrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAgBnC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAI5D,MAAM,WAAwB8P,EAEjC,YAAYzb,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,kBAAmBzL,EAASvB,EAAW,IAAI,GAAa0D,EAAMqP,MAAMlL,eAAgBnE,GAF9F,oBAGI,GAAAwJ,KAAI,GAAY,MAChBA,KAAKsU,QAAUtU,KAAKsU,QAAQ1kB,KAAKoQ,MAGrC,SACIA,KAAK3L,QAAQuQ,iBAAiB,QAAS5E,KAAKsU,SAC5C,GAAAtU,KAAI,GAAYA,KAAKmQ,QAAQ,IAAO7R,MAAO0B,KAAK8X,QAAQloB,KAAKoQ,QAGjE,YAGA,YACIA,KAAK3L,QAAQyQ,oBAAoB,QAAS9E,KAAKsU,SAC/CtU,KAAKwQ,YAAY,IAAOlS,MAAO,GAAA0B,KAAA,KAGnC,QAAQ+E,GACJ/E,KAAK8X,QAAQ/S,GACT/E,KAAK4I,KAAKkO,SACV/R,EAAG4P,iBAGX,QAAQ5P,GACJ,GAAI/E,KAAKgP,SACL,OAEJ,MAAMna,EAASmL,KAAKiX,YACf,YAAGpiB,IAIRmL,KAAKgP,UAAW,EAChBhP,KAAKqJ,IAAIxU,GAAQqiB,KAAM9J,IACnBpN,KAAKgR,eAAejM,EAAIqI,KACzBgK,MAAO9jB,IACN0M,KAAK+O,KAAKsI,UAAU/jB,KACrBgkB,QAAQ,KACPtX,KAAKgP,UAAW,KAThBhP,KAAK+O,KAAKzU,QAAQ,UAAU0F,KAAK4I,KAAK/T,mBAAoB,WAapD,IAAIA,G,0CACd,IAAI0iB,EAAS1iB,EAAekC,MAC5B,GAAI,YAAGwgB,GAEH,aADMvX,KAAKxJ,MAAM6N,IAAIoB,KAAK,IAAOnH,MAAOiZ,EAAOvX,KAAK4I,KAAK6I,QAClD,EACJ,GAAI,YAAIzR,KAAK4I,KAAKmC,OAAQ/K,KAAK4I,KAAK9X,SAAU,CACjD,IAAIka,EAAU,KAAsB/b,IAAI+Q,KAAK4I,KAAKmC,QAClD,OAAO/K,KAAKuP,cAAcW,eAAerb,EAAQmW,EAAShL,KAAK4I,KAAK9X,QAAS,KACzEkP,KAAK+X,kBAAkBljB,KAI3B,OADAmL,KAAKgY,uBAAuBnjB,IACrB,KAGP,kBAAkBA,GAClB,YAAGA,IAAWmL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiBra,IACzDmL,KAAKmP,OAAOmC,YAAYtR,KAAKkP,gBAAiBra,GAI9C,uBAAuBA,GAC3BmL,KAAKoP,MAAM,KACH,YAAGva,IAAWmL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiBra,IACzDmL,KAAKmP,OAAOgF,gBAAgBtf,EAAQmL,KAAKkP,mBAK7C,eAAenK,EAAgB2S,GAE/BA,GACA1X,KAAKiY,UAAUlT,GAGf,YACJ,OAAO,YAAG/E,KAAK4I,KAAK/T,QAAUxD,SAASuhB,cAAc5S,KAAK4I,KAAK/T,QAAU,YAAoBmL,KAAK3L,SAG9F,UAAU0Q,GACd/E,KAAKwR,UAAU,IAAOjT,OAAQ,CAC1BgH,UAAW3R,KAAK4R,MAChBiM,MAAOzR,KAAK4I,KAAK6I,MACjBpL,MAAOtB,K,+QC/IZ,MAAM,GAGT,cACI/E,KAAK+K,OAAS,KACd/K,KAAKnL,OAAS,KAGlB,MAAM+T,GACE,YAAGA,IAAS,YAASA,GACrB5I,KAAK+K,OAASnC,GAEd5I,KAAKnL,OAAS,YAAmB+T,EAAK/T,OAAQ,MAC9CmL,KAAK+K,OAASnC,EAAKmC,SAIxB,MAAMmN,GAET,YAAYtnB,GACRoP,KAAKlN,WAAelC,UAAU,OAAb,UAGrB,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,YAIlD,MAAM,WAAyBgd,EAKlC,YAAYzb,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAiB0D,GALvE,oBACA,oBACA,oBACA,oBAGI,GAAAwJ,KAAI,GAAWA,KAAK3L,SACpB,GAAA2L,KAAI,GAAUxJ,GACd,GAAAwJ,KAAI,GAAkB,MACtB,GAAAA,KAAI,GAAY,IAChBA,KAAKsU,QAAUtU,KAAKsU,QAAQ1kB,KAAKoQ,MAGrC,SACI,GAAAA,KAAI,GAAWA,KAAKiX,aACpB,GAAAjX,KAAI,GAAY,KAAsB/Q,IAAI+Q,KAAK4I,KAAKmC,SACpD/K,KAAK3L,QAAQuQ,iBAAiB,QAAS5E,KAAKsU,SAC5C,GAAAtU,KAAI,GAAkBA,KAAKmQ,QAAQ,IAAO3R,OAAQwB,KAAKmY,OAAOvoB,KAAKoQ,QAGvE,WACI,GAAAA,KAAI,GAAWA,KAAKiX,aACpB,GAAAjX,KAAI,GAAY,KAAsB/Q,IAAI+Q,KAAK4I,KAAKmC,SAGxD,YACI/K,KAAK3L,QAAQyQ,oBAAoB,QAAS9E,KAAKsU,SAC/CtU,KAAKwQ,YAAY,IAAOhS,OAAQ,GAAAwB,KAAA,KAGpC,SACI,GAAAA,KAAA,IAAc9L,QAAQ6W,GAAUA,EAAOoN,OAAO,GAAAnY,KAAA,OAAAA,KAAA,MAC9CA,KAAKwR,UAAU,IAAO/S,QAAS,CAC3BsM,OAAQ/K,KAAK4I,KAAKmC,OAClBlW,OAAQ,GAAAmL,KAAA,IACRuF,UAAW3R,KAAK4R,QAIxB,QAAQT,GACJ/E,KAAKmY,SACLpT,EAAG4P,iBAGP,YACI,OAAO,YAAG3U,KAAK4I,KAAK/T,QAAUxD,SAASuhB,cAAc5S,KAAK4I,KAAK/T,QAAUmL,KAAK3L,S,mTC9E/E,MAAM+jB,GACT,eAIA,MAAMxP,KAKH,MAAMyP,GAET,cACIrY,KAAKlN,UAAY,aAGrB,WACI,OAAO,KAGX,IAAIuB,EAAkBmC,GAClB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,YAIlD,MAAM,WAAyBgd,EAElC,YAAYzb,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,mBAAoBzL,EAASvB,EAAW,IAAIslB,GAAiB5hB,GAFvE,oBAGI,GAAAwJ,KAAI,GAAY,MAGpB,SACI,GAAAA,KAAI,GAAYA,KAAKxJ,MAAM6N,IAAIuI,GAAG,IAAOzO,OAAQ6B,KAAK0F,OAAO9V,KAAKoQ,QAEtE,YAGA,YAC0B,OAAlB,GAAAA,KAAA,MACAA,KAAKxJ,MAAM6N,IAAIwI,OAAO,IAAO1O,OAAQ,GAAA6B,KAAA,KACrC,GAAAA,KAAI,GAAY,OAIxB,OAAOqP,GACH9b,QAAQkU,IAAI4H,I,kRC1Cb,MAAM,GAGT,YAAYhL,GAFZ,oBACA,oBAEI,GAAArE,KAAI,GAAQqE,GACZ,GAAArE,KAAI,GAAa,IAAI,MAAoB,IACzC,GAAAA,KAAA,IAAeoO,YAAYpO,KAAK8N,UAAUle,KAAKoQ,OAEnD,UACI,GAAAA,KAAA,IAAesO,SAEnB,aACI,GAAAtO,KAAA,IAAe6M,SAGnB,UAAU9H,GACN,GAAA/E,KAAA,IAAUyF,KAAK,IAAO1G,QAAS,KAAM,CACjCwG,UAAW3R,KAAK4R,MAChBa,MAAOtB,K,qRCpBZ,MAAM,GAKT,YAAYuT,GAHZ,KAAA3pB,KAAe,gBAEf,oBAEIqR,KAAKkO,YAAc,wBACnBlO,KAAK6F,MAAQyS,EAGjB,KAAK9hB,GACD,GAAAwJ,KAAI,GAAiB,IAAI,GAAgBxJ,EAAM6N,MAC/C,GAAArE,KAAA,IAAmBgG,UAGvB,UACI,GAAAhG,KAAA,IAAmBoW,c,wRCTpB,MAAM,GAUT,YAAYxlB,EAAgB2nB,GAF5B,oBACA,oBAEIvY,KAAK2Q,UAAW,EAChB3Q,KAAKwY,UAAW,EAEhB,GAAAxY,KAAI,GAAeuY,GACnB,GAAAvY,KAAI,GAAWpP,GAInB,MAAMgY,GACF5I,KAAK2Q,SAAW,YAAa/H,EAAK+H,UAClC3Q,KAAKwY,SAAW,YAAa5P,EAAK4P,UAClCxY,KAAK4Q,SAAWhI,EAAKgI,SACrB5Q,KAAKlP,QAAU,YAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAKsQ,QAAU,YAAmB1H,EAAK0H,QAAS,YAjCpB,8BAiC+D,GAAAtQ,KAAA,MAC3FA,KAAKuQ,SAAW,YAAmB3H,EAAK2H,SAAU,YAjCrB,+BAiCiE,GAAAvQ,KAAA,O,8BAI/F,MAAMyY,GAGT,YAAY7nB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,UAGrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAI7D,MAAM,WAAyB,EAOlC,YAAY3L,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAclC,EAAQ4F,EAAMqP,MAAMjL,mBAAoBpE,GAN5G,oBACA,oBACA,oBACA,oBAII,GAAAwJ,KAAI,GAAc,YA9DR,uBA8DiCpP,IAC3C,GAAAoP,KAAI,GAAY,GAChB,GAAAA,KAAI,GAAuB,MAG/B,SACIwO,EAAe2C,QAAQnR,KAAK3L,QAAS,aAAc,IAEvD,YAIA,aAIA,eACI,OAAI2L,KAAK0Y,gBAGT,GAAA1Y,KAAI,GAAYhS,OAAO8Y,cAChB,GAGX,cACQ9G,KAAK4I,KAAK4P,UACV,GAAAxY,KAAI,GAAuBA,KAAKmQ,QAAQ,IAAOlR,aAAce,KAAK2Y,cAAc/oB,KAAKoQ,QAEzFA,KAAKmP,OAAO+B,SAAS,GAAAlR,KAAA,IAAiB3O,SAASkR,MAC/ClR,SAASkR,KAAK6B,MAAMsC,IAAM,IAAI,GAAA1G,KAAA,QAGlC,eACI3O,SAASkR,KAAK6B,MAAMsC,IAAM,GAC1B1Y,OAAO4qB,SAAS,GAA2B,GAAvB,GAAA5Y,KAAA,KAAiB,IACrC,GAAAA,KAAI,GAAY,GAChBA,KAAKmP,OAAOmC,YAAY,GAAAtR,KAAA,IAAiB3O,SAASkR,MAClDvC,KAAKwQ,YAAY,IAAOvR,aAAc,GAAAe,KAAA,KAG1C,gBACI,OAAO,EAGH,cACJ,OAAOA,KAAKmP,OAAO8E,SAAS,GAAAjU,KAAA,IAAiB3O,SAASkR,MAG1D,cAAcwC,GACV,IAAI8T,EAAY7Y,KAAK3L,QAAQue,cAAc,YA9GjC,6BA8G0D,GAAA5S,KAAA,MAChE6Y,IAAcA,EAAUnY,SAAUqE,EAAGlQ,SACrCmL,KAAKzG,MAAM,OAAO2d,KAAK,KACnBlX,KAAK+O,KAAKhD,MAAM,8B,qUC9GzB,MAAM,GAWT,YAAYnb,EAAgBE,GAF5B,oBACA,oBAEI,GAAAkP,KAAI,GAAWpP,GACfoP,KAAK2Q,UAAW,EAChB3Q,KAAK8Y,SAAW,QAChB9Y,KAAKsQ,QAAUtQ,KAAK+Y,sBACpB/Y,KAAKuQ,SAAWvQ,KAAKgZ,uBACrB,GAAAhZ,KAAI,GAAelP,GACnBkP,KAAKlP,QAAUA,EACfkP,KAAKwY,UAAW,EAChBxY,KAAK4Q,cAAWnO,EAIpB,MAAMmG,GACE,aAAGA,KACH5I,KAAK2Q,SAAW,uBAAa/H,EAAK+H,UAClC3Q,KAAKwY,SAAW,uBAAa5P,EAAK4P,UAClCxY,KAAK8Y,SAAW,6BAAmBlQ,EAAKkQ,SAAU,SAClD9Y,KAAKsQ,QAAU,6BAAmB1H,EAAK0H,QAAStQ,KAAK+Y,uBACrD/Y,KAAKuQ,SAAW,6BAAmB3H,EAAK2H,SAAUvQ,KAAKgZ,wBACvDhZ,KAAKlP,QAAU,0BAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAK4Q,SAAWhI,EAAKgI,UAI7B,sBACI,OAAO,wBAAgC,UAAlB5Q,KAAK8Y,SA7CM,uCAED,sCA2CoF,GAAA9Y,KAAA,KAGvH,uBACI,OAAO,wBAAgC,UAAlBA,KAAK8Y,SAhDO,wCAED,uCA8CqF,GAAA9Y,KAAA,M,8BAItH,MAAMiZ,GAGT,YAAYroB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,cAGrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAoBnC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAIhE,MAAM,WAA4B,EAOrC,YAAY3L,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,sBAAuBzL,EAASvB,EAAW,IAAI,GAAiBlC,EAAQ4F,EAAMqP,MAAMlL,eAAgBnE,GAN9G,oBACA,oBACA,oBACA,oBAII,GAAAwJ,KAAI,GAAWpP,GACf,GAAAoP,KAAI,GAAc,wBA3EH,2BA2EiCpP,IAChD,GAAAoP,KAAI,GAAuB,MAC3B,GAAAA,KAAI,GAAY,GAGpB,SACIA,KAAKgE,OAAO,KACRhE,KAAKkZ,kBACL1K,EAAe2C,QAAQnR,KAAK3L,QAAS,aAAc,MAG3D,WACI2L,KAAKkZ,kBAET,aAGA,eACI,OAAIlZ,KAAK0Y,gBAGT,GAAA1Y,KAAI,GAAYhS,OAAO8Y,cAChB,GAGX,cACQ9G,KAAK4I,KAAK4P,UACV,GAAAxY,KAAI,GAAuBA,KAAKmQ,QAAQ,SAAOlR,aAAce,KAAK2Y,cAAc/oB,KAAKoQ,QAEzFA,KAAKmP,OAAO+B,SAAS,GAAAlR,KAAA,IAAiB3O,SAASkR,MAC/ClR,SAASkR,KAAK6B,MAAMsC,IAAM,IAAIyS,YAElC,eACInZ,KAAKwQ,YAAY,SAAOvR,aAAc,GAAAe,KAAA,KACtCA,KAAKmP,OAAOmC,YAAY,GAAAtR,KAAA,IAAiB3O,SAASkR,MAClDlR,SAASkR,KAAK6B,MAAMsC,IAAM,GAC1B1Y,OAAO4qB,SAAS,GAAoB,EAAjB,GAAA5Y,KAAA,KAEvB,gBACI,OAAO,EAGX,cAAc+E,GACV,MAAM8T,EAAY7Y,KAAK3L,QAAQue,cAAc,wBArHrB,iCAqH4D,GAAA5S,KAAA,MAChF6Y,IAAcA,EAAUnY,SAAUqE,EAAGlQ,SACrCmL,KAAKzG,QAIb,cACI,OAAOyG,KAAKmP,OAAO8E,SAAS,GAAAjU,KAAA,IAAiB3O,SAASkR,MAG1D,kBACI,IAAImM,EAAM,kBAAQ,GAAA1O,KAAA,IAAc,QACL,SAAvBA,KAAK4I,KAAKkQ,UAAwB9Y,KAAKmP,OAAO8E,SAASvF,EAAK1O,KAAK3L,SAEpC,SAAtB2L,KAAK4I,KAAKkQ,UAAuB9Y,KAAKmP,OAAO8E,SAASvF,EAAK1O,KAAK3L,UACvE2L,KAAKmP,OAAOmC,YAAY5C,EAAK1O,KAAK3L,SAFlC2L,KAAKmP,OAAO+B,SAASxC,EAAK1O,KAAK3L,U,4mBCnHpC,MAAM,GAWT,YAAYzD,EAAgBE,GAH5B,oBACA,oBACA,oBAEI,GAAAkP,KAAI,GAAqB,YAfL,kCAewCpP,IAC5D,GAAAoP,KAAI,GAAqB,YAfL,MAewCpP,IAC5D,GAAAoP,KAAI,GAAelP,GACnBkP,KAAKwB,QAAS,EACdxB,KAAK6U,SAAW,iBAAiB,GAAA7U,KAAA,IACjCA,KAAKoZ,MAAQ,iBAAiB,GAAApZ,KAAA,IAC9BA,KAAKlP,QAAU,GAAAkP,KAAA,IAGnB,MAAM4I,GACF,GAAI,YAAGA,GAMH,OALA5I,KAAKwB,OAAS,YAAaoH,EAAKpH,QAChCxB,KAAK6U,SAAW,iBAAiB,YAAmBjM,EAAKiM,SAAU,GAAA7U,KAAA,KACnEA,KAAKoZ,MAAQ,iBAAiB,YAAmBxQ,EAAKpX,QAAS,GAAAwO,KAAA,KAC/DA,KAAKlP,QAAU,YAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,UAC7CA,KAAKqZ,UAAY,YAAazQ,EAAKyQ,YAM3C,UACI,OAAO,G,6CAIR,MAAMC,GAGT,YAAY1oB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,aAGrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAoBnC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAIhE,MAAM,WAA4B,EAIrC,YAAY3L,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,sBAAuBzL,EAASvB,EAAW,IAAI,GAAiBlC,EAAQ4F,EAAMqP,MAAMlL,eAAgBnE,GAJ9G,oBACA,oBACA,oBAGI,GAAAwJ,KAAI,GAAkB,MAG1B,SACI,GAAIA,KAAK4I,KAAK2Q,UAAW,CACrB,IACIvZ,KAAKwZ,cACL,GAAAxZ,KAAI,GAAkBA,KAAKmQ,QAAQ,SAAOzR,OAAQsB,KAAKyZ,SAAS7pB,KAAKoQ,QACvE,MAAO1M,GACL0M,KAAK+O,KAAKsI,UAAU/jB,EAAG,UAE3B0M,KAAK+O,KAAKhD,MAAM,cAAe,WAIvC,WACI,IACI/L,KAAKwZ,cACP,MAAOlmB,GACL0M,KAAK+O,KAAKsI,UAAU/jB,EAAG,WAI/B,YACI0M,KAAKwQ,YAAY,SAAO9R,OAAQ,GAAAsB,KAAA,KAGpC,WAAW0Z,IACHA,EAAU1H,MAAMzhB,OAAS,GAAKmpB,EAAUxH,QAAQ3hB,OAAS,IACzDyP,KAAKwZ,cAGP,OAAO/N,G,0CAET,GADAzL,KAAK+O,KAAKhD,MAAM,cAAgBN,GAC5BA,EAAQ,GAAKzL,KAAKgP,WAAahP,KAAKyP,cACpC,OAAO,EAIX,GADA,GAAAzP,KAAI,GAAUA,KAAK2Z,cACf,GAAA3Z,KAAA,IAAYzP,QAAUkb,EACtB,OAAO,EAEXzL,KAAKgP,UAAW,EAChB,MAAM5J,EAAU,GAAApF,KAAA,IAAYyL,GAgB5B,OAfIzL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiB9J,GAC3CpF,KAAKmP,OAAOgF,gBAAgB/O,EAASpF,KAAKkP,kBAEtClP,KAAK4I,KAAKpH,QACVxB,KAAK4Z,eAAenO,GAExBzL,KAAKmP,OAAO+E,aAAa9O,EAASpF,KAAKkP,kBAG3ClP,KAAKwR,UAAU,SAAO7S,SAAU,CAC5B8M,MAAOA,EACPoO,cAAezU,EACfG,UAAW3R,KAAK4R,QAEpBxF,KAAKgP,UAAW,GACT,KAGX,SAASvD,GACLzL,KAAK8Z,OAAO,YAAgBrO,GAAQ,IAAIyL,KAAK,KACzClX,KAAK+O,KAAKhD,MAAM,wBAA0BN,KAIlD,cACI,GAAAzL,KAAI,GAAUA,KAAK2Z,cACnB,MAAMrqB,EAAI0Q,KAAK3L,QAAQkhB,iBAAiBvV,KAAK4I,KAAKiM,UAClD,GAAA7U,KAAI,GAAY,IAChB1Q,EAAE4E,QAAQ,CAAC4O,EAAe2I,KACtB,IAAI5W,EAA6B,CAAER,QAASyO,GAC5C9C,KAAK+Z,YAAYllB,EAAQ4W,GACzB,GAAAzL,KAAA,IAAc0E,KAAK7P,KAI3B,eAAeuQ,GACXpF,KAAKgE,OAAO,KACR,GAAAhE,KAAA,IAAY9L,QAAQ,CAAC4O,EAAe2I,KAC5BrG,IAAYqG,GAASzL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiBpM,IAChEA,EAAKrC,UAAUG,OAAOZ,KAAKkP,qBAM3C,YAAYra,EAA4B4W,GACpC5W,EAAOgQ,SAAW,KACd7E,KAAK8Z,OAAOrO,IAEhB5W,EAAOR,QAAQuQ,iBAAiB,QAAS/P,EAAOgQ,UAGpD,eAAehQ,GACPA,EAAOgQ,UACPhQ,EAAOR,QAAQyQ,oBAAoB,QAASjQ,EAAOgQ,UAI3D,aACI,MAAO,IAAI7E,KAAK3L,QAAQkhB,iBAAiBvV,KAAK4I,KAAKwQ,S,gTCtLpD,MAAM,GAMT,YAAYvkB,GALZ,oBACA,YAAwC,MACxC,oBACA,oBACA,oBAEI,GAAAmL,KAAI,GAAWnL,GACf,GAAAmL,KAAI,IAAe,GACnB,GAAAA,KAAI,IAAe,GAGvB,YAAYzH,GACR,GAAAyH,KAAI,GAAazH,GAGrB,eACI,OAAO,GAAAyH,KAAA,IAEX,SACI,GAAAA,KAAA,IAAa4E,iBAAiB,YAAa5E,KAAKga,YAAYpqB,KAAKoQ,OACjE,GAAAA,KAAA,IAAa4E,iBAAiB,YAAa5E,KAAKqH,YAAYzX,KAAKoQ,OACjE,GAAAA,KAAA,IAAa4E,iBAAiB,WAAY5E,KAAKia,WAAWrqB,KAAKoQ,OAC/D,GAAAA,KAAI,IAAe,GAGvB,SACI,GAAAA,KAAA,IAAa8E,oBAAoB,YAAa9E,KAAKga,YAAYpqB,KAAKoQ,OACpE,GAAAA,KAAA,IAAa8E,oBAAoB,YAAa9E,KAAKqH,YAAYzX,KAAKoQ,OACpE,GAAAA,KAAA,IAAa8E,oBAAoB,WAAY9E,KAAKia,WAAWrqB,KAAKoQ,OAClE,GAAAA,KAAI,IAAe,GAGvB,KAAKka,EAAwBC,GACpB,YAAI,GAAAna,KAAA,QAGJma,GAAS,GAAAna,KAAA,MAGd,GAAAA,KAAI,IAAe,GACnBhS,OAAO6Y,sBAAsB7G,KAAKoa,OAAOxqB,KAAKoQ,KAAM,CAChDqa,WAAY,GAAAra,KAAA,IACZqG,MAAO6T,EACP3U,UAAW3R,KAAK4R,WAIxB,aACI,OAAO,GAAAxF,KAAA,IAEX,OAAO+E,GACH,GAAA/E,KAAA,SAAAA,KAAe+E,GACf,GAAA/E,KAAI,IAAe,GAGvB,YAAY+E,GACR,GAAA/E,KAAI,IAAe,GACnBA,KAAKyF,KAAKV,GAAI,GAGlB,WAAWA,GACP,GAAA/E,KAAI,IAAe,GACnBA,KAAKyF,KAAKV,GAAI,GAGlB,YAAYA,GACR/E,KAAKyF,KAAKV,GAAI,I,0oBCxDf,MAAM,GAOT,cACI/E,KAAK2Q,UAAW,EAChB3Q,KAAKzQ,KAAO,QACZyQ,KAAKsa,QAjBgB,cAkBrBta,KAAKua,WAAY,EACjBva,KAAKwY,UAAW,EAChBxY,KAAK8W,SAAU,EAGnB,MAAMlO,GACF5I,KAAK2Q,SAAW/H,EAAK+H,UAAY,YAAa/H,EAAK+H,UACnD3Q,KAAKzQ,KAAO,YAAmBqZ,EAAKrZ,KAAM,SAAS+F,cACnD0K,KAAKsa,QAAU,IAAiB,YAAmB1R,EAAK0R,QA1BnC,eA2BrBta,KAAK8W,QAAU,YAAalO,EAAKkO,SACjC9W,KAAKua,UAAY,YAAa3R,EAAK2R,WACnCva,KAAKwY,UAAW5P,EAAK4P,UAAW,YAAa5P,EAAK4P,WAInD,MAAMgC,GAGT,YAAY5pB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,QAGrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAenC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAI3D,MAAM,WAAuB8P,EAYhC,YAAYzb,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,iBAAkBzL,EAASvB,EAAW,IAAI,GAAe0D,GAZnE,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAGI,GAAAwJ,KAAI,GAAclN,GAClB,GAAAkN,KAAI,GAAWpP,GACf,GAAAoP,KAAI,GAAY,MAChB,GAAAA,KAAI,GAAc,YArER,qBAqEiCpP,IAC3C,GAAAoP,KAAI,GAAkB,IAAI,GAAiBA,KAAK3L,UAChD,GAAA2L,KAAA,IAAoBoO,YAAYpO,KAAKya,cAAc7qB,KAAKoQ,OACxD,GAAAA,KAAI,GAAe,MACnB,GAAAA,KAAI,GAAuB,MAC3B,GAAAA,KAAI,GAAgB,MACpB,GAAAA,KAAI,GAAiB,MACrBA,KAAK0a,eAAiB1a,KAAK0a,eAAe9qB,KAAKoQ,MAGnD,SACI,GAAAA,KAAI,GAAYA,KAAK3L,QAAQ2D,cAAc4a,cAAc5S,KAAK4I,KAAK0R,UACnE,GAAAta,KAAI,GAAyB,IAAI,GAAiB,GAAAA,KAAA,MAClDA,KAAK2a,kBACLnM,EAAe2C,QAAQnR,KAAK3L,QAAS,gBAAiB,IACtD,GAAA2L,KAAI,GAAgBA,KAAKmQ,QAAQ,IAAO/R,KAAM4B,KAAKuR,KAAK3hB,KAAKoQ,QAC7D,GAAAA,KAAI,GAAiBA,KAAKmQ,QAAQ,IAAO7R,MAAO0B,KAAKzG,MAAM3J,KAAKoQ,QAChEA,KAAK+O,KAAKhD,MAAM,cAAe,UAEnC,WACQ,GAAA/L,KAAA,IAA2B8L,aAC3B,GAAA9L,KAAA,IAA2B6M,SACG,UAAvB7M,KAAKwP,SAASjgB,MACrB,GAAAyQ,KAAA,IAAc8E,oBAAoB,QAAS9E,KAAK0a,gBAGpD,GAAA1a,KAAI,GAAYA,KAAK3L,QAAQ2D,cAAc4a,cAAc5S,KAAK4I,KAAK0R,UACnE,GAAAta,KAAI,GAAyB,IAAI,GAAiB,GAAAA,KAAA,MAClDA,KAAK2a,kBAGT,YACI3a,KAAKwQ,YAAY,IAAOpS,KAAM,GAAA4B,KAAA,KAC9BA,KAAKwQ,YAAY,IAAOlS,MAAO,GAAA0B,KAAA,KAG7B,O,0CACF,OAAIA,KAAKyQ,iBAAiB,UAGtBzQ,KAAK0Q,WACE1Q,KAAKzG,SAEZyG,KAAK0Y,sBACC1Y,KAAK4a,0BAEf5a,KAAKgP,UAAW,EAChBhP,KAAK+O,KAAKhD,MAAM,QAAQ/L,KAAKgK,KAAQ,QACrChK,KAAKgE,OAAOhE,KAAKgX,OAAQhX,MACrBA,KAAK4I,KAAK+H,UACV,GAAA3Q,KAAI,GAAeA,KAAKmQ,QAAQ,IAAOpR,QAASiB,KAAK6a,WAAWjrB,KAAKoQ,QAErEA,KAAK4I,KAAK4P,UACV,GAAAxY,KAAI,GAAuBA,KAAKmQ,QAAQ,IAAOlR,aAAce,KAAK2Y,cAAc/oB,KAAKoQ,QAEzFA,KAAKwR,UAAU,IAAOnT,OAAQ,CAC1BkH,UAAW3R,KAAK4R,QAEpB,GAAAxF,KAAA,IAAoBsO,SAChBtO,KAAK4I,KAAK2R,WACVva,KAAK8a,mBAET9a,KAAKgP,UAAW,GACT,OAGL,Q,0CACF,QAAIhP,KAAKyQ,iBAAiB,WAAazQ,KAAK0Q,cAG5C1Q,KAAKgP,UAAW,EAChBhP,KAAK+O,KAAKhD,MAAM,QAAQ/L,KAAKgK,KAAQ,SACrChK,KAAKgE,OAAOhE,KAAK8X,QAAS9X,MAC1BA,KAAKwQ,YAAY,IAAOzR,QAAS,GAAAiB,KAAA,KACjCA,KAAKwQ,YAAY,IAAOvR,aAAc,GAAAe,KAAA,KACtCA,KAAKwR,UAAU,IAAOjT,OAAQ,CAC1BgH,UAAW3R,KAAK4R,QAEpB,GAAAxF,KAAA,IAAoB6M,SACpB7M,KAAKgP,UAAW,GACT,MAGX,cAAcjK,GACNA,EAAGsV,YAAc,YAAG,GAAAra,KAAA,MACpB+a,aAAa,GAAA/a,KAAA,KACb,GAAAA,KAAI,GAAY,OACR+E,EAAGsV,YAAe,YAAG,GAAAra,KAAA,OAAkBA,KAAK4I,KAAK2R,WACzDva,KAAK8a,mBAIb,UACI9a,KAAKmP,OAAOmC,YAAYtR,KAAKkP,gBAAiBlP,KAAK3L,SACnD2L,KAAKmP,OAAOmC,YAAY,GAAAtR,KAAA,IAAiB3O,SAASkR,MAClDiM,EAAe2C,QAAQnR,KAAK3L,QAAS,gBAAiB,SAK1D,SACI2L,KAAKmP,OAAO+B,SAASlR,KAAKkP,gBAAiBlP,KAAK3L,SAChD2L,KAAKmP,OAAO+B,SAAS,GAAAlR,KAAA,IAAiB3O,SAASkR,MAC/CiM,EAAe2C,QAAQnR,KAAK3L,QAAS,gBAAiB,QAI1D,WAAW0Q,GACc,WAAjBA,EAAGsB,MAAM1W,KACTqQ,KAAKzG,QAIb,cAAcwL,GACL/E,KAAK3L,QAAQqM,SAAUqE,EAAGlQ,SAC3BmL,KAAKzG,QAIb,cACI,OAAOyG,KAAKmP,OAAO8E,SAAS,GAAAjU,KAAA,IAAiB3O,SAASkR,MAG1D,UAAU/B,GACN,OAAO,IAAI,KAAe,YAAcA,EAAW,GAAAR,KAAA,MAGjD,yB,0CACF,MAAMgb,EAAS3pB,SAASuhB,cAAc,IAAI,GAAA5S,KAAA,QAAoBA,KAAKkP,mBACnE,IAAK,YAAG8L,GAEJ,OADAhb,KAAK+O,KAAKzU,QAAQ,8BACX,EAEX,MAAM7C,EAAwBujB,EAAgBvkB,UAAU,GAAAuJ,KAAA,KACxD,OAAK,YAAGvI,GAIDA,EAAQ8B,SAHXyG,KAAK+O,KAAKzU,QAAQ,8CACX,MAKf,eAAeyK,GACP/E,KAAK0Q,WACL1Q,KAAKzG,QAELyG,KAAKuR,OAELvR,KAAK4I,KAAKkO,SACV/R,EAAG4P,iBAIX,aAAa5P,GACLA,EAAGsV,aAAera,KAAK0Q,YACvB1Q,KAAKuR,OAELvR,KAAK4I,KAAKkO,SACV/R,EAAGsB,MAAMsO,iBAIjB,kBAC2B,UAAnB3U,KAAK4I,KAAKrZ,MACV,GAAAyQ,KAAA,IAA2BoO,YAAYpO,KAAKib,aAAarrB,KAAKoQ,OAC9D,GAAAA,KAAA,IAA2BsO,UAE3B,GAAAtO,KAAA,IAAc4E,iBAAiB,QAAS5E,KAAK0a,gBAIrD,mBACI,GAAA1a,KAAI,GAAY/O,WAAW,KACvB+O,KAAKzG,SACN,O,4ZCxPJ,MAAM,GAMT,cAJA,KAAA5K,KAAe,eAEf,oBAGIqR,KAAKkO,YAAc,uBAGvB,KAAK1X,GACD,GAAAwJ,KAAI,GAAQxJ,EAAM6N,KAClBrW,OAAO4W,iBAAiB,QAAS5E,KAAK2Y,cAAc/oB,KAAKoQ,OAG7D,UACIhS,OAAO8W,oBAAoB,QAAS9E,KAAK2Y,cAAc/oB,KAAKoQ,OAGhE,cAAc+E,GACV,GAAA/E,KAAA,IAAUyF,KAAK,SAAOxG,aAAc,KAAM8F,I,wRCpB3C,MAAMmW,GAET,QAAQxU,EAAaF,EAAc2U,EAAiBC,GAChD,OAAQD,EAAU,GAAK3U,GAAQ2U,GAC1BC,EAAU,GAAK1U,GAAO0U,GAe5B,MAAMC,GAQT,cAPA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAEI,GAAArb,KAAI,GAAc,GAClB,GAAAA,KAAI,GAAa,GACjB,GAAAA,KAAI,GAAc,GAClB,GAAAA,KAAI,GAAc,GAClB,GAAAA,KAAI,GAAc,KAEtB,QAAQ0G,EAAaF,EAAc2U,EAAiBC,GAChD,OAAOpb,KAAKsb,YAAY5U,EAAK0U,IAAYpb,KAAKub,YAAY/U,EAAM2U,GAI5D,YAAY3U,EAAc2U,GAC9B,GAAIA,GAAW,EACX,OAAO,EACX,IAAIK,EAAQhV,EAAO,GAAAxG,KAAA,IAUnB,OATIwG,GAAQ2U,GAAWK,EAAQ,GAAAxb,KAAA,IAC3B,GAAAA,KAAI,IAAkB,GACf,GAAAA,KAAA,KAAuBwb,GAAS,GAAAxb,KAAA,KACvC,GAAAA,KAAI,IAAkB,IAEtBwb,EAAQ,GAAK,GAAAxb,KAAA,IAAkBwb,GAASA,GAAS,GAAK,GAAAxb,KAAA,IAAkBwb,IACxE,GAAAxb,KAAI,GAAcwG,GAEtB,GAAAxG,KAAI,GAAcwb,GACX,GAAAxb,KAAA,IAGH,YAAY0G,EAAa0U,GAC7B,GAAIA,GAAW,EACX,OAAO,EAEX,IAAIK,EAAQ/U,EAAM,GAAA1G,KAAA,IAUlB,OATI0G,GAAO0U,GAAWK,EAAQ,GAAAzb,KAAA,IAC1B,GAAAA,KAAI,IAAkB,GACf,GAAAA,KAAA,KAAuByb,GAAS,GAAAzb,KAAA,KACvC,GAAAA,KAAI,IAAkB,IAEtByb,EAAQ,GAAK,GAAAzb,KAAA,IAAkByb,GAASA,GAAS,GAAK,GAAAzb,KAAA,IAAkByb,IACxE,GAAAzb,KAAI,GAAa0G,GAErB,GAAA1G,KAAI,GAAcyb,GACX,GAAAzb,KAAA,K,2XCpCR,MAAM,GAOT,cACIA,KAAKmb,QAAU,EACfnb,KAAKob,QAAU,EACfpb,KAAKnL,OAAS,KACdmL,KAAKtS,MAAO,EACZsS,KAAK+K,OAAS,KACd/K,KAAKzQ,KAAO,SAGhB,MAAMqZ,GACF5I,KAAKnL,OAAS+T,EAAK/T,OACnBmL,KAAK+K,OAASnC,EAAKmC,OACnB/K,KAAKmb,QAAU,YAAgBvS,EAAKuS,SAAU,GAC9Cnb,KAAKob,QAAU,YAAgBxS,EAAKwS,SAAU,GAC9Cpb,KAAKtS,KAAO,YAAakb,EAAKlb,MAC9BsS,KAAKzQ,KAAO,YAAmBqZ,EAAKrZ,KAAM,WAG3C,MAAMmsB,GAET,YAAY9qB,GACRoP,KAAKlN,WAAelC,UAAU,OAAb,UAGrB,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,YAIlD,MAAM,WAAyBgd,EAYlC,YAAYzb,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAiB0D,GAXvE,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAGIwJ,KAAK3L,QAAUA,EAEf,GAAA2L,KAAI,GAAWA,KAAK3L,SACpB,GAAA2L,KAAI,GAAUxJ,GACd,GAAAwJ,KAAI,IAAY,GAChB,GAAAA,KAAI,GAAW,MACf,GAAAA,KAAI,GAAU,GACd,GAAAA,KAAI,GAAU,GACd,GAAAA,KAAI,GAAc,IAClB,GAAAA,KAAI,GAAS,MACb,GAAAA,KAAI,GAAgB,MAIxB,SACIA,KAAK7K,iBACL,GAAA6K,KAAI,GAAa,IAAI,KAAkBA,KAAK4I,KAAKlb,KAAQM,OAAiBgS,KAAK3L,QAAS2L,KAAKxJ,MAAMqP,MAAM9D,kBACzG,GAAA/B,KAAA,IAAeoO,YAAYpO,KAAKoV,SAASxlB,KAAKoQ,OAC9C,GAAAA,KAAA,IAAesO,SAEnB,WACItO,KAAK7K,iBAET,YACI,GAAA6K,KAAA,IAAe6M,SAGX,SAAS9H,GACb/E,KAAK2b,uBAAuB5W,EAAG2B,IAAK3B,EAAGyB,MAGnC,iBACJ,GAAAxG,KAAI,GAASA,KAAK4b,WAClB,GAAA5b,KAAI,GAAWA,KAAK4I,KAAK/T,OAASmL,KAAK4b,UAAUhJ,cAAc5S,KAAK4I,KAAK/T,QAAUmL,KAAK3L,SACxF,GAAA2L,KAAI,GAAW,KAAsB/Q,IAAI+Q,KAAK4I,KAAKmC,SACnD,GAAA/K,KAAI,GDhDL,MACH,WAAWzQ,GACP,MAAa,YAATA,EACO,IAAI8rB,GAER,IAAIH,KC2C8BjsB,IAAI+Q,KAAK4I,KAAKrZ,OACvDyQ,KAAK2b,uBAAuB3b,KAAK3L,QAAQ0S,UAAW/G,KAAK3L,QAAQ4S,YAI7D,uBAAuBP,EAAaF,GACxC,IAAIqV,EAAgB,GAAA7b,KAAA,IAAkBxN,QAAQkU,EAAKF,EAAMxG,KAAK4I,KAAKuS,QAASnb,KAAK4I,KAAKwS,SACtF,GAAIS,IAAkB,GAAA7b,KAAA,IAIlB,OAHAA,KAAK8b,IAAID,GACT,GAAA7b,KAAI,GAAY6b,QAChB7b,KAAK+b,UAAU,GAAA/b,KAAA,IAAewG,EAAME,KAAQ1G,KAAKgc,SAASxV,EAAME,IAGhE1G,KAAKic,kBAAkBzV,EAAME,KAC7B1G,KAAK+b,UAAU,GAAA/b,KAAA,IAAewG,EAAME,KAAQ1G,KAAKgc,SAASxV,EAAME,IAChE,GAAA1G,KAAI,GAAUwG,GACd,GAAAxG,KAAI,GAAU0G,IAKd,IAAIhQ,GACH,YAAI,GAAAsJ,KAAA,OAAAA,KAAA,OAGTA,KAAKgP,UAAW,EAChB,GAAAhP,KAAA,IAAa9L,QAAQ6W,IACbrU,EACAqU,EAAOpK,IAAI,GAAAX,KAAA,OAAAA,KAAA,KAEX+K,EAAOnK,OAAO,GAAAZ,KAAA,OAAAA,KAAA,OAGtBA,KAAKgP,UAAW,GAGZ,UAAUxc,EAAkBiS,EAAWoD,EAAWqU,EAAiBC,GACvEnc,KAAKwR,UAAU,SAAOtS,OAAQ,CAC1B1M,QAAS,GAAAwN,KAAA,IACTmb,QAAS1W,EACT2W,QAASvT,EACTqU,OAAQA,EACRC,OAAQA,EACR5W,UAAW3R,KAAK4R,QAIhB,UACJ,OAAOxF,KAAK4I,KAAKlb,KAAO2D,SAASkR,KAAOvC,KAAK3L,QAGzC,kBAAkBoQ,EAAWoD,GACjC,OAAO5R,KAAKgP,IAAIR,EAAI,GAAAzE,KAAA,KAAe,GAAAA,KAAA,KAAmB/J,KAAKgP,IAAI4C,EAAI,GAAA7H,KAAA,KAAe,GAAAA,KAAA,IAG9E,SAASyE,EAAWoD,GACxB,IAAIsU,GAAS,EACTD,GAAS,EAOb,OANI,GAAAlc,KAAA,IAAWoc,aAAe,GAAApc,KAAA,IAAW0V,cAAgB7N,EAAI,GAAA7H,KAAA,MACzDmc,GAAS,GAET,GAAAnc,KAAA,IAAWqc,YAAc,GAAArc,KAAA,IAAW2V,aAAelR,EAAI,GAAAzE,KAAA,MACvDkc,GAAS,GAEN,CAACA,EAAQC,I,sZCrLjB,MAAM,GAMT,YAAYrrB,EAAiBwrB,EAAoB/jB,GALjD,oBACA,oBACA,oBACA,oBAGI,GAAAyH,KAAI,GAAcsc,GAClB,GAAAtc,KAAI,GAAYlP,GAChB,GAAAkP,KAAI,GAAazH,GAErB,QACSyH,KAAKuc,WAGVvc,KAAKwc,OACL,GAAAxc,KAAI,GAAW/O,WAAW,KACtB,GAAA+O,KAAA,SAAAA,MACA,GAAAA,KAAI,GAAW,MACX,GAAAA,KAAA,KACAA,KAAK6K,SAEV,GAAA7K,KAAA,OAGP,OACQ,GAAAA,KAAA,MACA+a,aAAa,GAAA/a,KAAA,KACb,GAAAA,KAAI,GAAW,OAIvB,QACI,OAAO,GAAAA,KAAA,IAGH,SACJ,OAAO,YAAG,GAAAA,KAAA,MAAmB,GAAAA,KAAA,IAAgB,EAGjD,YAAYzH,GACR,GAAAyH,KAAI,GAAazH,I,+mBCxClB,MAAM,GAaT,YAAY3H,EAAgBE,GAF5B,oBACA,oBAEI,GAAAkP,KAAI,GAAWpP,GACf,GAAAoP,KAAI,GAAelP,GAGvB,MAAM8X,G,QACF5I,KAAKyc,QAAU,6BAAmB7T,EAAK6T,QAAS,iBArBzB,QAsBvBzc,KAAK0c,GAAK,mBAAiBztB,IAAW,QAAR,EAAC2Z,EAAK8T,UAAE,QAAI,wBAxBjB,wCAwByD,GAAA1c,KAAA,MAClFA,KAAKhN,IAAM,mBAAiB/D,IAAY,QAAT,EAAC2Z,EAAK5V,WAAG,QAAI,wBAxBlB,yCAwB2D,GAAAgN,KAAA,MACrFA,KAAKlP,QAAU,0BAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAK2c,MAAQ/T,EAAK+T,MAClB3c,KAAK8Z,OAASlR,EAAKkR,OACnB9Z,KAAK4c,YAAc,0BAAgBhU,EAAKgU,aAAc,GACtD5c,KAAK9H,OAAS,6BAAmB0Q,EAAK1Q,OAAQ,S,8BAK/C,MAAM2kB,GAET,YAAYjsB,GACRoP,KAAKlN,WAAelC,UAAU,OAAb,UAGrB,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,YAIlD,MAAM,WAAyB,EAOlC,YAAYuB,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAc0D,EAAMqP,MAAMjV,OAAQ4F,EAAMqP,MAAMlL,eAAgBnE,GAPpH,oBACA,oBACA,oBACA,oBACA,oBACA,oBAGI,GAAAwJ,KAAI,GAAY,IAChB,GAAAA,KAAI,IAAgB,GACpB,GAAAA,KAAI,GAAU,IACd,GAAAA,KAAI,GAAa,IACjB,GAAAA,KAAI,GAAkB,MAI1B,SACI,GAAAA,KAAI,GAAkBA,KAAKmQ,QAAQ,SAAOzR,OAAQsB,KAAK8c,aAAaltB,KAAKoQ,QACzEA,KAAK+c,aACL/c,KAAKgd,WACLhd,KAAKid,iBACLjd,KAAKkd,cACLld,KAAKmd,kBAAkB,GAAAnd,KAAA,KACvBA,KAAKod,eAAe,EAAG,GAAApd,KAAA,KACvBA,KAAKgE,OAAO,KACRhE,KAAKmP,OAAOkO,SAASrd,KAAK3L,QAAS,SAAU2L,KAAKsd,iBAAiB,GAAAtd,KAAA,OAAAA,KAAA,SAEvE,GAAAA,KAAI,GAAS,IAAI,GAAcA,KAAK4I,KAAKgU,aAAa,EAAM5c,KAAK8Z,OAAOlqB,KAAKoQ,KAAM,UACnFA,KAAKud,YAGT,WACIvd,KAAKgE,OAAO,KACRhE,KAAKmP,OAAOkO,SAASrd,KAAK3L,QAAS,SAAU2L,KAAKsd,iBAAiB,GAAAtd,KAAA,OAAAA,KAAA,SAEvEA,KAAKud,YAGT,YACI,GAAAvd,KAAA,IAAWwc,OACXxc,KAAKwQ,YAAY,SAAO9R,OAAQ,GAAAsB,KAAA,KAGpC,WAAWwd,GACPxd,KAAKgE,OAAO,KACRhE,KAAKmP,OAAOkO,SAASrd,KAAK3L,QAAS,SAAU2L,KAAKsd,iBAAiB,GAAAtd,KAAA,OAAAA,KAAA,SAIrE,OAAOyL,G,0CACT,GAAIzL,KAAKgP,SACL,OAAO,EAEXhP,KAAK+c,aACL/c,KAAKgd,WACLhd,KAAKkd,cACLld,KAAKid,iBACL,IAAIQ,EAAU,6BAAmBhS,EAAO,GAAAzL,KAAA,IAAkB,GAAAA,KAAA,IAAczP,QACxE,GAAIktB,GAAW,GAAAzd,KAAA,KAAoByd,EAAU,GAAKA,GAAW,GAAAzd,KAAA,IAAczP,OAEvE,OADAyP,KAAK+O,KAAKzU,QAAQ,SAASmR,uCACpB,EAEXzL,KAAKgP,UAAW,EAChBhP,KAAKmd,kBAAkBM,GACvB,IAAIC,EAAW,GAAA1d,KAAA,IAAcyd,GAqB7B,aAnBMzd,KAAKuP,cAAcoO,oBAAoBD,EACzC,GAAA1d,KAAA,KAAoB,EAAI,GAAAA,KAAA,OAAAA,KAAA,KAAkC,KAC1DA,KAAK4I,KAAK8T,GACV1c,KAAK4I,KAAK5V,IACV,KACI0qB,EAASjd,UAAUE,IAAIX,KAAKkP,iBACxB,GAAAlP,KAAA,KAAoB,GACpB,GAAAA,KAAA,OAAAA,KAAA,KAAgCS,UAAUG,OAAOZ,KAAKkP,iBAC1DlP,KAAKod,cAAc,GAAApd,KAAA,IAAkByd,GACrCzd,KAAKmP,OAAOkO,SAASrd,KAAK3L,QAAS,SAAU2L,KAAKsd,iBAAiBI,IACnE1d,KAAKud,YACLvd,KAAKgP,UAAW,GAEpBhP,KAAK4I,KAAK9X,SAEdkP,KAAKwR,UAAU,SAAO7S,SAAU,CAC5B4G,UAAW3R,KAAK4R,MAChBiG,MAAOgS,KAEJ,KAIX,aAAahS,GACTzL,KAAK8Z,OAAOrO,GAGhB,iBACI,GAAAzL,KAAI,GAAe,aAAG,GAAAA,KAAA,KAAiB,GAAAA,KAAA,IAAcwE,UAAU3P,GAAUmL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiBra,KAAY,GAGpI,iBAAiBuQ,GACb,OAAK,aAAGpF,KAAK4I,KAAK1Q,SAAgC,SAArB8H,KAAK4I,KAAK1Q,OAG5B8H,KAAK4I,KAAK1Q,OAFV,4BAAkBkN,GAAW,KAM5C,aACI,IAAI9V,EAAI0Q,KAAK3L,QAAQkhB,iBAAiBvV,KAAK4I,KAAK6T,SAChD,GAAAzc,KAAI,GAAY1Q,EAAEiB,OAAS,EAAI,IAAIjB,GAAK,IAG5C,WACI,GAAA0Q,KAAI,GAAU,aAAGA,KAAK4I,KAAK+T,OAAS,IAAItrB,SAASkkB,iBAAiBvV,KAAK4I,KAAK+T,QAAU,IAG1F,cACI,IAAIxsB,EAAI,aAAG6P,KAAK4I,KAAKkR,QAAUzoB,SAASkkB,iBAAiBvV,KAAK4I,KAAKkR,QAAU,KAC7E,GAAA9Z,KAAI,GAAa,IACb7P,GACAA,EAAE+D,QAAQ0pB,IACN,GAAA5d,KAAA,IAAe0E,KAAkBkZ,KAK7C,cAAcxY,EAAiBpO,GACtB,aAAG,GAAAgJ,KAAA,OAGJ,oBAAUoF,EAAS,EAAG,GAAApF,KAAA,IAAYzP,OAAS,IAC3CyP,KAAKmP,OAAOmC,YAAYtR,KAAKkP,gBAAiB,GAAAlP,KAAA,IAAYoF,IAE1D,oBAAUpO,EAAM,EAAG,GAAAgJ,KAAA,IAAYzP,OAAS,IACxCyP,KAAKmP,OAAO+B,SAASlR,KAAKkP,gBAAiB,GAAAlP,KAAA,IAAYhJ,KAQ/D,kBAAkByU,GACd,GAAAzL,KAAA,IAAe9L,QAAQ0pB,IACnB5d,KAAK6d,cAAcD,EAAG7mB,MAAO0U,KASrC,cAAc7J,EAAY6J,GAClB,aAAG7J,IACH5B,KAAKxJ,MAAM6N,IAAIoB,KAAK,SAAO/G,OAAQkD,EAAI6J,GAM/C,YACI,GAAAzL,KAAA,IAAWwc,OACPxc,KAAK4I,KAAKgU,aACV,GAAA5c,KAAA,IAAW6K,S,0VCpNhB,MAAM,GAKT,eAIA,MAAMjC,GACG,aAAGA,KAGR5I,KAAKnL,OAAS+T,EAAK/T,OACnBmL,KAAKyL,MAAQ7C,EAAK6C,QAKnB,MAAMqS,GAET,YAAYltB,GACRoP,KAAKlN,WAAelC,UAAU,OAAb,YAGrB,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,GAAmBnC,EAASmC,EAAOwJ,KAAKlN,YAIpD,MAAM,WAA2Bgd,EAKpC,YAAYzb,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,qBAAsBzL,EAASvB,EAAW,IAAI,GAAmB0D,GAL3E,oBACA,oBACA,oBACA,oBAGI,GAAAwJ,KAAI,GAAa,MACjB,GAAAA,KAAI,GAA+B,OAApB3L,EAAQ6C,SACvB,GAAA8I,KAAI,QAAkByC,GACtBzC,KAAK+d,aAAe/d,KAAK+d,aAAanuB,KAAKoQ,MAC3C,GAAAA,KAAI,GAAc,IAGtB,SACIA,KAAKge,YACLhe,KAAKiX,YAGT,WACIjX,KAAKiX,YAGT,YACIjX,KAAKie,eAGT,YACS,aAAGje,KAAK4I,KAAK/T,SACd,GAAAmL,KAAI,GAAa,MAGrB,IAAInL,EAAsBxD,SAASuhB,cAAc5S,KAAK4I,KAAK/T,QACvD,aAAGA,IACH,GAAAmL,KAAI,GAAanL,EAAOkC,OAIhC,YACI,GAAI,GAAAiJ,KAAA,IAAc,CACCA,KAAK3L,QAAQkhB,iBA5EJ,UA6EfrhB,QAAQ,CAAC0jB,EAAanM,KAC3B,IAAIyS,EAAOle,KAAKme,gBAAgBvuB,KAAKoQ,KAAMyL,GAC3C,GAAAzL,KAAA,IAAgB0E,KAAKwZ,GACrBtG,EAAGhT,iBAAiB,QAASsZ,UAGjCle,KAAK3L,QAAQuQ,iBAAiB,QAAS5E,KAAK+d,cAIpD,eACI,GAAI,GAAA/d,KAAA,IAAc,CACCA,KAAK3L,QAAQkhB,iBAzFJ,UA0FfrhB,QAAQ,CAAC0jB,EAAanM,KACvB,GAAAzL,KAAA,IAAgBzP,OAASkb,GACzBmM,EAAG9S,oBAAoB,QAAS,GAAA9E,KAAA,IAAgByL,MAExD,GAAAzL,KAAI,GAAc,SAElBA,KAAK3L,QAAQyQ,oBAAoB,QAAS9E,KAAK+d,cAIvD,aAAahZ,GACT/E,KAAKiX,YACA,aAAGjX,KAAK4I,KAAK6C,QAGlBzL,KAAKsU,QAAQtU,KAAK4I,KAAK6C,MAAM1X,QAGjC,gBAAgB0X,EAAe1G,GAC3B/E,KAAKiX,YACLjX,KAAKsU,QAAQ7I,GAGjB,QAAQA,GACC,aAAG,GAAAzL,KAAA,MAGRA,KAAKxJ,MAAM6N,IAAIoB,KAAK,SAAO/G,OAAQ,GAAAsB,KAAA,IAAgByL,I,4TClHpD,MAAM2S,GAET,UAAU3Z,EAAWoD,EAAW2T,EAAeC,GAC3C,MAAO,CAAChX,EAAGoD,I,YAkBZ,MAAMwW,GAET,YAAYhqB,GADZ,oBAEI,GAAA2L,KAAI,GAAY3L,GAEpB,UAAUoQ,EAAWoD,EAAW2T,EAAeC,GAG3C,MAAO,CAFKhX,EAAI,GAAAzE,KAAA,IAActL,WACjBmT,EAAI,GAAA7H,KAAA,IAAc1L,Y,sTCrBhC,MAAM,GAST,YAAY1D,EAAgB2nB,GAF5B,oBACA,oBAEIvY,KAAK2Q,UAAW,EAChB3Q,KAAK4Q,cAAWnO,EAChBzC,KAAKsQ,QAAU,GACftQ,KAAKuQ,SAAW,GAChBvQ,KAAKlP,QAAUynB,EAEf,GAAAvY,KAAI,GAAeuY,GACnB,GAAAvY,KAAI,GAAWpP,GAInB,MAAMgY,GACF5I,KAAK2Q,SAAW,YAAa/H,EAAK+H,UAClC3Q,KAAK4Q,SAAWhI,EAAKgI,SACrB5Q,KAAKlP,QAAU,YAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAKsQ,QAAU,YAAmB1H,EAAK0H,QAAS,YA/BrB,6BA+B+D,GAAAtQ,KAAA,MAC1FA,KAAKuQ,SAAW,YAAmB3H,EAAK2H,SAAU,YA/BtB,8BA+BiE,GAAAvQ,KAAA,O,8BAI9F,MAAMse,GAGT,YAAY1tB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,SAGrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAgBnC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAI5D,MAAM,WAAwB,EAWjC,YAAY3L,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,kBAAmBzL,EAASvB,EAAW,IAAI,GAAalC,EAAQ4F,EAAMqP,MAAMjL,mBAAoBpE,GAX1G,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAGI,GAAAwJ,KAAI,IAAa,GACjB,GAAAA,KAAI,IAAe,GACnB,GAAAA,KAAI,GAAU,GACd,GAAAA,KAAI,GAAU,GACd,GAAAA,KAAI,GAAiB,IAAI,MACzB,GAAAA,KAAA,IAAmB2U,gBAAe,GAClC,GAAA3U,KAAI,GAAuB,IAAIoe,IAC/B,GAAApe,KAAI,GAAqB,IAAIqe,GAAqBhqB,IAClD,GAAA2L,KAAI,GAAWpP,GACfoP,KAAKue,KAAOve,KAAKue,KAAK3uB,KAAKoQ,MAC3BA,KAAK0F,OAAS1F,KAAK0F,OAAO9V,KAAKoQ,MAGnC,SACIwO,EAAe2C,QAAQnR,KAAK3L,QAAS,aAAc,IACnD,GAAA2L,KAAI,GAAYA,KAAK3L,QAAQue,cAAc,YA/EtC,uBA+E0D,GAAA5S,KAAA,OAC/D,GAAAA,KAAI,GAAcA,KAAK3L,QAAQue,cAAc,YA/EtC,yBA+E4D,GAAA5S,KAAA,OACnE,GAAAA,KAAA,IAAmBoO,YAAYpO,KAAKwe,OAAO5uB,KAAKoQ,OAIpD,YAIA,aAEA,eACI,OAAO,EAEX,cACIzM,QAAQkU,IAAI,gBACZ,GAAAzH,KAAA,IAAmBsO,SAGvB,eACI/a,QAAQkU,IAAI,gBACZ,GAAAzH,KAAA,IAAmB6M,SAEvB,gBACI,OAAO,EAGX,OAAO9H,GACH,OAAQA,EAAGxB,MACP,IAAK,OACDvD,KAAKmH,YAAYpC,GACjB,MACJ,IAAK,KACD/E,KAAKoH,UAAUrC,GACf,MACJ,IAAK,OACD/E,KAAKqH,YAAYtC,IAM7B,YAAYA,GACRxR,QAAQkU,IAAI,QACR1C,EAAGlQ,SAAW,GAAAmL,KAAA,IACd,GAAAA,KAAI,IAAa,GACV+E,EAAGlQ,SAAW,GAAAmL,KAAA,KACrB,GAAAA,KAAI,IAAe,GAEvB,GAAAA,KAAI,GAAU+E,EAAGN,GACjB,GAAAzE,KAAI,GAAU+E,EAAG8C,GACjB7H,KAAKmP,OAAO+E,aAAa7iB,SAASkR,KAAM,UAAQnJ,WAEhD4G,KAAKxJ,MAAM6N,IAAIoB,KAAK,SAAOjG,UAAW,MAAM,GAGhD,YAAYuF,GACJ,GAAA/E,KAAA,IACAA,KAAKye,OAAO1Z,EAAI/E,KAAKue,MACd,GAAAve,KAAA,KACPA,KAAKye,OAAO1Z,EAAI/E,KAAK0F,QAK7B,UAAUX,GACN,GAAA/E,KAAI,IAAa,GACjB,GAAAA,KAAI,IAAe,GACnBA,KAAKmP,OAAOgF,gBAAgB9iB,SAASkR,KAAM,UAAQnJ,WAEnD4G,KAAKxJ,MAAM6N,IAAIoB,KAAK,SAAOjG,UAAW,MAAM,GAIhD,OAAOuF,EAAmBxM,GACtByH,KAAKgE,OAAO,KACJ,YAAGzL,IACHA,EAASyH,KAAK3L,QAAwB0Q,EAAGN,EAAGM,EAAG8C,EAAI9C,EAAGN,EAAI,GAAAzE,KAAA,IAAe+E,EAAG8C,EAAI,GAAA7H,KAAA,KACpF,GAAAA,KAAI,GAAU+E,EAAGN,GACjB,GAAAzE,KAAI,GAAU+E,EAAG8C,KAIzB,OAAOxT,EAAsBoQ,EAAWoD,EAAW2T,EAAeC,GAC9D,IAAKiD,EAAUC,GAAa,GAAA3e,KAAA,IAAuB4e,UAAUna,EAAGoD,EAAG2T,EAAOC,GACtEzb,KAAK6e,WAAWxqB,EAAQC,UAAWD,EAAQK,WAAYgqB,EAAUC,IACjE3e,KAAKgE,OAAO,KACR3P,EAAQ+P,MAAMxR,MAAQ8rB,EAAW,KACjCrqB,EAAQ+P,MAAMlM,OAASymB,EAAY,OAK/C,KAAKtqB,EAAsBoQ,EAAWoD,EAAW2T,EAAeC,GAC5D,IAAKqD,EAAMC,GAAQ,GAAA/e,KAAA,IAAyB4e,UAAUna,EAAGoD,EAAG2T,EAAOC,GAC/Dzb,KAAK6e,WAAWE,EAAMD,EAAMzqB,EAAQ2qB,YAAa3qB,EAAQgE,eACzD2H,KAAKgE,OAAO,KACR3P,EAAQ+P,MAAMoC,KAAOsY,EAAO,KAC5BzqB,EAAQ+P,MAAMsC,IAAMqY,EAAO,OAOvC,WAAWrY,EAAaF,EAAc5T,EAAesF,GACjD,OAAQwO,EAAMxO,EAASlK,OAAOsX,YAAc,IACvCoB,EAAM,IAAQF,EAAO,IACrBA,EAAO5T,EAAQ5E,OAAOuW,WAAa,I,6YChMzC,MAAM,GAKT,cACIvE,KAAKzP,OAASyP,KAAKwU,GAAKxU,KAAK7H,MAAQ,EACrC6H,KAAKif,KAAM,EAGf,YAAYzpB,GACR,IAAKA,IAAS,YAAGA,EAAK2C,QAAU,YAAG3C,EAAKgf,IACpC,MAAM,IAAI,KAAc,mDAE5BxU,KAAK7H,KAAO3C,EAAK2C,KACjB6H,KAAKwU,GAAKhf,EAAKgf,GACfxU,KAAKzP,OAAS0F,KAAKgP,IAAIjF,KAAKwU,GAAKxU,KAAK7H,MACtC6H,KAAKif,IAAMjf,KAAK7H,KAAO6H,KAAKwU,GAGhC,QAAQngB,EAAcgf,EAAkBnP,GACpC,GAAIlE,KAAKwU,GAAK,EACV,OAEJ,IAAIpP,EAAUpF,KAAKzP,OAAS8iB,EACxBhf,EAAe,QACfA,EAAQ+P,MAAM8a,QAAUlf,KAAKif,IAAMhpB,KAAKrE,IAAIoO,KAAK7H,KAAOiN,EAAS,GAAKnP,KAAKrE,IAAIoO,KAAK7H,KAAOiN,EAAS,KASzG,MAAM,GAOT,YAAYrV,GACR,GAFJ,qBAES,YAAGA,GACJ,MAAM,IAAI,KAAc,iDAE5BiQ,KAAKjQ,SAAWA,EAChBiQ,KAAKzP,OAASyP,KAAKwU,GAAKxU,KAAK7H,MAAQ,EACrC6H,KAAKif,KAAM,EACX,GAAAjf,KAAI,GAAS,IAGjB,YAAYxK,GACR,IAAKA,IAAS,YAAGA,EAAK2C,QAAU,YAAG3C,EAAKgf,IACpC,MAAM,IAAI,KAAc,oDAE5BxU,KAAK7H,KAAO3C,EAAK2C,KACjB6H,KAAKwU,GAAKhf,EAAKgf,GACfxU,KAAKzP,OAAS0F,KAAKgP,IAAIjF,KAAKwU,GAAKxU,KAAK7H,MACtC6H,KAAKif,IAAMjf,KAAK7H,KAAO6H,KAAKwU,GAC5B,GAAAxU,KAAI,GAASxK,EAAK2pB,MAGtB,QAAQ9qB,EAAcgf,EAAkBnP,GACpC,IAAKlE,KAAKjQ,SACN,OAEJ,IAAIqV,EAAUpF,KAAKzP,OAAS8iB,EACxBhf,EAAe,QACfA,EAAQ+P,MAAMpE,KAAKjQ,UAAYiQ,KAAKof,YAAYpf,KAAKif,IAAMjf,KAAK7H,KAAOiN,EAAUpF,KAAK7H,KAAOiN,EAAS,GAAApF,KAAA,MAItG,YAAY3Q,EAAe8vB,GAC/B,MAAO,GAAG9vB,IAAQ8vB,UAAQ,M,eAO3B,MAAM,GAET,cACInf,KAAKxK,UAAOiN,EAGhB,YAAYjN,GACR,IAAKA,EACD,MAAM,IAAI,KAAc,qDAE5BwK,KAAKxK,KAAOA,EAGhB,MAAM6d,GACF,IAAIgM,EAAkB,GACtB,IAAK,IAAI1wB,KAAQqR,KAAKxK,KAAM,CACxB,IAAI8pB,EAAMtf,KAAKxK,KAAK7G,GAChBqW,EAAO/O,KAAKgP,IAAIqa,EAAI9K,GAAK8K,EAAInnB,MAE7B9H,EADMivB,EAAInnB,KAAOmnB,EAAI9K,GACT8K,EAAInnB,KAAQ6M,EAAOqO,EAAYiM,EAAInnB,KAAQ6M,EAAOqO,EAClEgM,EAAM3a,KAAK1E,KAAKuf,YAAY5wB,EAAM0B,EAAKivB,EAAIH,OAG/C,OAAOE,EAAMhtB,KAAK,KAGtB,YAAY1D,EAAcU,EAAe8vB,GACrC,MAAO,GAAGxwB,KAAQU,IAAQ8vB,KAG9B,QAAQ9qB,EAAcgf,EAAkBnP,GAC/BlE,KAAKxK,MAGNnB,EAAe,QACfA,EAAQ+P,MAAMob,UAAYxf,KAAKgT,MAAMK,K,2UCzDjD,MAAM,GACF,IAAIzR,GACA,GAAKA,EAGL,OAAQA,GACJ,IAAK,UACD,OAAO,IAAI,GACf,IAAK,YACD,OAAO,IAAI,GACf,QACI,OAAO,IAAI,GAAiBA,KAMrC,MAAM6d,GAST,YAAYC,GARZ,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAEI,GAAA1f,KAAI,GAAc,IAClB,GAAAA,KAAI,QAAYyC,GAChB,GAAAzC,KAAI,QAAmByC,GACvB,GAAAzC,KAAI,GAAkB0f,YACtB,GAAA1f,KAAI,IAAS,GAGjB,SAASzH,GACL,GAAAyH,KAAI,GAAqBzH,GAG7B,aAAaonB,GACT,GAAA3f,KAAI,GAAc2f,GAGtB,WAAWtrB,GACP,GAAA2L,KAAI,GAAY3L,GAGpB,WAAWkE,GACP,GAAAyH,KAAI,GAAYzH,GAGpB,QAAQzH,EAAiBuiB,EAAmBuM,GACxC,GAAI,GAAA5f,KAAA,IACA,OAEJ,IAAK,GAAAA,KAAA,KAA4C,IAA3B,GAAAA,KAAA,IAAgBzP,OAElC,YADAyP,KAAK6f,YAAY,IAAIhgB,MAAM,oEAG/B,IAAIigB,EAAoBzM,UAAY,EAChC0M,EAAmBH,IAAkB,EACzC,GAAA5f,KAAI,IAAS,GACb6G,sBAAsB7G,KAAKggB,aAAapwB,KAAKoQ,KAAMlP,EAASgvB,EAAmBC,IAGnF,WACI,OAAO,GAAA/f,KAAA,IAGH,aAAalP,EAAiBmvB,EAAyBL,EAAiBra,GACvE,GAAAvF,KAAA,KACD,GAAAA,KAAI,GAAmBuF,GAE3B,IAAI2a,EAAK3a,EAAY,GAAAvF,KAAA,IACjB8f,EAAoBI,EAAKpvB,EACzBqvB,EAAe,EAEfA,EADoB,IAApBF,EACeH,EAEAF,EAASK,EAAmBH,EAAoBG,EAAmBA,EAAmBH,EAAoBG,EAE7HjgB,KAAKogB,WAAWR,EAAS3pB,KAAKrE,IAAIuuB,EAAc,GAAKlqB,KAAKtE,IAAIwuB,EAAc,GAAI,GAC5ED,EAAKpvB,IAAY,GAAAkP,KAAA,IACjB6G,sBAAsB7G,KAAKggB,aAAapwB,KAAKoQ,KAAMlP,EAASmvB,EAAiBL,IAE7E5f,KAAKqgB,aAAaT,GAIlB,aAAaU,GACb,GAAAtgB,KAAA,QAAAA,KAAA,KACA,GAAAA,KAAA,IAAckB,gBAAgB,SAE9B,GAAAlB,KAAA,KACA,GAAAA,KAAA,SAAAA,KAAI,YAAkCsgB,EAAU,GAAAtgB,KAAA,KAEpD,GAAAA,KAAI,IAAiB,GACrB,GAAAA,KAAI,QAAmByC,GACvB,GAAAzC,KAAI,IAAS,GAGT,WAAWqT,EAAkBnP,GACjC,IACI,GAAAlE,KAAA,IAAgB9L,QAAQqsB,GAAYA,EAAStW,QAAQ,GAAAjK,KAAA,IAAeqT,EAAUnP,IAChF,MAAO5Q,GACL0M,KAAK6f,YAAYvsB,GACjB,GAAA0M,KAAI,IAAiB,IAKrB,YAAY1M,GACZ,GAAA0M,KAAA,IACA,GAAAA,KAAA,SAAAA,KAAc1M,IAEdC,QAAQC,MAAM,yCACdD,QAAQC,MAAMF,K,wHAOnB,MAAM,GAMT,YAAYktB,GALZ,oBACA,oBACA,oBACA,oBACA,oBAEI,GAAAxgB,KAAI,QAAYyC,GAChB,GAAAzC,KAAI,GAAc,IAClB,GAAAA,KAAI,GAAoB,IAAIyf,GAAmBe,IAC/C,GAAAxgB,KAAI,GAAY,IAAI,IAGxB,WAAW3L,GACP,GAAA2L,KAAI,GAAY3L,GAGpB,YAAYkE,GACR,GAAAyH,KAAA,IAAsBqL,SAAS9S,GAGnC,WAAWA,GACP,GAAAyH,KAAI,GAAYzH,GAChB,GAAAyH,KAAA,IAAsBygB,WAAWloB,GAGrC,SAAS8mB,GACL,GAAK,YAAGA,GAAR,CAGA,GAAArf,KAAI,GAAc,IAClB,IACI,IAAK,IAAIxK,KAAQ6pB,EAAO,CACpB,IAAIkB,EAAW,GAAAvgB,KAAA,IAAc/Q,IAAIuG,GACjC,IAAK+qB,EAAU,OACfA,EAAStc,YAAYob,EAAM7pB,IAC3B,GAAAwK,KAAA,IAAgB0E,KAAK6b,IAE3B,MAAOjtB,GACL0M,KAAK6f,YAAYvsB,KAQzB,OAAO+f,GACE,GAAArT,KAAA,KAA4C,IAA3B,GAAAA,KAAA,IAAgBzP,QAGtC,GAAAyP,KAAA,IAAgB9L,QAAQqsB,GAAYA,EAAStW,QAAQ,GAAAjK,KAAA,IAAe/J,KAAKtE,IAAI0hB,EAAU,GAAI,IAO/F,YAAYA,GACRxM,sBAAsB7G,KAAK4C,OAAOhT,KAAKoQ,KAAMqT,IASjD,OAAOA,EAAkBviB,EAAiB8uB,GACtC,GAAA5f,KAAA,IAAsB0gB,WAAW,GAAA1gB,KAAA,KACjC,GAAAA,KAAA,IAAsB2gB,aAAa,GAAA3gB,KAAA,KACnC,GAAAA,KAAA,IAAsB4gB,QAAQ9vB,EAASuiB,EAAUuM,GAG7C,YAAYtsB,GACZ,GAAA0M,KAAA,IACA,GAAAA,KAAA,SAAAA,KAAc1M,GAEdC,QAAQkU,IAAInU,I,2ECzPjB,MAAMutB,GAAwD,CACjE,MAAS,CACLzb,QAAS,CACLoB,KAAM,CACFgZ,UAAW,CACPsB,WAAY,CACR3oB,KAAM,EACNqc,IAAK,IACL2K,KAAM,OAIlB4B,MAAO,CACHvB,UAAW,CACPsB,WAAY,CACR3oB,KAAM,EACNqc,GAAI,IACJ2K,KAAM,QAKtB9Z,SAAU,CACNmB,KAAM,CACFgZ,UAAW,CACPsB,WAAY,CACR3oB,KAAM,IACNqc,GAAI,EACJ2K,KAAM,OAIlB4B,MAAO,CACHvB,UAAW,CACPsB,WAAY,CACR3oB,MAAO,IACPqc,GAAI,EACJ2K,KAAM,SAM1B6B,KAAM,CACF5b,QAAS,CACLoB,KAAM,CACF0Y,QAAS,CACL/mB,KAAM,EACNqc,GAAI,IAGZuM,MAAO,CACH7B,QAAS,CACL/mB,KAAM,EACNqc,GAAI,KAIhBnP,SAAU,CACNmB,KAAM,CACF0Y,QAAS,CACL/mB,KAAM,EACNqc,GAAI,IAGZuM,MAAO,CACH7B,QAAS,CACL/mB,KAAM,EACNqc,GAAI,MAKpB9P,KAAM,CACFU,QAAS,CACLoB,KAAM,CACFgZ,UAAW,CACPsB,WAAY,CACR3oB,KAAM,EACNqc,IAAK,GACL2K,KAAM,OAIlB4B,MAAO,CACHvB,UAAW,CACPsB,WAAY,CACR3oB,KAAM,EACNqc,GAAI,GACJ2K,KAAM,QAKtB9Z,SAAU,CACNmB,KAAM,CACFgZ,UAAW,CACPsB,WAAY,CACR3oB,KAAM,IACNqc,GAAI,EACJ2K,KAAM,OAIlB4B,MAAO,CACHvB,UAAW,CACPsB,WAAY,CACR3oB,MAAO,IACPqc,GAAI,EACJ2K,KAAM,U,ilBCzGvB,MAAM,GAWT,YAAYvuB,EAAgBE,GAF5B,oBACA,oBAEI,GAAAkP,KAAI,GAAWpP,GACf,GAAAoP,KAAI,GAAelP,GAGvB,MAAM8X,GACF5I,KAAKyc,QAAU,iBAAiB,6BAAmB7T,EAAK6T,QAnBjC,QAoBvBzc,KAAKlP,QAAU,0BAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAK2c,MAAQ/T,EAAK+T,MAClB3c,KAAK4c,YAAc,0BAAgBhU,EAAKgU,aAAc,GACtD5c,KAAK9H,OAAS,6BAAmB0Q,EAAK1Q,OAAQ,QAC9C8H,KAAKqZ,UAAY,6BAAmBzQ,EAAKyQ,UAAW,SACpDrZ,KAAKihB,KAAO,8BAAoBrY,EAAKqY,MAAM,I,8BAK5C,MAAMC,GAET,YAAYtwB,GACRoP,KAAKlN,WAAelC,UAAU,OAAb,UAGrB,WACI,OAAO,KAGX,IAAIyD,EAAkBmC,GAClB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,YAIlD,MAAM,WAAyB,EAkBlC,YAAYuB,EAAkBmC,EAAiB1D,GAC3CgN,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAc0D,EAAMqP,MAAMjV,OAAQ4F,EAAMqP,MAAMlL,eAAgBnE,GAlBpH,oBACA,oBACA,oBACA,oBACA,oBAEA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAGI,GAAAwJ,KAAI,GAAY,IAChB,GAAAA,KAAI,IAAgB,GACpB,GAAAA,KAAI,IAAa,GACjB,GAAAA,KAAI,GAAU,IACd,GAAAA,KAAI,GAAkB,MACtB,GAAAA,KAAI,IAAe,GACnB,GAAAA,KAAI,IAAY,GAChB,GAAAA,KAAI,GAAe,GACnB,GAAAA,KAAI,GAAgB,MACpB,GAAAA,KAAI,GAAmB,IACvB,GAAAA,KAAI,GAAe,IAAI,IACvB,GAAAA,KAAI,GAAe,IAAI,IACvB,GAAAA,KAAA,IAAiBmhB,YAAYnhB,KAAKohB,kBAAkBxxB,KAAKoQ,OACzD,GAAAA,KAAI,GAAiB,GAGzB,SACI,GAAAA,KAAI,GAAkBA,KAAKmQ,QAAQ,SAAOzR,OAAQsB,KAAK8c,aAAaltB,KAAKoQ,QACzE,GAAAA,KAAI,GAAgBA,KAAKmQ,QAAQ,SAAO5Q,YAAaS,KAAKwe,OAAO5uB,KAAKoQ,QACtEA,KAAK+c,aACL/c,KAAKgd,WACLhd,KAAKid,iBACLjd,KAAKod,eAAe,EAAG,GAAApd,KAAA,KAEvBA,KAAKgE,OAAO,KACRhE,KAAKmP,OAAOkO,SAASrd,KAAK3L,QAAS,SAAU2L,KAAKsd,iBAAiB,GAAAtd,KAAA,OAAAA,KAAA,SAEvE,GAAAA,KAAI,GAAS,IAAI,GAAcA,KAAK4I,KAAKgU,aAAa,EAAM5c,KAAK8Z,OAAOlqB,KAAKoQ,KAAM,UACnF,GAAAA,KAAI,GAAiB6gB,GAA6B7gB,KAAK4I,KAAKyQ,YAC5DrZ,KAAKud,YAGT,WACIvd,KAAKgE,OAAO,KACRhE,KAAKmP,OAAOkO,SAASrd,KAAK3L,QAAS,SAAU2L,KAAKsd,iBAAiB,GAAAtd,KAAA,OAAAA,KAAA,SAEvE,GAAAA,KAAI,GAAiB6gB,GAA6B7gB,KAAK4I,KAAKyQ,YAC5DrZ,KAAKud,YAGT,YACI,GAAAvd,KAAA,IAAWwc,OACXxc,KAAKwQ,YAAY,SAAO9R,OAAQ,GAAAsB,KAAA,KAChCA,KAAKwQ,YAAY,SAAOjR,YAAa,GAAAS,KAAA,KAGzC,WAAWwd,IAOX,OAAOnO,GACH,GAAIrP,KAAKgP,WAAa,GAAAhP,KAAA,IAClB,OAEJ,IAAIoF,EAAU,GAAApF,KAAA,OAAAA,KAAA,KACd,OAAQqP,EAAK9L,MACT,IAAK,OACD,GAAI,GAAAvD,KAAA,MAAqBoF,EAAQ1E,SAAU2O,EAAKxa,QAC5C,OAEJ,GAAAmL,KAAI,IAAe,GACnB,GAAAA,KAAI,GAAWqP,EAAK5K,GACpB,GAAAzE,KAAA,IAAiB0gB,WAAWtb,GAC5BpF,KAAKmP,OAAO+E,aAAa7iB,SAASkR,KAAM,UAAQnJ,WAChD,MACJ,IAAK,KACD,IAAK,GAAA4G,KAAA,IACD,MAGJA,KAAKgP,UAAW,EAChB,IAAIqS,EAAWprB,KAAKgP,IAAI,GAAAjF,KAAA,KACpBlP,EAAUuwB,EAAWrhB,KAAK4I,KAAK9X,QAC/BwwB,EAAOD,GAAY,GAAArhB,KAAA,IACvB,GAAAA,KAAA,IAAiBuhB,OAAOF,EAAUvwB,EAASwwB,GAC3C,GAAAthB,KAAA,IAAiBuhB,OAAOF,EAAUvwB,EAASwwB,GAC3CthB,KAAKmP,OAAOgF,gBAAgB9iB,SAASkR,KAAM,UAAQnJ,WACnD,GAAA4G,KAAI,IAAe,GACnB,MACJ,IAAK,OACD,IAAK,GAAAA,KAAA,IACD,MAEJ,IAAIwhB,GAAYnS,EAAK5K,EAAI,GAAAzE,KAAA,KAAgBoF,EAAQ4Z,YACjD,GAAI/oB,KAAKgP,IAAIuc,EAAW,GAAAxhB,KAAA,KAAoB,IACxC,MAEJ,IAAIyd,EAAU,6BAAmB,GAAAzd,KAAA,IAAmB,EAAI,OAAS,OAAQ,GAAAA,KAAA,OAAAA,KAAA,KACzE,GAAAA,KAAI,GAAeA,KAAKyhB,gBAAgBD,IAEpC/D,IAAY,GAAAzd,KAAA,MACZ,GAAAA,KAAA,KAAqBA,KAAKmP,OAAOmC,YAAY,UAAQrY,aAAc,GAAA+G,KAAA,KACnE,GAAAA,KAAI,GAAgB,GAAAA,KAAA,IAAcyd,IAClC,GAAAzd,KAAI,GAAYyd,GAEhB,GAAAzd,KAAA,IAAiB0gB,WAAW,GAAA1gB,KAAA,KAC5B,GAAAA,KAAA,IAAiB0hB,SAAS,GAAA1hB,KAAA,IAAmB,EAAI,GAAAA,KAAA,IAAmBqF,SAAS0b,MAAQ,GAAA/gB,KAAA,IAAmBqF,SAASmB,MACjH,GAAAxG,KAAA,IAAiB0hB,SAAS,GAAA1hB,KAAA,IAAmB,EAAI,GAAAA,KAAA,IAAmBoF,QAAQ2b,MAAQ,GAAA/gB,KAAA,IAAmBoF,QAAQoB,MAC/GxG,KAAKgE,OAAO,KACRhE,KAAKmP,OAAO+B,SAAS,UAAQjY,aAAc,GAAA+G,KAAA,QAGnDA,KAAKgE,OAAO,KACR,GAAAhE,KAAA,IAAiB4C,OAAO3M,KAAKgP,IAAI,GAAAjF,KAAA,MACjC,GAAAA,KAAA,IAAiB4C,OAAO3M,KAAKgP,IAAI,GAAAjF,KAAA,SASjD,gBAAgByV,GACZ,OAAIzV,KAAK4I,KAAKqY,KACHxL,EAEP,GAAAzV,KAAA,MAAqB,GAAAA,KAAA,IAAqB,GAAKyV,EAAQ,GAGlC,IAArB,GAAAzV,KAAA,KAA0ByV,EAAQ,EAF3B,EAKJA,EAOL,OAAOhK,G,0CACT,OAAIzL,KAAKgP,WAGThP,KAAK8c,aAAarR,IACX,MASX,kBAAkBpX,EAAkBisB,EAAmBqB,GACnD3hB,KAAKgP,UAAW,EAEhB,IAAIhY,EAAO,GAAAgJ,KAAA,OAAAA,KAAA,KACPoF,EAAU,GAAApF,KAAA,OAAAA,KAAA,KACTsgB,GAqBDtgB,KAAKmP,OAAOmC,YAAY,UAAQrY,aAAc,GAAA+G,KAAA,KAC9CA,KAAKmP,OAAOjO,gBAAgB,QAASkE,GACrCpF,KAAKmP,OAAOjO,gBAAgB,QAAS,GAAAlB,KAAA,KACrC,GAAAA,KAAI,IAAa,GACjB,GAAAA,KAAI,GAAgB,MACpB,GAAAA,KAAI,IAAY,GAChB,GAAAA,KAAI,GAAe,IA1Bf,GAAAA,KAAA,KAAiB,GACjBA,KAAKgE,OAAO,KACRhE,KAAKmP,OAAOmC,YAAY,UAAQrY,aAAcjC,GAC9CgJ,KAAKmP,OAAO+B,SAASlR,KAAKkP,gBAAiBlY,GAC3CgJ,KAAKmP,OAAOmC,YAAYtR,KAAKkP,gBAAiB9J,GAC9CpF,KAAKmP,OAAOjO,gBAAgB,QAASkE,GACrCpF,KAAKmP,OAAOjO,gBAAgB,QAASlK,GACrCgJ,KAAKod,cAAc,GAAApd,KAAA,OAAAA,KAAA,KACnBA,KAAKwR,UAAU,SAAO7S,SAAU,CAC5B4G,UAAW3R,KAAK4R,MAChBiG,MAAO,GAAAzL,KAAA,MAEX,GAAAA,KAAI,gBACJ,GAAAA,KAAI,IAAa,GACjB,GAAAA,KAAI,GAAgB,MACpB,GAAAA,KAAI,IAAY,GAChB,GAAAA,KAAI,GAAe,KAgBnC,aAAayL,GACT,IAAK,aAAGA,IACJzL,KAAKgP,WACJ,GAAAhP,KAAA,MACCA,KAAK4I,KAAKqY,MAA6B,IAArB,GAAAjhB,KAAA,KAAoC,SAAVyL,IAC5CzL,KAAK4I,KAAKqY,MAAQ,GAAAjhB,KAAA,MAAqB,GAAAA,KAAA,IAAqB,GAAe,SAAVyL,EACnE,OAEJzL,KAAKgP,UAAW,EAChB,IAAIyO,EAAU,6BAAmBhS,EAAO,GAAAzL,KAAA,OAAAA,KAAA,KACxC,GAAIyd,GAAW,GAAAzd,KAAA,KAAoByd,EAAU,GAAKA,GAAW,GAAAzd,KAAA,IAAczP,OAEvE,OADAyP,KAAK+O,KAAKzU,QAAQ,SAASmR,uCACpB,EAEX,GAAAzL,KAAI,GAAYyd,GAChB,IAAIrY,EAAU,GAAApF,KAAA,OAAAA,KAAA,KACVhJ,EAAO,GAAAgJ,KAAA,OAAAA,KAAA,KACX,GAAAA,KAAA,IAAiB0gB,WAAWtb,GAC5B,GAAApF,KAAA,IAAiB0gB,WAAW1pB,GAC5B,GAAAgJ,KAAA,IAAiB0hB,SAAmB,SAAVjW,EAAmB,GAAAzL,KAAA,IAAmBoF,QAAQoB,KAAO,GAAAxG,KAAA,IAAmBoF,QAAQ2b,OAC1G,GAAA/gB,KAAA,IAAiB0hB,SAAmB,SAAVjW,EAAmB,GAAAzL,KAAA,IAAmBqF,SAASmB,KAAO,GAAAxG,KAAA,IAAmBqF,SAAS0b,OAC5G/gB,KAAKgE,OAAO,KACR,GAAAhE,KAAA,IAAiBuhB,OAAO,EAAGvhB,KAAK4I,KAAK9X,SAAS,GAC9C,GAAAkP,KAAA,IAAiBuhB,OAAO,EAAGvhB,KAAK4I,KAAK9X,SAAS,GAC9CkP,KAAKmP,OAAO+B,SAAS,UAAQjY,aAAcjC,KAKnD,iBACI,GAAAgJ,KAAI,GAAe,aAAG,GAAAA,KAAA,KAAiB,GAAAA,KAAA,IAAcwE,UAAU3P,GAAUmL,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiBra,KAAY,GAGpI,iBAAiBuQ,GACb,OAAK,aAAGpF,KAAK4I,KAAK1Q,SAAgC,SAArB8H,KAAK4I,KAAK1Q,OAG5B8H,KAAK4I,KAAK1Q,OAFV,4BAAkBkN,GAAW,KAS5C,aACI,IAAI9V,EAAI0Q,KAAK3L,QAAQkhB,iBAAiBvV,KAAK4I,KAAK6T,SAChD,GAAAzc,KAAI,GAAY1Q,EAAEiB,OAAS,EAAI,IAAIjB,GAAK,IACxC,GAAA0Q,KAAI,GAAiB,GAAAA,KAAA,IAAczP,QAMvC,WACI,GAAAyP,KAAI,GAAU,aAAGA,KAAK4I,KAAK+T,OAAS,IAAItrB,SAASkkB,iBAAiBvV,KAAK4I,KAAK+T,QAAU,IAQ1F,cAAcvX,EAAiBpO,GACtB,aAAG,GAAAgJ,KAAA,MAGRA,KAAKgE,OAAO,KACJ,oBAAUoB,EAAS,EAAG,GAAApF,KAAA,IAAYzP,OAAS,IAC3CyP,KAAKmP,OAAOmC,YAAYtR,KAAKkP,gBAAiB,GAAAlP,KAAA,IAAYoF,IAE1D,oBAAUpO,EAAM,EAAG,GAAAgJ,KAAA,IAAYzP,OAAS,IACxCyP,KAAKmP,OAAO+B,SAASlR,KAAKkP,gBAAiB,GAAAlP,KAAA,IAAYhJ,MASnE,YACI,GAAAgJ,KAAA,IAAWwc,OACPxc,KAAK4I,KAAKgU,aACV,GAAA5c,KAAA,IAAW6K,S,+fCrVhB,MAAM,GAYT,YAAYja,EAAgBE,GAF5B,oBACA,oBAEI,GAAAkP,KAAI,GAAelP,GACnB,GAAAkP,KAAI,GAAWpP,GAEfoP,KAAK2Q,UAAW,EAChB3Q,KAAK4Q,cAAWnO,EAIpB,MAAMmG,GACF5I,KAAK4hB,MAAQ,8BAAoBhZ,EAAKgZ,OAAO,GAC7C5hB,KAAK2Q,UAAW,EAChB3Q,KAAK4Q,cAAWnO,EAChBzC,KAAKlP,QAAU,0BAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAKsQ,QAAU,6BAAmB1H,EAAK0H,QAAS,wBA7BlB,8BA6BuD,GAAAtQ,KAAA,MACrFA,KAAKuQ,SAAW,6BAAmB3H,EAAK2H,SAAU,wBA7BnB,+BA6ByD,GAAAvQ,KAAA,O,8BAIzF,MAAM6hB,GAIT,YAAYjxB,GAFZ,oBAGI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,UAIrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAiBnC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAI7D,MAAM,WAAyB,EASlC,YAAY3L,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAclC,EAAQ4F,EAAMqP,MAAMlL,eAAgBnE,GAPxG,oBACA,oBACA,oBACA,oBACA,oBACA,oBAKI,GAAAwJ,KAAI,GAAgB,IAAI,IAAwB,IAChD,GAAAA,KAAA,IAAkBmhB,YAAYnhB,KAAK8hB,cAAclyB,KAAKoQ,OACtD,GAAAA,KAAA,IAAkB0gB,WAAW1gB,KAAK3L,SAClC,GAAA2L,KAAI,IAAY,GAChB,GAAAA,KAAI,GAAU,GACd,GAAAA,KAAI,GAAmB6gB,GAAmC,MAC1D,GAAA7gB,KAAI,GAAgB,MAGxB,SACI,GAAAA,KAAI,GAAgBA,KAAKmQ,QAAQ,SAAO5Q,YAAaS,KAAKwe,OAAO5uB,KAAKoQ,QAClEA,KAAK0Q,UACL1Q,KAAKuR,OAGb,YAIA,YACIvR,KAAKwQ,YAAY,SAAOjR,YAAa,GAAAS,KAAA,KAGzC,eACI,OAAO,EAEX,cACQA,KAAK4I,KAAKgZ,OACV,GAAA5hB,KAAI,GAAgBA,KAAKmQ,QAAQ,SAAO5Q,YAAaS,KAAKwe,OAAO5uB,KAAKoQ,QAG9E,eACIA,KAAKwQ,YAAY,SAAOjR,YAAa,GAAAS,KAAA,KAGzC,gBACI,OAAO,EAGX,OAAOqP,GACH,GAAIrP,KAAKgP,SACL,OAEJ,IAAI5J,EAAUpF,KAAK3L,QACnB,OAAQgb,EAAK9L,MACT,IAAK,OACD,GAAI,GAAAvD,KAAA,MAAqBoF,EAAQ1E,SAAU2O,EAAKxa,QAC5C,OAEJ,GAAAmL,KAAI,IAAe,GACnB,GAAAA,KAAI,GAAWqP,EAAK5K,GACpBzE,KAAKmP,OAAO+E,aAAa7iB,SAASkR,KAAM,UAAQnJ,WAChD,MACJ,IAAK,KACD,IAAK,GAAA4G,KAAA,KAAmC,GAAf,GAAAA,KAAA,IACrB,MAGJA,KAAKgP,UAAW,EAChB,IAAIqS,EAAWprB,KAAKgP,IAAI,GAAAjF,KAAA,KACpBlP,EAAUuwB,EAAWrhB,KAAK4I,KAAK9X,QAC/BwwB,EAAOD,GAAY,GACvB,GAAArhB,KAAA,IAAkBuhB,OAAOF,EAAUvwB,EAASwwB,GAC5CthB,KAAKmP,OAAOgF,gBAAgB9iB,SAASkR,KAAM,UAAQnJ,WACnD,GAAA4G,KAAI,IAAe,GACnB,MACJ,IAAK,OACD,GAAI,GAAAA,KAAA,IAAkB,CAClB,IAAIwhB,GAAYnS,EAAK5K,EAAI,GAAAzE,KAAA,KAAgBoF,EAAQ4Z,aAC7C,GAAAhf,KAAA,KAAe,GAAKwhB,GAAY,GAAK,GAAAxhB,KAAA,KAAe,GAAKwhB,EAAW,IACpE,GAAAxhB,KAAA,IAAkB0hB,SAASF,EAAW,EAAI,GAAAxhB,KAAA,IAAqBoF,QAAQ2b,MAAQ,GAAA/gB,KAAA,IAAqBoF,QAAQoB,MAEhH,GAAAxG,KAAI,GAAUwhB,GACdxhB,KAAKgE,OAAO,KACR,GAAAhE,KAAA,IAAkB4C,OAAO3M,KAAKgP,IAAI,GAAAjF,KAAA,UAStD,cAAc3L,EAAkBisB,EAAmB9sB,GAC/CwM,KAAKgP,UAAW,EACXsR,IACDtgB,KAAKmP,OAAOmC,YAAYtR,KAAKkP,gBAAiBlP,KAAK3L,SACnDma,EAAe2C,QAAQnR,KAAK3L,QAAS,gBAAiB,UAE1D,GAAA2L,KAAI,GAAU,GACd,GAAAA,KAAI,GAAW,I,6VCtJhB,MAAM,GAST,YAAYpP,EAAgB2nB,GAF5B,oBACA,oBAEIvY,KAAK2Q,UAAW,EAEhB,GAAA3Q,KAAI,GAAeuY,GACnB,GAAAvY,KAAI,GAAWpP,GAInB,MAAMgY,GACF5I,KAAK2Q,SAAW,YAAa/H,EAAK+H,UAClC3Q,KAAK4Q,SAAWhI,EAAKgI,SACrB5Q,KAAKlP,QAAU,YAAgB8X,EAAK9X,QAAS,GAAAkP,KAAA,KAC7CA,KAAKsQ,QAAU,YAAmB1H,EAAK0H,QAAS,YA7BrB,8BA6B+D,GAAAtQ,KAAA,MAC1FA,KAAKuQ,SAAW,YAAmB3H,EAAK2H,SAAU,YA7BtB,+BA6BiE,GAAAvQ,KAAA,O,8BAI9F,MAAM+hB,GAGT,YAAYnxB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAe,GAAAkN,KAAA,IAAH,SAGrB,WACI,OAAO,KAGX,IAAI3L,EAAkBmC,GAClB,OAAO,IAAI,GAAgBnC,EAASmC,EAAOwJ,KAAKlN,UAAW,GAAAkN,KAAA,M,eAI5D,MAAM,WAAwB,EAKjC,YAAY3L,EAAkBmC,EAAiB1D,EAAmBlC,GAC9DkP,MAAM,mBAAoBzL,EAASvB,EAAW,IAAI,GAAalC,EAAQ4F,EAAMqP,MAAMjL,mBAAoBpE,GAJ3G,oBACA,oBAII,GAAAwJ,KAAI,GAAc,YAxDR,sBAwDiCpP,IAC3C,GAAAoP,KAAI,GAAY,GAGpB,SACIwO,EAAe2C,QAAQnR,KAAK3L,QAAS,aAAc,IAEvD,YAIA,aAIA,eACI,OAAI2L,KAAK0Y,gBAGT,GAAA1Y,KAAI,GAAYhS,OAAO8Y,cAChB,GAGX,cACI9G,KAAKmP,OAAO+B,SAAS,GAAAlR,KAAA,IAAiB3O,SAASkR,MAC/ClR,SAASkR,KAAK6B,MAAMsC,IAAM,IAAI,GAAA1G,KAAA,QAC9BwO,EAAe2C,QAAQnR,KAAK3L,QAAS,cAAe,SAGxD,eACIhD,SAASkR,KAAK6B,MAAMsC,IAAM,GAC1B1Y,OAAO4qB,SAAS,GAA2B,GAAvB,GAAA5Y,KAAA,KAAiB,IACrC,GAAAA,KAAI,GAAY,GAChBA,KAAKmP,OAAOmC,YAAY,GAAAtR,KAAA,IAAiB3O,SAASkR,MAClDiM,EAAe2C,QAAQnR,KAAK3L,QAAS,cAAe,QAGxD,gBACI,OAAO,EAGH,cACJ,OAAO2L,KAAKmP,OAAO8E,SAAS,GAAAjU,KAAA,IAAiB3O,SAASkR,O,6RCxGvD,MAAMyf,GAET,cADA,oBAEI,GAAAhiB,KAAI,GAAa,IAGrB,YAAYiiB,GACR,GAAAjiB,KAAI,GAAaiiB,GAGrB,OAAOxd,EAAWoD,GACd,IAAIqa,EAAU,GAAAliB,KAAA,IAAiB,GAAAA,KAAA,IAAemN,OAAO,CAACgV,EAAS/pB,EAAOgqB,KAClE,MAAMC,EAAMjqB,EAAMkqB,wBAClB,IAAI1N,EAAS/M,EAAIwa,EAAI3b,IAAM2b,EAAInqB,OAAS,EACxC,OAAI0c,EAAS,GAAKA,EAASuN,EAAQvN,OACxB,CAAEA,OAAQA,EAAQvgB,QAAS+D,EAAOP,IAAKuqB,GAEvCD,GAEZ,CAAEvN,OAAQ2N,OAAOC,kBAAmBnuB,QAAS,KAAMwD,KAAM,SAAO4K,EACnE,OAAOyf,EAAU,CAACA,EAAQrqB,IAAKqqB,EAAQ7tB,SAAW,EAAE,OAAGoO,I,iSCpBxD,MAAM,GAWT,YAAY/U,GAVZ,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAEI,GAAAsS,KAAI,GAAStS,GACb,GAAAsS,KAAI,GAAgB,IAAI,MACxB,GAAAA,KAAI,GAAY,KAChB,GAAAA,KAAI,IAAe,GACnB,GAAAA,KAAI,QAAcyC,GAClB,GAAAzC,KAAA,IAAkBoO,YAAYpO,KAAKwe,OAAO5uB,KAAKoQ,OAGnD,oBAAoBlP,GAChB,GAAAkP,KAAI,GAAYlP,GAGpB,YAAYyH,GACR,GAAAyH,KAAI,GAAgBzH,GAGxB,WAAWA,GACP,GAAAyH,KAAI,GAAezH,GAGvB,UAAUA,GACN,GAAAyH,KAAI,GAAczH,GAGtB,SACI,GAAAyH,KAAA,IAAkBsO,SAGtB,SACI,GAAAtO,KAAA,IAAkB6M,SAGd,OAAOwC,GACX,OAAQA,EAAK9L,MACT,IAAK,OACD,GAAI,GAAAvD,KAAA,IACA,OAGJ,GAAAA,KAAI,GAAc/O,WAAW,KACrB,GAAA+O,KAAA,KAAqB,GAAAA,KAAA,SAAAA,KAAkBqP,IACvC,GAAArP,KAAI,IAAe,IAExB,GAAAA,KAAA,MAEH,MACJ,IAAK,OACD,IAAK,GAAAA,KAAA,IACD,OAEA,GAAAA,KAAA,KACA,GAAAA,KAAA,SAAAA,KAAiBqP,GAErB,MACJ,IAAK,KAKD,GAJI,GAAArP,KAAA,MACA+a,aAAa,GAAA/a,KAAA,KACb,GAAAA,KAAI,QAAcyC,KAEjB,GAAAzC,KAAA,IACD,OAEA,GAAAA,KAAA,KACA,GAAAA,KAAA,SAAAA,KAAgBqP,GAEpB,GAAArP,KAAI,IAAe,K,obC/D5B,MAAM,GAIT,cACIA,KAAKnL,OAAS,iBATG,QAUjBmL,KAAKsa,QAAU,iBAVE,QAWjBta,KAAKlP,QAAU,IAEnB,MAAMT,GACF2P,KAAKnL,OAASxE,EAAIwE,OAAS,iBAAiB,IAAMxE,EAAIwE,OAAS,iBAd9C,QAejBmL,KAAKsa,QAAUjqB,EAAIiqB,QAAU,iBAAiB,IAAMjqB,EAAIiqB,QAAU,iBAfjD,QAgBjBta,KAAKlP,QAAU,0BAAgBT,EAAIS,QAAS,MAK7C,MAAM2xB,GAGT,YAAY7xB,GADZ,oBAEI,GAAAoP,KAAI,GAAWpP,UAAU,OACzBoP,KAAKlN,UAAY,GAAAkN,KAAA,IAAe,YAEpC,WACI,OAAO,KAEX,IAAI3L,EAAsBquB,GACtB,OAAO,IAAI,GAAmBruB,EAAS2L,KAAKlN,UAAW4vB,EAAQ,GAAA1iB,KAAA,M,eAIhE,MAAM,WAA2B8P,EAepC,YAAYzb,EAAsBvB,EAAmB0D,EAAiB5F,GAClEkP,MAAM,qBAAsBzL,EAASvB,EAAW,IAAI,GAAmB0D,GAf3E,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBACA,oBAEA,oBACA,oBAGI,GAAAwJ,KAAI,GAAgB,IAAI,GAAe3L,IACvC,GAAA2L,KAAA,IAAkB2iB,YAAY3iB,KAAK2iB,YAAY/yB,KAAKoQ,OACpD,GAAAA,KAAA,IAAkB4iB,WAAW5iB,KAAK4iB,WAAWhzB,KAAKoQ,OAClD,GAAAA,KAAA,IAAkB6iB,UAAU7iB,KAAK6iB,UAAUjzB,KAAKoQ,OAChD,GAAAA,KAAI,GAAc,wBA1DC,kBA0DiCpP,IACpD,GAAAoP,KAAI,GAAe,wBAzDE,4BAyDkCpP,IACvD,GAAAoP,KAAI,GAAc,wBAzDE,2BAyDiCpP,IACrD,GAAAoP,KAAI,GAAa,IAAIgiB,IACrB,GAAAhiB,KAAI,QAAkByC,GACtB,GAAAzC,KAAI,GAAc,IAAI,IACtB,GAAAA,KAAA,IAAgBmhB,YAAY,KACxBnhB,KAAK8iB,mBACL9iB,KAAK+iB,uBACL/iB,KAAKxJ,MAAM6N,IAAIoB,KAAK,SAAOjG,UAAW,MAAM,KAKpD,SACI,GAAAQ,KAAA,IAAkBsO,SAClBtO,KAAK+iB,uBAGT,WACQ/iB,KAAK4I,KAAK/T,SAAWmL,KAAKwP,SAAS3a,QACnCmL,KAAK4I,KAAK0R,UAAYta,KAAKwP,SAAS8K,SACpCta,KAAK+iB,uBAET,GAAA/iB,KAAA,IAAkBgjB,oBAAoBhjB,KAAK4I,KAAK9X,SAGpD,YACI,GAAAkP,KAAA,IAAkB6M,SAOd,uBACJ,IAKI,GAJA,GAAA7M,KAAI,GAAY,IAAIA,KAAK3L,QAAQkhB,iBAAiBvV,KAAK4I,KAAK/T,UAC5D,GAAAmL,KAAI,GAAa,IAAIA,KAAK3L,QAAQkhB,iBAAiBvV,KAAK4I,KAAK0R,WAC7D/mB,QAAQkU,IAAI,GAAAzH,KAAA,KACZzM,QAAQkU,IAAI,GAAAzH,KAAA,KACR,GAAAA,KAAA,IAAezP,SAAW,GAAAyP,KAAA,IAAczP,OACxC,MAAM,IAAIsP,MAAM,iDAEpB,GAAAG,KAAA,IAAeijB,YAAY,GAAAjjB,KAAA,KAC7B,MAAO1M,GACL0M,KAAK+O,KAAKvb,MAAM,wCAChBwM,KAAK+O,KAAKsI,UAAU/jB,EAAG,wBACvB,GAAA0M,KAAI,GAAY,IAChB,GAAAA,KAAI,GAAa,KAIjB,YAAYqP,GAGhB,OAFA,GAAArP,KAAI,GAAeA,KAAKkjB,qBAAqB7T,EAAKxa,SAClD,GAAAmL,KAAI,GAAkB,GAAAA,KAAA,KAAoB,EAAI,GAAAA,KAAA,OAAAA,KAAA,UAAiDyC,KAC1F,GAAAzC,KAAA,MAGLA,KAAKxJ,MAAM6N,IAAIoB,KAAK,SAAOjG,UAAW,MAAM,GAC5CQ,KAAKmjB,qBACE,GAGH,WAAW9T,GACfrP,KAAKue,KAAKlP,GAGN,UAAUA,GACd,GAAArP,KAAA,IAAgB0gB,WAAW,GAAA1gB,KAAA,KAC3B,GAAAA,KAAA,IAAgB0hB,SAAS1hB,KAAKojB,sBAC9B,GAAApjB,KAAA,IAAgBuhB,OAAO,EAAG,KAAK,GAG3B,qBAAqB1sB,GACzB,OAAO,GAAAmL,KAAA,IAAewE,UAAW8V,GACtBA,EAAQ5Z,SAAS7L,IAIxB,oBACJmL,KAAKgE,OAAO,KACRhE,KAAKmP,OAAO+B,SAAS,GAAAlR,KAAA,OAAAA,KAAA,KACrBA,KAAKmP,OAAO+B,SAAS,aAAclR,KAAK3L,SACxC2L,KAAKmP,OAAO+B,SAAS,UAAQ9X,UAAW/H,SAASkR,MACjDvC,KAAKqjB,gBACLrjB,KAAKsjB,iBAIL,mBACJtjB,KAAKgE,OAAO,KACJ,GAAAhE,KAAA,QAAAA,KAAA,KACAA,KAAKujB,cAAc,GAAAvjB,KAAA,OAAAA,KAAA,KAEvBA,KAAKmP,OAAOmC,YAAY,GAAAtR,KAAA,OAAAA,KAAA,KACxBA,KAAKmP,OAAOmC,YAAY,UAAQlY,UAAW/H,SAASkR,MACpDvC,KAAKmP,OAAOmC,YAAY,aAActR,KAAK3L,SAC3C2L,KAAKwjB,gBACLxjB,KAAKyjB,eACL,GAAAzjB,KAAI,QAAkByC,GACtB,GAAAzC,KAAI,QAAkByC,KAItB,KAAK4M,GACTrP,KAAKgE,OAAO,KACRhE,KAAK0jB,YAAYrU,GACjBrP,KAAK2jB,WAAWtU,KAIhB,gBACJ,GAAArP,KAAI,GAAY,IAAI,KAAe,OAAO2O,WAAW,GAAA3O,KAAA,KAAkBgT,SACvE,GAAAhT,KAAA,IAAcoE,MAAMxR,MAAW,GAAAoN,KAAA,IAAoBgf,YAAvB,KAC5B,GAAAhf,KAAA,IAAcoE,MAAMlM,OAAY,GAAA8H,KAAA,IAAoB3H,aAAvB,KAC7B,GAAA2H,KAAA,IAAcoE,MAAMsC,IAAS,GAAA1G,KAAA,IAAoB1L,UAAvB,KAC1B,GAAA0L,KAAA,IAAcoE,MAAMoC,KAAU,GAAAxG,KAAA,IAAoBtL,WAAvB,KAC3BrD,SAASkR,KAAKoL,YAAY,GAAA3N,KAAA,KAGtB,eACJ,GAAAA,KAAI,GAAW,IAAI,KAAe,OAAO2O,WAAW,GAAA3O,KAAA,KAAiBgT,SACrE,GAAAhT,KAAA,IAAaoE,MAAMxR,MAAW,GAAAoN,KAAA,IAAoBgf,YAAvB,KAC3B,GAAAhf,KAAA,IAAaoE,MAAMlM,OAAY,GAAA8H,KAAA,IAAoB3H,aAAvB,KAC5B2H,KAAK3L,QAAQsZ,YAAY,GAAA3N,KAAA,KAGrB,eACA,GAAAA,KAAA,MACA,GAAAA,KAAA,IAAaY,SACb,GAAAZ,KAAI,GAAW,OAIf,gBACA,GAAAA,KAAA,MACA,GAAAA,KAAA,IAAcY,SACd,GAAAZ,KAAI,GAAY,OAIhB,YAAYqP,GACX,GAAArP,KAAA,MAIL,GAAAA,KAAA,IAAcoE,MAAMsC,IAAS2I,EAAKxH,EAAR,KAC1B,GAAA7H,KAAA,IAAcoE,MAAMoC,KAAU6I,EAAK5K,EAAR,MAGvB,WAAW4K,GACf,IAAK,GAAArP,KAAA,IACD,OAEJ,IAAKnI,EAAK+rB,GAAY,GAAA5jB,KAAA,IAAe6jB,OAAOxU,EAAK5K,EAAG4K,EAAKxH,GACrDhQ,GAAO,IAAMA,EAAM,GAAAmI,KAAA,KAAoBnI,EAAM,GAAAmI,KAAA,IAAmB,IAAM,GAAAA,KAAA,MAAwB4jB,IACzF5jB,KAAKmP,OAAO8E,SAASjU,KAAKkP,gBAAiB,GAAAlP,KAAA,MAC5CA,KAAKmP,OAAO+B,SAASlR,KAAKkP,gBAAiB,GAAAlP,KAAA,KAE/CA,KAAKujB,cAAc,GAAAvjB,KAAA,IAAc4jB,GACjC,GAAA5jB,KAAI,GAAkB4jB,IAItB,cAAcE,EAAiBC,GAC/BA,EACA/jB,KAAK3L,QAAQ6e,aAAa4Q,EAAQC,GAElC/jB,KAAK3L,QAAQsZ,YAAYmW,GAIzB,qBACJ,MAAMzB,EAAM,GAAAriB,KAAA,IAAasiB,wBACzB,MAAO,CACHpD,QAAS,CACL/mB,KAAM,EACNqc,GAAI,GAER9N,IAAK,CACDvO,KAAM,GAAA6H,KAAA,IAAc1L,UACpBkgB,GAAI6N,EAAI3b,IAAM,EAAI2b,EAAI3b,IAAM,GAAA1G,KAAA,IAAc1L,UAC1C6qB,KAAM,MAEV3Y,KAAM,CACFrO,KAAM,GAAA6H,KAAA,IAActL,WACpB8f,GAAI6N,EAAI7b,KAAO,EAAI6b,EAAI7b,KAAO,GAAAxG,KAAA,IAActL,WAC5CyqB,KAAM,Q,ouBC/Nf,MAAM,GAET,cADA,oBAEI,GAAAnf,KAAI,GAAWhS,QAGb,KAAK6X,G,0CACP,IAAIme,EAAQ,+BAAuB,IAAI,KAAmBne,EAAMA,OAChE,MAAMoe,EAAoBD,EAAS3hB,IAC7B+K,EAAwB,CAC1BA,QAAQ,GAEZ,GAAI,YAAG,GAAApN,KAAA,IAAaikB,IAEhB,OADA7W,EAAO3Z,QAAU,kCACV2Z,EAEX,GAAI,YAAGvH,EAAMqe,OACT,IAAK,IAAI1R,KAAQ3M,EAAMqe,MACnB,IAAM1R,GAAQ3M,EAAMqe,MAAM1R,GAGlC,GAAI,YAAG3M,EAAMse,iBACT,IAAK,IAAI9K,KAAaxT,EAAMse,gBACxBtD,GAA6BxH,GAAaxT,EAAMse,gBAAgB9K,GAIxE,IACI,GAAArZ,KAAA,IAAaikB,GAAa,IAAI,IAAYD,EAAUne,EAAM5D,QAAS4D,EAAMtP,YACzE,GAAAyJ,KAAA,IAAaikB,GAAW/hB,OAC1B,MAAO5O,GAGL,OAFAC,QAAQC,MAAMF,GACd8Z,EAAO3Z,QAAU,yCACV2Z,EAGX,OADAA,EAAOA,QAAS,EACTA,M,eAIR,MAAM,GAET,cADA,oBAEI,GAAApN,KAAI,IAAkB,GAGpB,KAAKqP,G,gDACP,GAAI,GAAArP,KAAA,IAEA,OADAzM,QAAQkU,IAAI,kCACL,EAEX,MAAM2c,EAAc,IAAI,GAClBC,EAA2B,CAC7B,IAAI,EAAuB,CAAElW,WAAW,IACxC,IAAI,GAAuB,CAAE2H,WAAW,IACxC,IAAI,GAAsB,MAC1B,IAAI,IAGFwO,EAAiC,CACnC,IAAI7R,EACJ,IAAI,GACJ,IAAI,GACJ,IAAI2B,GACJ,IAAI,GACJ,IAAIY,GACJ,IAAIqB,GACJ,IAAIU,GACJ,IAAIc,GACJ,IAAIK,GACJ,IAAIG,GACJ,IAAII,GACJ,IAAIQ,GACJ,IAAIK,GACJ,IAAIkB,GACJ,IAAIkB,GACJ,IAAImB,GACJ,IAAIiB,GACJ,IAAIQ,GACJ,IAAI4C,GACJ,IAAIW,GACJ,IAAIE,GACJ,IAAIU,IAGR,IAAIrV,QAAegX,EAAYliB,KAAK,CAChC2D,MAAOwJ,EAAKxJ,MACZqe,MAAO7U,EAAK6U,MACZjiB,QAAS,YAAGoN,EAAKpN,SAAW,IAAIoiB,KAAehV,EAAKpN,SAAWoiB,EAC/D9tB,WAAY,YAAG8Y,EAAK9Y,YAAc,IAAI+tB,KAAkBjV,EAAK9Y,YAAc+tB,EAC3EH,gBAAiB9U,EAAK8U,kBAE1B,OAAI/W,EAAOA,QACP,GAAApN,KAAI,IAAkB,IACf,IAEPzM,QAAQC,MAAM,yCAAuD,QAAd,EAAA4Z,EAAO3Z,eAAO,QAAI,QAE7EF,QAAQkU,IAAI,6BACL,O,wpBC7HR,MAAM,EAOT,YAAYwa,EAAqBzrB,GANjC,mBACA,mBACA,mBACA,mBACA,mBACA,mBAEI,EAAAwJ,KAAI,EAAaiiB,GACjB,EAAAjiB,KAAI,GAAa,GACjB,EAAAA,KAAI,EAAW,IAAiB/Q,IAAI,mBACpC,EAAA+Q,KAAI,EAAUxJ,GACd,EAAAwJ,KAAI,EAAQpM,KAAK4R,OACjB,EAAAxF,KAAI,EAAkB,IAAI,IAAiBxJ,EAAM2M,eAG/C,YAAY3C,G,yCACd,QAAK,YAAGA,IAGDR,KAAKzR,KAAM8F,IACTA,EAAQoM,UAAUC,SAASF,GAG5BnM,EAAQoM,UAAUG,OAAOJ,GAFzBnM,EAAQoM,UAAUE,IAAIH,IAI3B,kBAGD,cAAcA,G,yCAChB,QAAK,YAAGA,IAGDR,KAAKzR,KAAM8F,IACd,IAAI4R,EAAU5R,EAAQoM,UACtB,EAAAT,KAAA,GAAYmD,aAAaiM,MAAM,KACtBnJ,EAAQvF,SAASF,GAGlB,EAAAR,KAAA,GAAYmD,aAAaa,OAAOiC,EAAQrF,OAAQqF,EAASzF,GAFzD,EAAAR,KAAA,GAAYmD,aAAaa,OAAOiC,EAAQtF,IAAKsF,EAASzF,IAI3DR,OAEJ,oBAGD,SAASQ,G,yCACX,QAAK,YAAGA,IAGDR,KAAKzR,KAAM8F,IACTA,EAAQoM,UAAUC,SAASF,IAC5BnM,EAAQoM,UAAUE,IAAIH,IAE3B,eAGD,WAAWA,G,yCACb,QAAK,YAAGA,IAIDR,KAAKzR,KAAM8F,IACd,IAAI4R,EAAU5R,EAAQoM,UACtB,EAAAT,KAAA,GAAYmD,aAAaiM,MAAM,KACtBnJ,EAAQvF,SAASF,IAClB,EAAAR,KAAA,GAAYmD,aAAaa,OAAOiC,EAAQtF,IAAKsF,EAASzF,IAE3DR,OAEJ,iBAGD,YAAYQ,G,yCACd,QAAK,YAAGA,IAGDR,KAAKzR,KAAM8F,IACVA,EAAQoM,UAAUC,SAASF,IAC3BnM,EAAQoM,UAAUG,OAAOJ,IAE9B,kBAGD,cAAcA,G,yCAChB,QAAK,YAAGA,IAGDR,KAAKzR,KAAM8F,IACd,IAAI4R,EAAU5R,EAAQoM,UACtB,EAAAT,KAAA,GAAYmD,aAAaiM,MAAM,KACvBnJ,EAAQvF,SAASF,IACjB,EAAAR,KAAA,GAAYmD,aAAaa,OAAOiC,EAAQrF,OAAQqF,EAASzF,IAE9DR,OACJ,kBAGP,aAAa6O,GACT,OAAK,YAAGA,GAGD,EAAA7O,KAAA,GAAemN,OAAiB,CAAC9c,EAAe+U,KAC/CA,EAAQzO,aAAakY,GACrBxe,EAAIqU,KAAKU,EAAQhQ,aAAayZ,IAE9Bxe,EAAIqU,KAAK,MAENrU,GACR,IATQ,KAYT,aAAawe,EAAuB0V,G,yCACtC,QAAK,YAAG1V,IAGD7O,KAAKzR,KAAM8F,IACdA,EAAQ8C,aAAa0X,EAAe0V,UAAkB,KACvD,mBAGD,eAAe1V,EAAuB0V,G,yCACxC,QAAK,YAAG1V,IAGD7O,KAAKzR,KAAM8F,IACd,EAAA2L,KAAA,GAAYmD,aAAaa,OAAO3P,EAAQ8C,aAAc9C,EAASwa,EAAe0V,UAAkB,KACjG,qBAGD,gBAAgB1V,G,yCAClB,QAAK,YAAGA,IAGD7O,KAAKzR,KAAM8F,IACdA,EAAQ6M,gBAAgB2N,IACzB,sBAGD,kBAAkBA,G,yCACpB,QAAK,YAAGA,IAGD7O,KAAKzR,KAAM8F,IACd,EAAA2L,KAAA,GAAYmD,aAAaa,OAAO3P,EAAQ6M,gBAAiB7M,EAASwa,IACnE,wBAGD,gBAAgBA,EAAuB0V,G,yCACzC,QAAK,YAAG1V,IAGD7O,KAAKzR,KAAM8F,IACVA,EAAQsC,aAAakY,GACrBxa,EAAQ6M,gBAAgB2N,GAExBxa,EAAQ8C,aAAa0X,EAAe0V,UAAkB,KAE3D,sBAGD,kBAAkB1V,EAAuB0V,G,yCAC3C,QAAK,YAAG1V,IAGD7O,KAAKzR,KAAM8F,IACd,EAAA2L,KAAA,GAAYmD,aAAaiM,MAAM,KACvB/a,EAAQsC,aAAakY,GACrB,EAAA7O,KAAA,GAAYmD,aAAaa,OAAO3P,EAAQ6M,gBAAiB7M,EAASwa,GAElE,EAAA7O,KAAA,GAAYmD,aAAaa,OAAO3P,EAAQ8C,aAAc9C,EAASwa,EAAe0V,UAAkB,KAErGvkB,OAEJ,wBAGD,MAAMsU,G,yCACR,QAAK,YAAGA,IAGDtU,KAAKzR,KAAM8F,IACdA,EAAQuQ,iBAAiB,QAAS0P,IACnC,YAGD,MAAMkQ,EAAmBjsB,G,yCAC3B,SAAK,YAAGisB,KAAe,YAAGjsB,KAGnByH,KAAKzR,KAAM8F,IACdA,EAAQuQ,iBAAiB4f,EAAWjsB,IACrC,YAGD,KAAKA,EAAqD5E,G,yCAS5D,OARI,EAAJ,SACI,EAAAqM,KAAA,GAAaxM,MAAM,oBAAqBG,GAE5CqM,KAAKykB,OACL,EAAAzkB,KAAA,GAAe9L,QAAQ,CAACG,EAASoX,KAC7BlT,EAASlE,EAASoX,KAEtBzL,KAAK0kB,UACE,KAGL,QAAQlkB,EAAmB1P,G,yCAC7B,IAAK,YAAG0P,GACJ,OAAO,EAEX,MAAMmkB,EAAQ7zB,UAAW,EAAAkP,KAAA,GAAY6F,MAAMlL,cAC3C,OAAOqF,KAAKzR,KAAM8F,IACd2L,KAAK4kB,OAAO,KACRvwB,EAAQoM,UAAUE,IAAIH,GACtBnM,EAAQoM,UAAUE,IAAI,IAAQ1H,cAC9BhI,WAAW,KACP+O,KAAK4kB,OAAO,KACRvwB,EAAQoM,UAAUG,OAAOJ,GACzBnM,EAAQoM,UAAUG,OAAO,IAAQ3H,iBAEtC0rB,UAKT,KAAKE,EAAmBC,EAAwBh0B,G,yCAClD,IAAK,YAAI+zB,EAAWC,GAChB,OAAO,EAEX,MAAMH,EAAQ7zB,UAAW,EAAAkP,KAAA,GAAY6F,MAAMlL,cACrCoQ,EAAS,IAAI,IAAe+Z,GAClC,OAAO9kB,KAAKzR,KAAM8F,IACd,EAAA2L,KAAA,GAAoB+Q,cAAc1c,EAAS0W,EAAQ4Z,GAAOzN,KAAK,KAC3D7iB,EAAQoM,UAAUE,IAAIkkB,UAK5B,MAAME,EAAoBD,EAAwBh0B,G,yCACpD,IAAK,YAAIi0B,EAAYD,GACjB,OAAO,EAEX,MAAMH,EAAQ7zB,UAAW,EAAAkP,KAAA,GAAY6F,MAAMlL,cACrCoQ,EAAS,IAAI,IAAe+Z,GAClC,OAAO9kB,KAAKzR,KAAM8F,IACd,EAAA2L,KAAA,GAAoB+Q,cAAc1c,EAAS0W,EAAQ4Z,GAAOzN,KAAK,KAC3D7iB,EAAQoM,UAAUG,OAAOmkB,UAKrC,KAAK1e,KAAkBuC,GACd,YAAGvC,GAIRrG,KAAKzR,KAAM8F,IACP,IAAI2V,EAAqB3V,EAAiB0C,MACtC,YAAGiT,KACH,EAAAhK,KAAA,GAAa+L,MAAM,kBAAkB1F,QAAY2D,KACjD,EAAAhK,KAAA,GAAYqE,IAAIoB,KAAKY,EAAO2D,KAASpB,KAE1C,QATC,EAAA5I,KAAA,GAAa1F,QAAQ,gCAAiC,QAY9D,GAAG+L,EAAe9N,GACd,IAAIysB,EAAgB,GACpB,OAAK,YAAI3e,EAAO9N,IAKhByH,KAAKzR,KAAM8F,IACP,IAAI4wB,EAA2B5wB,EAC3B,YAAG4wB,IACHD,EAAItgB,KAAK,EAAA1E,KAAA,GAAYqE,IAAIuI,GAAGvG,EAAO9N,EAAU0sB,KAElD,MACID,IAVH,EAAAhlB,KAAA,GAAaxM,MAAM,sBAAuB,MACnCwxB,GAYf,OAAO3e,EAAezE,GACb,YAAIyE,EAAOzE,IACZ,EAAA5B,KAAA,GAAaxM,MAAM,sBAAuB,UAE9CwM,KAAKzR,KAAM8F,IACP,IAAI4wB,EAA2B5wB,EAC3B,YAAG4wB,IACH,EAAAjlB,KAAA,GAAYqE,IAAIwI,OAAOxG,EAAOzE,EAAIqjB,IAEvC,UAGP,KAAK1sB,KAAkBqQ,GACnB,EAAA5I,KAAA,GAAYmD,aAAaiM,MAAM7W,EAAUyH,QAAS4I,GAGtD,OAAOrQ,KAAkBqQ,GACrB,EAAA5I,KAAA,GAAYmD,aAAaa,OAAOzL,EAAUyH,QAAS4I,GAGvD,WACI,OAAO,EAAP,QAGJ,QACI,OAAO,EAAA5I,KAAA,GAAezP,OAG1B,OACI,EAAAyP,KAAI,GAAa,GAGrB,SACI,EAAAA,KAAI,GAAa,GAGrB,WACI,OAAO,EAAP,QAGJ,UACI,OAAQpM,KAAK4R,MAAQ,EAAH,QAAgB,M,ooBCvUnC,MAAM,EAST,YAAYlD,EAAqC1R,EAAgB+J,GARjE,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBACA,mBAEI,EAAAqF,KAAI,EAAiBsC,GACrB,EAAAtC,KAAI,EAAa,IAAIpP,WACrB,EAAAoP,KAAI,EAAiBpP,EAAH,UAClB,EAAAoP,KAAI,EAAiBpP,EAAH,WAClB,EAAAoP,KAAI,EAAkBrF,GACtB,EAAAqF,KAAI,GAAS,GACb,EAAAA,KAAI,EAAiBpP,EAAH,uBAClB,EAAAoP,KAAI,EAAkBpP,EAAH,wBAGjB,KAAK6C,G,yCACP,GAAI,EAAAuM,KAAA,GACA,OAAO,EAEX,EAAAA,KAAI,GAAS,GACb,IAAIklB,EAAe7zB,SAASuhB,cAAc,EAAA5S,KAAA,IAkC1C,OAjCK,YAAGklB,KACJA,EAAe7zB,SAASC,cAAc,OACtC4zB,EAAazkB,UAAUE,IAAI,EAAAX,KAAA,IAC3B3O,SAASkR,KAAKoL,YAAYuX,SACpB,YAAM,KAGhB,EAAAllB,KAAA,GAAmBgE,OAAO,KACtBkhB,EAAaC,YAAc1xB,EAC3ByxB,EAAazkB,UAAUE,IAAI,IAAQ1H,cACnCisB,EAAazkB,UAAUE,IAAI,EAAAX,KAAA,KAC5BA,YAEG,YAAM,EAAAA,KAAA,IACZ,EAAAA,KAAA,GAAmBgE,OAAO,KACtBkhB,EAAazkB,UAAUG,OAAO,IAAQ3H,cACtCisB,EAAazkB,UAAUG,OAAO,EAAAZ,KAAA,IAC9BklB,EAAazkB,UAAUE,IAAI,EAAAX,KAAA,KAC5BA,YACG,YAAM,KACZ,EAAAA,KAAA,GAAmBgE,OAAO,KACtBkhB,EAAazkB,UAAUE,IAAI,IAAQ1H,cACnCisB,EAAazkB,UAAUE,IAAI,EAAAX,KAAA,KAC5BA,MAEH/O,WAAW,KACP,EAAA+O,KAAA,GAAmBgE,OAAO,KACtBkhB,EAAazkB,UAAUG,OAAO,IAAQ3H,cACtCisB,EAAazkB,UAAUG,OAAO,EAAAZ,KAAA,IAC9BklB,EAAazkB,UAAUG,OAAO,EAAAZ,KAAA,KAC/BA,MACH,EAAAA,KAAI,GAAS,IACd,EAAAA,KAAA,KACI,M,kpBC1DR,MAAM,EAMT,YAAYmD,GALZ,mBACA,mBACA,mBACA,mBACA,mBAEI,EAAAnD,KAAI,EAAiBmD,GACrB,EAAAnD,KAAI,EAAQ,IAAiB/Q,IAAI,sBAGrC,YAAYgzB,GACR,EAAAjiB,KAAI,EAAaiiB,GAGrB,UAAUzhB,GACN,EAAAR,KAAI,EAAgBQ,GAGxB,kBAAkB4kB,EAAyBC,EAAsBC,EAAgBC,GAC7EF,EAAY5kB,UAAUE,IAAI,IAAQ1H,cAClCmsB,EAAe3kB,UAAUE,IAAI4kB,GAC7BF,EAAY5kB,UAAUE,IAAI2kB,GAG9B,gBAAgBF,EAAyBC,EAAsBC,EAAgBC,GAC3EF,EAAY5kB,UAAUG,OAAO,IAAQ3H,cACrCmsB,EAAe3kB,UAAUG,OAAO2kB,GAChCF,EAAY5kB,UAAUG,OAAO0kB,GAC7BF,EAAe3kB,UAAUG,OAAO,EAAAZ,KAAA,IAChCqlB,EAAY5kB,UAAUE,IAAI,EAAAX,KAAA,IAG9B,YAAYyL,EAAerG,EAAiBvM,GACxC,OAAO4S,GAAS,GAAKA,IAAUrG,GAAWqG,EAAQ5S,EAGhD,WAAW2sB,EAAkBpgB,G,yCAO/B,OANApF,KAAKykB,OACL,EAAAzkB,KAAA,GAAU+L,MAAM,yBAAyB3G,QAAcogB,KACnDpgB,GAAW,GACX,EAAApF,KAAA,GAAeoF,GAAS3E,UAAUG,OAAO,EAAAZ,KAAA,IAC7C,EAAAA,KAAA,GAAewlB,GAAU/kB,UAAUE,IAAI,EAAAX,KAAA,IACvCA,KAAK0kB,UACE,KAGL,wBAAwBc,EAAkBC,EAAqBC,EAAsBC,EAAkBvgB,G,yCACzGpF,KAAKykB,OACL,EAAAzkB,KAAA,GAAU+L,MAAM,yBAAyB3G,QAAcogB,KAEvD,MAAMJ,EAAiB,EAAAplB,KAAA,GAAeoF,GAChCigB,EAAc,EAAArlB,KAAA,GAAewlB,GAMnC,OALA,EAAAxlB,KAAA,GAAmBgE,OAAOhE,KAAK4lB,kBAAmB5lB,KAAMolB,EAAgBC,EAAaI,EAAaC,GAClGz0B,WAAW,KACP,EAAA+O,KAAA,GAAmBgE,OAAOhE,KAAK6lB,gBAAiB7lB,KAAMolB,EAAgBC,EAAaI,EAAaC,GAChG1lB,KAAK0kB,UACNiB,IACI,KAGX,kBACI,IAAK,YAAG,EAAA3lB,KAAA,IACJ,OAAQ,EAEZ,IAAI8lB,EAAM9lB,KAAKnH,QACf,IAAK,IAAIzK,EAAI,EAAGA,EAAI03B,EAAK13B,IACrB,GAAI,EAAA4R,KAAA,GAAe5R,GAAGqS,UAAUC,SAAS,EAAAV,KAAA,IACrC,OAAO5R,EAGf,OAAQ,EAGZ,WACI,OAAO,EAAA4R,KAAA,GAGX,QACI,OAAI,EAAAA,KAAA,IACA,EAAAA,KAAA,GAAU1F,QAAQ,uCAAwC,UACnD,GACC,YAAG,EAAA0F,KAAA,MAGJA,KAAKnH,SAAW,KACvB,EAAAmH,KAAA,GAAU1F,QAAQ,yBAA0B,UACrC,IAJP,EAAA0F,KAAA,GAAU1F,QAAQ,yCAA0C,UACrD,GAQf,QACI,OAAO,EAAA0F,KAAA,GAAiB,EAAAA,KAAA,GAAezP,QAAU,EAGrD,OACI,EAAAyP,KAAI,GAAa,GAGrB,SACI,EAAAA,KAAI,GAAa,I,omBCtGlB,MAAM,EAMT,YAAYiiB,EAAqB9e,GALjC,mBAEA,mBACA,mBAGI,EAAAnD,KAAI,EAAQ,IAAiB/Q,IAAI,sBACjC,EAAA+Q,KAAI,EAAW,IAAI,EAAwBmD,IAC3C,EAAAnD,KAAA,GAAaijB,YAAYhB,GACzB,EAAAjiB,KAAI,EAAQpM,KAAK4R,OAGrB,UAAUhF,GACN,EAAAR,KAAA,GAAa+lB,UAAUvlB,GAG3B,YAAYyhB,GACR,EAAAjiB,KAAA,GAAaijB,YAAYhB,GAG7B,MAAM1pB,GACF,EAAAyH,KAAA,GAAaiiB,WAAW/tB,QAAQ,CAACG,EAASoX,KACtCpX,EAAQuQ,iBAAiB,QAAS,KAC9B5E,KAAKwD,IAAIiI,GAAOyL,KAAK,KACb3e,GACAA,EAASlE,EAASoX,SAOhC,O,yCACF,IAAK,EAAAzL,KAAA,GAAagmB,QACd,OAAO,EAEX,IAAIC,EAAS,EAAAjmB,KAAA,GAAakmB,kBAAoB,EAC9C,OAAOlmB,KAAKwD,IAAIyiB,GAAUjmB,KAAKzP,SAAW,EAAI01B,MAG5C,W,yCACF,IAAK,EAAAjmB,KAAA,GAAagmB,QACd,OAAO,EAEX,IAAIC,EAAS,EAAAjmB,KAAA,GAAakmB,kBAAoB,EAC9C,OAAOlmB,KAAKwD,IAAIyiB,EAAS,EAAIjmB,KAAKzP,SAAW,EAAI01B,MAG/C,IAAIxa,G,yCACN,IAAIrG,EAAU,EAAApF,KAAA,GAAakmB,kBAC3B,SAAK,EAAAlmB,KAAA,GAAagmB,UAAY,EAAAhmB,KAAA,GAAammB,YAAY1a,EAAOrG,EAASpF,KAAKzP,YAGrE,EAAAyP,KAAA,GAAakV,WAAWzJ,EAAOrG,MAGpC,iBAAiBqG,EAAega,EAAqBC,EAAsBC,G,yCAC7E,IAAIvgB,EAAU,EAAApF,KAAA,GAAakmB,kBAC3B,SAAK,EAAAlmB,KAAA,GAAagmB,UAAY,EAAAhmB,KAAA,GAAammB,YAAY1a,EAAOrG,EAASpF,KAAKzP,YAGrE,EAAAyP,KAAA,GAAaomB,wBAAwB3a,EAAOga,EAAaC,EAAcC,EAAUvgB,MAG5F,kBACI,OAAO,EAAApF,KAAA,GAAakmB,kBAGxB,SACI,OAAO,EAAAlmB,KAAA,GAAanH,QAGxB,UACI,OAAOmH,KAAKzP,SAAW,GAAKqD,KAAK4R,MAAQ,EAAAxF,KAAA,GAAY,M,ulBCzEtD,MAAM,GAIT,YAAYiC,GAHZ,mBACA,mBACA,mBAEI,EAAAjC,KAAI,EAAYiC,UAAW,IAC3B,EAAAjC,KAAI,EAAQ,IAAiB/Q,IAAI,qBAGrC,KAAKuH,GACD,GAAAwJ,KAAA,GAAU+L,MAAM,mCAAqC,GAAA/L,KAAA,GAAczP,QACnE,EAAAyP,KAAI,EAAY,GAAAA,KAAA,GAAcpJ,OAAQyvB,GAC3B,YAAGA,EAAO1U,YAErB,GAAA3R,KAAA,GAAc9L,QAAQmyB,IAClBA,EAAOnkB,KAAK1L,GACZA,EAAMqP,MAAM5D,QAAQokB,EAAOnY,aAAemY,EAAOxgB,QAErD,GAAA7F,KAAA,GAAU+L,MAAM,iCAGpB,IAAIpd,GACA,GAAK,YAAGA,GAGR,OAAO,GAAAqR,KAAA,GAAc3I,KAAKnH,GAAKA,EAAEvB,OAASA,GAGxC,WAAWgjB,G,yCACb,IAAI5I,EAA4B,GAKhC,OAJA,GAAA/I,KAAA,GAAc9L,QAASmyB,IACnBtd,EAAMrE,KAAK2hB,EAAO1U,SAASA,cAED5gB,QAAQ4U,IAAIoD,IAC5B1R,KAAKhH,W,gUCpCpB,MAAM,GAOT,YAAYO,EAAgB01B,EAAkBC,GAN9C,oBACA,oBACA,oBACA,oBACA,oBACA,oBAEI,GAAAvmB,KAAI,GAAWpP,GACf,GAAAoP,KAAI,MAAWA,KAAI,MAAWA,KAAI,GAAS,QAC3C,GAAAA,KAAI,GAAaumB,UAAY,IAC7B,GAAAvmB,KAAI,GAAYsmB,GAGpB,aAAaE,EAAevgB,EAAmBgc,GACtC,cAAGhc,KACJA,EAAU,IAET,cAAGgc,KACJA,EAAW,IAEf,IAAIwE,EAAgB,IAAI,KAAe,OACvCA,EAAc9X,WAAc,GAAA3O,KAAA,IAAH,oBAAoCiG,GAC7D,GAAAjG,KAAI,GAAWymB,EAAczT,SAE7B,IAAI0T,EAAe,IAAI,KAAe,QAAQ/X,WAAW3O,KAAK2mB,kBAAkB,kBAAkB3T,MAAMwT,GAExG,GAAAxmB,KAAA,IAAa2N,YAAY+Y,GACzB1mB,KAAK4mB,gBAAgB,GAAA5mB,KAAA,OAAiBiiB,GAI1C,aAAahc,EAAmBgc,GACvB,cAAGhc,KACJA,EAAU,IAET,cAAGgc,KACJA,EAAW,IAEf,GAAAjiB,KAAI,GAAW,IAAI,KAAe,OAAO2O,WAAW3O,KAAK2mB,kBAAkB,qBAAsB1gB,GAAS+M,SAC1GhT,KAAK4mB,gBAAgB,GAAA5mB,KAAA,OAAiBiiB,GAG1C,WAAWhc,EAAmBgc,GACrB,cAAGhc,KACJA,EAAU,IAET,cAAGgc,KACJA,EAAW,IAEf,GAAAjiB,KAAI,GAAS,IAAI,KAAe,OAAO2O,WAAW3O,KAAK2mB,kBAAkB,mBAAoB1gB,GAAS+M,SACtGhT,KAAK4mB,gBAAgB,GAAA5mB,KAAA,OAAeiiB,GAGxC,MAAMrgB,GACF,IAAIqE,EAAU,CAACjG,KAAK2mB,kBAAkB,YAClC,GAAA3mB,KAAA,KACAiG,EAAQvB,KAAK1E,KAAK2mB,kBAAkB,kBAExC,IAAIE,EAAS,IAAI,KAAe,OAAO5X,MAAMrN,GAAI+M,cAAc1I,GAAS6gB,cAAc,CAClF,CAAC9mB,KAAK2mB,kBAAkB,YAAa,GAAA3mB,KAAA,MACtCgT,QACC6F,EAAY,IAAI,KAAe,OAAOlK,WAAW3O,KAAK2mB,kBAAkB,sBAAsB3T,QAKlG,OAJA6F,EAAUlL,YAAY,GAAA3N,KAAA,KACtB6Y,EAAUlL,YAAY,GAAA3N,KAAA,KACtB6Y,EAAUlL,YAAY,GAAA3N,KAAA,KACtB6mB,EAAOlZ,YAAYkL,GACZgO,EAGH,gBAAgB9uB,KAAoBkqB,GACpC,cAAGA,IACHA,EAAS/tB,QAASG,GAAY0D,EAAO4V,YAAYtZ,IAGjD,kBAAkB0yB,GACtB,OAAO,GAAA/mB,KAAA,IAAe+mB,G,sWClE9B,MAAe,GAYX,YAAYlhB,EAAiBjE,EAAYyN,GAXzC,oBACA,oBACA,oBACA,oBAOA,oBAEI,GAAArP,KAAI,GAAc,CACd,IAAOqP,EAAK2X,MACZ,GAAM3X,EAAK4X,KACX,OAAU5X,EAAK6X,SACf,GAAM7X,EAAK8X,OAEfnnB,KAAKxO,QAAU6d,EAAK5b,QACpBuM,KAAKwmB,MAAQnX,EAAKmX,MAClBxmB,KAAKpP,OAASiV,EAAMA,MAAMjV,OAC1B,GAAAoP,KAAI,GAAU6F,GACd,GAAA7F,KAAI,GAAO4B,GACX5B,KAAKsmB,SAAU,EACf,GAAAtmB,KAAI,GAAU,MACdA,KAAKonB,SAAc,GAAApnB,KAAA,IAAY6F,MAAMjV,OAArB,SAChBoP,KAAK6S,QAAa,GAAA7S,KAAA,IAAY6F,MAAMjV,OAArB,QAGnB,QACI,OAAO,GAAAoP,KAAA,IAGX,KAAKtS,GACD,IAAI2G,EAAUhD,SAASg2B,eAAe,GAAArnB,KAAA,KACjC,cAAG3L,GAIJ2L,KAAKsnB,cAAcjzB,IAHnBA,EAAU2L,KAAK1O,gBACf5D,EAAKigB,YAAYtZ,IAIrBpD,WAAW,KACP,GAAA+O,KAAI,GAAY,IAAI,EAAe,CAAC3L,GAAU,GAAA2L,KAAA,MAC9C,IAAIglB,EAAM,GAAAhlB,KAAA,IAAc4M,GAAG,SAAU5M,KAAK8X,QAAQloB,KAAKoQ,OACvD,GAAAA,KAAI,GAAUglB,EAAIz0B,OAAS,EAAIy0B,EAAI,GAAK,MACxC,GAAAhlB,KAAA,IAAcyF,KAAK,SACpB,KAGP,cAAcpR,GACV,IAAImyB,EAAQnyB,EAAQue,cAAc,IAAI5S,KAAKpP,uBACvCY,EAAU6C,EAAQue,cAAc,IAAI5S,KAAKpP,wBAC7C,GAAAoP,KAAA,IAAYmD,aAAaa,OAAO,KACxBwiB,IACAA,EAAMj1B,UAAYyO,KAAKwmB,OAEvBh1B,IACAA,EAAQD,UAAYyO,KAAKxO,UAE9B,MAGP,QAAQ+1B,GACJ,IACQ,cAAGA,IAASA,EAAS,OACjB,cAAG,GAAAvnB,KAAA,IAAgBunB,EAAI9V,SACvB,GAAAzR,KAAA,IAAgBunB,EAAI9V,S,QAIT,MAAf,GAAAzR,KAAA,MACA,GAAAA,KAAA,IAAc6M,OAAO,SAAU,GAAA7M,KAAA,KAC/B,GAAAA,KAAI,GAAU,OAGlB,GAAAA,KAAI,GAAY,Q,2EASrB,MAAM,WAAwB,GAEjC,YAAY6F,EAAiBjE,EAAYyN,G,MACrCvP,MAAM+F,EAAOjE,EAAIyN,GAFrB,oBAGI,GAAArP,KAAI,GAAO4B,GACX5B,KAAKsmB,QAAsB,QAAf,EAAGjX,EAAKiX,eAAO,SAG/B,gBACI,IAAIkB,EAAgB,IAAI,GAAcxnB,KAAKpP,OAAQoP,KAAKsmB,SAexD,OAbAkB,EAAcC,aAAaznB,KAAKwmB,MAAO,KAAM,CACzC,IAAI,KAAe,KAAK7X,WAAc3O,KAAKpP,OAAR,SAAuBk2B,cAAc,CACpE,CAAC9mB,KAAKonB,UAAW,gBACjB,CAACpnB,KAAK6S,SAAU,UACjBG,UAEPwU,EAAcE,WAAW,KAAM,CAC3B,IAAI,KAAe,KAAK1U,MAAMhT,KAAKxO,WAEvCg2B,EAAcG,aAAa,CAAI3nB,KAAKpP,OAAR,QAA0BoP,KAAKpP,OAAR,UAAyB,CACxE,IAAI,KAAe,UAAU+d,WAAc3O,KAAKpP,OAAR,UAA4BoP,KAAKpP,OAAR,uBAAqCk2B,cAAc,CAAE,CAAC9mB,KAAKonB,UAAW,kBAAmBpU,MAAM,UAChK,IAAI,KAAe,UAAUrE,WAAc3O,KAAKpP,OAAR,UAA4BoP,KAAKpP,OAAR,WAAyBk2B,cAAc,CAAE,CAAC9mB,KAAKonB,UAAW,cAAepU,MAAM,QAE7IwU,EAAcxU,MAAM,GAAAhT,KAAA,M,eAI5B,MAAM,WAA8B,GAEvC,YAAY6F,EAAiBjE,EAAYyN,G,MACrCvP,MAAM+F,EAAOjE,EAAIyN,GAFrB,oBAGI,GAAArP,KAAI,GAAO4B,GACX5B,KAAKxO,QAAU6d,EAAK5b,QACpBuM,KAAKwmB,MAAQnX,EAAKmX,MAClBxmB,KAAKpP,OAASiV,EAAMA,MAAMjV,OAC1BoP,KAAKsmB,QAAsB,QAAf,EAAGjX,EAAKiX,eAAO,SAI/B,gBACI,IAAIkB,EAAgB,IAAI,GAAcxnB,KAAKpP,OAAQoP,KAAKsmB,SASxD,OARAkB,EAAcC,aAAaznB,KAAKwmB,MAAO,KAAM,MAC7CgB,EAAcE,WAAW,KAAM,CAC3B,IAAI,KAAe,KAAK1U,MAAMhT,KAAKxO,WAEvCg2B,EAAcG,aAAa,CAAI3nB,KAAKpP,OAAR,QAA0BoP,KAAKpP,OAAR,UAAyB,CACxE,IAAI,KAAe,UAAU+d,WAAc3O,KAAKpP,OAAR,UAA4BoP,KAAKpP,OAAR,WAAyBk2B,cAAc,CAAE,CAAC9mB,KAAKonB,UAAW,cAAepU,MAAM,QAG7IwU,EAAcxU,MAAM,GAAAhT,KAAA,M,eAI5B,MAAM,WAA6B,GAEtC,YAAY6F,EAAiBjE,EAAYyN,G,MACrCvP,MAAM+F,EAAOjE,EAAIyN,GAFrB,oBAGI,GAAArP,KAAI,GAAO4B,GACX5B,KAAKxO,QAAU6d,EAAK5b,QACpBuM,KAAKwmB,MAAQnX,EAAKmX,MAClBxmB,KAAKpP,OAASiV,EAAMA,MAAMjV,OAC1BoP,KAAKsmB,QAAsB,QAAf,EAAGjX,EAAKiX,eAAO,SAG/B,gBACI,IAAIkB,EAAgB,IAAI,GAAcxnB,KAAKpP,OAAQoP,KAAKsmB,SAexD,OAbAkB,EAAcC,aAAaznB,KAAKwmB,MAAO,KAAM,CACzC,IAAI,KAAe,KAAK7X,WAAc3O,KAAKpP,OAAR,SAAuBk2B,cAAc,CACpE,CAAC9mB,KAAKonB,UAAW,gBACjB,CAACpnB,KAAK6S,SAAU,UACjBG,UAEPwU,EAAcE,WAAW,KAAM,CAC3B,IAAI,KAAe,KAAK1U,MAAMhT,KAAKxO,WAEvCg2B,EAAcG,aAAa,CAAI3nB,KAAKpP,OAAR,QAA0BoP,KAAKpP,OAAR,UAAyB,CACxE,IAAI,KAAe,UAAU+d,WAAc3O,KAAKpP,OAAR,UAA4BoP,KAAKpP,OAAR,uBAAqCk2B,cAAc,CAAE,CAAC9mB,KAAKonB,UAAW,cAAepU,MAAM,MAC5J,IAAI,KAAe,UAAUrE,WAAc3O,KAAKpP,OAAR,UAA4BoP,KAAKpP,OAAR,WAAyBk2B,cAAc,CAAE,CAAC9mB,KAAKonB,UAAW,eAAgBpU,MAAM,SAE9IwU,EAAcxU,MAAM,GAAAhT,KAAA,M,2RChL5B,MAAM,GAMT,YAAYqE,GALZ,oBACA,oBACA,oBACA,oBACA,oBAEI,GAAArE,KAAI,GAAQqE,GACZ,GAAArE,KAAI,GAAiB,IAAI,MACzB,GAAAA,KAAA,IAAmBoO,YAAYpO,KAAKwe,OAAO5uB,KAAKoQ,OAChD,GAAAA,KAAI,GAAe,MAGvB,SACS,GAAAA,KAAA,IAAmB8L,eACpB,GAAA9L,KAAA,IAAmBsO,SACnB,GAAAtO,KAAI,GAAY,GAAAA,KAAA,IAAU4M,GAAG,UAAOpN,UAAWQ,KAAK4nB,WAAWh4B,KAAKoQ,SAI5E,SACQ,GAAAA,KAAA,IAAmB8L,eACnB,GAAA9L,KAAA,IAAmB6M,SACnB,GAAA7M,KAAA,KAAiB,GAAAA,KAAA,IAAU6M,OAAO,UAAOrN,UAAW,GAAAQ,KAAA,MAK5D,aACI,OAAO,GAAAA,KAAA,IAAmB8L,aAGtB,OAAOuD,GACX,IAAI,GAAArP,KAAA,IAGJ,OAAQqP,EAAK9L,MACT,IAAK,OACD,GAAAvD,KAAI,GAAeqP,GACnB,MACJ,IAAK,OACG,GAAArP,KAAA,MACA,GAAAA,KAAA,IAAUyF,KAAK,UAAOlG,YAAa,KAAM,GAAAS,KAAA,KACzC,GAAAA,KAAI,GAAe,OAEvB,GAAAA,KAAA,IAAUyF,KAAK,UAAOlG,YAAa,KAAM8P,GACzC,MACJ,IAAK,KACD,GAAI,GAAArP,KAAA,IAEA,YADA,GAAAA,KAAI,GAAe,MAIvB,GAAAA,KAAA,IAAUyF,KAAK,UAAOlG,YAAa,KAAM8P,IAU7C,WAAWnJ,GACf,GAAAlG,KAAI,GAAakG,I,2nBClDlB,MAAM,GAST,YAAYL,EAAqB5D,EAAuB1L,GARxD,oBACA,oBACA,oBACA,oBAEA,oBACA,oBACA,oBAEI,IAAQ3F,OAASiV,EAAMjV,OACvB,IAAQmN,SAAW8H,EAAM9H,SACzBiC,KAAKiC,QAAU,IAAI,GAAiBA,GACpC,GAAAjC,KAAI,GAAezJ,UAAc,IACjC,GAAAyJ,KAAI,GAAU,IAAI,IAAS6F,IAC3B,GAAA7F,KAAI,GAAQ,IAAiB/Q,IAAI,gBACjC,GAAA+Q,KAAI,GAAgB6F,EAAMnY,MAC1B,GAAAsS,KAAI,GAAiB,IAAI,GAAgB,GAAAA,KAAA,IAAYqE,MAGzD,OAGI,GAFA,GAAArE,KAAA,IAAU+L,MAAM,mBAAoB,SAE/B,YAAG/d,OAAO65B,kBACX,MAAM,IAAI,IAAqB,qCAEnC,GAAA7nB,KAAI,GAAiB,IAAI,EAAgB,GAAAA,KAAA,IAAYmD,aAAc,GAAAnD,KAAA,IAAY6F,MAAMjV,OAAQ,GAAAoP,KAAA,IAAY6F,MAAMjL,oBAC/G,MAAMktB,EAA8B,GAAA9nB,KAAA,IAAiBuB,IAAIkD,GAAcA,EAAE3R,WACnEi1B,EAAe,YAAGD,GAAqB,GAAA9nB,KAAA,IAAkBuV,iBAAiB,YAAuBuS,IAAsB,KAC7H,GAAI,YAAGC,GAAe,CAClB,GAAA/nB,KAAA,IAAU+L,MAAM,cAAcgc,EAAax3B,mBAC3C,IACIw3B,EAAa7zB,QAAS4O,IAClB,YAAmBA,EAAM,GAAA9C,KAAA,IAAkB8nB,EAAmB,GAAA9nB,KAAA,OAEpE,MAAO1M,GACL,GAAA0M,KAAA,IAAUqX,UAAU/jB,IAwB5B,OArBA,GAAA0M,KAAA,IAAU+L,MAAM,eAAgB,QAEhC/L,KAAKiC,QAAQC,KAAK,GAAAlC,KAAA,KAEd,YAAI,GAAAA,KAAA,IAAkB8nB,KACtB,GAAA9nB,KAAA,IAAU+L,MAAM,yBAA0B,QAC1C,GAAA/L,KAAI,GAAqB,IAAI,IAAoB,GAAAA,KAAA,OAAAA,KAAA,MACjD,GAAAA,KAAA,IAAuBgoB,cAAc,GAAAhoB,KAAA,KAAkB8mB,cAAcgB,GACrE,GAAA9nB,KAAA,IAAuBioB,WAAWjoB,KAAKiC,SACvC,GAAAjC,KAAA,IAAuB6K,SAG3B,GAAA7K,KAAA,IAAU+L,MAAM,sBAAuB,QACvC,GAAA/L,KAAA,IAAYmD,aAAaa,OAAO,KAC5B,GAAAhE,KAAA,IAAYiE,YAAY,IAAcrJ,kBAAsB,GAAAoF,KAAA,IAAY6F,MAAMjL,kBAArB,MACzD,GAAAoF,KAAA,IAAYiE,YAAY,IAActJ,cAAkB,GAAAqF,KAAA,IAAY6F,MAAMlL,cAArB,MACrD,GAAAqF,KAAA,IAAYiE,YAAY,IAAcpJ,mBAAuB,GAAAmF,KAAA,IAAY6F,MAAMhL,mBAArB,OAC3D,MACH,GAAAmF,KAAA,IAAmBsO,SAEnB,GAAAtO,KAAA,IAAYqE,IAAIoB,KAAK,IAAOxH,qBAAsB,MAC3C+B,KAGX,SACI,GAAAA,KAAA,IAAuBwc,OACvB,GAAAxc,KAAA,IAAmB6M,SACnB,GAAA7M,KAAA,IAAYqE,IAAIoB,KAAK,IAAOvH,kBAAmB,MAGnD,IAAI2W,GACA,MAAMoN,EAAWjiB,KAAK2F,IAAIkP,GAC1B,IAAKoN,EACD,OAGJ,OADmB,IAAI,EAAeA,EAAU,GAAAjiB,KAAA,KAIpD,WAAW6U,GACP,MAAMoN,EAAWjiB,KAAK2F,IAAIkP,GAC1B,IAAK,YAAGoN,GACJ,OAGJ,OADc,IAAI,EAAkBA,EAAU,GAAAjiB,KAAA,IAAYmD,cAKxD,MAAM1P,G,0CACR,QAAK,YAAGA,IAGD,GAAAuM,KAAA,IAAmBkoB,KAAKz0B,MAGnC,OAAOohB,GACH,OAAOxjB,SAASuhB,cAAciC,GAGlC,IAAIA,GACA,MAAMsT,EAA6B92B,SAASkkB,iBAAiBV,GAC7D,GAAK,YAAGsT,GAGR,MAAO,IAAIA,GAGf,WACI,OAAO,GAAAnoB,KAAA,IAGX,GAAGqG,EAAe9N,EAAelE,GACxB,YAAIgS,EAAO9N,IACZ,GAAAyH,KAAA,IAAUxM,MAAM,sBAAuB,MAE3C,GAAAwM,KAAA,IAAYqE,IAAIuI,GAAGvG,EAAO9N,EAAUlE,GAGxC,OAAOgS,EAAezE,GACb,YAAIyE,EAAOzE,IACZ,GAAA5B,KAAA,IAAUxM,MAAM,sBAAuB,UAE3C,GAAAwM,KAAA,IAAYqE,IAAIwI,OAAOxG,EAAOzE,GAGlC,UAAUyE,GACD,YAAGA,IACJ,GAAArG,KAAA,IAAUxM,MAAM,sBAAuB,aAE3C,GAAAwM,KAAA,IAAYqE,IAAIyI,UAAUzG,GAG9B,KAAKA,EAAehS,KAA8BuU,GAC9C,IAAK,YAAIvC,EAAOhS,GAEZ,YADA,GAAA2L,KAAA,IAAU1F,QAAQ,gCAAiC,QAGvD,IACI0P,GADwB,iBAAZ3V,EAAuBhD,SAASuhB,cAAcve,GAAWA,GACpC0C,MAChC,YAAGiT,GAIR,GAAAhK,KAAA,IAAYqE,IAAIoB,KAAKY,EAAO2D,KAASpB,GAHjC,GAAA5I,KAAA,IAAU1F,QAAQ,+BAAgC,QAM1D,MAAMsH,EAAY2B,EAAoB8L,IFoBnC,MACH,WAAWzN,EAAY2B,EAAoB8L,EAAoB7Y,GAC3D,MAAa,SAAT+M,EACO,IAAI,GAAsB/M,EAAOoL,EAAIyN,GAC5B,gBAAT9L,EACA,IAAI,GAAqB/M,EAAOoL,EAAIyN,GAC3B,aAAT9L,EACA,IAAI,GAAgB/M,EAAOoL,EAAIyN,QADnC,KEzBqBpgB,IAAI2S,EAAI2B,EAAM8L,EAAM,GAAArP,KAAA,KAC1CkoB,KAAK,GAAAloB,KAAA,M,meC9IZ,MAAMooB,EAUT,YAAY/zB,EAAsBmC,GARlC,mBACA,mBACA,mBAEA,mBACA,mBACA,mBACA,mBAEI,EAAAwJ,KAAI,EAAa,MACjB,EAAAA,KAAI,EAAY3L,GAChB2L,KAAK+O,KAAO,IAAiB9f,IAAI,uBACjC+Q,KAAKiC,QAAU,KACf,EAAAjC,KAAI,EAAe,IACnB,EAAAA,KAAI,EAAe,IACnB,EAAAA,KAAI,EAAUxJ,GACd,EAAAwJ,KAAI,EAAgB,IAIxB,WAAWiC,GAEP,OADAjC,KAAKiC,QAAUA,EACRjC,KAGX,cAAczJ,GAEV,OADA,EAAAyJ,KAAI,EAAezJ,GACZyJ,KAGX,cAAc5N,GASV,OARA,EAAA4N,KAAI,EAAY,CACZ5N,YAAY,EACZi2B,SAAS,EACTC,WAAW,EACXC,gBAAiBn2B,IAErB,EAAA4N,KAAI,EAAe5N,GACnB,EAAA4N,KAAI,EAAgB,YAAuB5N,IACpC4N,KAGX,QAKI,OAJAA,KAAK+O,KAAKhD,MAAM,YAChB,EAAA/L,KAAI,EAAa,IAAI6nB,iBAAiB7nB,KAAKwoB,iBAAiB54B,KAAKoQ,QACjE,EAAAA,KAAA,GAAe4R,QAAQ,EAAD,mBACtB5R,KAAK+O,KAAKhD,MAAM,WACT/L,KAGX,OAOI,OANAA,KAAK+O,KAAKhD,MAAM,YACO,OAAnB,EAAA/L,KAAA,IACAA,KAAK+O,KAAKhD,MAAM,sBACpB,EAAA/L,KAAA,GAAeoW,aACf,EAAApW,KAAI,EAAa,MACjBA,KAAK+O,KAAKhD,MAAM,WACT/L,KAGH,iBAAiB0Z,EAA6BzD,GAClDyD,EAAUxlB,QAASyd,IACf,OAAQA,EAASpO,MACb,IAAK,aACD,MAAMT,EAAO6O,EAAS9c,OAClB,YAAIiO,EAAKrM,UAAWqM,EAAKrM,UAAUkb,EAAS9C,iBAC5C/L,EAAKrM,UAAUkb,EAAS9C,eAAe9L,QAAQ,YAAeD,EAAM6O,EAAS9C,gBAEjF,MAEJ,IAAK,YACD7O,KAAKyoB,wBAAwB9W,GAGjC,YAAG3R,KAAKiC,UACRjC,KAAKiC,QAAQyP,WAAWC,GAAUuF,KAAK,UAO3C,wBAAwBvF,GAC5B,MAAM+W,EAAW/W,EAASI,WAAWxhB,OAC/Bo4B,EAAahX,EAASM,aAAa1hB,OACrCm4B,EAAW,GACX1oB,KAAK+O,KAAKhD,MAAM,4BAA8B2c,GAC9C1oB,KAAK4oB,iBAAiBjX,EAASI,aACxB4W,EAAa,IACpB3oB,KAAK+O,KAAKhD,MAAM,mBAAqB4c,GACrC3oB,KAAK6oB,mBAAmBlX,EAASM,eAIjC,iBAAiBkW,GACrBA,EAAMj0B,QAASoC,IACX,IACI,YAAmBA,EAAM,EAAF,6BACvB,IAAIwyB,EAAYxyB,EAAKyyB,gBAAkBzyB,EAAKif,iBAAiB,EAAD,SAAsB,KAC9E,YAAGuT,IACHA,EAAU50B,QAASkE,IACf,YAAmBA,EAAO,EAAF,+BAGlC,MAAO9E,GACL0M,KAAK+O,KAAKsI,UAAU/jB,MAKxB,mBAAmB60B,GACvBA,EAAMj0B,QAASoC,IACX0J,KAAKgpB,qBAAqB1yB,GAC1B,IAAIwyB,EAAYxyB,EAAKyyB,gBAAkBzyB,EAAKif,iBAAiB,EAAD,SAAsB,KAC9E,YAAGuT,IACHA,EAAU50B,QAASkE,IACf4H,KAAKgpB,qBAAqB5wB,OAMlC,qBAAqB9B,GACzB,IAAIjC,EAAUiC,EACd,GAAIjC,EAAQoC,UACR,IAAK,IAAI9H,KAAQ0F,EAAQoC,UACrB,GAAIpC,EAAQoC,UAAUxG,eAAetB,GACjC,IACI0F,EAAQoC,UAAU9H,GAAMs6B,UAC1B,MAAO31B,GACL0M,KAAK+O,KAAKsI,UAAU/jB,EAAG,YAAc3E,K,kGAStD,MAAMu6B,EAST,YAAYr0B,GARZ,mBACA,mBACA,mBACA,mBACA,WAAiC,CAC7ByzB,WAAW,EACXD,SAAS,IAGT,EAAAroB,KAAI,EAAa,MACjB,EAAAA,KAAI,GAAgB,GACpB,EAAAA,KAAI,EAAYnL,GAGpB,UACS,EAAD,SAAuB,EAAD,UACtB,EAAAmL,KAAA,GAAe4R,QAAQ,EAAD,mBACtB,EAAA5R,KAAI,GAAgB,IAG5B,YACQ,EAAJ,UACI,EAAAA,KAAA,GAAeoW,aACf,EAAApW,KAAI,GAAgB,IAI5B,cACI,OAAO,EAAP,QAGJ,QAAQkG,GACJ,EAAAlG,KAAI,EAAakG,GACb,EAAJ,SACIlG,KAAK6R,YAIb,WAAWtZ,GACH,EAAJ,SACIyH,KAAK6R,YACT,EAAA7R,KAAI,EAAa,IAAI6nB,iBAAiBtvB,K,uMC9M9C,qoBAEO,MAAM4wB,EAAoB,SAejCn7B,OAAOo7B,QAAU,IAAI","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cui-light\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cui-light\"] = factory();\n\telse\n\t\troot[\"cui-light\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 29);\n","import { CuiLightMode, CuiWindowSize } from \"./types\";\r\nimport { ArgumentError, RegisterElementError } from \"../models/errors\";\r\nimport { ICuiComponent, CuiElement } from \"../models/interfaces\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { COMPONENTS_COUNTER, CUID_ATTRIBUTE } from \"./statics\";\r\n\r\n/**\r\n * Checks if value is defined an is not null\r\n * Additionally with type check it can check value if it is not empty string or collection or object\r\n * \r\n * @param val - value\r\n * @param typecheck - default true - additional check whether value is not empty (string, collection, object)\r\n * @returns whether value passed all conditions\r\n */\r\nexport function is(val: any, typecheck: boolean = true): boolean {\r\n    if (typeof val !== 'undefined' && val !== null) {\r\n        if (!typecheck) {\r\n            return true;\r\n        } else {\r\n            return !isEmpty(val)\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Checks if value is empty string, array or object\r\n *\r\n *\r\n * @param val - value\r\n * @returns whether value passed all conditions\r\n */\r\nexport function isEmpty(val: any): boolean {\r\n    if (typeof val === \"string\") {\r\n        return val.length === 0\r\n    }\r\n    if (typeof val === \"boolean\") {\r\n        return val;\r\n    }\r\n    else if (Array.isArray(val)) {\r\n        return val.length === 0\r\n    }\r\n    return false\r\n}\r\n\r\nexport function getName(prefix: string, name: string) {\r\n    if (!is(prefix) || !is(name)) {\r\n        throw new ArgumentError(\"Missing argument value\")\r\n    }\r\n    return `${prefix}-${name}`\r\n}\r\n\r\nexport function sleep(timeout: number): Promise<boolean> {\r\n    return new Promise(resolve => setTimeout(() => {\r\n        resolve(true)\r\n    }, timeout));\r\n}\r\n\r\n/**\r\n * Creates proper html element from given string\r\n * @param htmlString - string containing html\r\n */\r\nexport function createElementFromString(htmlString: string): Element {\r\n    if (!is(htmlString)) {\r\n        return null;\r\n    }\r\n    let template = document.createElement('template')\r\n    template.innerHTML = htmlString\r\n    return template.content.children.length > 0 ? template.content.children[0] : null;\r\n}\r\n\r\nexport function getMatchingAttribute(element: any, attributes: string[]): string {\r\n    let attr = null;\r\n    let len = attributes.length;\r\n    for (let i = 0; i < len; i++) {\r\n        let attribute = attributes[i];\r\n        if (element.hasAttribute(attribute)) {\r\n            attr = attribute\r\n            break;\r\n        }\r\n    }\r\n    return attr;\r\n}\r\n\r\nexport function getMatchingAttributes(element: any, attributes: string[]): string[] {\r\n    if (!element || !is(element.hasAttribute)) {\r\n        return null;\r\n    }\r\n    return attributes.filter(a => {\r\n        return element.hasAttribute(a);\r\n    });\r\n}\r\n\r\nexport function getRangeValue(value: number, min: number, max: number) {\r\n    if (value < min) {\r\n        return min;\r\n    } else if (value > max) {\r\n        return max;\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function getRangeValueOrDefault(value: number, min: number, max: number, def: number) {\r\n    if (value === null || typeof value === 'undefined' || isNaN(value)) {\r\n        return def;\r\n    }\r\n    return getRangeValue(value, min, max)\r\n}\r\n\r\nexport function increaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value + (value * amount);\r\n}\r\n\r\nexport function decreaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value - (value * amount);\r\n}\r\n\r\nexport function clone(object: any): any {\r\n    if (!is(object)) {\r\n        return null;\r\n    }\r\n    return Object.assign({}, object);\r\n}\r\n\r\nexport function getSingleColorRatio(first: number, second: number, max: number): number {\r\n    return Math.abs(((first - second) / max) * 100)\r\n}\r\n\r\n/**\r\n * Creates string containg css selector for array of attributes\r\n * @param attributes - attributes values\r\n */\r\nexport function joinAttributesForQuery(attributes: string[]): string {\r\n    if (!is(attributes)) {\r\n        return \"\"\r\n    }\r\n    return `[${attributes.join('],[')}]`\r\n}\r\n\r\n/**\r\n * Checks light system light mode\r\n * @returns Light Mode - dark/light\r\n */\r\nexport function getSystemLightMode(): CuiLightMode {\r\n    return window.matchMedia &&\r\n        window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n}\r\n\r\n/**\r\n * Check print mode in the browser window\r\n * @returns true if window is displayed in print mode\r\n */\r\nexport function getSystemPrintMode(): boolean {\r\n    return window.matchMedia &&\r\n        window.matchMedia('print').matches;\r\n}\r\n\r\n/**\r\n * Verifies whether attributes exist and have some values\r\n * @param attributes attributes list\r\n */\r\nexport function are(...attributes: any[]): boolean {\r\n    if (!is(attributes)) {\r\n        return false\r\n    }\r\n    let c = attributes.length;\r\n    for (let i = 0; i < c; i++) {\r\n        if (!is(attributes[i])) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function calcWindowSize(width: number): CuiWindowSize {\r\n    if (width <= 640) {\r\n        return 'small';\r\n    } else if (width > 640 && width <= 960) {\r\n        return \"medium\"\r\n    } else if (width > 960 && width <= 1200) {\r\n        return \"large\"\r\n    }\r\n    return 'xlarge';\r\n}\r\n\r\n/**\r\n * Creates object from string.\r\n * Supported syntaxes are:\r\n * - JSON\r\n * - single value\r\n * - key:value,value;key=value\r\n * \r\n * @param attribute - attribute value\r\n */\r\nexport function parseAttributeString(attribute: string): any {\r\n    let ret: any = parseJsonString(attribute.trim())\r\n\r\n    if (!is(ret)) {\r\n        if (!attribute.includes(';') && !attribute.includes(':')) {\r\n            ret = attribute;\r\n        } else {\r\n            ret = {}\r\n            attribute.split(';').forEach(val => {\r\n                let sp = val.split(':')\r\n                if (sp.length === 2) {\r\n                    ret[sp[0].trim()] = sp[1].trim()\r\n                }\r\n            })\r\n        }\r\n    }\r\n    return ret\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n* String must start with { and end with }\r\n *\r\n * @param attribute - attribute value\r\n * @returns object if string passes test, null otherwise\r\n */\r\n\r\nexport function parseJsonString(attribute: string): any | null {\r\n    let out = null;\r\n    if (is(attribute) && attribute.startsWith('{') && attribute.endsWith('}')) {\r\n        try {\r\n            out = jsonify(attribute);\r\n        } catch (e) {\r\n            console.error(prepLogString(\"An exception occured\", 'Functions', 'parseJsonString'), e)\r\n        }\r\n        return out;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n * @param attribute - JSON string\r\n */\r\nexport function jsonify(attribute: string): any {\r\n    return attribute && attribute.length > 0 ? JSON.parse(attribute) : {}\r\n}\r\n\r\nexport function getOffsetTop(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetTop - parseInt(getStyleValue(element, 'margin-top')) - parseInt(getStyleValue(element, 'padding-top')) - parseInt(getStyleValue(element, 'border-top-width'))\r\n    return val < 0 ? element.offsetTop : val;\r\n}\r\n\r\nexport function getOffsetLeft(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetLeft - parseInt(getStyleValue(element, 'margin-left')) - parseInt(getStyleValue(element, 'padding-left')) - parseInt(getStyleValue(element, 'border-left-width'))\r\n    return val < 0 ? element.offsetLeft : val;\r\n}\r\n\r\nexport function getIntOrDefault(value: any, def: number): number {\r\n    let integer = parseInt(value);\r\n    return isNaN(integer) ? def : integer;\r\n}\r\n\r\nexport function getStyleValue(target: any, property: string): any {\r\n    if (!is(target) || !is(property)) {\r\n        return null;\r\n    }\r\n    if (target.currentStyle) {\r\n        return target.currentStyle[property];\r\n    } else if (window.getComputedStyle) {\r\n        return window.getComputedStyle(target, null).getPropertyValue(property)\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function prepLogString(message: string, component: string, functionName?: string) {\r\n    return `[${new Date().toLocaleString()}][${component ?? \"-\"}][${functionName ?? '-'}][${message}]`\r\n}\r\n\r\nexport function isInRange(value: number, min: number, max: number): boolean {\r\n    return is(value) && value >= min && value <= max;\r\n}\r\n\r\nexport function getActiveClass(prefix: string) {\r\n    return `${prefix ?? \"\"}-active`;\r\n}\r\n\r\nexport function parseAttribute(element: Element, attribute: string): any {\r\n    return are(element, attribute) ? parseAttributeString(element.getAttribute(attribute)) : null;\r\n}\r\n\r\n\r\n/**\r\n *  Checks whether string value contains synonym of true\r\n * @param value - string to check\r\n */\r\nexport function isStringTrue(value: string): boolean {\r\n    return is(value) ? ['y', 't', 'true', 'yes'].includes(value.toLowerCase()) : false\r\n}\r\n\r\nexport function boolStringOrDefault(prop: any, def: boolean): boolean {\r\n    return is(prop) ? isStringTrue(prop) : def;\r\n}\r\n\r\nexport function getStringOrDefault(value: any, def: string) {\r\n    return is(value) ? value.toLowerCase() : def;\r\n}\r\n\r\n/**\r\n * Checks whether device supports touch\r\n */\r\nexport function isTouchSupported(): boolean {\r\n    return ('ontouchstart' in window) ||\r\n        (navigator.maxTouchPoints > 0) ||\r\n        (navigator.msMaxTouchPoints > 0);\r\n}\r\n\r\n/**\r\n * Checks whether value is type of string\r\n * @param {any} value - value to be checked\r\n */\r\nexport function isString(value: any): boolean {\r\n    return typeof value === 'string';\r\n}\r\n\r\n\r\n/**\r\n * Replaces mask {prefix} with actual value in the string\r\n * @param {string} value - text containg a mask\r\n * @param {string} prefix - value to be put in place of mask\r\n */\r\nexport function replacePrefix(value: string, prefix: string): string {\r\n    return !is(value) ? value : value.replace(\"{prefix}\", prefix ?? \"\");\r\n}\r\n\r\n/**\r\n * Generates identifier for Cui element\r\n * \r\n * @param element - Cui element selector\r\n * @returns generated identifier\r\n */\r\nexport function generateCUID(element?: string) {\r\n    let starter = is(element) ? element : \"cui-element\"\r\n    return `${starter}-${COMPONENTS_COUNTER.next().value}`;\r\n}\r\n\r\n/**\r\n * Generates random string\r\n */\r\nexport function generateRandomString(): string {\r\n    let rand = getRandomInt(1, 1000)\r\n    let rand2 = getRandomInt(1, 100)\r\n    return `${Math.floor(Math.random() * rand2)}-${Math.floor(rand)}`;\r\n}\r\n/**\r\n * Generates random integer\r\n * @param min - min number\r\n * @param max - max number\r\n * @returns random integer\r\n */\r\nexport function getRandomInt(min: number, max: number): number {\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n/**\r\n * Registers Element as Cui element, initializes handlers, sets component style to document header and sets $cuid\r\n * @param {any} node - document node\r\n * @param {ICuiComponent[]} components -supported components array\r\n * @param {string[]} attributes - supported attributes array\r\n * @param {CuiUtils} utils - Cui Utils instance\r\n */\r\nexport function registerCuiElement(node: any, components: ICuiComponent[], attributes: string[], utils: CuiUtils) {\r\n    let element = node as CuiElement;\r\n    element.$handlers = {};\r\n    let matching: string[] = getMatchingAttributes(node, attributes)\r\n    if (is(matching)) {\r\n        element.$cuid = node.hasAttribute(CUID_ATTRIBUTE) ? node.getAttribute(CUID_ATTRIBUTE) : generateCUID(node.tagName)\r\n        node.setAttribute(CUID_ATTRIBUTE, element.$cuid);\r\n        matching.forEach(match => {\r\n            let component = components.find(c => { return c.attribute === match });\r\n            if (is(component)) {\r\n                try {\r\n                    utils.styleAppender.append(component.getStyle());\r\n                    let handler = component.get(node, utils);\r\n                    element.$handlers[component.attribute] = handler;\r\n                    element.$handlers[component.attribute].handle(parseAttribute(node, component.attribute));\r\n                } catch (e) {\r\n                    let attr = matching ? matching.join(\", \") : \"\";\r\n                    throw new RegisterElementError(`An error occured during [${attr}] initialization: ${e.message}`);\r\n                }\r\n            }\r\n        })\r\n\r\n    }\r\n}\r\n\r\nexport function* counter() {\r\n    let idx = 0;\r\n    while (true) {\r\n        let reset = yield idx++;\r\n        if (reset || idx > 200000) {\r\n            idx = 0\r\n        }\r\n    }\r\n}\r\n\r\nexport function getHandlerExtendingOrNull<T>(target: CuiElement, fName: string): T {\r\n    if (!is(target.$handlers)) {\r\n        return null;\r\n    }\r\n\r\n    for (let handler in target.$handlers) {\r\n\r\n        if (target.$handlers.hasOwnProperty(handler)) {\r\n            let h: any = target.$handlers[handler];\r\n            if (hasFunction(h, fName))\r\n                return h;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Checks whether property exists on the object and it is a function\r\n * @param obj - object\r\n * @param fName - property name\r\n */\r\nexport function hasFunction(obj: any, fName: string) {\r\n    return is(obj[fName]) && typeof obj[fName] === 'function'\r\n}\r\n\r\n/**\r\n * Gets closest parent element which is a cUI element\r\n * @param element \r\n */\r\nexport function getParentCuiElement(element: Element): Element {\r\n    if (!is(element)) {\r\n        return undefined;\r\n    }\r\n    let parent = element.parentElement as any;\r\n    return is(parent) && is(parent.$cuid) ? parent : getParentCuiElement(parent);\r\n}\r\n\r\n/**\r\n * Calculates element height by calculating childerns heights\r\n * @param element\r\n */\r\nexport function getChildrenHeight(element: Element): number {\r\n    let height: number = 0;\r\n    if (!element) {\r\n        return -1;\r\n    }\r\n    Array.from(element.children).forEach((child: HTMLElement) => {\r\n        height += child.offsetHeight;\r\n    })\r\n    return height > 0 ? height + 2 : height;\r\n}\r\n\r\nexport function enumerateObject<T>(object: T, callback: (property: string, value: any) => void) {\r\n    if (!are(object, callback)) {\r\n        return;\r\n    }\r\n    for (let prop in object) {\r\n        if (object.hasOwnProperty(prop)) {\r\n            callback(prop, object[prop]);\r\n        }\r\n    }\r\n}\r\n\r\nexport function round(value: number, decimalPlaces: number): number {\r\n    const multiplier = 10 ** decimalPlaces;\r\n    const semiValue = value * multiplier;\r\n    return Math.floor(value) / multiplier;\r\n}\r\n\r\nexport function calculateNextIndex(val: any, currentIndex: number, totalLength: number): number {\r\n    let idx = -1;\r\n    switch (val) {\r\n        case 'prev':\r\n            idx = currentIndex <= 0 ? totalLength - 1 : currentIndex - 1;\r\n            break;\r\n        case 'next':\r\n            idx = currentIndex < totalLength - 1 ? currentIndex + 1 : 0\r\n            break;\r\n        case 'first':\r\n            idx = 0;\r\n            break;\r\n        case 'last':\r\n            idx = totalLength - 1;\r\n        default:\r\n            idx = getIntOrDefault(val, -1);\r\n            break;\r\n    }\r\n    return idx;\r\n}\r\n\r\nexport function getFirstMatching<T>(array: T[], callback: (t: T, index: number) => boolean): T | undefined {\r\n    let count = array.length;\r\n    if (!array || count === 0) {\r\n        return undefined;\r\n    }\r\n\r\n    for (let idx = 0; idx < count; idx++) {\r\n        if (callback(array[idx], idx)) {\r\n            return array[idx];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n\r\nexport function mapObject<T, V>(input: T, callback: (t: T) => V): V | undefined {\r\n    return input ? callback(input) : undefined;\r\n}\r\n\r\nexport function mapObjectArray<T, V>(input: T[], callback: (t: T) => V): V[] {\r\n    return input.map((item: T) => {\r\n        return mapObject(item, callback);\r\n    })\r\n}\r\n\r\n/**\r\n * Delays callback execution by specific time. Callback cannot be called again until previous execution finishes or was cancelled\r\n * @param callback - callback to execute\r\n * @param delayTime - time in ms that execution shall be delayed by\r\n * @returns Cancel callback\r\n */\r\nexport function delay(callback: (...args: any[]) => void, delayTime: number) {\r\n    if (!are(callback, delayTime)) {\r\n        throw new Error(\"[delay]: Input arguments are not correct\")\r\n    }\r\n    let id: any = null;\r\n    return function (...args: any[]) {\r\n        if (id === null) {\r\n            id = setTimeout(() => {\r\n                callback(...args);\r\n                id = null;\r\n            }, delayTime)\r\n        }\r\n        return function () {\r\n            if (id !== null) {\r\n                clearTimeout(id);\r\n                id = null;\r\n            }\r\n        }\r\n    }\r\n}","export * from \"./models/colors\";\r\nexport * from \"./models/errors\";\r\nexport * from \"./models/events\";\r\nexport * from \"./models/interfaces\";\r\nexport * from \"./models/setup\";\r\nexport * from \"./models/utils\";\r\n// Utils\r\nexport * from \"./utils/actions\";\r\nexport * from \"./utils/dictionary\";\r\nexport * from \"./utils/functions\";\r\nexport * from \"./utils/interactions\";\r\nexport * from \"./utils/logger\";\r\nexport * from \"./utils/types\";\r\nexport * from \"./utils/statics\";\r\n\r\nexport * from \"./styles/appender\";\r\n// Factories\r\nexport * from \"./factories/logger\";\r\nexport * from \"./factories/interactions\";\r\n//Helpers\r\nexport * from \"./helpers/helpers\";\r\n// BUS\r\nexport * from \"./bus/executors\";\r\nexport * from \"./bus/handlers\";\r\nexport * from \"./bus/bus\";\r\n// Listeners\r\nexport * from \"./listeners/keys\";\r\nexport * from \"./listeners/media\";\r\nexport * from \"./listeners/scroll\";\r\n","import { CuiLogLevel } from \"./types\";\r\nimport { CuiColorPair } from \"../models/colors\";\r\nimport { counter } from \"./functions\";\r\nexport const CUID_ATTRIBUTE = \"cuid\";\r\n\r\nexport const CLASSES = {\r\n    dark: 'dark',\r\n    animProgress: 'animation-progress',\r\n    print: 'print',\r\n    active: 'active',\r\n    swipingOn: \"swiping-on\",\r\n    selectionOff: \"selection-off\"\r\n}\r\n\r\nexport const ICONS: any = {\r\n    close: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 1.9999999,1.9999999 18,18\\\"></path><path d=\\\"M 18,1.9999999 1.9999999,18\\\"></path></svg>\",\r\n    accordion: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 5.0000475,7.4490018 10.000024,12.551028 15,7.4490018\\\"></path></svg>\",\r\n    special_menu: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path class=\\\"menu_handle_2\\\" d=\\\"M 1,10 H 19\\\"></path><path class=\\\"menu_handle_1\\\" d=\\\"M 1,4.8571429 H 19\\\"></path><path  class=\\\"menu_handle_3\\\" d=\\\"M 1,15.142857 H 19\\\"></path></svg>\",\r\n    special_fail: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-fail\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7.000001 A 43,43 0 0 1 92.999999,50 43,43 0 0 1 50,92.999999 43,43 0 0 1 7.0000011,50 43,43 0 0 1 50,7.000001 Z\\\"></path><path class=\\\"arm_1\\\" d=\\\"M 28.536809,28.536809 71.342023,71.342023\\\"></path><path class=\\\"arm_2\\\" d=\\\"M 71.342023,28.536809 28.536809,71.342023\\\"></path></svg>\",\r\n    special_success: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-success\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7 A 43,43 0 0 1 93,50 43,43 0 0 1 50,93 43,43 0 0 1 7,50 43,43 0 0 1 50,7 Z\\\"></path><path class=\\\"arm\\\" d=\\\"M 22.988405,48.234784 36.946233,72.410453 75.516456,33.84023\\\"></path></svg>\",\r\n};\r\n\r\nexport const COLORS = ['red', 'green', 'blue', 'alpha']\r\n\r\nexport const CSS_APP_BACKGROUND_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-app-background',\r\n    dark: '--cui-color-dark-app-background'\r\n}\r\n\r\nexport const CSS_COMPONENT_BACKGROUND_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-background',\r\n    dark: '--cui-color-dark-background '\r\n}\r\n\r\nexport const CSS_COMPONENT_BORDER_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-border',\r\n    dark: '--cui-color-dark-border'\r\n}\r\n\r\nexport const CSS_THEMES = {\r\n    light: {\r\n        base: '--cui-color-light-base',\r\n        muted: '--cui-color-light-muted',\r\n        active: '--cui-color-light-active'\r\n    },\r\n    dark: {\r\n        base: '--cui-color-dark-base',\r\n        muted: '--cui-color-dark-muted',\r\n        active: '--cui-color-dark-active'\r\n    },\r\n    accent: {\r\n        base: '--cui-color-primary',\r\n        muted: '--cui-color-primary-muted',\r\n        active: '--cui-color-primary-active'\r\n    },\r\n    secondary: {\r\n        base: '--cui-color-secondary',\r\n        muted: '--cui-color-secondary-muted',\r\n        active: '--cui-color-secondary-active'\r\n    },\r\n    success: {\r\n        base: '--cui-color-success',\r\n        muted: '--cui-color-success-muted',\r\n        active: '--cui-color-success-active'\r\n    },\r\n    warning: {\r\n        base: '--cui-color-warning',\r\n        muted: '--cui-color-warning-muted',\r\n        active: '--cui-color-warning-active'\r\n    },\r\n    error: {\r\n        base: '--cui-color-error',\r\n        muted: '--cui-color-error-muted',\r\n        active: '--cui-color-error-active'\r\n    }\r\n}\r\n\r\nexport const SCOPE_SELECTOR = \":scope \";\r\n\r\nexport const CSS_VARIABLES: any = {\r\n    fontSize: \"--{prefix}-font-size\",\r\n    lineHeight: \"--{prefix}-line-height\",\r\n    animationTime: \"--{prefix}-animation-time\",\r\n    animationTimeLong: \"--{prefix}-animation-time-long\",\r\n    animationTimeShort: \"--{prefix}-animation-time-short\",\r\n    colorLightAppBackground: \"--{prefix}-color-light-app-background\",\r\n    colorLightBackground: \"--{prefix}-color-light-background\",\r\n    colorLightBorder: \"--{prefix}-color-light-border\",\r\n    colorLightBase: \"--{prefix}-color-light-base\",\r\n    colorLightActive: \"--{prefix}-color-light-active\",\r\n    colorLightMuted: \"--{prefix}-color-light-muted\",\r\n    colorDarkAppBackground: \"--{prefix}-color-dark-app-background\",\r\n    colorDarkBackground: \"--{prefix}-color-dark-background\",\r\n    colorDarkBorder: \"--{prefix}-color-dark-border\",\r\n    colorDarkBase: \"--{prefix}-color-dark-base\",\r\n    colorDarkActive: \"--{prefix}-color-dark-active\",\r\n    colorDarkMuted: \"--{prefix}-color-dark-muted\",\r\n    colorAccent: \"--{prefix}-color-primary\",\r\n    colorAccentActive: \"--{prefix}-color-primary-active\",\r\n    colorAccentMuted: \"--{prefix}-color-primary-muted\",\r\n    colorAccentShade: \"--{prefix}-color-primary-shade\",\r\n    colorAccentShadeDark: \"--{prefix}-color-primary-shade-dark\",\r\n    colorSecondary: \"--{prefix}-color-secondary\",\r\n    colorSecondaryActive: \"--{prefix}-color-secondary-active\",\r\n    colorSecondaryMuted: \"--{prefix}-color-secondary-muted\",\r\n    colorSecondaryShade: \"--{prefix}-color-secondary-shade\",\r\n    colorSecondaryShadeDark: \"--{prefix}-color-secondary-shade-dark\",\r\n    colorWarning: \"--{prefix}-color-warning\",\r\n    colorWarningActive: \"--{prefix}-color-warning-active\",\r\n    colorWarningMuted: \"--{prefix}-color-warning-muted\",\r\n    colorWarningShade: \"--{prefix}-color-warning-shade\",\r\n    colorWarningShadeDark: \"--{prefix}-color-warning-shade-dark\",\r\n    colorSuccess: \"--{prefix}-color-success\",\r\n    colorSuccessActive: \"--{prefix}-color-success-active\",\r\n    colorSuccessMuted: \"--{prefix}-color-success-muted\",\r\n    colorSuccessShade: \"--{prefix}-color-success-shade\",\r\n    colorSuccessShadeDark: \"--{prefix}-color-success-shade-dark\",\r\n    colorError: \"--{prefix}-color-error\",\r\n    colorErrorActive: \"--{prefix}-color-error-active\",\r\n    colorErrorMuted: \"--{prefix}-color-error-muted\",\r\n    colorErrorShade: \"--{prefix}-color-error-shade\",\r\n    colorErrorShadeDark: \"--{prefix}-color-error-shade-dark\",\r\n    inputBackground: \"--{prefix}-input-background-color\",\r\n    colorShade: \"--{prefix}-color-shade\",\r\n    colorShadeDarker: \"--{prefix}-color-shade-darker\",\r\n    colorShadeLight: \"--{prefix}-color-shade-light\",\r\n    colorShadeLighter: \"--{prefix}-color-shade-light-lighter\",\r\n    outline: \"--{prefix}-outline\",\r\n    borderRadius: \"--{prefix}-border-radius\",\r\n    padding: \"--{prefix}-padding\",\r\n    margin: \"--{prefix}-margin\",\r\n    scrollbarWidth: \"--{prefix}-scrollbar-width\",\r\n    componentSpace: \"--{prefix}-component-space\"\r\n}\r\n\r\n\r\nexport class STATICS {\r\n    static logLevel: CuiLogLevel = 'none';\r\n    static prefix: string = 'cui';\r\n}\r\n\r\nexport const EVENTS = {\r\n    INSTANCE_INITIALIZED: 'instance-initialized',\r\n    INSTANCE_FINISHED: 'instance-finished',\r\n    RESIZE: \"resize\",\r\n    OPEN: \"open\",\r\n    OPENED: \"opened\",\r\n    CLOSE: \"close\",\r\n    CLOSED: \"closed\",\r\n    TOGGLE: \"toggle\",\r\n    TOGGLED: 'toggled',\r\n    SWITCH: \"switch\",\r\n    SWITCHED: \"switched\",\r\n    ON_SCROLL: \"scroll\",\r\n    TARGET_CHANGE: 'targetchange',\r\n    INTERSECTION: 'intersection',\r\n    KEYDOWN: 'keydown',\r\n    SCROLLBY: 'scrollby',\r\n    WINDOW_CLICK: 'windowclick',\r\n    OFFSET: 'offset',\r\n    PROGRESS_CHANGE: \"progresschange\",\r\n    PROGRESS_CHANGED: \"progresschanged\",\r\n    CHANGE: \"change\",\r\n    CHANGED: \"changed\",\r\n    GLOBAL_MOVE: \"globalmove\",\r\n    MOVE_LOCK: \"movelock\",\r\n    PAUSE: \"pause\",\r\n    PAUSED: \"paused\"\r\n}\r\n\r\nexport const OBSERVABLE_SCROLL = \"SCROLL\";\r\nexport const OBSERVABLE_INTERSECTION = \"INTERSECTION\";\r\nexport const COMPONENTS_COUNTER = counter();","export class ErrorBase extends Error {\r\n    constructor(name: string, message?: string,) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport class ItemNotFoundError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ItemNotFoundError\", message);\r\n    }\r\n}\r\n\r\nexport class ArgumentError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiBusError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiInstanceInitError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiInstanceInitError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiScrollSpyOutOfRangeError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiScrollSpyOutOfRangeError\", message);\r\n    }\r\n}\r\n\r\n\r\nexport class RegisterElementError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"RegisterElementError\", message);\r\n    }\r\n}\r\n\r\nexport class AnimatorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"AnimatorError\", message);\r\n    }\r\n}\r\n","import { is, are } from \"./functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\n\r\nexport interface ICuiComponentAction {\r\n    add(element: Element, utils?: CuiUtils): void;\r\n    remove(element: Element, utils?: CuiUtils): void;\r\n    toggle(element: Element, utils?: CuiUtils): void;\r\n}\r\n\r\nexport class CuiClassAction implements ICuiComponentAction {\r\n    #class: string;\r\n\r\n    constructor(className: string) {\r\n        this.#class = className;\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && !element.classList.contains(this.#class)) {\r\n            element.classList.add(this.#class);\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && element.classList.contains(this.#class)) {\r\n            element.classList.remove(this.#class);\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class)) {\r\n            if (element.classList.contains(this.#class)) {\r\n                element.classList.remove(this.#class);\r\n            } else {\r\n                element.classList.add(this.#class);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiInboundAction implements ICuiComponentAction {\r\n    #name: string;\r\n\r\n    constructor(name: string) {\r\n        this.#name = name;\r\n    }\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n            case 'light-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n        }\r\n    }\r\n\r\n    private setDarkMode(utils: CuiUtils) {\r\n        if (utils.getLightMode() === 'dark') {\r\n            utils.setLightMode('light')\r\n        } else {\r\n            utils.setLightMode('dark')\r\n        }\r\n    }\r\n}\r\n\r\nexport class AttributeAction implements ICuiComponentAction {\r\n    #attributeName: string;\r\n    #attributeValue: string;\r\n    constructor(attribute: string) {\r\n        [this.#attributeName, this.#attributeValue] = attribute.split(',')\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        element.setAttribute(this.#attributeName, this.#attributeValue)\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this.#attributeName)) {\r\n            element.removeAttribute(this.#attributeName)\r\n        }\r\n\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this.#attributeName)) {\r\n            element.removeAttribute(this.#attributeName)\r\n        } else {\r\n            element.setAttribute(this.#attributeName, this.#attributeValue)\r\n        }\r\n    }\r\n}\r\n\r\nexport class DummyAction implements ICuiComponentAction {\r\n    constructor() {\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n    }\r\n}\r\n\r\nexport class CuiActionsFatory {\r\n    public static get(value: string): ICuiComponentAction {\r\n        if (!is(value)) {\r\n            return new DummyAction();\r\n        }\r\n        let indicator = value[0];\r\n        switch (indicator) {\r\n            case '.':\r\n                return new CuiClassAction(value.substring(1));\r\n            case '~':\r\n                return new CuiInboundAction(value.substring(1));\r\n            case \"&\":\r\n                return new AttributeAction(value.substring(1));\r\n            default:\r\n                return new CuiClassAction(value);\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiActionsListFactory {\r\n    public static get(value: string): ICuiComponentAction[] {\r\n        if (!is(value)) {\r\n            return [];\r\n        }\r\n        const split = value.split(',');\r\n        return split.map(single => {\r\n            return CuiActionsFatory.get(single.trim());\r\n        })\r\n    }\r\n}","import { CuiLogger } from \"../utils/logger\";\r\nimport { CuiLogLevel } from \"../utils/types\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\nimport { STATICS } from \"../utils/statics\";\r\n\r\n/**\r\n * \r\n */\r\nexport class CuiLoggerFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param name - component name\r\n     */\r\n    public static get(name: string, logLevel?: CuiLogLevel): ICuiLogger {\r\n        return new CuiLogger(name, logLevel ?? STATICS.logLevel)\r\n    }\r\n}","import { is, isTouchSupported, enumerateObject } from \"../../core/index\";\r\n\r\nexport interface ElementBuilderAttribute {\r\n    [name: string]: string;\r\n}\r\nexport class ElementBuilder {\r\n    #id: string;\r\n    #classes: string[];\r\n    #attributes: ElementBuilderAttribute;\r\n    #tag: string;\r\n    constructor(tag: string) {\r\n        this.#tag = tag;\r\n        this.#classes = [];\r\n        this.#attributes = null\r\n    }\r\n    setId(id: string): ElementBuilder {\r\n        this.#id = id;\r\n        return this;\r\n    }\r\n\r\n    setClasses(...classList: string[]): ElementBuilder {\r\n        this.#classes = classList;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: ElementBuilderAttribute): ElementBuilder {\r\n        this.#attributes = attributes;\r\n        return this;\r\n    }\r\n\r\n    build(innerHTML?: string): HTMLElement {\r\n        let element = document.createElement(this.#tag);\r\n        if (is(this.#id)) {\r\n            element.id = this.#id;\r\n        }\r\n        if (is(this.#classes)) {\r\n            element.classList.add(...this.#classes);\r\n        }\r\n        if (is(this.#attributes)) {\r\n            enumerateObject(this.#attributes, (attr: string, value: string) => {\r\n                element.setAttribute(attr, value);\r\n            })\r\n        }\r\n        if (is(innerHTML)) {\r\n            element.innerHTML = innerHTML;\r\n        }\r\n        return element;\r\n    }\r\n}","import { ICuiEventBusQueueSetup } from \"../bus/interfaces\";\r\nimport { CuiLogLevel, CuiInteractionsType } from \"../utils/types\";\r\n\r\ninterface CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n}\r\n\r\nexport class CuiSetup implements CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    plugins: any;\r\n\r\n    constructor() {\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.plugins = {};\r\n    }\r\n\r\n    fromInit(init: CuiSetupInit): CuiSetup {\r\n        this.prefix = init.prefix;\r\n        this.logLevel = init.logLevel;\r\n        this.cacheSize = init.cacheSize;\r\n        this.autoLightMode = init.autoLightMode;\r\n        this.animationTime = init.animationTime;\r\n        this.animationTimeShort = init.animationTimeShort;\r\n        this.animationTimeLong = init.animationTimeLong;\r\n        this.scrollThreshold = init.scrollThreshold;\r\n        this.resizeThreshold = init.resizeThreshold;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiSetupInit implements CuiSetupCommon {\r\n    prefix?: string;\r\n    app?: string;\r\n    interaction?: CuiInteractionsType;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n    busSetup?: ICuiEventBusQueueSetup[];\r\n    root: HTMLElement;\r\n\r\n    constructor() {\r\n        this.prefix = 'cui';\r\n        this.app = '$cui';\r\n        this.logLevel = 'warning';\r\n        this.interaction = 'async';\r\n        this.animationTime = 300;\r\n        this.animationTimeShort = 150;\r\n        this.animationTimeLong = 500;\r\n        this.cacheSize = 500;\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.root = document.body;\r\n        this.busSetup = undefined;\r\n    }\r\n}","import { ICuiDictionary, CuiCachable, ICuiManager } from \"../../core/models/interfaces\";\r\nimport { CuiDictionary } from \"../../core/utils/dictionary\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiCacheManager implements ICuiManager<CuiCachable> {\r\n    #cache: ICuiDictionary<CuiCachable>;\r\n    #maxSize: number;\r\n    constructor(maxSize?: number) {\r\n        this.#cache = new CuiDictionary<CuiCachable>();\r\n        this.#maxSize = maxSize ?? 500;\r\n    }\r\n    put(key: string, element: CuiCachable): void {\r\n        if (!is(key)) return;\r\n        if (this.has(key)) {\r\n            this.#cache.update(key, element);\r\n            return;\r\n        }\r\n        this.clean();\r\n        this.#cache.add(key, element);\r\n    }\r\n\r\n    get(key: string): CuiCachable {\r\n        if (!is(key)) return null;\r\n        if (this.has(key)) {\r\n            let item = this.#cache.get(key);\r\n            if (item.refresh()) {\r\n                return item;\r\n            }\r\n            this.#cache.remove(key);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    has(key: string): boolean {\r\n        return is(key) ? this.#cache.containsKey(key) : false;\r\n    }\r\n\r\n    remove(key: string): boolean {\r\n        if (!is(key)) return false;\r\n        if (this.has(key)) {\r\n            this.#cache.remove(key);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    clear(): void {\r\n        this.#cache.clear();\r\n    }\r\n\r\n    private clean() {\r\n        if (this.#cache.keys().length >= this.#maxSize) {\r\n            this.#cache.remove(this.#cache.keys()[0]);\r\n        }\r\n    }\r\n}\r\n\r\n","import { CuiColorSetType } from \"../../core/utils/types\";\r\nimport { is, getRangeValue, are } from \"../../core/utils/functions\";\r\nimport { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { CuiColor, CuiColorSet } from \"../../core/models/colors\";\r\nimport { CSS_APP_BACKGROUND_COLORS, CSS_COMPONENT_BACKGROUND_COLORS, CSS_COMPONENT_BORDER_COLORS, CSS_THEMES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiInstanceColorHandler {\r\n    #root: HTMLElement;\r\n    #interactions: IUIInteractionProvider;\r\n    #LIGHTEN_FACTOR: number = 15;\r\n    #DARKEN_FACTOR: number = 15;\r\n\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#root = document.documentElement;\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    setAppBackground(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_APP_BACKGROUND_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_APP_BACKGROUND_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setComponentBackground(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_COMPONENT_BACKGROUND_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_COMPONENT_BACKGROUND_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setBordersColors(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_COMPONENT_BORDER_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_COMPONENT_BORDER_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setColor(type: CuiColorSetType, set: CuiColorSet) {\r\n        const colors = CSS_THEMES[type];\r\n        const baseColor = set.base;\r\n        if (!is(colors) || !is(baseColor)) {\r\n            return\r\n        }\r\n        const mutedColor = set.muted ?? baseColor.clone().lighten(this.#LIGHTEN_FACTOR);\r\n        const activeColor = set.active ?? baseColor.clone().darken(this.#DARKEN_FACTOR);\r\n\r\n        this.#interactions.mutate(() => {\r\n            this.setProperty(colors.base, baseColor.toCssString());\r\n            this.setProperty(colors.active, activeColor.toCssString());\r\n            this.setProperty(colors.muted, mutedColor.toCssString());\r\n        }, this)\r\n\r\n    }\r\n\r\n    setLightenFactor(factor: number) {\r\n        this.#LIGHTEN_FACTOR = getRangeValue(factor, 0, 100);\r\n    }\r\n\r\n    setDarkenFactor(factor: number) {\r\n        this.#DARKEN_FACTOR = getRangeValue(factor, 0, 100);\r\n    }\r\n\r\n    setProperty(propertyName: string, value: string) {\r\n        this.#root.style.setProperty(propertyName, value);\r\n    }\r\n\r\n    setPropertyIn(propertyName: string, value: string) {\r\n        if (!are(value, propertyName)) {\r\n            return;\r\n        }\r\n        this.#interactions.mutate(this.setProperty, this, propertyName, value)\r\n    }\r\n}","import { CuiWindowSize } from \"../../core/utils/types\";\r\nimport { calcWindowSize } from \"../../core/utils/functions\";\r\nimport { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport interface ICuiResizable {\r\n    resize(data: CuiResizeData): Promise<boolean>;\r\n}\r\n\r\nexport interface ICuiResizableObserver {\r\n    observe(target: ICuiResizable): void;\r\n    unobserve(target: ICuiResizable): void;\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport interface CuiResizeData {\r\n    current: CuiWindowSize;\r\n    previous: CuiWindowSize;\r\n    width: number;\r\n    height: number;\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiResizeObserver implements ICuiResizableObserver {\r\n\r\n    #items: ICuiResizable[];\r\n    #promises: Promise<boolean>[];\r\n    #prevYValue: number;\r\n    #inProgress: boolean;\r\n    #previousSize: CuiWindowSize;\r\n    #threshold: number;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus, threshold?: number) {\r\n        this.#items = [];\r\n        this.#promises = [];\r\n        this.#prevYValue = window.innerWidth;\r\n        this.#inProgress = false;\r\n        this.#previousSize = calcWindowSize(window.innerWidth)\r\n        this.#threshold = threshold ?? 0;\r\n        this.#bus = bus;\r\n    }\r\n\r\n    observe(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx < 0) {\r\n            this.#items.push(target);\r\n        }\r\n    }\r\n\r\n    unobserve(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx >= 0) {\r\n            this.#items.splice(idx, 1)\r\n        }\r\n    }\r\n    connect(): void {\r\n        window.addEventListener('resize', this.listener.bind(this))\r\n    }\r\n\r\n    disconnect(): void {\r\n        window.removeEventListener('resize', this.listener.bind(this))\r\n    }\r\n\r\n    private listener(ev: UIEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true\r\n        const diff = window.innerWidth - this.#prevYValue;\r\n\r\n        if (Math.abs(diff) >= this.#threshold) {\r\n            const currentSize = calcWindowSize(window.innerWidth);\r\n            if (currentSize !== this.#previousSize) {\r\n                const resizeData: CuiResizeData = {\r\n                    current: currentSize,\r\n                    previous: this.#previousSize,\r\n                    width: window.innerWidth,\r\n                    height: window.innerHeight,\r\n                    timestamp: Date.now()\r\n                };\r\n                this.#bus.emit(EVENTS.RESIZE, null, resizeData)\r\n                if (this.#items.length > 0) {\r\n                    this.#promises = [];\r\n                    this.#items.forEach(x => {\r\n                        this.#promises.push(x.resize(resizeData))\r\n                    })\r\n                    Promise.all(this.#promises)\r\n                    this.#promises = [];\r\n                }\r\n\r\n                this.#previousSize = currentSize;\r\n            }\r\n        }\r\n        this.#inProgress = false\r\n    }\r\n\r\n\r\n}","import { IUIInteractionProvider, ICuiEventBus, ICuiManager, CuiCachable } from \"./interfaces\";\r\nimport { CuiSetup, CuiSetupInit } from \"./setup\";\r\nimport { CuiLightMode } from \"../utils/types\";\r\nimport { CuiInteractionsFactory } from \"../factories/interactions\";\r\nimport { CuiCacheManager } from \"../../app/managers/cache\";\r\nimport { CuiEventBus, CuiEventBusFactory } from \"../bus/bus\";\r\nimport { TaskedEventEmitHandler } from \"../bus/handlers\";\r\nimport { CuiCallbackExecutor } from \"../bus/executors\";\r\nimport { getName, replacePrefix } from \"../utils/functions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { ICuiDocumentStyleAppender, CuiDocumentStyleAppender } from \"../styles/appender\";\r\nimport { CuiInstanceColorHandler } from \"../../app/handlers/colors\";\r\nimport { ICuiResizableObserver, CuiResizeObserver } from \"../../app/observers/resize\";\r\n\r\nexport class CuiUtils {\r\n    interactions: IUIInteractionProvider;\r\n    bus: ICuiEventBus;\r\n    setup: CuiSetup;\r\n    cache: ICuiManager<CuiCachable>;\r\n    colors: CuiInstanceColorHandler;\r\n    styleAppender: ICuiDocumentStyleAppender;\r\n    #resizeObserver: ICuiResizableObserver;\r\n    constructor(initialSetup: CuiSetupInit) {\r\n        this.setup = new CuiSetup().fromInit(initialSetup);\r\n        this.interactions = CuiInteractionsFactory.get(initialSetup.interaction)\r\n        this.cache = new CuiCacheManager(this.setup.cacheSize);\r\n        this.bus = CuiEventBusFactory.get(initialSetup.busSetup);\r\n        this.colors = new CuiInstanceColorHandler(this.interactions);\r\n        this.styleAppender = new CuiDocumentStyleAppender(this.interactions);\r\n        this.#resizeObserver = new CuiResizeObserver(this.bus, this.setup.resizeThreshold);\r\n        this.#resizeObserver.connect();\r\n    }\r\n\r\n    setLightMode(mode: CuiLightMode) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        const classes = document.body.classList;\r\n        if (mode === 'dark' && !classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.add(name);\r\n            }, this)\r\n\r\n        } else if (mode === 'light' && classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.remove(name);\r\n            }, this)\r\n        }\r\n    }\r\n\r\n    getLightMode(): CuiLightMode {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        return document.body.classList.contains(name) ? 'dark' : 'light';\r\n    }\r\n\r\n    setPrintMode(flag: boolean) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        const classes = document.body.classList;\r\n        if (flag && !classes.contains(name)) {\r\n            classes.add(name);\r\n\r\n        } else if (!flag && classes.contains(name)) {\r\n            classes.remove(name);\r\n        }\r\n    }\r\n\r\n    isPrintMode(): boolean {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        return document.body.classList.contains(name);\r\n    }\r\n\r\n    setProperty(name: string, value: string) {\r\n        let prop = replacePrefix(name, this.setup.prefix);\r\n        document.documentElement.style.setProperty(prop, value);\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\n\r\nexport class CuiMediaQueryListener implements ICuiEventListener<MediaQueryListEvent> {\r\n\r\n    #mediaQuery: string;\r\n    #callback: (t: MediaQueryListEvent) => void;\r\n    #isInitialized: boolean;\r\n    #inProgress: boolean;\r\n    constructor(mediaQuery: string) {\r\n        this.#mediaQuery = mediaQuery;\r\n        this.#isInitialized = false;\r\n    }\r\n    setCallback(callback: (t: MediaQueryListEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        if (!window.matchMedia || this.#isInitialized || !this.#mediaQuery) {\r\n            return;\r\n        }\r\n        window.matchMedia(this.#mediaQuery)\r\n            .addEventListener('change', this.event.bind(this))\r\n        this.#isInitialized = true\r\n    }\r\n\r\n    detach(): void {\r\n        if (this.#isInitialized) {\r\n            window.matchMedia(this.#mediaQuery).removeEventListener('change', this.event.bind(this));\r\n            this.#isInitialized = false\r\n        }\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isInitialized;\r\n    }\r\n\r\n    private event(ev: MediaQueryListEvent): void {\r\n        if (this.#inProgress) {\r\n            return\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            this.#callback(ev);\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            this.#inProgress = false;\r\n        }\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { getRangeValueOrDefault } from \"../utils/functions\";\r\n\r\nexport interface CuiScrollEvent {\r\n    base: Event;\r\n    top: number;\r\n    left: number;\r\n}\r\n\r\nexport class CuiScrollListener implements ICuiEventListener<CuiScrollEvent> {\r\n    #target: Element;\r\n    #inProgress: boolean;\r\n    #threshold: number;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #callback: (ev: CuiScrollEvent) => void;\r\n    #isAttached: boolean;\r\n    #isRoot: boolean;\r\n    constructor(target: Element, threshold?: number) {\r\n        this.#target = target;\r\n        this.#inProgress = false;\r\n        this.#threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n        this.#prevX = this.#prevY = 0;\r\n        this.#isAttached = false;\r\n        this.#isRoot = target instanceof Window;\r\n    }\r\n\r\n    setCallback(callback: (ev: CuiScrollEvent) => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#target.addEventListener('scroll', this.listener.bind(this))\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach() {\r\n        this.#target.removeEventListener('scroll', this.listener.bind(this))\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    private listener(ev: Event) {\r\n        let left = this.getLeft();\r\n        let top = this.getTop();\r\n        this.#prevX += left;\r\n        this.#prevY += top;\r\n        if (this.#inProgress || !this.passedThreshold()) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n\r\n        requestAnimationFrame(() => {\r\n            this.#callback({\r\n                base: ev,\r\n                top: top,\r\n                left: left\r\n            })\r\n            this.#inProgress = false\r\n            this.#prevX = 0;\r\n            this.#prevY = 0;\r\n        })\r\n    }\r\n\r\n    private passedThreshold() {\r\n        return this.#threshold <= 0 || (this.#prevX >= this.#threshold || this.#prevY >= this.#threshold);\r\n    }\r\n\r\n    getTop() {\r\n        return this.#isRoot ? window.pageYOffset : this.#target.scrollTop;\r\n    }\r\n\r\n    getLeft(): number {\r\n        return this.#isRoot ? window.pageXOffset : this.#target.scrollLeft;\r\n    }\r\n}","import { TaskedEventEmitHandler } from \"../bus/handlers\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is, round } from \"../utils/functions\";\r\n\r\ninterface OnMoveCallback {\r\n    (ev: ICuiMoveEvent): void;\r\n}\r\n\r\ninterface IMoveListener {\r\n    onMove(data: OnMoveCallback): void\r\n    start(): void;\r\n    stop(): void;\r\n}\r\n\r\nexport type CuiMoveEventState = \"down\" | \"up\" | \"move\";\r\nexport interface ICuiMoveEvent {\r\n    x: number;\r\n    y: number;\r\n    moveX: number;\r\n    moveY: number;\r\n    type: CuiMoveEventState;\r\n    target: EventTarget;\r\n    event: MouseEvent | TouchEvent;\r\n}\r\n\r\nexport class CuiMoveEventListener implements ICuiEventListener<ICuiMoveEvent> {\r\n    #element: HTMLElement | Document;\r\n    #onEvent: (t: ICuiMoveEvent) => void;\r\n    #isLocked: boolean;\r\n    #isAttached: boolean;\r\n    #preventDefault: boolean;\r\n    constructor(element?: HTMLElement) {\r\n        this.#isLocked = false;\r\n        this.#element = element ?? document.body;\r\n        this.#isAttached = false;\r\n        this.#preventDefault = false;\r\n        this.onMouseDown = this.onMouseDown.bind(this);\r\n        this.onMouseUp = this.onMouseUp.bind(this)\r\n        this.onMouseMove = this.onMouseMove.bind(this)\r\n        this.onTouchStart = this.onTouchStart.bind(this)\r\n        this.onTouchEnd = this.onTouchEnd.bind(this)\r\n        this.onTouchMove = this.onTouchMove.bind(this)\r\n    }\r\n    setCallback(callback: (t: ICuiMoveEvent) => void): void {\r\n        this.#onEvent = callback;\r\n    }\r\n    isInProgress(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n    preventDefault(flag: boolean) {\r\n        this.#preventDefault = flag;\r\n    }\r\n    attach(): void {\r\n        if (this.#isAttached) {\r\n            return;\r\n        }\r\n        this.#element.addEventListener('mousedown', this.onMouseDown)\r\n        this.#element.addEventListener('mouseup', this.onMouseUp)\r\n        this.#element.addEventListener('mousemove', this.onMouseMove)\r\n        this.#element.addEventListener('touchstart', this.onTouchStart)\r\n        this.#element.addEventListener('touchend', this.onTouchEnd)\r\n        this.#element.addEventListener('touchmove', this.onTouchMove)\r\n        this.#isAttached = true;\r\n    }\r\n    detach(): void {\r\n        console.log(\"On detach\")\r\n        if (!this.#isAttached) {\r\n            return;\r\n        }\r\n\r\n        this.#element.removeEventListener('mousedown', this.onMouseDown)\r\n        this.#element.removeEventListener('mouseup', this.onMouseUp)\r\n        this.#element.removeEventListener('mousemove', this.onMouseMove)\r\n        this.#element.removeEventListener('touchstart', this.onTouchStart)\r\n        this.#element.removeEventListener('touchend', this.onTouchEnd)\r\n        this.#element.removeEventListener('touchmove', this.onTouchMove)\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached\r\n    }\r\n\r\n    onMouseDown(ev: MouseEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = true;\r\n        this.publishMouseEvent(\"down\", ev)\r\n\r\n    }\r\n\r\n    onMouseUp(ev: MouseEvent) {\r\n        if (!this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = false;\r\n        this.publishMouseEvent(\"up\", ev)\r\n\r\n    }\r\n\r\n    onMouseMove(ev: MouseEvent) {\r\n        if (this.#isLocked) {\r\n            this.publishMouseEvent(\"move\", ev)\r\n            // if (this.#preventDefault) {\r\n            //     ev.preventDefault();\r\n            // }\r\n        }\r\n    }\r\n\r\n    onTouchStart(ev: TouchEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = true;\r\n        this.publishTouchEvent('down', ev);\r\n    }\r\n\r\n    onTouchEnd(ev: TouchEvent) {\r\n        if (!this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = false;\r\n        this.publishTouchEvent('up', ev);\r\n    }\r\n\r\n    onTouchMove(ev: TouchEvent) {\r\n        if (this.#isLocked) {\r\n            this.publishTouchEvent('move', ev);\r\n            // if (this.#preventDefault) {\r\n            //     ev.preventDefault();\r\n            // }\r\n        }\r\n    }\r\n\r\n    private publishMouseEvent(type: CuiMoveEventState, ev: MouseEvent) {\r\n        // if (this.#preventDefault && ev.cancelable) {\r\n        //     ev.preventDefault();\r\n        // }\r\n        if (is(this.#onEvent)) {\r\n            this.#onEvent({\r\n                type: type,\r\n                x: ev.clientX,\r\n                y: ev.clientY,\r\n                moveX: ev.movementX,\r\n                moveY: ev.movementY,\r\n                target: ev.target,\r\n                event: ev\r\n            })\r\n        }\r\n    }\r\n\r\n    private publishTouchEvent(type: CuiMoveEventState, ev: TouchEvent) {\r\n        // if (this.#preventDefault && ev.cancelable)\r\n        //     ev.preventDefault();\r\n        if (is(this.#onEvent)) {\r\n            let touch = null;\r\n            if (ev.touches.length > 0) {\r\n                touch = ev.touches[0]\r\n            } else if (ev.changedTouches.length > 0) {\r\n                touch = ev.changedTouches[0]\r\n            }\r\n            this.#onEvent({\r\n                event: ev,\r\n                type: type,\r\n                target: ev.target,\r\n                x: is(touch) ? touch.clientX : -1,\r\n                y: is(touch) ? touch.clientY : -1,\r\n                moveX: -1,\r\n                moveY: -1\r\n            })\r\n        }\r\n    }\r\n\r\n}\r\n","import { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport class FastDom implements IUIInteractionProvider {\r\n    private writes: any[];\r\n    private reads: any[];\r\n    private raf: any;\r\n    private isScheduled: boolean = false;\r\n    #limit: number;\r\n\r\n    constructor() {\r\n        this.raf = window.requestAnimationFrame.bind(window)\r\n        this.writes = []\r\n        this.reads = []\r\n        this.#limit = 5;\r\n    }\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.reads.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.writes.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n    private run(tasks: any[]) {\r\n        let task = null\r\n        while (task = tasks.shift()) {\r\n            task()\r\n        }\r\n    }\r\n\r\n    private schedule(recursion?: number) {\r\n        if (!this.isScheduled) {\r\n            this.isScheduled = true;\r\n            if (recursion >= this.#limit) {\r\n                throw new Error(\"Fast Dom limit reached\")\r\n            } else {\r\n                this.raf(this.flush.bind(this, recursion));\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private flush(recursion?: number) {\r\n        let rec: number = recursion ?? 0;\r\n        let error = null;\r\n        let writes = this.writes;\r\n        let reads = this.reads;\r\n\r\n        try {\r\n            this.run(reads);\r\n            this.run(writes);\r\n        } catch (e) {\r\n            error = e\r\n            console.error(e)\r\n        }\r\n        this.isScheduled = false;\r\n\r\n        if (error) {\r\n            this.schedule(rec + 1)\r\n        }\r\n        if (this.writes.length || this.reads.length) {\r\n            this.schedule(recursion + 1);\r\n        }\r\n    }\r\n}\r\n\r\nexport class SyncInteractions implements IUIInteractionProvider {\r\n    tasks: any[];\r\n    raf: any;\r\n    isRunning: boolean = false;\r\n    constructor() {\r\n        this.tasks = [];\r\n        this.raf = window.requestAnimationFrame.bind(window)\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private schedule() {\r\n        if (!this.isRunning) {\r\n            this.isRunning = true;\r\n            this.raf(this.flush.bind(this))\r\n        }\r\n    }\r\n\r\n    private flush() {\r\n        let task = null\r\n        while (task = this.tasks.shift()) {\r\n            try {\r\n                task()\r\n            }\r\n            catch (e) {\r\n            }\r\n        }\r\n        this.isRunning = false\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n}","import { ICuiEventEmitHandler, ICuiLogger, ICuiCallbackExecutor, CuiEventReceiver } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\n\r\ninterface EmitHandlerData {\r\n    events: CuiEventReceiver;\r\n    cuid: string;\r\n    args: any[];\r\n}\r\n\r\nclass EmitHandlerBase {\r\n    isBusy: boolean;\r\n    queue: EmitHandlerData[];\r\n    constructor() {\r\n        this.queue = [];\r\n        this.isBusy = false;\r\n    }\r\n    idMatches(emitId: string, handleId: string) {\r\n        return !is(emitId) || (is(emitId) && emitId == handleId);\r\n    }\r\n}\r\n\r\nexport class SimpleEventEmitHandler extends EmitHandlerBase implements ICuiEventEmitHandler {\r\n    #log: ICuiLogger;\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        super();\r\n        this.#executor = executor;\r\n        this.#log = CuiLoggerFactory.get(\"SimpleEventEmitHandler\");\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args: any[]): Promise<void> {\r\n        if (!is(events)) {\r\n            this.#log.warning(\"No events provided\")\r\n            return\r\n        }\r\n        this.queue.push({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        if (!this.isBusy) {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.perform();\r\n                if (this.queue.length > 0) {\r\n                    await this.perform();\r\n                }\r\n                this.isBusy = false;\r\n            }\r\n        }\r\n        return;\r\n    }\r\n\r\n    private async perform() {\r\n        let task = this.queue.shift();\r\n        for (let id in task.events) {\r\n            let event = task.events[id]\r\n            try {\r\n                if (this.idMatches(task.cuid, event.$cuid))\r\n                    await this.#executor.execute(event.callback, task.args)\r\n            }\r\n            catch (e) {\r\n                this.#log.error(e)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class TaskedEventEmitHandler extends EmitHandlerBase implements ICuiEventEmitHandler {\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        super();\r\n        this.#executor = executor;\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args: any[]): Promise<void> {\r\n        if (!is(events)) {\r\n            return\r\n        }\r\n        this.queue.push({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        if (!this.isBusy) {\r\n            this.isBusy = true;\r\n            this.perform();\r\n            if (this.queue.length > 0) {\r\n                this.perform();\r\n            }\r\n            this.isBusy = false;\r\n        }\r\n        return;\r\n    }\r\n\r\n    private async perform(): Promise<void[]> {\r\n        let task = this.queue.shift();\r\n        let promises: Promise<void>[] = []\r\n        for (let id in task.events) {\r\n            let event = task.events[id]\r\n            if (this.idMatches(task.cuid, event.$cuid))\r\n                promises.push(this.#executor.execute(event.callback, task.args))\r\n        }\r\n        return Promise.all(promises)\r\n    }\r\n}\r\n\r\n\r\nexport class CuiEventEmitHandlerFactory {\r\n    static get(name: string, executor: ICuiCallbackExecutor): ICuiEventEmitHandler {\r\n        switch (name) {\r\n            case \"tasked\":\r\n                return new TaskedEventEmitHandler(executor);\r\n            default:\r\n                return new SimpleEventEmitHandler(executor);\r\n        }\r\n    }\r\n}","import { ICuiCallbackExecutor } from \"../models/interfaces\"\r\n\r\nexport class CuiCallbackExecutor implements ICuiCallbackExecutor {\r\n    async execute(callback: any, args: any[]): Promise<void> {\r\n        args = args ?? []\r\n\r\n        callback(...args)\r\n        return;\r\n    }\r\n}","import { CuiLogLevel } from \"./types\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\n\r\nexport class CuiLogger implements ICuiLogger {\r\n    level: CuiLogLevel\r\n    component: string;\r\n    id: string;\r\n    constructor(name: string, level: CuiLogLevel) {\r\n        this.level = level\r\n        this.component = name\r\n        this.id = \"-\";\r\n    }\r\n\r\n    setLevel(level: CuiLogLevel) {\r\n        this.level = level\r\n    }\r\n\r\n    setId(id: string) {\r\n        this.id = id\r\n    }\r\n    debug(message: string, functionName?: string): void {\r\n        if (this.level === 'debug') {\r\n            console.log(this.prepString(message, \"debug\", functionName))\r\n        }\r\n    }\r\n    error(message: string, functionName?: string): void {\r\n        if (this.level === 'error' || this.level === 'debug' || this.level === 'warning')\r\n            console.error(this.prepString(message, \"error\", functionName))\r\n    }\r\n\r\n    warning(message: string, functionName?: string): void {\r\n        if (this.level === 'warning' || this.level === 'debug')\r\n            console.warn(this.prepString(message, \"warning\", functionName))\r\n    }\r\n\r\n    exception(e: Error, functionName?: string): void {\r\n        console.error(this.prepString(`An exception occured: ${e.name}: ${e.message}`, \"exception\", functionName))\r\n        if (this.level === 'debug')\r\n            console.error(e.stack)\r\n    }\r\n\r\n    performance(callback: () => void, functionName?: string): void {\r\n        if (this.level !== 'debug') {\r\n            return;\r\n        }\r\n        let start = Date.now();\r\n        callback();\r\n        console.log(this.prepString(`Performance measure: ${Date.now() - start}ms`, \"performance\", functionName))\r\n    }\r\n\r\n    private prepString(message: string, level: string, functionName?: string) {\r\n        return `[${new Date().toLocaleString()}][${level}][${this.component}][${functionName ?? '-'}][${this.id}][${message}]`\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { ICuiComponentAction } from \"../utils/actions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiActionsHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    async performAction(target: Element, action: ICuiComponentAction, timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                action.add(target);\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        action.remove(target);\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performActions(target: Element, actions: ICuiComponentAction[], timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                actions.forEach(x => x.add(target));\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        actions.forEach(x => x.remove(target));\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performSwitchAction(inTarget: Element, outTarget: Element, inAction: ICuiComponentAction, outAction: ICuiComponentAction, onFinish: () => void, timeout: number): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                inAction.add(inTarget);\r\n                inTarget.classList.add(CLASSES.animProgress);\r\n                if (is(outTarget)) {\r\n                    outAction.add(outTarget);\r\n                    outTarget.classList.add(CLASSES.animProgress);\r\n                }\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        inAction.remove(inTarget);\r\n                        outAction.remove(outTarget);\r\n                        inTarget.classList.remove(CLASSES.animProgress);\r\n                        outTarget.classList.remove(CLASSES.animProgress);\r\n                        onFinish();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { CuiInteractionsType } from \"../utils/types\";\r\nimport { FastDom, SyncInteractions } from \"../utils/interactions\";\r\n\r\nexport class CuiInteractionsFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param type - Interactions type\r\n     */\r\n    public static get(type: CuiInteractionsType): IUIInteractionProvider {\r\n        const interactionType = type;\r\n        switch (interactionType) {\r\n            case 'async':\r\n                return new FastDom();\r\n            default:\r\n                return new SyncInteractions();\r\n        }\r\n    }\r\n}","import { ICuiDictionary, ICuiDictionaryItem } from \"../models/interfaces\";\r\nimport { ItemNotFoundError, ArgumentError } from \"../models/errors\";\r\nimport { is } from \"./functions\";\r\n\r\nexport class CuiDictionary<T> implements ICuiDictionary<T> {\r\n\r\n    #keys: string[];\r\n    #values: T[];\r\n\r\n    constructor(init?: ICuiDictionaryItem<T>[]) {\r\n        this.#keys = []\r\n        this.#values = []\r\n\r\n        if (init) {\r\n            init.forEach(x => {\r\n                if (!is(x.key)) {\r\n                    this.#keys = []\r\n                    this.#values = []\r\n                    throw new ArgumentError(\"Key is empty\");\r\n                }\r\n                this.add(x.key, x.value)\r\n            })\r\n        }\r\n    }\r\n\r\n    add(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        if (this.containsKey(key))\r\n            throw new Error(\"Key already exists\");\r\n        this.#keys.push(key)\r\n        this.#values.push(value)\r\n    }\r\n\r\n    remove(key: string): void {\r\n        if (!is(key)) {\r\n            return\r\n        }\r\n        let index = this.#keys.indexOf(key);\r\n        if (index >= 0) {\r\n            this.#keys.splice(index, 1)\r\n            this.#values.splice(index, 1)\r\n        }\r\n    }\r\n    get(key: string): T {\r\n        this.throwOnEmptyKey(key)\r\n        let index = this.indexOf(key)\r\n        if (index < 0) {\r\n            return undefined;\r\n        }\r\n        return this.#values[index];\r\n    }\r\n    containsKey(key: string): boolean {\r\n        return is(key) && this.indexOf(key) >= 0\r\n    }\r\n    keys(): string[] {\r\n        return this.#keys\r\n    }\r\n    values(): T[] {\r\n        return this.#values;\r\n    }\r\n\r\n    indexOf(key: string): number {\r\n        return is(key) ? this.#keys.indexOf(key) : -1;\r\n    }\r\n\r\n    update(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        let index = this.indexOf(key)\r\n        if (index < 0) {\r\n            throw new ItemNotFoundError(`Item with key [${key}] not found`)\r\n        }\r\n        this.#values[index] = value\r\n    }\r\n\r\n    clear() {\r\n        this.#values = [];\r\n        this.#keys = [];\r\n    }\r\n\r\n    private throwOnEmptyKey(key: string) {\r\n        if (!is(key)) {\r\n            throw new ArgumentError(\"Key is empty\");\r\n        }\r\n    }\r\n}","import { ICuiEventBus, CuiEventReceiver, ICuiLogger, ICuiEventEmitHandler, CuiContext, CuiElement, CuiEventObj } from \"../models/interfaces\";\r\nimport { is, are, generateRandomString, enumerateObject, mapObject } from \"../utils/functions\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\nimport { CuiEventEmitHandlerFactory, TaskedEventEmitHandler } from \"./handlers\";\r\nimport { CuiCallbackExecutor } from \"./executors\";\r\nimport { CuiBusExtStatistics, ICuiEventBusQueueSetup } from \"./interfaces\";\r\n\r\ninterface ICuiBusMapping {\r\n    [name: string]: number;\r\n}\r\n\r\n\r\n\r\n\r\nexport class CuiEventBus implements ICuiEventBus {\r\n    #events: { [event: string]: CuiEventReceiver }\r\n    #log: ICuiLogger;\r\n    #eventHandler: ICuiEventEmitHandler;\r\n    #name: string;\r\n    constructor(emitHandler: ICuiEventEmitHandler, name?: string) {\r\n        this.#events = {};\r\n        this.#eventHandler = emitHandler;\r\n        this.#name = name ?? \"CuiEventBus\"\r\n        this.#log = CuiLoggerFactory.get(this.#name);\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on(name: string, callback: any, cui?: CuiElement): string {\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        // When context is not provided (e.g. anonymous function) then generate random\r\n        let id = this.#name + \"-\" + generateRandomString();\r\n\r\n\r\n        if (!this.#events[name]) {\r\n            this.#events[name] = {}\r\n        }\r\n        if (this.isAttached(this.#events[name], id, cui)) {\r\n            return null;\r\n        }\r\n        this.#log.debug(`Attaching new event: [${name}] for: [${id}]`)\r\n\r\n        this.#events[name][id] = { callback: callback, $cuid: this.getCuid(cui) }\r\n        return id;\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        let ev = this.#events[name]\r\n        this.#log.debug(`Detaching item: [${id}] from [${name}]`)\r\n        if (this.isAttached(ev, id)) {\r\n            delete ev[id];\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        if (is(name) && this.#events[name]) {\r\n            delete this.#events[name]\r\n        } else {\r\n            this.#log.error(`Event name is missing or incorrect`, \"detachAll\")\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit(event: string, cuid: string, ...args: any[]): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n\r\n        let callbacks = this.#events[event];\r\n        if (is(callbacks)) {\r\n            this.#log.debug(`Emit: [${event}]`)\r\n            await this.#eventHandler.handle(this.#events[event], cuid, args)\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        let ev = this.#events[name]\r\n        return this.isAttached(ev, id, cui)\r\n    }\r\n\r\n    /**\r\n     * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n     * @param {string} event - event name\r\n     * @param {string} cuid - cuid of the component\r\n     */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return;\r\n        }\r\n        let ev = this.#events[event];\r\n        if (!is(ev)) {\r\n            return;\r\n        }\r\n        enumerateObject({ ...ev }, (evId: string, evValue: CuiEventObj) => {\r\n            if (evValue.$cuid === cuid) {\r\n                delete ev[evId]\r\n            }\r\n        })\r\n    }\r\n\r\n    private isAttached(ev: CuiEventReceiver, id: string, cui?: CuiElement): boolean {\r\n        if (is(cui)) {\r\n            return is(ev) && is(id) && is(ev[id]) && ev[id].$cuid == cui.$cuid;\r\n        }\r\n        return is(ev) && is(id) && is(ev[id]);\r\n    }\r\n\r\n    private getCuid(cui: CuiElement) {\r\n        return is(cui) ? cui.$cuid : null;\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport class CuiEventExtBus implements ICuiEventBus {\r\n    #events: { [event: string]: number };\r\n    #log: ICuiLogger;\r\n    #buses: ICuiEventBus[];\r\n    #last: number;\r\n    constructor(setup: ICuiEventBusQueueSetup[]) {\r\n        this.#log = CuiLoggerFactory.get(\"CuiEventBus\");\r\n        this.#buses = [];\r\n        if (is(setup)) {\r\n            this.#log.debug(\"Initiating buses\")\r\n            let sorted = setup.length === 1 ? setup : setup.sort((first, second) => {\r\n                return first.priority - second.priority\r\n            })\r\n            sorted.forEach((item, index) => {\r\n                this.#buses.push(this.initBusInstance(item.name, item.handler))\r\n                this.#events = {\r\n                    ...this.#events,\r\n                    ...this.mapEvents(item.eventsDef, index),\r\n                }\r\n                this.#log.debug(`Bus ${item.name} has been initialized with number: ${index}`)\r\n            })\r\n\r\n            this.#buses.push(this.initBusInstance(\"DefaultEventBus\", 'tasked'))\r\n            this.#last = this.#buses.length - 1;\r\n            this.#log.debug(`Bus initialization finished`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on(name: string, callback: any, cui?: CuiElement): string {\r\n\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        return this.get(name).on(name, callback, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string, cui?: CuiElement): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        this.get(name).detach(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        this.get(name).detachAll(name);\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit(event: string, cuid: string, ...args: any[]): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n        return this.get(event).emit(event, cuid, ...args);\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        return this.get(name).isSubscribing(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n    * @param {string} event - event name\r\n    * @param {string} cuid - cuid of the component\r\n    */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return\r\n        }\r\n        this.get(event).detachByCuid(event, cuid);\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates and initializes event bus instance\r\n     * @param busName Event bus name for logger\r\n     * @param handlerName handler name to create proper handler instance\r\n     */\r\n    private initBusInstance(busName: string, handlerName: string): ICuiEventBus {\r\n        if (!are(busName, handlerName)) {\r\n            throw new ArgumentError(\"Bus name or handler name is incorrect\");\r\n        }\r\n        let executor = new CuiCallbackExecutor();\r\n        let handler = CuiEventEmitHandlerFactory.get(handlerName, executor);\r\n        return new CuiEventBus(handler, busName);\r\n    }\r\n\r\n    /**\r\n     * Creates mapping object from events array\r\n     * @param events events array\r\n     * @param index queue number\r\n     */\r\n    private mapEvents(events: string[], index: number): ICuiBusMapping {\r\n        return events.reduce((result: ICuiBusMapping, current: string) => {\r\n            if (!result[current]) {\r\n                return {\r\n                    ...result,\r\n                    [current]: index\r\n                }\r\n            }\r\n            return result;\r\n        }, {})\r\n    }\r\n\r\n    /**\r\n     * Retrives porper event bus based on event name\r\n     * @param event \r\n     */\r\n    private get(event: string): ICuiEventBus {\r\n        let idx = this.#events[event];\r\n        return this.#buses[idx ?? this.#last];\r\n    }\r\n}\r\n\r\nexport class CuiEventBusFactory {\r\n    static get(setup: ICuiEventBusQueueSetup[]): ICuiEventBus {\r\n        return is(setup) ? new CuiEventExtBus(setup) : new CuiEventBus(new TaskedEventEmitHandler(new CuiCallbackExecutor));\r\n    }\r\n}\r\n\r\nexport class CuiBusExtStatisticsHandler {\r\n    #isOn: boolean;\r\n    #statistics: CuiBusExtStatistics;\r\n    constructor(gather: boolean, queueCount: number) {\r\n        this.#isOn = gather;\r\n        this.#statistics = {\r\n            queueCount: queueCount,\r\n            events: {}\r\n        }\r\n    }\r\n\r\n    addEvent(event: string, queueNumber: number, emitCount?: number) {\r\n        this.#statistics.events[event] = {\r\n            name: event,\r\n            queueNumber: queueNumber,\r\n            emits: emitCount ?? 0\r\n        }\r\n    }\r\n\r\n    addQueue() {\r\n        this.#statistics.queueCount += 1;\r\n    }\r\n\r\n    addEmit(event: string, queueNumber?: number) {\r\n        if (!this.#isOn) {\r\n            return;\r\n        }\r\n\r\n        if (this.#statistics.events[event]) {\r\n            this.#statistics.events[event].emits += 1;\r\n        } else {\r\n            this.addEvent(event, queueNumber ?? -1, 1);\r\n        }\r\n\r\n    }\r\n\r\n    getStatistics(): CuiBusExtStatistics {\r\n        return this.#statistics;\r\n    }\r\n\r\n}","import { is } from \"../utils/functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport interface ICuiDocumentStyleAppender {\r\n    append(style: string): boolean;\r\n}\r\n\r\nexport class CuiDocumentStyleAppender implements ICuiDocumentStyleAppender {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    append(style: string): boolean {\r\n        if (is(style)) {\r\n            const head = document.head || document.getElementsByTagName('head')[0]\r\n            const node = document.createElement('style');\r\n            const text = document.createTextNode(style);\r\n            node.type = 'text/css';\r\n            node.appendChild(text);\r\n            head.appendChild(node);\r\n        }\r\n        return true;\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiKeyPressListener implements ICuiEventListener<KeyboardEvent> {\r\n    #callback: (t: KeyboardEvent) => void;\r\n    #keys: string[];\r\n    #inProgress: boolean;\r\n    #singleEmit: boolean;\r\n    #isAttached: boolean;\r\n    constructor(singleEmit: boolean, keys?: string[]) {\r\n        this.#keys = keys;\r\n        this.#inProgress = false;\r\n        this.#singleEmit = true;\r\n    }\r\n\r\n    setCallback(callback: (t: KeyboardEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    attach(): void {\r\n        document.addEventListener('keydown', this.onKeyDown.bind(this))\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.onKeyUp.bind(this))\r\n        }\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        document.removeEventListener('keydown', this.onKeyDown.bind(this))\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.onKeyUp.bind(this))\r\n        }\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            if (!is(this.#keys) || this.#keys.includes(ev.code)) {\r\n                this.#callback(ev);\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            if (!this.#singleEmit)\r\n                this.#inProgress = false;\r\n        }\r\n    }\r\n\r\n    onKeyUp(ev: KeyboardEvent) {\r\n        this.#inProgress = false;\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemLightMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoLightPluginSetup {\r\n    autoLight: boolean;\r\n}\r\n\r\nexport class CuiAutoLightModePlugin implements ICuiPlugin {\r\n    description: string = 'Dark vs Light mode auto switcher';\r\n    name: string = 'auto-light';\r\n    setup: AutoLightPluginSetup;\r\n    #listener: CuiMediaQueryListener;\r\n    #utils: CuiUtils;\r\n    constructor(autoLightInit: AutoLightPluginSetup) {\r\n        this.description = \"CuiAutoLightModePlugin\";\r\n        this.setup = autoLightInit;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils\r\n        if (this.setup.autoLight && getSystemLightMode() === 'dark') {\r\n            this.#utils.setLightMode('dark')\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('(prefers-color-scheme: dark)')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        let autoLightSetup = this.#utils.setup.plugins[this.description] as AutoLightPluginSetup;\r\n        let autoLight = autoLightSetup?.autoLight ?? false;\r\n        if (autoLight) {\r\n            if (ev.matches) {\r\n                this.#utils.setLightMode('dark')\r\n            } else {\r\n                this.#utils.setLightMode('light')\r\n            }\r\n        }\r\n    }\r\n\r\n}","export class AriaAttributes {\r\n    public static setLabel(element: Element, label: string): void {\r\n        if (!element.hasAttribute('aria-label')) {\r\n            element.setAttribute('aria-label', label);\r\n        }\r\n    }\r\n\r\n    public static setAria(element: Element, attr: string, value: string) {\r\n        if (!element.hasAttribute(attr)) {\r\n            element.setAttribute(attr, value);\r\n        }\r\n    }\r\n\r\n    public static removeAria(element: Element, attr: string) {\r\n        if (element.hasAttribute(attr)) {\r\n            element.removeAttribute(attr);\r\n        }\r\n    }\r\n}","import { ICuiLogger, IUIInteractionProvider, CuiContext, ICuiComponentHandler, ICuiParsable, ICuiOpenable, ICuiClosable } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getActiveClass, CuiActionsHelper, ICuiComponentAction, is, EVENTS, CuiActionsFatory, CuiActionsListFactory } from \"../../core/index\";\r\nimport { ICuiComponentMutationObserver, CuiComponentMutationHandler } from \"../observers/mutations\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { KeyDownEvent } from \"../../plugins/keys/observer\";\r\n\r\nexport interface CuiChildMutation {\r\n    removed: Node[];\r\n    added: Node[];\r\n}\r\n\r\nexport class ComponentHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    hasClass(cls: string, element: Element) {\r\n        return cls && element.classList.contains(cls)\r\n    }\r\n\r\n    setClass(cls: string, element: Element) {\r\n        this.setClasses([cls], element);\r\n    }\r\n\r\n    setClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.add(...classes)\r\n        }\r\n    }\r\n\r\n    setClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.setClasses, this, classes, element);\r\n    }\r\n\r\n    removeClass(cls: string, element: Element) {\r\n        this.removeClasses([cls], element);\r\n    }\r\n\r\n    removeClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.remove(...classes)\r\n        }\r\n    }\r\n\r\n    removeClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.removeClasses, this, classes, element);\r\n    }\r\n\r\n    removeAttribute(attributeName: string, element: Element) {\r\n        if (element && element.hasAttribute(attributeName))\r\n            element.removeAttribute(attributeName);\r\n    }\r\n\r\n    setStyle(element: any, property: string, value: string) {\r\n        if (element && element[\"style\"] && is(value)) {\r\n            element.style[property] = value\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiComponentBase implements CuiContext {\r\n    _log: ICuiLogger;\r\n    utils: CuiUtils;\r\n    element: Element;\r\n    cuid: string;\r\n    isLocked: boolean;\r\n    activeClassName: string;\r\n    helper: ComponentHelper;\r\n    #emittedEvents: string[];\r\n    constructor(componentName: string, element: Element, utils: CuiUtils) {\r\n        this._log = CuiLoggerFactory.get(componentName);\r\n        this.utils = utils;\r\n        this.element = element;\r\n        this.cuid = (<any>element).$cuid;\r\n        this.isLocked = false;\r\n        this._log.setId(this.cuid);\r\n        this.activeClassName = getActiveClass(utils.setup.prefix);\r\n        this.helper = new ComponentHelper(utils.interactions);\r\n        this.#emittedEvents = [];\r\n    }\r\n\r\n\r\n    mutate(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    fetch(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    getEventName(name: string) {\r\n        return [name, this.cuid].join('-');\r\n    }\r\n\r\n    emitEvent(event: string, ...data: any[]) {\r\n        if (!this.#emittedEvents.includes(event))\r\n            this.#emittedEvents.push(event);\r\n        this.utils.bus.emit(event, this.cuid, ...data)\r\n    }\r\n\r\n    onEvent(event: string, callback: any): string {\r\n        return this.utils.bus.on(event, callback, this.element as any)\r\n    }\r\n\r\n    detachEvent(event: string, id: string) {\r\n        if (id != null) {\r\n            this.utils.bus.detach(event, id);\r\n            id = null;\r\n        }\r\n    }\r\n\r\n    getId(): string {\r\n        return this.cuid;\r\n    }\r\n\r\n    checkLockAndWarn(fName?: string): boolean {\r\n        if (this.isLocked) {\r\n            this._log.warning(\"Component is locked\", fName)\r\n            return true\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Helper which checks whether element has an active flag set\r\n     */\r\n    isActive(): boolean {\r\n        return this.element.classList.contains(this.activeClassName);\r\n    }\r\n\r\n    detachEmiitedEvents() {\r\n        this.#emittedEvents.forEach(event => {\r\n            this.utils.bus.detachByCuid(event, this.cuid);\r\n            this._log.debug(\"Detaching event: \" + event + \" on component delete\");\r\n        })\r\n\r\n    }\r\n\r\n}\r\n\r\nabstract class CuiHandlerBase<T extends ICuiParsable> extends CuiComponentBase implements ICuiComponentHandler {\r\n    args: T;\r\n    prevArgs: T;\r\n    isInitialized: boolean;\r\n    activeClassName: string;\r\n    actionsHelper: CuiActionsHelper;\r\n    #attribute: string;\r\n    constructor(componentName: string, element: Element, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, utils);\r\n        this.args = args;\r\n\r\n        this.actionsHelper = new CuiActionsHelper(utils.interactions)\r\n        this.prevArgs = null;\r\n        this.isInitialized = false;\r\n        this.#attribute = attribute;\r\n    }\r\n\r\n    handle(args: any): void {\r\n        this._log.debug(\"Init\", 'handle');\r\n        if (this.isInitialized) {\r\n            this._log.warning(\"Trying to initialize component again\", 'handle');\r\n            return;\r\n        }\r\n        this.args.parse(args);\r\n        if (!this.element.classList.contains(this.#attribute)) {\r\n            this.element.classList.add(this.#attribute);\r\n        }\r\n        this.onHandle();\r\n        this.isInitialized = true;\r\n    }\r\n\r\n    refresh(args: any): void {\r\n        this._log.debug(\"Update\", 'refresh')\r\n        if (!this.isInitialized) {\r\n            this._log.error(\"Cannot update not initialized component\", 'refresh');\r\n            return;\r\n        }\r\n        this.prevArgs = { ...this.args };\r\n        this.args.parse(args);\r\n        this.onRefresh();\r\n    }\r\n\r\n    destroy(): void {\r\n        this._log.debug(\"Destroy\", \"destroy\");\r\n        this.onRemove();\r\n        this.detachEmiitedEvents();\r\n        this.isInitialized = false;\r\n    }\r\n\r\n\r\n\r\n    // Abstract\r\n    abstract onHandle(): void;\r\n    abstract onRefresh(): void;\r\n    abstract onRemove(): void;\r\n}\r\n\r\n\r\nexport abstract class CuiHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    args: T;\r\n    prevArgs: T;\r\n    isInitialized: boolean;\r\n\r\n    actionsHelper: CuiActionsHelper;\r\n    constructor(componentName: string, element: Element, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n    }\r\n\r\n    onHandle() {\r\n        this.onInit();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        this.onUpdate();\r\n    }\r\n\r\n    onRemove() {\r\n        this.onDestroy();\r\n    }\r\n\r\n    /**\r\n     * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n     * \r\n     * @param action - action to perfrom\r\n     * @param timeout - timeout specified for action removal\r\n     * @param onFinish - callback to be performed after action is finished after removal\r\n     * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n     */\r\n    async performAction(actions: ICuiComponentAction[], timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performActions(this.element, actions, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Abstract\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n\r\n}\r\nexport interface CuiInteractableArgs {\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    escClose: boolean;\r\n    keyClose: string;\r\n}\r\n\r\nexport abstract class CuiInteractableHandler<T extends ICuiParsable & CuiInteractableArgs> extends CuiHandlerBase<T> implements ICuiOpenable, ICuiClosable {\r\n    args: T;\r\n    prevArgs: T;\r\n    isInitialized: boolean;\r\n\r\n    actionsHelper: CuiActionsHelper;\r\n    #openEventId: string;\r\n    #closeEventId: string;\r\n    #keyCloseEventId: string;\r\n    #openAct: ICuiComponentAction[];\r\n    #closeAct: ICuiComponentAction[];\r\n    constructor(componentName: string, element: Element, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n    }\r\n\r\n\r\n    onHandle() {\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.openFromEvent.bind(this))\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.closeFromEvent.bind(this))\r\n        this.#openAct = CuiActionsListFactory.get(this.args.openAct)\r\n        this.#closeAct = CuiActionsListFactory.get(this.args.closeAct)\r\n        this.onInit();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        if (this.args.openAct !== this.prevArgs.openAct) {\r\n            this.#openAct = CuiActionsListFactory.get(this.args.openAct)\r\n        }\r\n        if (this.args.closeAct !== this.prevArgs.closeAct) {\r\n            this.#closeAct = CuiActionsListFactory.get(this.args.closeAct)\r\n        }\r\n        this.onUpdate();\r\n    }\r\n\r\n    onRemove() {\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId)\r\n        this.onDestroy();\r\n    }\r\n\r\n    async open(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"open\")) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            this._log.warning(\"Component is already opened\");\r\n            return false;\r\n        }\r\n        if (this.args.escClose || is(this.args.keyClose)) {\r\n            this.#keyCloseEventId = this.onEvent(EVENTS.KEYDOWN, this.onKeyClose.bind(this))\r\n        }\r\n\r\n        if (!this.onBeforeOpen()) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        return this.performAction(this.#openAct, this.args.timeout, this.onActionFinish.bind(this, this.onAfterOpen.bind(this), EVENTS.OPENED, args), () => {\r\n            this.helper.setClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'true');\r\n        });;\r\n    }\r\n\r\n    async close(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\")) {\r\n            return false;\r\n        }\r\n        if (!this.isActive()) {\r\n            this._log.warning(\"Component is already closed\");\r\n            return false;\r\n        }\r\n\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#keyCloseEventId);\r\n        if (!this.onBeforeClose()) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        return this.performAction(this.#closeAct, this.args.timeout, this.onActionFinish.bind(this, this.onAfterClose.bind(this), EVENTS.CLOSED, args), () => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        });;\r\n    }\r\n\r\n\r\n    /**\r\n     * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n     * \r\n     * @param action - action to perfrom\r\n     * @param timeout - timeout specified for action removal\r\n     * @param onFinish - callback to be performed after action is finished after removal\r\n     * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n     */\r\n    async performAction(actions: ICuiComponentAction[], timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performActions(this.element, actions, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private openFromEvent(args: any) {\r\n        this.open(args);\r\n    }\r\n\r\n    private closeFromEvent(args: any) {\r\n        this.close(args);\r\n    }\r\n\r\n    private onActionFinish(callback: () => void, event: string, args: any) {\r\n        callback();\r\n        this.emitEvent(event, {\r\n            timestamp: Date.now(),\r\n            state: args\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private async onKeyClose(ev: KeyDownEvent) {\r\n        if (this.args.escClose && ev.event.key === \"Escape\" || is(this.args.keyClose) && ev.event.key === this.args.keyClose) {\r\n            await this.close('Closed by key');\r\n        }\r\n    }\r\n    // Abstract\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n    abstract onBeforeOpen(): boolean;\r\n    abstract onAfterOpen(): void;\r\n    abstract onAfterClose(): void;\r\n    abstract onBeforeClose(): boolean;\r\n\r\n}\r\n\r\nexport abstract class CuiMutableHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    #mutionHandler: ICuiComponentMutationObserver;\r\n    constructor(componentName: string, element: Element, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n        this.#mutionHandler = new CuiComponentMutationHandler(element);\r\n        this.#mutionHandler.onMutation(this.mutation.bind(this))\r\n    }\r\n\r\n    onHandle() {\r\n        this.onInit();\r\n        this.#mutionHandler.observe();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        this.#mutionHandler.unobserve();\r\n        this.onUpdate();\r\n        this.#mutionHandler.observe();\r\n    }\r\n\r\n    onRemove() {\r\n        this.#mutionHandler.unobserve();\r\n        this.onDestroy();\r\n    }\r\n\r\n    /**\r\n     * Callback attached to mutation observer set on root element\r\n     * \r\n     * @param record - mutation records\r\n     */\r\n    mutation(records: MutationRecord[]): void {\r\n        this._log.debug(\"Element mutation\", \"mutation\")\r\n        this.onMutation(records.reduce<CuiChildMutation>((result: CuiChildMutation, item: MutationRecord) => {\r\n            if (item.type !== \"childList\") {\r\n                return result;\r\n            }\r\n            if (item.addedNodes.length > 0) {\r\n                result.added.push(...item.addedNodes)\r\n            }\r\n            if (item.removedNodes.length > 0) {\r\n                result.removed.push(...item.removedNodes)\r\n            }\r\n            return result;\r\n        }, {\r\n            added: [],\r\n            removed: []\r\n        }));\r\n    }\r\n\r\n    abstract onMutation(record: CuiChildMutation): void;\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n}","import { createElementFromString, is } from \"../../core/index\";\r\n\r\nexport class IconBuilder {\r\n    #element: string;\r\n    #scale: number;\r\n    #appender: IconScaleAppender;\r\n\r\n    constructor(svgString: string) {\r\n        this.#element = svgString;\r\n        this.#scale = 1;\r\n        this.#appender = new IconScaleAppender();\r\n    }\r\n\r\n    setScale(scale: number): IconBuilder {\r\n        this.#scale = scale\r\n        return this\r\n    }\r\n\r\n    build(): Element {\r\n        let created = createElementFromString(this.#element)\r\n        if (is(created) && this.#scale) {\r\n            this.#appender.append(created, this.#scale)\r\n        }\r\n        return created\r\n    }\r\n}\r\n\r\nexport class IconScaleAppender {\r\n    append(element: Element, value: number): void {\r\n        let width = element.hasAttribute(\"width\") ? parseInt(element.getAttribute(\"width\")) : 20;\r\n        let height = element.hasAttribute(\"height\") ? parseInt(element.getAttribute(\"height\")) : 20;\r\n        element.setAttribute(\"width\", (width * value).toString())\r\n        element.setAttribute(\"height\", (height * value).toString())\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICONS } from \"../../core/utils/statics\";\r\nimport { is, isString, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../app/builders/icon\";\r\n\r\nexport class CuiIconArgs implements ICuiParsable {\r\n    icon: string;\r\n    scale: number;\r\n\r\n    constructor() {\r\n        this.icon = null;\r\n        this.scale = 1;\r\n    }\r\n    parse(val: any) {\r\n        if (isString(val)) {\r\n            this.icon = getStringOrDefault(val, \"\");\r\n        } else {\r\n            this.icon = getStringOrDefault(val.icon, \"\");\r\n            this.scale = getIntOrDefault(val.scale, 1);\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport class CuiIconComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-icon`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIconHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiIconHandler extends CuiHandler<CuiIconArgs> {\r\n\r\n    #currentIcon: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIconHandler\", element, attribute, new CuiIconArgs(), utils);\r\n        this.#currentIcon = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        if (this.#currentIcon !== null) {\r\n            this._log.debug(\"Icon already initialized\")\r\n            return;\r\n        }\r\n        this.addIcon(this.args.icon)\r\n        this.#currentIcon = this.args.icon;\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.args.icon === this.#currentIcon) {\r\n            return;\r\n        }\r\n        this.addIcon(this.args.icon);\r\n        this.#currentIcon = this.args.icon;\r\n    }\r\n\r\n    onDestroy(): void {\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n        this.#currentIcon = null;\r\n    }\r\n\r\n    private addIcon(icon: string) {\r\n        const iconStr = icon ? ICONS[icon] : null;\r\n        if (!iconStr) {\r\n            return;\r\n        }\r\n        const iconSvg = new IconBuilder(iconStr).setScale(this.args.scale).build();\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n\r\n        if (this.element.childNodes.length > 0) {\r\n            this.mutate(this.insertBefore, iconSvg)\r\n        } else {\r\n            this.mutate(this.appendChild, iconSvg)\r\n        }\r\n    }\r\n\r\n    private insertBefore(iconElement: Element) {\r\n        this.element.insertBefore(iconElement, this.element.firstChild);\r\n    }\r\n\r\n    private appendChild(iconElement: Element) {\r\n        this.element.appendChild(iconElement);\r\n    }\r\n}\r\n","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { is, getRangeValue, isString, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { ICONS, EVENTS } from \"../../core/utils/statics\";\r\nimport { IconBuilder } from \"../../app/builders/icon\";\r\n\r\nexport interface CuiCircleProgressChnaged {\r\n    timestamp: number;\r\n    progress: number;\r\n}\r\n\r\nexport class CuiCircleArgs implements ICuiParsable {\r\n    progress: number;\r\n    constructor() {\r\n        this.progress = 0;\r\n    }\r\n\r\n    parse(val: any): void {\r\n        if (!is(val)) {\r\n            this.progress = 0;\r\n        }\r\n        else if (isString(val)) {\r\n            this.progress = getIntOrDefault(val, 0);\r\n        } else {\r\n            this.progress = getIntOrDefault(val.progress, 0);\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nexport class CuiCircleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = (prefix ?? 'cui') + '-circle-progress';\r\n        ICONS['special_circle_progress'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"  class=\\\"circle-progress\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle-progress-path\\\" d=\\\"M 50,5.3660047 A 44.867708,44.633994 0 0 1 94.867709,49.999997 44.867708,44.633994 0 0 1 50,94.633995 44.867708,44.633994 0 0 1 5.1322908,50.000001 44.867708,44.633994 0 0 1 50,5.3660047\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCircleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiCircleHandler extends CuiHandler<CuiCircleArgs> {\r\n    #factor: number;\r\n    #full: number;\r\n    #path: any;\r\n    #attr: string;\r\n    #progressEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiCircleHandler\", element, attribute, new CuiCircleArgs(), utils);\r\n        this.#factor = this.#full = 0;\r\n        this.#path = null\r\n        this.#attr = attribute;\r\n        this.#progressEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        const iconSvg = new IconBuilder(ICONS['special_circle_progress']).build();\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n        this.element.appendChild(iconSvg);\r\n        this.#path = this.element.querySelector('.circle-progress-path');\r\n        this.#full = this.#path.getTotalLength();\r\n        this.#factor = this.#full / 100;\r\n        this.fetch(this.readStyle)\r\n        this.#progressEventId = this.onEvent(EVENTS.PROGRESS_CHANGE, this.onSetProgress.bind(this))\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.fetch(this.readStyle)\r\n        this.emitEvent(EVENTS.PROGRESS_CHANGED, {\r\n            timestamp: Date.now(),\r\n            progress: this.args.progress\r\n        })\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.PROGRESS_CHANGE, this.#progressEventId);\r\n    }\r\n\r\n    onSetProgress(val: any) {\r\n        if (is(val)) {\r\n            this.element.setAttribute(this.#attr, val);\r\n        }\r\n    }\r\n\r\n    private updateStyle(value: number) {\r\n        this.#path.style.strokeDashoffset = value;\r\n    }\r\n\r\n    private readStyle(): void {\r\n        if (this.prevArgs && this.args.progress === this.prevArgs.progress) {\r\n            return;\r\n        }\r\n        const progress = getRangeValue(this.args.progress, 0, 100);\r\n\r\n        this.mutate(this.updateStyle, this.#full - this.#factor * progress);\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CLASSES, EVENTS, ICONS } from \"../../core/utils/statics\";\r\nimport { is, isString, getStringOrDefault, getIntOrDefault, replacePrefix } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../app/builders/icon\";\r\n\r\nexport class CuiSpinnerArgs implements ICuiParsable {\r\n    spinner: string;\r\n    scale: number;\r\n    constructor() {\r\n        this.spinner = \"circle\";\r\n        this.scale = 1;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (isString(args)) {\r\n            this.spinner = getStringOrDefault(args, \"circle\");\r\n        } else {\r\n            this.spinner = getStringOrDefault(args.spinner, \"circle\");\r\n            this.scale = getIntOrDefault(args.scale, 1);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSpinnerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-spinner`;\r\n        ICONS['spinner_circle'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 7.800378,1.7908996 A 8.4986862,8.4986862 0 0 1 18.2091,7.8003784 8.4986862,8.4986862 0 0 1 12.199621,18.209101 8.4986862,8.4986862 0 0 1 1.7908995,12.199622 8.4986862,8.4986862 0 0 1 7.800378,1.7908996 Z\\\"></path></svg>\";\r\n        ICONS['spinner_circle_double'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 10,1.5000006 A 8.4999997,8.4999997 0 0 1 18.5,10 8.4999997,8.4999997 0 0 1 10,18.499999 8.4999997,8.4999997 0 0 1 1.5000005,10 8.4999997,8.4999997 0 0 1 10,1.5000006 Z\\\"></path><path d=\\\"M 10,3.4999997 A 6.5000002,6.5000002 0 0 1 16.5,10 6.5000002,6.5000002 0 0 1 10,16.5 6.5000002,6.5000002 0 0 1 3.5,9.9999993 6.5000002,6.5000002 0 0 1 10,3.4999997 Z\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSpinnerHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiSpinnerHandler extends CuiHandler<CuiSpinnerArgs> {\r\n    #pauseEventId: string;\r\n    #animationPauseClass: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiSpinnerHandler\", element, attribute, new CuiSpinnerArgs(), utils);\r\n        this.#pauseEventId = null;\r\n        this.#animationPauseClass = replacePrefix(\"{prefix}-animation-pause\", prefix);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#pauseEventId = this.onEvent(EVENTS.PAUSE, this.onPause.bind(this));\r\n        this.add()\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.args.spinner !== this.prevArgs.spinner) {\r\n            this.add();\r\n        }\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.removeIfAnyExisists();\r\n        this.detachEvent(EVENTS.PAUSE, this.#animationPauseClass);\r\n    }\r\n\r\n    private addSpinner(iconElement: Element, name: string) {\r\n        this.element.appendChild(iconElement);\r\n        this.element.classList.add(`animation-spinner-${name}`);\r\n    }\r\n\r\n    private add() {\r\n        const svgIcon = is(this.args.spinner) ? ICONS[`spinner_${this.args.spinner}`] : null;\r\n        if (!is(svgIcon)) {\r\n            this._log.warning(\"Incorrect spinner name: \" + this.args.spinner);\r\n            return;\r\n        }\r\n        this.removeIfAnyExisists();\r\n        const iconElement = new IconBuilder(svgIcon).setScale(this.args.scale).build();\r\n        this.mutate(this.addSpinner, iconElement, this.args.spinner);\r\n    }\r\n\r\n    private removeIfAnyExisists() {\r\n        let existing = this.element.querySelector(\"svg\");\r\n        if (existing) {\r\n            existing.remove();\r\n        }\r\n    }\r\n\r\n\r\n    private onPause(flag: boolean) {\r\n        this.fetch(() => {\r\n            if (flag && !this.helper.hasClass(this.#animationPauseClass, this.element)) {\r\n                this.helper.setClassesAs(this.element, this.#animationPauseClass);\r\n            } else {\r\n                this.helper.removeClassesAs(this.element, this.#animationPauseClass);\r\n            }\r\n        })\r\n        this.emitEvent(EVENTS.PAUSED, flag);\r\n    }\r\n\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase } from \"../../app/handlers/base\";\r\n\r\nexport class CuiDummyComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor() {\r\n        this.attribute = 'cui-dummy';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDummyHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiDummyHandler extends CuiComponentBase implements ICuiComponentHandler {\r\n\r\n    #attribute: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiDummyHandler\", element, utils);\r\n\r\n        this.#attribute = attribute\r\n    }\r\n\r\n    handle(args: any): void {\r\n\r\n    }\r\n\r\n    refresh(args: any): void {\r\n\r\n    }\r\n\r\n    destroy(): void {\r\n\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { is, getOffsetTop, getStringOrDefault } from \"../../core/utils/functions\";\r\n\r\n/**\r\n * Component scrolls to specified target in the document\r\n * Arguments: \r\n * target - selector to target element where page should be scrolled to.\r\n * parent - set parent selector if parent should be different than html parent\r\n * behavior - auto/smooth - choose between step and smooth scrolling\r\n * \r\n */\r\n\r\nexport class CuiScrollComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = is(prefix) ? prefix + 'scroll' : 'cui-scroll';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport interface CuiScrollAttribute {\r\n    target?: string;\r\n    parent?: string;\r\n    behavior?: 'auto' | 'smooth';\r\n}\r\n\r\nexport class CuiScrollArgs implements ICuiParsable {\r\n    target?: string;\r\n    parent?: string;\r\n    behavior?: 'auto' | 'smooth';\r\n\r\n    constructor() {\r\n        this.target = null;\r\n        this.parent = null;\r\n        this.behavior = 'auto';\r\n    }\r\n\r\n    parse(val: any): void {\r\n        this.target = getStringOrDefault(val.target, \"\");\r\n        this.parent = getStringOrDefault(val.parent, \"\");\r\n        this.behavior = is(val.behavior) && val.behavior.toLowerCase() === 'smooth' ? 'smooth' : 'auto';\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiScrollHandler extends CuiHandler<CuiScrollArgs> {\r\n    #parent: HTMLElement;\r\n    #target: HTMLElement;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollHandler\", element, attribute, new CuiScrollArgs(), utils);\r\n        this.element = element;\r\n        this.#parent = null;\r\n        this.#target = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick.bind(this));\r\n        this.setTargets();\r\n    }\r\n    onUpdate(): void {\r\n        this.setTargets();\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick.bind(this));\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        if (!is(this.#target)) {\r\n            return;\r\n        }\r\n        let to = getOffsetTop(this.#target) - this.#parent.offsetTop;\r\n        let from = this.#parent.scrollTop;\r\n        let by = to - from;\r\n        this.#parent.scrollBy({\r\n            top: by,\r\n            behavior: this.args.behavior\r\n        });\r\n        this.emitEvent(EVENTS.ON_SCROLL, {\r\n            to: to,\r\n            by: by,\r\n            target: this.#target,\r\n            parent: this.#parent,\r\n            timestamp: Date.now(),\r\n        })\r\n        ev.preventDefault();\r\n    }\r\n\r\n    private setTargets(): void {\r\n        this.#target = document.querySelector(this.args.target) as HTMLElement;\r\n        if (is(this.#target)) {\r\n            this.#parent = is(this.args.parent) ? document.querySelector(this.args.parent) : this.#target.parentElement;\r\n        }\r\n    }\r\n}\r\n\r\n","import { ICuiComponent, ICuiComponentHandler, CuiObservables } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiScrollListener, CuiScrollEvent } from \"../../core/listeners/scroll\";\r\nimport { ICuiComponentAction, CuiActionsFatory } from \"../../core/utils/actions\";\r\nimport { parseAttributeString, getRangeValue, is, getOffsetTop, getRangeValueOrDefault, isInRange, getOffsetLeft, clone } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiScrollSpyOutOfRangeError } from \"../../core/models/errors\";\r\n\r\nexport interface CuiScrollSpyAttribute {\r\n    selector?: string;\r\n    action?: string;\r\n    link?: string;\r\n    linkAction: string;\r\n    offset: number;\r\n}\r\n\r\n\r\nexport class CuiScrollSpyArgs {\r\n    selector: string;\r\n    action: ICuiComponentAction;\r\n    link?: string;\r\n    linkAction?: ICuiComponentAction;\r\n    offset?: number;\r\n\r\n    constructor() {\r\n        this.offset = 0;\r\n    }\r\n    parse(args: any) {\r\n        if (!args.selector) {\r\n            throw new Error(\"Incorrect arguments\");\r\n        }\r\n        this.selector = args.selector;\r\n        this.action = CuiActionsFatory.get(args.action);\r\n        this.link = args.link;\r\n        this.linkAction = CuiActionsFatory.get(args.linkAction);\r\n        this.offset = getRangeValueOrDefault(parseInt(args.offset), -1, 1, 0);\r\n    }\r\n}\r\nexport class CuiScrollspyComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-scrollspy`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollspyHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiScrollspyHandler extends CuiHandler<CuiScrollSpyArgs> {\r\n\r\n    #listener: CuiScrollListener;\r\n    #links: Element[];\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #targetsLength: number;\r\n    #linksLength: number;\r\n    #prevScrollTop: number;\r\n    #prevScrollLeft: number;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollspyHandler\", element, attribute, new CuiScrollSpyArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n        this.#listener = new CuiScrollListener(this.element, this.utils.setup.scrollThreshold);\r\n        this.#links = [];\r\n        this.#targets = [];\r\n        this.#currentIdx = this.#targetsLength = this.#linksLength = -1;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#prevScrollTop = this.element.scrollTop;\r\n        this.#prevScrollLeft = this.element.scrollLeft;\r\n        this.parseAttribute();\r\n        let current = this.calculateCurrent(this.#prevScrollTop);\r\n        this.setCurrent(current);\r\n        this.setCurrentLink(current, -1);\r\n        this.#currentIdx = current;\r\n        this.#listener.setCallback(this.onScroll.bind(this));\r\n        this.#listener.attach();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.#prevScrollTop = this.element.scrollTop;\r\n        this.#prevScrollLeft = this.element.scrollLeft;\r\n        this.parseAttribute();\r\n        this.calculateCurrent(this.#prevScrollTop);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        let idx = -1;\r\n        if (Math.abs(ev.left - this.#prevScrollLeft) > Math.abs(ev.top - this.#prevScrollTop)) {\r\n            idx = this.calculateCurrentLeft(ev.left);\r\n        } else {\r\n            idx = this.calculateCurrent(ev.top);\r\n        }\r\n        if (idx !== this.#currentIdx) {\r\n            let newTarget = this.setCurrent(idx)\r\n            this.setCurrentLink(idx, this.#currentIdx);\r\n            this.#currentIdx = idx;\r\n            this.emitEvent(EVENTS.TARGET_CHANGE, {\r\n                top: ev.top,\r\n                left: ev.left,\r\n                target: newTarget,\r\n                timestamp: Date.now()\r\n            })\r\n        }\r\n\r\n        this.#prevScrollTop = this.element.scrollTop;\r\n        this.#prevScrollLeft = this.element.scrollLeft;\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#targets = [...this.element.querySelectorAll(this.args.selector)];\r\n        this.#links = this.args.link ? [...document.querySelectorAll(this.args.link)] : [];\r\n        this.#targetsLength = this.#targets.length;\r\n        this.#linksLength = this.#links.length;\r\n    }\r\n\r\n    private calculateCurrent(scroll: number): number {\r\n        return this.#targets.findIndex((target: HTMLElement) => {\r\n            let offset = getOffsetTop(target) - (<any>this.element).offsetTop;\r\n            let ratio = offset * this.args.offset\r\n            return offset + ratio <= scroll && scroll < offset + target.clientHeight + ratio;\r\n        })\r\n    }\r\n\r\n    private calculateCurrentLeft(scroll: number): number {\r\n        return this.#targets.findIndex((target: HTMLElement) => {\r\n            let offset = getOffsetLeft(target) - (<any>this.element).offsetLeft;\r\n            let ratio = offset * this.args.offset\r\n            return offset + ratio <= scroll && scroll < offset + target.clientWidth + ratio;\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Performs action on current, new target and on links if there are any.\r\n     * Returns new target element or null if index is out of range\r\n     * \r\n     * @param idx - new target index\r\n     * @returns New target item\r\n     */\r\n    private setCurrent(idx: number): Element {\r\n        if (!isInRange(idx, 0, this.#targetsLength)) {\r\n            throw new CuiScrollSpyOutOfRangeError(\"New index is out of targets length\")\r\n        }\r\n        let ret = this.#targets[idx]\r\n        this.args.action.add(ret)\r\n        this.args.action.remove(this.#targets[this.#currentIdx]);\r\n        return ret;\r\n    }\r\n\r\n    private setCurrentLink(idx: number, prev: number) {\r\n        if (this.#linksLength > 0) {\r\n            if (isInRange(idx, 0, this.#linksLength)) {\r\n                this.args.linkAction.add(this.#links[idx]);\r\n            }\r\n            if (isInRange(prev, 0, this.#linksLength)) {\r\n                this.args.linkAction.remove(this.#links[prev]);\r\n            }\r\n        }\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemPrintMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoPrintPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport class CuiAutoPrintModePlugin implements ICuiPlugin {\r\n    description: string = 'Auto print mode';\r\n    name: string = 'auto-print';\r\n    setup: AutoPrintPluginSetup;\r\n    #listener: CuiMediaQueryListener;\r\n    #utils: CuiUtils;\r\n    constructor(autoPrintInit: AutoPrintPluginSetup) {\r\n        this.description = \"CuiAutoPrintModePlugin\";\r\n        this.setup = autoPrintInit;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils\r\n        if (this.setup.autoPrint && getSystemPrintMode()) {\r\n            this.#utils.setPrintMode(true)\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('print')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        this.setup = this.#utils.setup.plugins[this.description] as AutoPrintPluginSetup;\r\n        let autoPrint = this.setup?.autoPrint ?? false;\r\n        if (autoPrint) {\r\n            console.log(ev.matches)\r\n            if (ev.matches) {\r\n                this.#utils.setPrintMode(true)\r\n            } else {\r\n                this.#utils.setPrintMode(false)\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { ICuiObserver } from \"../../core/models/interfaces\";\r\n\r\nexport interface ICuiIntersectionObserver {\r\n    observe(target: Element): void;\r\n    unobserve(target: Element): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport class CuiIntersectionEntry {\r\n    isInView: boolean;\r\n    ratio: number;\r\n}\r\n\r\nexport interface ICuiIntersectionHandler {\r\n    onIntersection(entry: CuiIntersectionEntry): Promise<boolean>;\r\n}\r\n\r\n/**\r\n * Creates a wrapper for intersection observer\r\n * Constructor gets a root element for observer and optional array of threshold values [0...1]\r\n */\r\nexport class CuiIntersectionObserver implements ICuiObserver {\r\n    private observer: IntersectionObserver\r\n    #root: Element;\r\n    #threshold: number[];\r\n    #callback: IntersectionObserverCallback;\r\n    constructor(root: Element, threshold?: number[]) {\r\n        this.#root = root;\r\n        this.#threshold = threshold ?? [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1];\r\n    }\r\n\r\n    setCallback(callback: IntersectionObserverCallback) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    connect(): void {\r\n        this.observer = new IntersectionObserver(this.#callback, {\r\n            root: this.#root,\r\n            rootMargin: '0px',\r\n            threshold: this.#threshold\r\n        })\r\n    }\r\n\r\n    observe(target: Element): void {\r\n        this.observer.observe(target)\r\n    }\r\n\r\n    unobserve(target: Element): void {\r\n        this.observer.unobserve(target)\r\n    }\r\n\r\n    disconnect() {\r\n        this.observer.disconnect()\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiIntersectionObserver } from \"../../app/observers/intersection\";\r\nimport { CuiActionsFatory, ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { is, getRangeValueOrDefault, clone } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\n/**\r\n * Intersection\r\n * Toggles action in/out when target is intersecting with the screen\r\n * \r\n * Set this on scrollable element\r\n * target - children selector\r\n * offset - 0...1 - tells how much target must intersecting with the screen\r\n * action - action to trigger\r\n */\r\n\r\nexport class CuiIntersectionAttributes {\r\n    target: string;\r\n    action: ICuiComponentAction;\r\n    offset: number\r\n    constructor() {\r\n        this.target = \"div\";\r\n        this.action = CuiActionsFatory.get('dummy');\r\n        this.offset = 0;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.target = is(args.target) ? args.target : 'div';\r\n        this.action = is(args.action) ? CuiActionsFatory.get(args.action) : CuiActionsFatory.get('dummy');\r\n        this.offset = getRangeValueOrDefault(parseInt(args.offset), 0, 1, 0);\r\n    }\r\n}\r\n\r\nexport class CuiIntersectionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-intersection`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIntersectionHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiIntersectionHandler extends CuiHandler<CuiIntersectionAttributes> {\r\n\r\n    #observer: CuiIntersectionObserver;\r\n    #targets: Element[];\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIntersectionHandler\", element, attribute, new CuiIntersectionAttributes(), utils);\r\n        this.#observer = new CuiIntersectionObserver(this.element);\r\n        this.#targets = []\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseArguments();\r\n        this.#observer.setCallback(this.onIntersection.bind(this))\r\n        this.#observer.connect();\r\n        this.#targets.forEach(target => {\r\n            this.#observer.observe(target);\r\n        })\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.parseArguments();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#observer.disconnect();\r\n    }\r\n\r\n    parseArguments() {\r\n        if (this.prevArgs === null || this.prevArgs.target !== this.args.target) {\r\n            this.#targets = [...document.querySelectorAll(this.args.target)];\r\n        }\r\n    }\r\n\r\n    onIntersection(entries: IntersectionObserverEntry[], observer: IntersectionObserver): void {\r\n        if (!is(this.#targets)) {\r\n            return;\r\n        }\r\n        let action = null;\r\n        entries.forEach(entry => {\r\n            action = this.getAction(entry.target);\r\n            if (entry.isIntersecting && entry.intersectionRatio >= this.args.offset) {\r\n                action.add(entry.target)\r\n            } else {\r\n                action.remove(entry.target)\r\n            }\r\n            this.emitIntersection(entry)\r\n        })\r\n    }\r\n\r\n    getAction(element: Element) {\r\n        return element.hasAttribute('action') ? CuiActionsFatory.get(element.getAttribute('action')) : this.args.action;\r\n    }\r\n\r\n    emitIntersection(entry: IntersectionObserverEntry) {\r\n        this.emitEvent(EVENTS.INTERSECTION, {\r\n            entry: entry,\r\n            offset: this.args.offset,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { getStringOrDefault, getIntOrDefault, is, getActiveClass, isString, getHandlerExtendingOrNull, isStringTrue, are, getFirstMatching } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiActionsFatory, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { CUID_ATTRIBUTE, EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiOpenArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n\r\n    #defTimeout: number;\r\n    constructor(timeout: number) {\r\n        this.target = \"\";\r\n        this.action = undefined;\r\n        this.timeout = 0;\r\n        this.prevent = false;\r\n        this.state = \"\";\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.target = args;\r\n            this.action = args.actions;\r\n            this.timeout = this.#defTimeout;\r\n            this.prevent = false;\r\n            this.state = \"\";\r\n            return;\r\n        }\r\n        this.target = getStringOrDefault(args.target, null);\r\n        this.action = args.action;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.prevent = isStringTrue(args.prevent)\r\n        this.state = args.state;\r\n    }\r\n}\r\n\r\nexport class CuiOpenComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-open`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOpenHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOpenHandler extends CuiHandler<CuiOpenArgs> {\r\n    #eventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOpenHandler\", element, attribute, new CuiOpenArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick)\r\n        this.#eventId = this.onEvent(EVENTS.OPEN, this.onOpen.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        //\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick)\r\n        this.detachEvent(EVENTS.OPEN, this.#eventId);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.onOpen(ev);\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n\r\n    onOpen(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget(this.args.target);\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.run(target).then((result) => {\r\n            this.activateTarget(ev, target, result);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n    /**\r\n     * Emits open event or performs an opening action\r\n     * @param target target element\r\n     * @returns whether event opened shall be emitted\r\n     */\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            this._log.debug(\"Open cUI component\")\r\n            await this.utils.bus.emit(EVENTS.OPEN, cuiId, this.args.state);\r\n            return false;\r\n        } else {\r\n            this._log.debug(\"Open html component\")\r\n            if (are(this.args.timeout, this.args.action)) {\r\n                this._log.debug(\"Perfrom an action\")\r\n                let actions = CuiActionsListFactory.get(this.args.action)\r\n                await this.actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                    this.setActiveClass(target)\r\n                });\r\n                return true;\r\n            }\r\n            this.setActiveClassAsync(target);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    private setActiveClass(target: Element) {\r\n        if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.setClass(this.activeClassName, target);\r\n        }\r\n    }\r\n\r\n    private setActiveClassAsync(target: Element) {\r\n        this.fetch(() => {\r\n            if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n                this.helper.setClassesAs(target, this.activeClassName);\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    private activateTarget(ev: MouseEvent, target: Element, shouldEmit: boolean): void {\r\n        if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.setClassesAs(target, this.activeClassName);\r\n        }\r\n        if (shouldEmit)\r\n            this.emitOpen(ev);\r\n    }\r\n\r\n    private emitOpen(ev: MouseEvent) {\r\n        this.emitEvent(EVENTS.OPENED, {\r\n            event: ev,\r\n            state: this.args.state,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private getTarget(target: string) {\r\n        if (is(target)) {\r\n            return document.querySelector(target);\r\n        }\r\n        let parent = this.element.parentElement;\r\n        let result = is(parent) ? parent.querySelectorAll(`[${CUID_ATTRIBUTE}]`) : undefined;\r\n        if (!result || result.length < 2) {\r\n            return undefined;\r\n        }\r\n\r\n        return getFirstMatching([...result], (el: Element) => {\r\n            return el !== this.element;\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiClosable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { getStringOrDefault, getIntOrDefault, parseAttribute, is, getActiveClass, isString, isStringTrue, getHandlerExtendingOrNull, getParentCuiElement, are } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiActionsFatory, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { CLASSES, EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\n\r\nexport class CuiCloseArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n    #defTimeout: number;\r\n\r\n    constructor(timeout: number) {\r\n        this.target = \"\";\r\n        this.action = null;\r\n        this.timeout = timeout;\r\n        this.prevent = false;\r\n        this.state = null;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.target = args\r\n            this.action = null\r\n            this.timeout = this.#defTimeout;\r\n            this.prevent = false\r\n            this.state = null;\r\n            return;\r\n        }\r\n        this.target = getStringOrDefault(args.target, null);\r\n        this.action = args.action;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.prevent = args.prevent && isStringTrue(args.prevent)\r\n        this.state = args.state;\r\n    }\r\n}\r\n\r\nexport class CuiCloseComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-close`;\r\n\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCloseHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCloseHandler extends CuiHandler<CuiCloseArgs> {\r\n    #eventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiCloseHandler\", element, attribute, new CuiCloseArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick)\r\n        this.#eventId = this.onEvent(EVENTS.CLOSE, this.onClose.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        //\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick)\r\n        this.detachEvent(EVENTS.CLOSE, this.#eventId);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.onClose(ev);\r\n        if (this.args.prevent)\r\n            ev.preventDefault();\r\n    }\r\n\r\n    onClose(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget();\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.run(target).then((result) => {\r\n            this.onActionFinish(ev, result);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            await this.utils.bus.emit(EVENTS.CLOSE, cuiId, this.args.state);\r\n            return false;\r\n        } else if (are(this.args.action, this.args.timeout)) {\r\n            let actions = CuiActionsListFactory.get(this.args.action);\r\n            return this.actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                this.removeActiveClass(target);\r\n            });\r\n        } else {\r\n            this.removeActiveClassAsync(target);\r\n            return true;\r\n        }\r\n    }\r\n    private removeActiveClass(target: Element) {\r\n        if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.removeClass(this.activeClassName, target);\r\n        }\r\n    }\r\n\r\n    private removeActiveClassAsync(target: Element) {\r\n        this.fetch(() => {\r\n            if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n                this.helper.removeClassesAs(target, this.activeClassName);\r\n            }\r\n        })\r\n\r\n    }\r\n    private onActionFinish(ev: MouseEvent, shouldEmit: boolean) {\r\n\r\n        if (shouldEmit)\r\n            this.emitClose(ev);\r\n    }\r\n\r\n    private getTarget(): Element {\r\n        return is(this.args.target) ? document.querySelector(this.args.target) : getParentCuiElement(this.element);\r\n    }\r\n\r\n    private emitClose(ev: MouseEvent) {\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now(),\r\n            state: this.args.state,\r\n            event: ev\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsFatory, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { is, isString, getStringOrDefault, getName, parseAttribute } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToggleArgs {\r\n    target: string;\r\n    action: string;\r\n    constructor() {\r\n        this.action = null;\r\n        this.target = null;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.action = args;\r\n        } else {\r\n            this.target = getStringOrDefault(args.target, null);\r\n            this.action = args.action;\r\n        }\r\n    }\r\n}\r\nexport class CuiToggleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? \"cui\"}-toggle`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiToggleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiToggleHandler extends CuiHandler<CuiToggleArgs> {\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #toggleEventId: string;\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiToggleHandler\", element, attribute, new CuiToggleArgs(), utils);\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#toggleEventId = null;\r\n        this.#actions = [];\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#target = this.getTarget();\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.element.addEventListener('click', this.onClick);\r\n        this.#toggleEventId = this.onEvent(EVENTS.TOGGLE, this.toggle.bind(this));\r\n\r\n    }\r\n    onUpdate(): void {\r\n        this.#target = this.getTarget();\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick);\r\n        this.detachEvent(EVENTS.TOGGLE, this.#toggleEventId);\r\n    }\r\n\r\n    toggle() {\r\n        this.#actions.forEach(action => action.toggle(this.#target, this.#utils));\r\n        this.emitEvent(EVENTS.TOGGLED, {\r\n            action: this.args.action,\r\n            target: this.#target,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.toggle();\r\n        ev.preventDefault();\r\n    }\r\n\r\n    getTarget(): Element {\r\n        return is(this.args.target) ? document.querySelector(this.args.target) : this.element;\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, CuiContext, ICuiEventBus, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICuiResizable, CuiResizeData } from \"../../app/observers/resize\";\r\nimport { generateCUID } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiResizeArgs implements ICuiParsable {\r\n    constructor() {\r\n\r\n    }\r\n\r\n    parse(args: any) {\r\n\r\n    }\r\n}\r\n\r\nexport class CuiResizeComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor() {\r\n        this.attribute = 'cui-resize';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiResizeHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiResizeHandler extends CuiHandler<CuiResizeArgs> {\r\n    #eventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiResizeHandler\", element, attribute, new CuiResizeArgs(), utils);\r\n        this.#eventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#eventId = this.utils.bus.on(EVENTS.RESIZE, this.resize.bind(this));\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n    onDestroy(): void {\r\n        if (this.#eventId !== null) {\r\n            this.utils.bus.detach(EVENTS.RESIZE, this.#eventId);\r\n            this.#eventId = null\r\n        }\r\n    }\r\n\r\n    resize(data: CuiResizeData) {\r\n        console.log(data);\r\n    }\r\n}","import { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { CuiKeyPressListener } from \"../../core/listeners/keys\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nexport interface KeyDownEvent {\r\n    timestamp: number;\r\n    event: KeyboardEvent;\r\n}\r\nexport interface ICuiKeysObserver {\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\nexport class CuiKeysObserver {\r\n    #listener: CuiKeyPressListener;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus) {\r\n        this.#bus = bus;\r\n        this.#listener = new CuiKeyPressListener(true);\r\n        this.#listener.setCallback(this.onKeyDown.bind(this))\r\n    }\r\n    connect(): void {\r\n        this.#listener.attach();\r\n    }\r\n    disconnect(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        this.#bus.emit(EVENTS.KEYDOWN, null, {\r\n            timestamp: Date.now(),\r\n            event: ev\r\n        })\r\n    }\r\n\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiKeysObserver, CuiKeysObserver } from \"./observer\";\r\n\r\n\r\nexport interface CuiKeysObserverPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport class CuiKeysObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'keys-observer';\r\n    setup: CuiKeysObserverPluginSetup;\r\n    #keysObserver: ICuiKeysObserver;\r\n    constructor(keySetup: CuiKeysObserverPluginSetup) {\r\n        this.description = \"CuiKeysObserverPlugin\";\r\n        this.setup = keySetup;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#keysObserver = new CuiKeysObserver(utils.bus);\r\n        this.#keysObserver.connect();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#keysObserver.disconnect();\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\n\r\nconst DIALOG_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst DIALOG_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-dialog-open';\r\nconst CONTAINER = '.{prefix}-dialog-container';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDialogArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout: number) {\r\n        this.escClose = false;\r\n        this.outClose = false;\r\n\r\n        this.#defTimeout = defTimeout;\r\n        this.#prefix = prefix;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.outClose = isStringTrue(args.outClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(DIALOG_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(DIALOG_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiDialogComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-dialog`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDialogHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDialogHandler extends CuiInteractableHandler<CuiDialogArgs> {\r\n\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #windowClickEventId: string;\r\n\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiDialogArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#scrollY = 0;\r\n        this.#windowClickEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        document.body.style.top = `-${this.#scrollY}px`;\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, (this.#scrollY || 0) * -1);\r\n        this.#scrollY = 0;\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        let container = this.element.querySelector(replacePrefix(CONTAINER, this.#prefix));\r\n        if (container && !container.contains((ev.target as Node))) {\r\n            this.close('out').then(() => {\r\n                this._log.debug(\"Closed by click outside\")\r\n            });\r\n        }\r\n    }\r\n}","import { isStringTrue, replacePrefix, EVENTS, is, getStringOrDefault, getIntOrDefault, getName, ICuiParsable } from \"../../core/index\";\r\nimport { ICuiComponent, CuiUtils, ICuiComponentHandler } from \"../../index\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\n\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-right-in\";\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-right-out\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-left-in\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-left-out\";\r\n\r\nconst OFFCANVAS_BODY = \"{prefix}-off-canvas-open\";\r\nconst OFFCANVAS_CONTAINER_CLS = '.{prefix}-off-canvas-container';\r\n\r\nexport class CuiOffCanvasArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n    position: 'left' | 'right';\r\n    timeout: number;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.escClose = false;\r\n        this.position = 'right';\r\n        this.openAct = this.getDefaultOpenClass();\r\n        this.closeAct = this.getDefaultCloseClass();\r\n        this.#defTimeout = timeout;\r\n        this.timeout = timeout;\r\n        this.outClose = false;\r\n        this.keyClose = undefined;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        if (is(args)) {\r\n            this.escClose = isStringTrue(args.escClose);\r\n            this.outClose = isStringTrue(args.outClose);\r\n            this.position = getStringOrDefault(args.position, 'right');\r\n            this.openAct = getStringOrDefault(args.openAct, this.getDefaultOpenClass())\r\n            this.closeAct = getStringOrDefault(args.closeAct, this.getDefaultCloseClass());\r\n            this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n            this.keyClose = args.keyClose;\r\n        }\r\n    }\r\n\r\n    getDefaultOpenClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_IN : OFFCANVAS_LEFT_ANIM_DEFAULT_IN, this.#prefix);\r\n    }\r\n\r\n    getDefaultCloseClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT : OFFCANVAS_LEFT_ANIM_DEFAULT_OUT, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-off-canvas`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffCanvasHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasHandler extends CuiInteractableHandler<CuiOffCanvasArgs>  {\r\n\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #windowClickEventId: string;\r\n\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOffCanvasHandler\", element, attribute, new CuiOffCanvasArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#prefix = prefix;\r\n        this.#bodyClass = replacePrefix(OFFCANVAS_BODY, prefix);\r\n        this.#windowClickEventId = null;\r\n        this.#scrollY = 0;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.mutate(() => {\r\n            this.setPositionLeft();\r\n            AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        })\r\n    }\r\n    onUpdate(): void {\r\n        this.setPositionLeft();\r\n    }\r\n    onDestroy(): void {\r\n\r\n    }\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.helper.setClass(this.#bodyClass, document.body);\r\n        document.body.style.top = `-${scrollY}px`;\r\n    }\r\n    onAfterClose(): void {\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, this.#scrollY * -1);\r\n    }\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        const container = this.element.querySelector(replacePrefix(OFFCANVAS_CONTAINER_CLS, this.#prefix));\r\n        if (container && !container.contains((ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    setPositionLeft() {\r\n        let cls = getName(this.#prefix, 'left');\r\n        if (this.args.position === 'left' && !this.helper.hasClass(cls, this.element)) {\r\n            this.helper.setClass(cls, this.element)\r\n        } else if (this.args.position == 'right' && this.helper.hasClass(cls, this.element)) {\r\n            this.helper.removeClass(cls, this.element)\r\n        }\r\n    }\r\n\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { getIntOrDefault, is, getActiveClass, isStringTrue, replacePrefix, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { SCOPE_SELECTOR, EVENTS } from \"../../core/index\";\r\n\r\n/**\r\n * \r\n */\r\n\r\nexport interface CuiAccordionEvent {\r\n    index: number;\r\n    previous: number;\r\n    currentTarget: Element;\r\n    previousTarget: Element;\r\n    timestamp: number;\r\n}\r\n\r\ninterface CuiAccordionTarget {\r\n    element: Element,\r\n    listener?: any\r\n}\r\n\r\nconst ACCORDION_TITLE_CLS = '> * > .{prefix}-accordion-title';\r\nconst ACCORDION_ITEMS_CLS = '> *';\r\n\r\nexport class CuiAccordionArgs {\r\n    single: boolean;\r\n    selector: string;\r\n    items: string;\r\n    timeout: number;\r\n    animation: boolean;\r\n    content: string\r\n\r\n    #defTitleSelector: string;\r\n    #defItemsSelector: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#defTitleSelector = replacePrefix(ACCORDION_TITLE_CLS, prefix);\r\n        this.#defItemsSelector = replacePrefix(ACCORDION_ITEMS_CLS, prefix);\r\n        this.#defTimeout = timeout;\r\n        this.single = false;\r\n        this.selector = SCOPE_SELECTOR + this.#defTitleSelector;\r\n        this.items = SCOPE_SELECTOR + this.#defItemsSelector;\r\n        this.timeout = this.#defTimeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args)) {\r\n            this.single = isStringTrue(args.single);\r\n            this.selector = SCOPE_SELECTOR + getStringOrDefault(args.selector, this.#defTitleSelector);\r\n            this.items = SCOPE_SELECTOR + getStringOrDefault(args.content, this.#defItemsSelector);\r\n            this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n            this.animation = isStringTrue(args.animation);\r\n            return;\r\n        }\r\n\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class CuiAccordionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-accordion`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiAccordionHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiAccordionHandler extends CuiMutableHandler<CuiAccordionArgs> implements ICuiSwitchable {\r\n    #items: Element[];\r\n    #targets: CuiAccordionTarget[];\r\n    #switchEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiAccordionHandler\", element, attribute, new CuiAccordionArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#switchEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        if (this.args.isValid()) {\r\n            try {\r\n                this.initTargets();\r\n                this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onSwitch.bind(this))\r\n            } catch (e) {\r\n                this._log.exception(e, 'handle')\r\n            }\r\n            this._log.debug(\"Initialized\", \"handle\")\r\n        }\r\n    }\r\n\r\n    onUpdate(): void {\r\n        try {\r\n            this.initTargets();\r\n        } catch (e) {\r\n            this._log.exception(e, 'handle')\r\n        }\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(mutations: CuiChildMutation) {\r\n        if (mutations.added.length > 0 || mutations.removed.length > 0)\r\n            this.initTargets();\r\n    }\r\n\r\n    async switch(index: number): Promise<boolean> {\r\n        this._log.debug(\"Switch to: \" + index);\r\n        if (index < 0 || this.isLocked || !this.isInitialized) {\r\n            return false;\r\n        }\r\n\r\n        this.#items = this.queryItems();\r\n        if (this.#items.length <= index) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        const current = this.#items[index]\r\n        if (this.helper.hasClass(this.activeClassName, current)) {\r\n            this.helper.removeClassesAs(current, this.activeClassName)\r\n        } else {\r\n            if (this.args.single) {\r\n                this.closeAllExcept(index)\r\n            }\r\n            this.helper.setClassesAs(current, this.activeClassName)\r\n\r\n        }\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            index: index,\r\n            currentTarget: current,\r\n            timestamp: Date.now()\r\n        })\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n    onSwitch(index: any): void {\r\n        this.switch(getIntOrDefault(index, -1)).then(() => {\r\n            this._log.debug(\"Switch from event to \" + index);\r\n        });\r\n    }\r\n\r\n    initTargets() {\r\n        this.#items = this.queryItems();\r\n        const t = this.element.querySelectorAll(this.args.selector);\r\n        this.#targets = [];\r\n        t.forEach((item: Element, index: number) => {\r\n            let target: CuiAccordionTarget = { element: item };\r\n            this.setListener(target, index)\r\n            this.#targets.push(target);\r\n        })\r\n    }\r\n\r\n    closeAllExcept(current: number) {\r\n        this.mutate(() => {\r\n            this.#items.forEach((item: Element, index: number) => {\r\n                if (current !== index && this.helper.hasClass(this.activeClassName, item)) {\r\n                    item.classList.remove(this.activeClassName)\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    setListener(target: CuiAccordionTarget, index: number) {\r\n        target.listener = () => {\r\n            this.switch(index);\r\n        }\r\n        target.element.addEventListener('click', target.listener)\r\n    }\r\n\r\n    removeListener(target: CuiAccordionTarget) {\r\n        if (target.listener) {\r\n            target.element.removeEventListener('click', target.listener);\r\n        }\r\n    }\r\n\r\n    queryItems(): Element[] {\r\n        return [...this.element.querySelectorAll(this.args.items)]\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are } from \"../utils/functions\";\r\n\r\nexport interface CuiHoverEvent {\r\n    isHovering: boolean;\r\n    event: MouseEvent;\r\n    timestamp: number;\r\n}\r\nexport class CuiHoverListener implements ICuiEventListener<CuiHoverEvent> {\r\n    #target: Element;\r\n    #callback: (t: CuiHoverEvent) => void = null;\r\n    #inProgress: boolean;\r\n    #isHovering: boolean;\r\n    #isAttached: boolean;\r\n    constructor(target: Element) {\r\n        this.#target = target;\r\n        this.#inProgress = false;\r\n        this.#isHovering = false;\r\n    }\r\n\r\n    setCallback(callback: (t: CuiHoverEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        this.#target.addEventListener(\"mouseover\", this.onMouseOver.bind(this));\r\n        this.#target.addEventListener(\"mousemove\", this.onMouseMove.bind(this));\r\n        this.#target.addEventListener(\"mouseout\", this.onMouseOut.bind(this));\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        this.#target.removeEventListener(\"mouseover\", this.onMouseOver.bind(this));\r\n        this.#target.removeEventListener(\"mousemove\", this.onMouseMove.bind(this));\r\n        this.#target.removeEventListener(\"mouseout\", this.onMouseOut.bind(this));\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    emit(mouseEvent: MouseEvent, force: boolean) {\r\n        if (!are(this.#callback)) {\r\n            return;\r\n        }\r\n        if (!force && this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        window.requestAnimationFrame(this.invoke.bind(this, {\r\n            isHovering: this.#isHovering,\r\n            event: mouseEvent,\r\n            timestamp: Date.now()\r\n        }))\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#isAttached;\r\n    }\r\n    invoke(ev: CuiHoverEvent) {\r\n        this.#callback(ev);\r\n        this.#inProgress = false;\r\n    }\r\n\r\n    onMouseOver(ev: MouseEvent) {\r\n        this.#isHovering = true;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    onMouseOut(ev: MouseEvent) {\r\n        this.#isHovering = false;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    onMouseMove(ev: MouseEvent) {\r\n        this.emit(ev, false);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable, ICuiClosable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { getIntOrDefault, parseAttribute, is, getActiveClass, isString, getName, replacePrefix, isStringTrue, getStringOrDefault, boolStringOrDefault } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiClassAction } from \"../../core/utils/actions\";\r\nimport { CLASSES, EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\nimport { KeyDownEvent } from \"../../plugins/keys/observer\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHoverListener, CuiHoverEvent } from \"../../core/listeners/hover\";\r\n\r\nconst bodyClass = '{prefix}-drop-open';\r\n\r\nconst DROP_DEFAULT_TRIGGER = \"> a, button\";\r\n\r\n\r\nexport interface CuiDropEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDropArgs {\r\n    escClose: boolean;\r\n    mode: \"click\" | \"hover\";\r\n    trigger: string;\r\n    prevent: boolean;\r\n    autoClose: boolean;\r\n    outClose: boolean;\r\n    constructor() {\r\n        this.escClose = false;\r\n        this.mode = \"click\";\r\n        this.trigger = DROP_DEFAULT_TRIGGER;\r\n        this.autoClose = false;\r\n        this.outClose = false;\r\n        this.prevent = false;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.escClose = args.escClose && isStringTrue(args.escClose);\r\n        this.mode = getStringOrDefault(args.mode, 'click').toLowerCase();\r\n        this.trigger = SCOPE_SELECTOR + getStringOrDefault(args.trigger, DROP_DEFAULT_TRIGGER);\r\n        this.prevent = isStringTrue(args.prevent);\r\n        this.autoClose = isStringTrue(args.autoClose);\r\n        this.outClose = args.outClose ? isStringTrue(args.outClose) : true;\r\n    }\r\n}\r\n\r\nexport class CuiDropComponenet implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-drop`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDropHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDropHandler extends CuiHandler<CuiDropArgs> implements ICuiOpenable, ICuiClosable {\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #attribute: string;\r\n    #triggerHoverListener: CuiHoverListener;\r\n    #hoverListener: CuiHoverListener;\r\n    #trigger: Element;\r\n    #clearId: any;\r\n    #keyEventId: string;\r\n    #windowClickEventId: string;\r\n    #openEventId: string;\r\n    #closeEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuidropHandler\", element, attribute, new CuiDropArgs(), utils);\r\n        this.#attribute = attribute;\r\n        this.#prefix = prefix;\r\n        this.#clearId = null;\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#hoverListener = new CuiHoverListener(this.element);\r\n        this.#hoverListener.setCallback(this.onTargetHover.bind(this))\r\n        this.#keyEventId = null;\r\n        this.#windowClickEventId = null;\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n        this.onTriggerClick = this.onTriggerClick.bind(this)\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#trigger = this.element.parentElement.querySelector(this.args.trigger)\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.setTriggerEvent();\r\n        AriaAttributes.setAria(this.element, 'aria-dropdown', \"\");\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.open.bind(this));\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.close.bind(this));\r\n        this._log.debug(\"Initialized\", \"handle\")\r\n    }\r\n    onUpdate(): void {\r\n        if (this.#triggerHoverListener.isAttached()) {\r\n            this.#triggerHoverListener.detach();\r\n        } else if (this.prevArgs.mode === 'click') {\r\n            this.#trigger.removeEventListener('click', this.onTriggerClick)\r\n        }\r\n\r\n        this.#trigger = this.element.parentElement.querySelector(this.args.trigger)\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.setTriggerEvent();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId);\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n    }\r\n\r\n    async open(): Promise<boolean> {\r\n        if (this.checkLockAndWarn('open')) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            return this.close();\r\n        }\r\n        if (this.isAnyActive()) {\r\n            await this.findAndCloseOpenedDrop();\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Drop ${this.cuid}`, 'open');\r\n        this.mutate(this.onOpen, this);\r\n        if (this.args.escClose) {\r\n            this.#keyEventId = this.onEvent(EVENTS.KEYDOWN, this.onEscClose.bind(this))\r\n        }\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.emitEvent(EVENTS.OPENED, {\r\n            timestamp: Date.now()\r\n        })\r\n        this.#hoverListener.attach();\r\n        if (this.args.autoClose) {\r\n            this.runAutoCloseTask();\r\n        }\r\n        this.isLocked = false;\r\n        return true\r\n    }\r\n\r\n    async close(): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\") || !this.isActive()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Drop ${this.cuid}`, 'close');\r\n        this.mutate(this.onClose, this);\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#keyEventId);\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now()\r\n        })\r\n        this.#hoverListener.detach();\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n    onTargetHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering && is(this.#clearId)) {\r\n            clearTimeout(this.#clearId);\r\n            this.#clearId = null;\r\n        } else if (!ev.isHovering && !is(this.#clearId) && this.args.autoClose) {\r\n            this.runAutoCloseTask();\r\n        }\r\n    }\r\n\r\n    onClose() {\r\n        this.helper.removeClass(this.activeClassName, this.element)\r\n        this.helper.removeClass(this.#bodyClass, document.body)\r\n        AriaAttributes.setAria(this.element, 'aria-expanded', 'false')\r\n\r\n\r\n    }\r\n\r\n    onOpen() {\r\n        this.helper.setClass(this.activeClassName, this.element)\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        AriaAttributes.setAria(this.element, 'aria-expanded', 'true')\r\n\r\n    }\r\n\r\n    onEscClose(ev: KeyDownEvent) {\r\n        if (ev.event.key === \"Escape\") {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        if (!this.element.contains((ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    getAction(className: string): ICuiComponentAction {\r\n        return new CuiClassAction(replacePrefix(className, this.#prefix));\r\n    }\r\n\r\n    async findAndCloseOpenedDrop(): Promise<boolean> {\r\n        const opened = document.querySelector(`[${this.#attribute}].${this.activeClassName}`);\r\n        if (!is(opened)) {\r\n            this._log.warning(\"Opened drop was not found\");\r\n            return false;\r\n        }\r\n        const handler = (<CuiElement>(opened as any)).$handlers[this.#attribute] as any;\r\n        if (!is(handler)) {\r\n            this._log.warning(\"Drop handler was not found in the element\");\r\n            return false;\r\n        }\r\n        return handler.close();\r\n    }\r\n\r\n    onTriggerClick(ev: MouseEvent) {\r\n        if (this.isActive()) {\r\n            this.close();\r\n        } else {\r\n            this.open();\r\n        }\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n\r\n    onHoverEvent(ev: CuiHoverEvent) {\r\n        if (ev.isHovering && !this.isActive()) {\r\n            this.open();\r\n        }\r\n        if (this.args.prevent) {\r\n            ev.event.preventDefault();\r\n        }\r\n    }\r\n\r\n    setTriggerEvent() {\r\n        if (this.args.mode === 'hover') {\r\n            this.#triggerHoverListener.setCallback(this.onHoverEvent.bind(this));\r\n            this.#triggerHoverListener.attach();\r\n        } else {\r\n            this.#trigger.addEventListener('click', this.onTriggerClick)\r\n        }\r\n    }\r\n\r\n    runAutoCloseTask() {\r\n        this.#clearId = setTimeout(() => {\r\n            this.close();\r\n        }, 5000)\r\n    }\r\n\r\n}","import { ICuiPlugin, ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS } from \"../../core/index\";\r\n\r\nexport class CuiWindowClickPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'click-plugin';\r\n    setup: any;\r\n    #bus: ICuiEventBus;\r\n\r\n    constructor() {\r\n        this.description = \"CuiWindowClickPlugin\";\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#bus = utils.bus;\r\n        window.addEventListener('click', this.onWindowClick.bind(this))\r\n    }\r\n\r\n    destroy(): void {\r\n        window.removeEventListener('click', this.onWindowClick.bind(this));\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        this.#bus.emit(EVENTS.WINDOW_CLICK, null, ev)\r\n    }\r\n}","export interface ICuiOffsetMode {\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean;\r\n}\r\n\r\nexport class CuiOffsetStaticMode implements ICuiOffsetMode {\r\n\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return (offsetX > 0 && left >= offsetX) ||\r\n            (offsetY > 0 && top >= offsetY)\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Dynamically calculates whether to trigger or untrigger an action.\r\n * If current value exceedes offset and threshold action is triggered.\r\n * If action was triggered and current move is lower than threshold action is untriggered\r\n * \r\n * Example: If offsetY is 100, then first after 100 action is set on. It is kept when scrolling down.\r\n * If user decides to scroll up and difference between turning point and current is bigger than threshold then action is set off.\r\n *  \r\n * Example usage is with navbar - it shall disappear after offset and return back when user scrolls up. \r\n */\r\nexport class CuiOffsetDynamicMode implements ICuiOffsetMode {\r\n    #pointLeft: number;\r\n    #pointTop: number;\r\n    #prevDiffY: number;\r\n    #prevDiffX: number;\r\n    #wasTriggeredX: boolean;\r\n    #wasTriggeredY: boolean;\r\n    #threshold: number;\r\n    constructor() {\r\n        this.#pointLeft = 0;\r\n        this.#pointTop = 0;\r\n        this.#prevDiffX = 0;\r\n        this.#prevDiffY = 0;\r\n        this.#threshold = 100;\r\n    }\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return this.fitsOffsetY(top, offsetY) || this.fitsOffsetX(left, offsetX);\r\n    }\r\n\r\n\r\n    private fitsOffsetX(left: number, offsetX: number) {\r\n        if (offsetX <= 0)\r\n            return false;\r\n        let diffX = left - this.#pointLeft;\r\n        if (left >= offsetX && diffX > this.#threshold) {\r\n            this.#wasTriggeredX = true;\r\n        } else if (this.#wasTriggeredX && diffX < -this.#threshold) {\r\n            this.#wasTriggeredX = false;\r\n        }\r\n        if (diffX < 0 && this.#prevDiffX < diffX || diffX >= 0 && this.#prevDiffX > diffX) {\r\n            this.#pointLeft = left;\r\n        }\r\n        this.#prevDiffX = diffX;\r\n        return this.#wasTriggeredX;\r\n    }\r\n\r\n    private fitsOffsetY(top: number, offsetY: number) {\r\n        if (offsetY <= 0) {\r\n            return false;\r\n        }\r\n        let diffY = top - this.#pointTop;\r\n        if (top >= offsetY && diffY > this.#threshold) {\r\n            this.#wasTriggeredY = true;\r\n        } else if (this.#wasTriggeredY && diffY < -this.#threshold) {\r\n            this.#wasTriggeredY = false;\r\n        }\r\n        if (diffY < 0 && this.#prevDiffY < diffY || diffY >= 0 && this.#prevDiffY > diffY) {\r\n            this.#pointTop = top;\r\n        }\r\n        this.#prevDiffY = diffY;\r\n        return this.#wasTriggeredY;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiOffsetModeFactory {\r\n    static get(mode: string) {\r\n        if (mode === 'dynamic') {\r\n            return new CuiOffsetDynamicMode();\r\n        }\r\n        return new CuiOffsetStaticMode();\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiScrollListener, CuiScrollEvent } from \"../../core/listeners/scroll\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { are, getIntOrDefault, getStringOrDefault, isStringTrue } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/index\";\r\nimport { CuiOffsetModeFactory, ICuiOffsetMode } from \"./modes\";\r\n\r\n/**\r\n * Toggles an action after specified offset is reached in relation to the element or document\r\n * \r\n * target?: string - target which action shall be triggered on\r\n * action?: string - action to trigger\r\n * offsetY?: number - vertical offset\r\n * offsetX?: number - horizontal offset\r\n * root?: boolean - set true if scroll listener shall be set on document element\r\n * mode?: string - static/dynamic \r\n */\r\n\r\nexport interface CuiOffsetEvent {\r\n    matches: boolean;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    limitX: boolean;\r\n    limitY: boolean;\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiOffsetAttribute {\r\n    target?: string;\r\n    action?: string;\r\n    offsetY?: number;\r\n    offsetX?: number;\r\n    root?: boolean;\r\n}\r\n\r\nexport class CuiOffsetArgs {\r\n    target: string;\r\n    action: string;\r\n    offsetY?: number;\r\n    offsetX?: number\r\n    root: boolean;\r\n    mode: \"static\" | \"dynamic\";\r\n    constructor() {\r\n        this.offsetX = 0;\r\n        this.offsetY = 0;\r\n        this.target = null;\r\n        this.root = false;\r\n        this.action = null;\r\n        this.mode = 'static';\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.target = args.target;\r\n        this.action = args.action;\r\n        this.offsetX = getIntOrDefault(args.offsetX, -1);\r\n        this.offsetY = getIntOrDefault(args.offsetY, -1);\r\n        this.root = isStringTrue(args.root);\r\n        this.mode = getStringOrDefault(args.mode, 'static');\r\n    }\r\n}\r\nexport class CuiOffsetComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-offset`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffsetHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiOffsetHandler extends CuiHandler<CuiOffsetArgs> {\r\n\r\n    #listener: CuiScrollListener;\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #matched: boolean;\r\n    #action: ICuiComponentAction[];\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #threshold: number;\r\n    #root: Element;\r\n    #modeHandler: ICuiOffsetMode;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiOffsetHandler\", element, attribute, new CuiOffsetArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#matched = false;\r\n        this.#action = null;\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#threshold = 20;\r\n        this.#root = null;\r\n        this.#modeHandler = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseAttribute();\r\n        this.#listener = new CuiScrollListener(this.args.root ? (window as any) : this.element, this.utils.setup.scrollThreshold);\r\n        this.#listener.setCallback(this.onScroll.bind(this));\r\n        this.#listener.attach();\r\n    }\r\n    onUpdate(): void {\r\n        this.parseAttribute();\r\n    }\r\n    onDestroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        this.checkAndPerformActions(ev.top, ev.left);\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#root = this.getRoot();\r\n        this.#target = this.args.target ? this.getRoot().querySelector(this.args.target) : this.element;\r\n        this.#action = CuiActionsListFactory.get(this.args.action);\r\n        this.#modeHandler = CuiOffsetModeFactory.get(this.args.mode);\r\n        this.checkAndPerformActions(this.element.scrollTop, this.element.scrollLeft);\r\n\r\n    }\r\n\r\n    private checkAndPerformActions(top: number, left: number) {\r\n        let matchesOffset = this.#modeHandler.matches(top, left, this.args.offsetX, this.args.offsetY);\r\n        if (matchesOffset !== this.#matched) {\r\n            this.act(matchesOffset);\r\n            this.#matched = matchesOffset;\r\n            this.callEvent(this.#matched, left, top, ...this.isOnEdge(left, top));\r\n            return;\r\n        }\r\n        if (this.exceededThreshold(left, top)) {\r\n            this.callEvent(this.#matched, left, top, ...this.isOnEdge(left, top));\r\n            this.#prevX = left;\r\n            this.#prevY = top;\r\n        }\r\n    }\r\n\r\n\r\n    private act(matching: boolean) {\r\n        if (!are(this.#action, this.#target)) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.#action.forEach(action => {\r\n            if (matching) {\r\n                action.add(this.#target, this.#utils)\r\n            } else {\r\n                action.remove(this.#target, this.#utils)\r\n            }\r\n        });\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private callEvent(matches: boolean, x: number, y: number, limitX: boolean, limitY: boolean) {\r\n        this.emitEvent(EVENTS.OFFSET, {\r\n            matches: this.#matched,\r\n            offsetX: x,\r\n            offsetY: y,\r\n            limitX: limitX,\r\n            limitY: limitY,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private getRoot(): Element {\r\n        return this.args.root ? document.body : this.element;\r\n    }\r\n\r\n    private exceededThreshold(x: number, y: number): boolean {\r\n        return Math.abs(x - this.#prevX) > this.#threshold || Math.abs(y - this.#prevY) > this.#threshold;\r\n    }\r\n\r\n    private isOnEdge(x: number, y: number): [boolean, boolean] {\r\n        let limitY = false;\r\n        let limitX = false;\r\n        if (this.#root.scrollHeight - this.#root.clientHeight <= y + this.#threshold) {\r\n            limitY = true\r\n        }\r\n        if (this.#root.scrollWidth - this.#root.clientWidth <= x + this.#threshold) {\r\n            limitX = true\r\n        }\r\n        return [limitX, limitY];\r\n    }\r\n\r\n\r\n}","import { are, is } from \"./functions\";\r\n\r\nexport interface ICuiTask {\r\n    start(): void;\r\n    stop(): void;\r\n    getId(): any;\r\n    setCallback(callback: () => void): void;\r\n}\r\n\r\nexport class CuiTaskRunner implements ICuiTask {\r\n    #taskId: any;\r\n    #autoRenew: boolean;\r\n    #timeout: number;\r\n    #callback: () => void;\r\n\r\n    constructor(timeout: number, autoRenew: boolean, callback?: () => void) {\r\n        this.#autoRenew = autoRenew;\r\n        this.#timeout = timeout;\r\n        this.#callback = callback;\r\n    }\r\n    start(): void {\r\n        if (!this.canRun()) {\r\n            return;\r\n        }\r\n        this.stop();\r\n        this.#taskId = setTimeout(() => {\r\n            this.#callback();\r\n            this.#taskId = null;\r\n            if (this.#autoRenew) {\r\n                this.start();\r\n            }\r\n        }, this.#timeout);\r\n    }\r\n\r\n    stop(): void {\r\n        if (this.#taskId) {\r\n            clearTimeout(this.#taskId);\r\n            this.#taskId = null\r\n        }\r\n    }\r\n\r\n    getId() {\r\n        return this.#taskId;\r\n    }\r\n\r\n    private canRun(): boolean {\r\n        return is(this.#callback) && this.#timeout > 0;\r\n    }\r\n\r\n    setCallback(callback: () => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { ICuiComponentAction, is, getStringOrDefault, CuiActionsFatory, replacePrefix, getIntOrDefault, isInRange, isStringTrue, EVENTS, getChildrenHeight, SCOPE_SELECTOR, calculateNextIndex } from \"../../core/index\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\n\r\nconst SWITCH_DEFAULT_ACTION_IN = \".{prefix}-switch-animation-default-in\";\r\nconst SWITCH_DEFAULT_ACTION_OUT = \".{prefix}-switch-animation-default-out\";\r\nconst SWITCH_DEFAULT_TARGETS = \"> li\";\r\n\r\nexport class CuiSwitchArgs implements ICuiParsable {\r\n\r\n    targets: string;\r\n    in: ICuiComponentAction;\r\n    out: ICuiComponentAction;\r\n    timeout: number;\r\n    links: string;\r\n    switch: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.targets = getStringOrDefault(args.targets, SCOPE_SELECTOR + SWITCH_DEFAULT_TARGETS)\r\n        this.in = CuiActionsFatory.get(args.in ?? replacePrefix(SWITCH_DEFAULT_ACTION_IN, this.#prefix))\r\n        this.out = CuiActionsFatory.get(args.out ?? replacePrefix(SWITCH_DEFAULT_ACTION_OUT, this.#prefix))\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.links = args.links;\r\n        this.switch = args.switch;\r\n        this.autoTimeout = getIntOrDefault(args.autoTimeout, -1);\r\n        this.height = getStringOrDefault(args.height, 'auto')\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSwitchComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switch`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitchHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitchHandler extends CuiMutableHandler<CuiSwitchArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #switches: CuiElement[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitchHandler\", element, attribute, new CuiSwitchArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#links = [];\r\n        this.#switches = [];\r\n        this.#switchEventId = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getActiveIndex();\r\n        this.getSwitches();\r\n        this.setSwitchesActive(this.#currentIdx);\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n    }\r\n\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getSwitches();\r\n        this.getActiveIndex();\r\n        let nextIdx = calculateNextIndex(index, this.#currentIdx, this.#targets.length);\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this._log.warning(`Index ${index} is not within the suitable range`);\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this.setSwitchesActive(nextIdx);\r\n        let nextItem = this.#targets[nextIdx];\r\n\r\n        await this.actionsHelper.performSwitchAction(nextItem,\r\n            this.#currentIdx > -1 ? this.#targets[this.#currentIdx] : null,\r\n            this.args.in,\r\n            this.args.out,\r\n            () => {\r\n                nextItem.classList.add(this.activeClassName);\r\n                if (this.#currentIdx > -1)\r\n                    this.#targets[this.#currentIdx].classList.remove(this.activeClassName)\r\n                this.setLinkActive(this.#currentIdx, nextIdx);\r\n                this.helper.setStyle(this.element, 'height', this.getElementHeight(nextItem))\r\n                this.startTask();\r\n                this.isLocked = false;\r\n            },\r\n            this.args.timeout,\r\n        )\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            timestamp: Date.now(),\r\n            index: nextIdx\r\n        })\r\n        return true;\r\n\r\n    }\r\n\r\n    onPushSwitch(index: string) {\r\n        this.switch(index);\r\n    }\r\n\r\n    getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n    }\r\n\r\n    getLinks() {\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    getSwitches() {\r\n        let s = is(this.args.switch) ? document.querySelectorAll(this.args.switch) : null;\r\n        this.#switches = [];\r\n        if (s) {\r\n            s.forEach(sw => {\r\n                this.#switches.push(<CuiElement>(sw as any))\r\n            })\r\n        }\r\n    }\r\n\r\n    setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        if (isInRange(current, 0, this.#links.length - 1)) {\r\n            this.helper.removeClass(this.activeClassName, this.#links[current])\r\n        }\r\n        if (isInRange(next, 0, this.#links.length - 1)) {\r\n            this.helper.setClass(this.activeClassName, this.#links[next])\r\n        }\r\n    }\r\n    /**\r\n     * Sets propers active state on attached switches\r\n     * @param index \r\n     */\r\n\r\n    setSwitchesActive(index: number) {\r\n        this.#switches.forEach(sw => {\r\n            this.setLinkSwitch(sw.$cuid, index)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Emits push event to attached switch to set proper index\r\n     * @param id - cuid of element\r\n     * @param index - index to be set on element\r\n     */\r\n    setLinkSwitch(id: string, index: number) {\r\n        if (is(id))\r\n            this.utils.bus.emit(EVENTS.SWITCH, id, index);\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { EVENTS, is } from \"../../core/index\";\r\n\r\nconst SWITCHER_LIST_ITEM_SELECTOR = \"li > a\";\r\n\r\nexport class CuiSwitcherArgs implements ICuiParsable {\r\n\r\n    target: string;\r\n    index: string;\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    parse(args: any): void {\r\n        if (!is(args)) {\r\n            return;\r\n        }\r\n        this.target = args.target;\r\n        this.index = args.index;\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSwitcherComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switcher`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitcherHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitcherHandler extends CuiHandler<CuiSwitcherArgs>  {\r\n    #targetId: string;\r\n    #isList: boolean;\r\n    #swtichEventID: string;\r\n    #listeners: ((ev: MouseEvent) => void)[];\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitcherHandler\", element, attribute, new CuiSwitcherArgs(), utils);\r\n        this.#targetId = null;\r\n        this.#isList = element.tagName === 'UL';\r\n        this.#swtichEventID = undefined;\r\n        this.onClickEvent = this.onClickEvent.bind(this);\r\n        this.#listeners = [];\r\n    }\r\n\r\n    onInit(): void {\r\n        this.setEvents();\r\n        this.getTarget();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.getTarget();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.removeEvents();\r\n    }\r\n\r\n    getTarget() {\r\n        if (!is(this.args.target)) {\r\n            this.#targetId = null;\r\n        }\r\n\r\n        let target = <CuiElement>(document.querySelector(this.args.target) as any);\r\n        if (is(target)) {\r\n            this.#targetId = target.$cuid;\r\n        }\r\n    }\r\n\r\n    setEvents() {\r\n        if (this.#isList) {\r\n            let elements = this.element.querySelectorAll(SWITCHER_LIST_ITEM_SELECTOR);\r\n            elements.forEach((el: Element, index: number) => {\r\n                let list = this.onListItemClick.bind(this, index)\r\n                this.#listeners.push(list)\r\n                el.addEventListener('click', list)\r\n            })\r\n        } else {\r\n            this.element.addEventListener('click', this.onClickEvent)\r\n        }\r\n    }\r\n\r\n    removeEvents() {\r\n        if (this.#isList) {\r\n            let elements = this.element.querySelectorAll(SWITCHER_LIST_ITEM_SELECTOR);\r\n            elements.forEach((el: Element, index: number) => {\r\n                if (this.#listeners.length > index)\r\n                    el.removeEventListener('click', this.#listeners[index])\r\n            })\r\n            this.#listeners = [];\r\n        } else {\r\n            this.element.removeEventListener('click', this.onClickEvent);\r\n        }\r\n    }\r\n\r\n    onClickEvent(ev: MouseEvent) {\r\n        this.getTarget();\r\n        if (!is(this.args.index)) {\r\n            return;\r\n        }\r\n        this.onClick(this.args.index.trim());\r\n    }\r\n\r\n    onListItemClick(index: number, ev: MouseEvent) {\r\n        this.getTarget();\r\n        this.onClick(index);\r\n    }\r\n\r\n    onClick(index: any) {\r\n        if (!is(this.#targetId)) {\r\n            return;\r\n        }\r\n        this.utils.bus.emit(EVENTS.SWITCH, this.#targetId, index);\r\n    }\r\n\r\n}","export interface ICuiFloatPositionCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport interface ICuiFloatResizeCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport class BasePositionCalculator implements ICuiFloatPositionCalculator {\r\n\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        return [x, y];\r\n    }\r\n\r\n}\r\n\r\nexport class OptionalPositionCalculator implements ICuiFloatPositionCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let newX = this.#element.offsetLeft + diffX;\r\n        let newY = this.#element.offsetTop + diffY;\r\n        return [newX, newY];\r\n    }\r\n\r\n}\r\n\r\nexport class BaseResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = x - this.#element.offsetLeft;\r\n        let height = y - this.#element.offsetTop;\r\n        return [width, height];\r\n    }\r\n}\r\n\r\nexport class OptionalResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = this.#element.offsetWidth + diffX;\r\n        let height = this.#element.offsetHeight + diffY;\r\n        return [width, height];\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, is, getIntOrDefault, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { BasePositionCalculator, BaseResizeCalculator, ICuiFloatPositionCalculator, ICuiFloatResizeCalculator } from \"./helpers\";\r\nimport { CLASSES, EVENTS } from \"../../core/index\";\r\n\r\nconst FLOAT_OPEN_ANIMATION_CLASS = '.{prefix}-float-default-in';\r\nconst FLOAT_CLOSE_ANIMATION_CLASS = '.{prefix}-float-default-out';\r\nconst MOVE = '.{prefix}-float-move';\r\nconst RESIZE = '.{prefix}-float-resize';\r\n\r\n\r\nexport class CuiFloatArgs implements CuiInteractableArgs, ICuiParsable {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout: number) {\r\n        this.escClose = false;\r\n        this.keyClose = undefined;\r\n        this.openAct = \"\";\r\n        this.closeAct = \"\";\r\n        this.timeout = defTimeout;\r\n\r\n        this.#defTimeout = defTimeout;\r\n        this.#prefix = prefix;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(FLOAT_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(FLOAT_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiFloatComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-float`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiFloatHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiFloatHandler extends CuiInteractableHandler<CuiFloatArgs> {\r\n    #isMoving: boolean;\r\n    #isResizing: boolean;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #prefix: string;\r\n    #moveListener: CuiMoveEventListener;\r\n    #positionCalculator: ICuiFloatPositionCalculator;\r\n    #resizeCalculator: ICuiFloatResizeCalculator;\r\n    #resizeBtn: HTMLElement;\r\n    #moveBtn: HTMLElement;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiFloatHandler\", element, attribute, new CuiFloatArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.preventDefault(true);\r\n        this.#positionCalculator = new BasePositionCalculator();\r\n        this.#resizeCalculator = new BaseResizeCalculator(element as HTMLElement)\r\n        this.#prefix = prefix;\r\n        this.move = this.move.bind(this);\r\n        this.resize = this.resize.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        this.#moveBtn = this.element.querySelector(replacePrefix(MOVE, this.#prefix))\r\n        this.#resizeBtn = this.element.querySelector(replacePrefix(RESIZE, this.#prefix))\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n\r\n    }\r\n\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n    }\r\n    onBeforeOpen(): boolean {\r\n        return true\r\n    }\r\n    onAfterOpen(): void {\r\n        console.log(\"Opened float\");\r\n        this.#moveListener.attach();\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        console.log(\"Closed float\");\r\n        this.#moveListener.detach();\r\n    }\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onMove(ev: ICuiMoveEvent) {\r\n        switch (ev.type) {\r\n            case 'down':\r\n                this.onMouseDown(ev);\r\n                break;\r\n            case 'up':\r\n                this.onMouseUp(ev)\r\n                break;\r\n            case 'move':\r\n                this.onMouseMove(ev);\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n    onMouseDown(ev: ICuiMoveEvent) {\r\n        console.log(\"DOwn\");\r\n        if (ev.target === this.#moveBtn) {\r\n            this.#isMoving = true;\r\n        } else if (ev.target === this.#resizeBtn) {\r\n            this.#isResizing = true;\r\n        }\r\n        this.#prevX = ev.x;\r\n        this.#prevY = ev.y;\r\n        this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n        // Lock global move handler\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n    }\r\n\r\n    onMouseMove(ev: ICuiMoveEvent) {\r\n        if (this.#isMoving) {\r\n            this.peform(ev, this.move)\r\n        } else if (this.#isResizing) {\r\n            this.peform(ev, this.resize)\r\n        }\r\n    }\r\n\r\n\r\n    onMouseUp(ev: ICuiMoveEvent) {\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n        // Unlock global handler\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n\r\n    }\r\n\r\n    peform(ev: ICuiMoveEvent, callback: (element: HTMLElement, x: number, y: number, diffX: number, diffY: number) => void) {\r\n        this.mutate(() => {\r\n            if (is(callback))\r\n                callback(this.element as HTMLElement, ev.x, ev.y, (ev.x - this.#prevX), (ev.y - this.#prevY));\r\n            this.#prevX = ev.x;\r\n            this.#prevY = ev.y;\r\n        })\r\n    }\r\n\r\n    resize(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newWidth, newHeight] = this.#resizeCalculator.calculate(x, y, diffX, diffY);\r\n        if (this.fitsWindow(element.offsetTop, element.offsetLeft, newWidth, newHeight)) {\r\n            this.mutate(() => {\r\n                element.style.width = newWidth + \"px\";\r\n                element.style.height = newHeight + \"px\";\r\n            })\r\n        }\r\n    }\r\n\r\n    move(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newX, newY] = this.#positionCalculator.calculate(x, y, diffX, diffY)\r\n        if (this.fitsWindow(newY, newX, element.offsetWidth, element.offsetHeight)) {\r\n            this.mutate(() => {\r\n                element.style.left = newX + \"px\";\r\n                element.style.top = newY + \"px\";\r\n            })\r\n        }\r\n    }\r\n\r\n\r\n\r\n    fitsWindow(top: number, left: number, width: number, height: number) {\r\n        return (top + height < window.innerHeight - 10) &&\r\n            (top > 10) && (left > 10) &&\r\n            (left + width < window.innerWidth - 10);\r\n    }\r\n}","import { AnimatorError } from \"../models/errors\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ICuiPropertyAnimator, AnimatorPropertyValue, TransformAnimatorProperty } from \"./interfaces\";\r\n\r\n/**\r\n * Changes the opacity of the element from 0 to 1\r\n */\r\nexport class OpacityAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    length: number;\r\n    from: number;\r\n    to: number;\r\n    rtl: boolean;\r\n    constructor() {\r\n        this.length = this.to = this.from = -1;\r\n        this.rtl = false;\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue): void {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[OpacityAnimator] Property has incorrect format\");\r\n        }\r\n        this.from = prop.from;\r\n        this.to = prop.to;\r\n        this.length = Math.abs(this.to - this.from);\r\n        this.rtl = this.from > this.to;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (this.to < 0) {\r\n            return;\r\n        }\r\n        let current = this.length * progress\r\n        if (element[\"style\"]) {\r\n            element.style.opacity = this.rtl ? Math.max(this.from - current, 0) : Math.max(this.from + current, 1);\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * Changes any style property of the element\r\n */\r\nexport class PropertyAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    length: number;\r\n    from: number;\r\n    to: number;\r\n    rtl: boolean;\r\n    property: string;\r\n    #unit: string;\r\n    constructor(property: string) {\r\n        if (!is(property)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Valid property is required\");\r\n        }\r\n        this.property = property;\r\n        this.length = this.to = this.from = -1;\r\n        this.rtl = false;\r\n        this.#unit = \"\";\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue) {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Property has incorrect format\");\r\n        }\r\n        this.from = prop.from;\r\n        this.to = prop.to;\r\n        this.length = Math.abs(this.to - this.from);\r\n        this.rtl = this.from > this.to;\r\n        this.#unit = prop.unit;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (!this.property) {\r\n            return;\r\n        }\r\n        let current = this.length * progress\r\n        if (element[\"style\"]) {\r\n            element.style[this.property] = this.createValue(this.rtl ? this.from - current : this.from + current, this.#unit);\r\n        }\r\n    }\r\n\r\n    private createValue(value: number, unit: string) {\r\n        return `${value}${unit ?? \"\"}`;\r\n    }\r\n}\r\n\r\n/**\r\n * Changes transform property of the element. Supports mulitple properties at the time\r\n */\r\nexport class TransformAnimator implements ICuiPropertyAnimator<TransformAnimatorProperty> {\r\n    prop: TransformAnimatorProperty;\r\n    constructor() {\r\n        this.prop = undefined;\r\n    }\r\n\r\n    setProperty(prop: TransformAnimatorProperty) {\r\n        if (!prop) {\r\n            throw new AnimatorError(\"[TransformAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n    }\r\n\r\n    build(progress: number) {\r\n        let props: string[] = [];\r\n        for (let name in this.prop) {\r\n            let cur = this.prop[name];\r\n            let diff = Math.abs(cur.to - cur.from);\r\n            let rtl = cur.from > cur.to;\r\n            let val = rtl ? cur.from - (diff * progress) : cur.from + (diff * progress)\r\n            props.push(this.buildSingle(name, val, cur.unit))\r\n        }\r\n\r\n        return props.join(\" \");\r\n    }\r\n\r\n    buildSingle(name: string, value: number, unit: string) {\r\n        return `${name}(${value}${unit})`;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (!this.prop) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style.transform = this.build(progress);\r\n        }\r\n\r\n    }\r\n}\r\n","import { is } from \"../utils/functions\";\r\nimport { OpacityAnimator, TransformAnimator, PropertyAnimator } from \"./animators\";\r\nimport { ICuiPropertyAnimator, AnimationProperty, AnimatorPropertyValue, TransformAnimatorProperty, OnAnimationFinishCallback } from \"./interfaces\";\r\n\r\nexport type PropsTypes = AnimatorPropertyValue | TransformAnimatorProperty;\r\n\r\nexport class CuiAnimation {\r\n    #engine: CuiAnimationEngine;\r\n    #timeout: number;\r\n    #factory: AnimatorFactory;\r\n    #onError: (e: Error) => void;\r\n    constructor(element?: Element) {\r\n        this.#engine = new CuiAnimationEngine(true);\r\n        this.#engine.setElement(element);\r\n        this.#timeout = 0;\r\n        this.#factory = new AnimatorFactory();\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#engine.setElement(element);\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n    \r\n    onError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n        this.#engine.setOnError(callback)\r\n    }\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#engine.onFinish(callback);\r\n    }\r\n\r\n    perform(props: AnimationProperty<PropsTypes>, timeout?: number, factor?: number) {\r\n        if (!is(props)) {\r\n            this.reportError(new Error(\"Animation property cannot be empty\"))\r\n            return;\r\n        }\r\n        let animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = this.#factory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                animators.push(animator);\r\n                this.#engine.setAnimators(animators);\r\n                this.#engine.animate(timeout ?? this.#timeout)\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e)\r\n        } else {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nclass AnimatorFactory {\r\n    get(id: string): ICuiPropertyAnimator<AnimatorPropertyValue | TransformAnimatorProperty> {\r\n        if (!id) {\r\n            return undefined;\r\n        }\r\n        switch (id) {\r\n            case \"opacity\":\r\n                return new OpacityAnimator();\r\n            case \"transform\":\r\n                return new TransformAnimator();\r\n            default:\r\n                return new PropertyAnimator(id);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiAnimationEngine {\r\n    #onFinishCallback: OnAnimationFinishCallback;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #lock: boolean;\r\n    #animStartStamp: number;\r\n    #element: Element;\r\n    #cleanOnFinish: boolean;\r\n    #errorOccured: boolean;\r\n    #onError: (e: Error) => void;\r\n    constructor(cleanOnFinish?: boolean) {\r\n        this.#animators = [];\r\n        this.#element = undefined;\r\n        this.#animStartStamp = undefined;\r\n        this.#cleanOnFinish = cleanOnFinish ?? false;\r\n        this.#lock = false;\r\n    }\r\n\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#onFinishCallback = callback;\r\n    }\r\n\r\n    setAnimators(animators: ICuiPropertyAnimator<PropsTypes>[]) {\r\n        this.#animators = animators;\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n    }\r\n\r\n    animate(timeout: number, progress?: number, revert?: boolean): void {\r\n        if (this.#lock) {\r\n            return;\r\n        }\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            this.reportError(new Error(\"Animation cannot be performed: element or animators are not set\"));\r\n            return;\r\n        }\r\n        let animationProgress = progress ?? 0;\r\n        let shouldCalcRevert = revert ? revert : false;\r\n        this.#lock = true;\r\n        requestAnimationFrame(this.animateAsync.bind(this, timeout, animationProgress, shouldCalcRevert))\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#lock;\r\n    }\r\n\r\n    private animateAsync(timeout: number, initialProgress: number, revert: boolean, timestamp: number) {\r\n        if (!this.#animStartStamp) {\r\n            this.#animStartStamp = timestamp;\r\n        }\r\n        let pr = timestamp - this.#animStartStamp;\r\n        let animationProgress = pr / timeout;\r\n        let currProgress = 0;\r\n        if (initialProgress === 0) {\r\n            currProgress = animationProgress;\r\n        } else {\r\n            currProgress = revert ? initialProgress - (animationProgress * initialProgress) : initialProgress + (animationProgress * initialProgress)\r\n        }\r\n        this.callUpdate(revert ? Math.max(currProgress, 0) : Math.min(currProgress, 1), 1);\r\n        if (pr < timeout && !this.#errorOccured) {\r\n            requestAnimationFrame(this.animateAsync.bind(this, timeout, initialProgress, revert))\r\n        } else {\r\n            this.endAnimation(revert);\r\n        }\r\n    }\r\n\r\n    private endAnimation(reverted: boolean) {\r\n        if (this.#cleanOnFinish && this.#element) {\r\n            this.#element.removeAttribute(\"style\");\r\n        }\r\n        if (this.#onFinishCallback) {\r\n            this.#onFinishCallback(this.#element, reverted, this.#errorOccured);\r\n        }\r\n        this.#errorOccured = false;\r\n        this.#animStartStamp = undefined;\r\n        this.#lock = false;\r\n    }\r\n\r\n    private callUpdate(progress: number, factor: number) {\r\n        try {\r\n            this.#animators.forEach(animator => animator.perform(this.#element, progress, factor));\r\n        } catch (e) {\r\n            this.reportError(e);\r\n            this.#errorOccured = true;\r\n        }\r\n\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e);\r\n        } else {\r\n            console.error(\"An error occured in CuiAnimtionEngine\");\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiSwipeAnimationEngine {\r\n    #element: Element;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #animationEngine: CuiAnimationEngine;\r\n    #factory: AnimatorFactory;\r\n    #onError: (e: Error) => void;\r\n    constructor(shouldCleanOnFinish?: boolean) {\r\n        this.#element = undefined;\r\n        this.#animators = [];\r\n        this.#animationEngine = new CuiAnimationEngine(shouldCleanOnFinish);\r\n        this.#factory = new AnimatorFactory();\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnFinish(callback: OnAnimationFinishCallback) {\r\n        this.#animationEngine.onFinish(callback);\r\n    }\r\n\r\n    setOnError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n        this.#animationEngine.setOnError(callback);\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        if (!is(props)) {\r\n            return;\r\n        }\r\n        this.#animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = this.#factory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                this.#animators.push(animator);\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    update(progress: number) {\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            return;\r\n        }\r\n        this.#animators.forEach(animator => animator.perform(this.#element, Math.min(progress, 1), 1))\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators in RAF\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    updateAsync(progress: number) {\r\n        requestAnimationFrame(this.update.bind(this, progress));\r\n    }\r\n\r\n    /**\r\n     * Finish swipe animation using animation engine\r\n     * @param progress - initial progress value 0..1\r\n     * @param timeout - time for animation to perform\r\n     * @param revert - whether animation should return back to 0 or progress to the end\r\n     */\r\n    finish(progress: number, timeout: number, revert: boolean) {\r\n        this.#animationEngine.setElement(this.#element);\r\n        this.#animationEngine.setAnimators(this.#animators);\r\n        this.#animationEngine.animate(timeout, progress, revert);\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e);\r\n        } else {\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n}","import { PropsTypes } from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\n\r\nexport interface AnimationDefinition {\r\n    previous: DefinitionItem;\r\n    current: DefinitionItem;\r\n}\r\n\r\nexport interface DefinitionItem {\r\n    left: AnimationProperty<PropsTypes>;\r\n    right: AnimationProperty<PropsTypes>\r\n}\r\n\r\nexport interface CuiAnimationsDefinition {\r\n    [id: string]: AnimationDefinition;\r\n}\r\n\r\nexport const SWIPE_ANIMATIONS_DEFINITIONS: CuiAnimationsDefinition = {\r\n    \"slide\": {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    fade: {\r\n        current: {\r\n            left: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            }\r\n        }\r\n    },\r\n    push: {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { is, getStringOrDefault, getIntOrDefault, isInRange, EVENTS, getChildrenHeight, SCOPE_SELECTOR, CLASSES, boolStringOrDefault, calculateNextIndex } from \"../../core/index\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../app/animation/definitions\";\r\n\r\n/**\r\n * \r\n *   targets: string - slider elements\r\n *   timeout: number - animation timeout\r\n *   links: string; - link to switcher (indicator, tab, etc)\r\n *   autoTimeout: number - if defined, slider will switch item automatically\r\n *   height: 'auto' | string - element height\r\n *   animation: string - animation name\r\n *   loop: boolean - allows to slide elements in loop\r\n */\r\nconst SWITCH_DEFAULT_TARGETS = \"> li\";\r\n\r\nexport class CuiSliderArgs implements ICuiParsable {\r\n    targets: string;\r\n    timeout: number;\r\n    links: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n    animation: string;\r\n    loop: boolean;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.targets = SCOPE_SELECTOR + getStringOrDefault(args.targets, SWITCH_DEFAULT_TARGETS)\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.links = args.links;\r\n        this.autoTimeout = getIntOrDefault(args.autoTimeout, -1);\r\n        this.height = getStringOrDefault(args.height, 'auto')\r\n        this.animation = getStringOrDefault(args.animation, 'slide');\r\n        this.loop = boolStringOrDefault(args.loop, false);\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSliderComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-slider`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSliderHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSliderHandler extends CuiMutableHandler<CuiSliderArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string;\r\n    //  #moveListener: CuiMoveEventListener;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #swipeRatio: number;\r\n    #nextIdx: number;\r\n    #nextElement: HTMLElement;\r\n    #ratioThreshold: number;\r\n    #currSlider: CuiSwipeAnimationEngine;\r\n    #nextSlider: CuiSwipeAnimationEngine;\r\n    #animationDef: AnimationDefinition;\r\n    #targetsCount: number;\r\n    #moveEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSliderHandler\", element, attribute, new CuiSliderArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#nextIdx = -1;\r\n        this.#links = [];\r\n        this.#switchEventId = null;\r\n        this.#isTracking = false;\r\n        this.#startX = -1;\r\n        this.#swipeRatio = 0;\r\n        this.#nextElement = null;\r\n        this.#ratioThreshold = 0.5;\r\n        this.#currSlider = new CuiSwipeAnimationEngine();\r\n        this.#nextSlider = new CuiSwipeAnimationEngine();\r\n        this.#currSlider.setOnFinish(this.onAnimationFinish.bind(this));\r\n        this.#targetsCount = 0;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this))\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getActiveIndex();\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n\r\n    }\r\n    /**\r\n     * Move listener callback\r\n     * @param data move listener data\r\n     */\r\n    onMove(data: ICuiMoveEvent) {\r\n        if (this.isLocked || !this.#animationDef) {\r\n            return;\r\n        }\r\n        let current = this.#targets[this.#currentIdx] as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking || !current.contains((data.target as Node))) {\r\n                    return;\r\n                }\r\n                this.#isTracking = true;\r\n                this.#startX = data.x;\r\n                this.#currSlider.setElement(current);\r\n                this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                // Lock component until animation is finished\r\n                this.isLocked = true;\r\n                let absRatio = Math.abs(this.#swipeRatio);\r\n                let timeout = absRatio * this.args.timeout;\r\n                let back = absRatio <= this.#ratioThreshold;\r\n                this.#currSlider.finish(absRatio, timeout, back);\r\n                this.#nextSlider.finish(absRatio, timeout, back);\r\n                this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                let newRatio = (data.x - this.#startX) / current.offsetWidth;\r\n                if (Math.abs(newRatio - this.#swipeRatio) < 0.02) {\r\n                    break;\r\n                }\r\n                let nextIdx = calculateNextIndex(this.#swipeRatio > 0 ? \"next\" : \"prev\", this.#currentIdx, this.#targetsCount);\r\n                this.#swipeRatio = this.adjustMoveRatio(newRatio);\r\n\r\n                if (nextIdx !== this.#nextIdx) {\r\n                    this.#nextElement && this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n                    this.#nextElement = this.#targets[nextIdx] as HTMLElement;\r\n                    this.#nextIdx = nextIdx;\r\n\r\n                    this.#nextSlider.setElement(this.#nextElement)\r\n                    this.#nextSlider.setProps(this.#swipeRatio > 0 ? this.#animationDef.previous.right : this.#animationDef.previous.left);\r\n                    this.#currSlider.setProps(this.#swipeRatio > 0 ? this.#animationDef.current.right : this.#animationDef.current.left);\r\n                    this.mutate(() => {\r\n                        this.helper.setClass(CLASSES.animProgress, this.#nextElement);\r\n                    })\r\n                }\r\n                this.mutate(() => {\r\n                    this.#currSlider.update(Math.abs(this.#swipeRatio));\r\n                    this.#nextSlider.update(Math.abs(this.#swipeRatio));\r\n                })\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    adjustMoveRatio(ratio: number): number {\r\n        if (this.args.loop) {\r\n            return ratio;\r\n        }\r\n        if (this.#currentIdx === this.#targetsCount - 1 && ratio > 0) {\r\n            return 0;\r\n        }\r\n        if (this.#currentIdx === 0 && ratio < 0) {\r\n            return 0;\r\n        }\r\n        return ratio;\r\n    }\r\n\r\n    /**\r\n     * Api method to switch childrens\r\n     * @param index - index to switch to\r\n     */\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.onPushSwitch(index);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param element element this animation was perfromed on\r\n     * @param reverted - flag inidicating whether animation was performed to the end or reverted back to start\r\n     * @param errorOccured - tells whether animation was finished with error\r\n     */\r\n    onAnimationFinish(element: Element, reverted: boolean, errorOccured: boolean) {\r\n        this.isLocked = false;\r\n        // If not go back or from push then switch, else was go back\r\n        let next = this.#targets[this.#nextIdx];\r\n        let current = this.#targets[this.#currentIdx];\r\n        if (!reverted) {\r\n            if (this.#nextIdx > -1) {\r\n                this.mutate(() => {\r\n                    this.helper.removeClass(CLASSES.animProgress, next);\r\n                    this.helper.setClass(this.activeClassName, next);\r\n                    this.helper.removeClass(this.activeClassName, current);\r\n                    this.helper.removeAttribute(\"style\", current);\r\n                    this.helper.removeAttribute(\"style\", next);\r\n                    this.setLinkActive(this.#currentIdx, this.#nextIdx);\r\n                    this.emitEvent(EVENTS.SWITCHED, {\r\n                        timestamp: Date.now(),\r\n                        index: this.#nextIdx\r\n                    })\r\n                    this.#currentIdx = this.#nextIdx;\r\n                    this.#nextIdx = -1;\r\n                    this.#nextElement = null;\r\n                    this.#startX = -1;\r\n                    this.#swipeRatio = 0;\r\n                })\r\n            }\r\n        } else {\r\n            this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n            this.helper.removeAttribute(\"style\", current);\r\n            this.helper.removeAttribute(\"style\", this.#nextElement);\r\n            this.#nextIdx = -1;\r\n            this.#nextElement = null;\r\n            this.#startX = -1;\r\n            this.#swipeRatio = 0;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    onPushSwitch(index: string) {\r\n        if (!is(index) ||\r\n            this.isLocked ||\r\n            !this.#animationDef ||\r\n            (!this.args.loop && this.#currentIdx === 0 && index === 'prev') ||\r\n            (!this.args.loop && this.#currentIdx === this.#targetsCount - 1 && index === 'next')) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        let nextIdx = calculateNextIndex(index, this.#currentIdx, this.#targetsCount);\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this._log.warning(`Index ${index} is not within the suitable range`);\r\n            return false;\r\n        }\r\n        this.#nextIdx = nextIdx;\r\n        let current = this.#targets[this.#currentIdx];\r\n        let next = this.#targets[this.#nextIdx];\r\n        this.#currSlider.setElement(current);\r\n        this.#nextSlider.setElement(next);\r\n        this.#currSlider.setProps(index === 'prev' ? this.#animationDef.current.left : this.#animationDef.current.right);\r\n        this.#nextSlider.setProps(index === 'prev' ? this.#animationDef.previous.left : this.#animationDef.previous.right);\r\n        this.mutate(() => {\r\n            this.#currSlider.finish(0, this.args.timeout, false);\r\n            this.#nextSlider.finish(0, this.args.timeout, false);\r\n            this.helper.setClass(CLASSES.animProgress, next);\r\n        })\r\n\r\n    }\r\n\r\n    getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Queries targets\r\n     */\r\n    getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n        this.#targetsCount = this.#targets.length;\r\n    }\r\n\r\n    /**\r\n     * Get linked switcher elements\r\n     */\r\n    getLinks() {\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    /**\r\n     * Set active class on linked switcher if set\r\n     * @param current - current index (to remove active from)\r\n     * @param next - next index (to set action on)\r\n     */\r\n    setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        this.mutate(() => {\r\n            if (isInRange(current, 0, this.#links.length - 1)) {\r\n                this.helper.removeClass(this.activeClassName, this.#links[current])\r\n            }\r\n            if (isInRange(next, 0, this.#links.length - 1)) {\r\n                this.helper.setClass(this.activeClassName, this.#links[next])\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n}\r\n","import { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../app/animation/definitions\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\nimport { CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { boolStringOrDefault, CLASSES, EVENTS, getIntOrDefault, getStringOrDefault, ICuiParsable, replacePrefix } from \"../../core/index\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { ICuiComponent, CuiUtils, ICuiComponentHandler } from \"../../index\";\r\n\r\nconst BANNER_OPEN_ANIMATION: string = \".{prefix}-animation-fade-in\";\r\nconst BANNER_CLOSE_ANIMATION: string = \".{prefix}-animation-fade-out\";\r\n\r\nexport class CuiBannerArgs implements ICuiParsable, CuiInteractableArgs {\r\n    timeout: number;\r\n    swipe: boolean;\r\n\r\n    openAct: string;\r\n    closeAct: string;\r\n    // Not in use\r\n    escClose: boolean;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#defTimeout = timeout;\r\n        this.#prefix = prefix;\r\n\r\n        this.escClose = false;\r\n        this.keyClose = undefined;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.swipe = boolStringOrDefault(args.swipe, false);\r\n        this.escClose = false;\r\n        this.keyClose = undefined;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(BANNER_OPEN_ANIMATION, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(BANNER_CLOSE_ANIMATION, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiBanerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-banner`;\r\n\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiBannerHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiBannerHandler extends CuiInteractableHandler<CuiBannerArgs> {\r\n\r\n    //  #moveListener: CuiMoveEventListener;\r\n    #swipeEngine: CuiSwipeAnimationEngine;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #ratio: number;\r\n    #swipeAnimation: AnimationDefinition;\r\n    #moveEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiBannerHandler\", element, attribute, new CuiBannerArgs(prefix, utils.setup.animationTime), utils);\r\n        // this.#moveListener = new CuiMoveEventListener();\r\n        // this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#swipeEngine = new CuiSwipeAnimationEngine(true);\r\n        this.#swipeEngine.setOnFinish(this.onSwipeFinish.bind(this));\r\n        this.#swipeEngine.setElement(this.element)\r\n        this.#startX = -1;\r\n        this.#ratio = 0;\r\n        this.#swipeAnimation = SWIPE_ANIMATIONS_DEFINITIONS[\"fade\"];\r\n        this.#moveEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this));\r\n        if (this.isActive) {\r\n            this.open();\r\n        }\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId);\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        return true;\r\n    }\r\n    onAfterOpen(): void {\r\n        if (this.args.swipe) {\r\n            this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this));\r\n        }\r\n    }\r\n    onAfterClose(): void {\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onMove(data: ICuiMoveEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        let current = this.element as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking || !current.contains((data.target as Node))) {\r\n                    return;\r\n                }\r\n                this.#isTracking = true;\r\n                this.#startX = data.x;\r\n                this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking && this.#ratio == 0) {\r\n                    break;\r\n                }\r\n                // Lock component until animation is finished\r\n                this.isLocked = true;\r\n                let absRatio = Math.abs(this.#ratio);\r\n                let timeout = absRatio * this.args.timeout;\r\n                let back = absRatio <= 0.4;\r\n                this.#swipeEngine.finish(absRatio, timeout, back);\r\n                this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (this.#isTracking) {\r\n                    let newRatio = (data.x - this.#startX) / current.offsetWidth;\r\n                    if (this.#ratio >= 0 && newRatio <= 0 || this.#ratio <= 0 && newRatio > 0) {\r\n                        this.#swipeEngine.setProps(newRatio > 0 ? this.#swipeAnimation.current.right : this.#swipeAnimation.current.left);\r\n                    }\r\n                    this.#ratio = newRatio;\r\n                    this.mutate(() => {\r\n                        this.#swipeEngine.update(Math.abs(this.#ratio));\r\n                    })\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onSwipeFinish(element: Element, reverted: boolean, error: boolean) {\r\n        this.isLocked = false;\r\n        if (!reverted) {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        }\r\n        this.#ratio = 0;\r\n        this.#startX = 0;\r\n\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\n\r\nconst COVER_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst COVER_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-cover-open';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiCoverArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout: number) {\r\n        this.escClose = false;\r\n\r\n        this.#defTimeout = defTimeout;\r\n        this.#prefix = prefix;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(COVER_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(COVER_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiCoverComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-cover`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCoverHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCoverHandler extends CuiInteractableHandler<CuiCoverArgs> {\r\n\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiCoverArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#scrollY = 0;\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        document.body.style.top = `-${this.#scrollY}px`;\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"false\");\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, (this.#scrollY || 0) * -1);\r\n        this.#scrollY = 0;\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"true\");\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n}","import { ICuiElementDetector } from \"./interfaces\";\r\n\r\nexport class CuiDragOverDetector implements ICuiElementDetector {\r\n    #elements: Element[];\r\n    constructor() {\r\n        this.#elements = [];\r\n    }\r\n\r\n    setElements(elements: Element[]): void {\r\n        this.#elements = elements;\r\n    }\r\n\r\n    detect(x: number, y: number): [number, Element] {\r\n        let reduced = this.#elements ? this.#elements.reduce((closest, child, currentId) => {\r\n            const box = child.getBoundingClientRect();\r\n            let offset = y - box.top - box.height / 2\r\n            if (offset < 0 && offset > closest.offset) {\r\n                return { offset: offset, element: child, idx: currentId }\r\n            } else {\r\n                return closest\r\n            }\r\n        }, { offset: Number.NEGATIVE_INFINITY, element: null, idx: -1 }) : undefined;\r\n        return reduced ? [reduced.idx, reduced.element] : [-1, undefined];\r\n    }\r\n\r\n    // private isElement(x: number, y: number, element: Element) {\r\n    //     let box = element.getBoundingClientRect();\r\n    //     return y >= box.top - 4 &&\r\n    //         y <= box.bottom + 4 &&\r\n    //         x >= box.left &&\r\n    //         x <= box.right\r\n    // }\r\n}","import { CuiMoveEventListener, ICuiMoveEvent } from \"../../../core/listeners/move\";\r\n\r\nexport class CuiDragHandler {\r\n    #root: Element;\r\n    #targets: Element[];\r\n    #triggers: Element[];\r\n    #moveHandler: CuiMoveEventListener;\r\n    #onDragStart: (data: ICuiMoveEvent) => boolean;\r\n    #onDragOver: (data: ICuiMoveEvent) => void;\r\n    #onDragEnd: (data: ICuiMoveEvent) => void;\r\n    #timeout: number;\r\n    #isTracking: boolean;\r\n    #timeoutId: any;\r\n    constructor(root: Element) {\r\n        this.#root = root;\r\n        this.#moveHandler = new CuiMoveEventListener();\r\n        this.#timeout = 150;\r\n        this.#isTracking = false;\r\n        this.#timeoutId = undefined;\r\n        this.#moveHandler.setCallback(this.onMove.bind(this));\r\n    }\r\n\r\n    setLongPressTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n    onDragStart(callback: (data: ICuiMoveEvent) => boolean) {\r\n        this.#onDragStart = callback;\r\n    }\r\n\r\n    onDragOver(callback: (data: ICuiMoveEvent) => void) {\r\n        this.#onDragOver = callback;\r\n    }\r\n\r\n    onDragEnd(callback: (data: ICuiMoveEvent) => void) {\r\n        this.#onDragEnd = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#moveHandler.attach();\r\n    }\r\n\r\n    detach() {\r\n        this.#moveHandler.detach();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveEvent) {\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking) {\r\n                    return;\r\n                }\r\n\r\n                this.#timeoutId = setTimeout(() => {\r\n                    if (this.#onDragStart && this.#onDragStart(data)) {\r\n                        this.#isTracking = true;\r\n                    }\r\n                }, this.#timeout);\r\n\r\n                break;\r\n            case \"move\":\r\n                if (!this.#isTracking) {\r\n                    return;\r\n                }\r\n                if (this.#onDragOver) {\r\n                    this.#onDragOver(data);\r\n                }\r\n                break;\r\n            case \"up\":\r\n                if (this.#timeoutId) {\r\n                    clearTimeout(this.#timeoutId);\r\n                    this.#timeoutId = undefined;\r\n                }\r\n                if (!this.#isTracking) {\r\n                    return;\r\n                }\r\n                if (this.#onDragEnd) {\r\n                    this.#onDragEnd(data);\r\n                }\r\n                this.#isTracking = false;\r\n                break;\r\n        }\r\n    }\r\n}","import { ElementBuilder } from \"../../app/builders/element\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiDragOverDetector } from \"../../app/handlers/drag/detectors\";\r\nimport { CuiDragHandler } from \"../../app/handlers/drag/drag\";\r\nimport { ICuiElementDetector } from \"../../app/handlers/drag/interfaces\";\r\nimport { CuiSwipeAnimationEngine, PropsTypes } from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\nimport { CLASSES, CuiUtils, delay, EVENTS, getIntOrDefault, getStringOrDefault, ICuiComponent, ICuiComponentHandler, ICuiParsable, replacePrefix, SCOPE_SELECTOR } from \"../../core/index\";\r\nimport { ICuiMoveEvent } from \"../../core/listeners/move\";\r\n\r\nconst SORTABLE_ITEMS_SELECTOR = \".{prefix}-sortable-item\";\r\nconst SORTABLE_IS_MOVING = \"{prefix}-moving\";\r\nconst DEFAULT_SELECTOR = \" > li\";\r\nconst SORTABLE_PREVIEW_CLS = \"{prefix}-sortable-preview\";\r\nconst SORTABLE_SHADOW_CLS = \"{prefix}-sortable-shadow\";\r\n\r\nexport class CuiSortableArgs implements ICuiParsable {\r\n    target: string;\r\n    trigger: string;\r\n    timeout: number\r\n    constructor() {\r\n        this.target = SCOPE_SELECTOR + DEFAULT_SELECTOR;;\r\n        this.trigger = SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.timeout = 150;\r\n    }\r\n    parse(val: any): void {\r\n        this.target = val.target ? SCOPE_SELECTOR + \" \" + val.target : SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.trigger = val.trigger ? SCOPE_SELECTOR + \" \" + val.trigger : SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.timeout = getIntOrDefault(val.timeout, 150);\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSortableComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? \"cui\";\r\n        this.attribute = this.#prefix + \"-sortable\";\r\n    }\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n    get(element: HTMLElement, sutils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSortableHandler(element, this.attribute, sutils, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiSortableHandler extends CuiHandler<CuiSortableArgs> {\r\n    #dragHandler: CuiDragHandler;\r\n    #triggers: Element[];\r\n    #targets: Element[];\r\n    #currentTarget: HTMLElement;\r\n    #currentIdx: number;\r\n    #preview: HTMLElement;\r\n    #shadow: HTMLElement;\r\n    #movingCls: string;\r\n    #detector: ICuiElementDetector;\r\n    #currentBefore: HTMLElement;\r\n    #animation: CuiSwipeAnimationEngine;\r\n\r\n    #previewCls: string;\r\n    #shadowCls: string;\r\n    constructor(element: HTMLElement, attribute: string, utils: CuiUtils, prefix: string) {\r\n        super(\"CuiSortableHandler\", element, attribute, new CuiSortableArgs(), utils);\r\n        this.#dragHandler = new CuiDragHandler(element);\r\n        this.#dragHandler.onDragStart(this.onDragStart.bind(this));\r\n        this.#dragHandler.onDragOver(this.onDragOver.bind(this));\r\n        this.#dragHandler.onDragEnd(this.onDragEnd.bind(this));\r\n        this.#movingCls = replacePrefix(SORTABLE_IS_MOVING, prefix);\r\n        this.#previewCls = replacePrefix(SORTABLE_PREVIEW_CLS, prefix);\r\n        this.#shadowCls = replacePrefix(SORTABLE_SHADOW_CLS, prefix);\r\n        this.#detector = new CuiDragOverDetector();\r\n        this.#currentBefore = undefined;\r\n        this.#animation = new CuiSwipeAnimationEngine();\r\n        this.#animation.setOnFinish(() => {\r\n            this.stopMovementPrep();\r\n            this.getTargetsAndTrggers();\r\n            this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n\r\n        })\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#dragHandler.attach();\r\n        this.getTargetsAndTrggers();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.args.target !== this.prevArgs.target ||\r\n            this.args.trigger !== this.prevArgs.trigger) {\r\n            this.getTargetsAndTrggers();\r\n        }\r\n        this.#dragHandler.setLongPressTimeout(this.args.timeout);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#dragHandler.detach();\r\n    }\r\n\r\n    /**\r\n     * queries targets and triggers from the element\r\n     * If exception - lists are cleared\r\n     */\r\n    private getTargetsAndTrggers() {\r\n        try {\r\n            this.#targets = [...this.element.querySelectorAll(this.args.target)];\r\n            this.#triggers = [...this.element.querySelectorAll(this.args.trigger)];\r\n            console.log(this.#triggers);\r\n            console.log(this.#targets);\r\n            if (this.#triggers.length !== this.#targets.length) {\r\n                throw new Error(\"Triggers and targets selector are not correct\")\r\n            }\r\n            this.#detector.setElements(this.#targets);\r\n        } catch (e) {\r\n            this._log.error(\"Incorrect trigger or target selector\")\r\n            this._log.exception(e, \"getTargetsAndTrggers\");\r\n            this.#targets = [];\r\n            this.#triggers = [];\r\n        }\r\n    }\r\n\r\n    private onDragStart(data: ICuiMoveEvent): boolean {\r\n        this.#currentIdx = this.getPressedElementIdx(data.target as Node);\r\n        this.#currentTarget = this.#currentIdx > -1 ? this.#targets[this.#currentIdx] as HTMLElement : undefined;\r\n        if (!this.#currentTarget) {\r\n            return false;\r\n        }\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n        this.startMovementPrep();\r\n        return true;\r\n    }\r\n\r\n    private onDragOver(data: ICuiMoveEvent): void {\r\n        this.move(data);\r\n    }\r\n\r\n    private onDragEnd(data: ICuiMoveEvent): void {\r\n        this.#animation.setElement(this.#preview);\r\n        this.#animation.setProps(this.getFinishAnimation());\r\n        this.#animation.finish(0, 100, false);\r\n    }\r\n\r\n    private getPressedElementIdx(target: Node) {\r\n        return this.#triggers.findIndex((trigger: Element) => {\r\n            return trigger.contains(target)\r\n        });\r\n    }\r\n\r\n    private startMovementPrep() {\r\n        this.mutate(() => {\r\n            this.helper.setClass(this.#movingCls, this.#currentTarget);\r\n            this.helper.setClass(\"cui-locked\", this.element);\r\n            this.helper.setClass(CLASSES.swipingOn, document.body);\r\n            this.createPreview();\r\n            this.createShadow();\r\n        })\r\n    }\r\n\r\n    private stopMovementPrep() {\r\n        this.mutate(() => {\r\n            if (this.#currentTarget && this.#currentBefore) {\r\n                this.insertElement(this.#currentTarget, this.#currentBefore);\r\n            }\r\n            this.helper.removeClass(this.#movingCls, this.#currentTarget);\r\n            this.helper.removeClass(CLASSES.swipingOn, document.body);\r\n            this.helper.removeClass(\"cui-locked\", this.element);\r\n            this.removePreview();\r\n            this.removeShadow();\r\n            this.#currentTarget = undefined;\r\n            this.#currentBefore = undefined;\r\n        })\r\n    }\r\n\r\n    private move(data: ICuiMoveEvent) {\r\n        this.mutate(() => {\r\n            this.movePreview(data);\r\n            this.moveShadow(data);\r\n        })\r\n    }\r\n\r\n    private createPreview() {\r\n        this.#preview = new ElementBuilder(\"div\").setClasses(this.#previewCls).build();\r\n        this.#preview.style.width = `${this.#currentTarget.offsetWidth}px`;\r\n        this.#preview.style.height = `${this.#currentTarget.offsetHeight}px`;\r\n        this.#preview.style.top = `${this.#currentTarget.offsetTop}px`;\r\n        this.#preview.style.left = `${this.#currentTarget.offsetLeft}px`;\r\n        document.body.appendChild(this.#preview);\r\n    }\r\n\r\n    private createShadow() {\r\n        this.#shadow = new ElementBuilder(\"div\").setClasses(this.#shadowCls).build();\r\n        this.#shadow.style.width = `${this.#currentTarget.offsetWidth}px`;\r\n        this.#shadow.style.height = `${this.#currentTarget.offsetHeight}px`;\r\n        this.element.appendChild(this.#shadow);\r\n    }\r\n\r\n    private removeShadow() {\r\n        if (this.#shadow) {\r\n            this.#shadow.remove();\r\n            this.#shadow = null;\r\n        }\r\n    }\r\n\r\n    private removePreview() {\r\n        if (this.#preview) {\r\n            this.#preview.remove();\r\n            this.#preview = null;\r\n        }\r\n    }\r\n\r\n    private movePreview(data: ICuiMoveEvent) {\r\n        if (!this.#preview) {\r\n            return;\r\n        }\r\n\r\n        this.#preview.style.top = `${data.y}px`;\r\n        this.#preview.style.left = `${data.x}px`;\r\n    }\r\n\r\n    private moveShadow(data: ICuiMoveEvent) {\r\n        if (!this.#shadow) {\r\n            return;\r\n        }\r\n        let [idx, detected] = this.#detector.detect(data.x, data.y);\r\n        if (idx > -1 && (idx < this.#currentIdx || idx > this.#currentIdx + 1) && this.#currentBefore !== detected) {\r\n            if (!this.helper.hasClass(this.activeClassName, this.#shadow)) {\r\n                this.helper.setClass(this.activeClassName, this.#shadow);\r\n            }\r\n            this.insertElement(this.#shadow, detected);\r\n            this.#currentBefore = detected as HTMLElement;\r\n        }\r\n    }\r\n\r\n    private insertElement(source: Element, destination: Element) {\r\n        if (destination) {\r\n            this.element.insertBefore(source, destination);\r\n        } else {\r\n            this.element.appendChild(source);\r\n        }\r\n    }\r\n\r\n    private getFinishAnimation(): AnimationProperty<PropsTypes> {\r\n        const box = this.#shadow.getBoundingClientRect();\r\n        return {\r\n            opacity: {\r\n                from: 1,\r\n                to: 0,\r\n            },\r\n            top: {\r\n                from: this.#preview.offsetTop,\r\n                to: box.top > 0 ? box.top : this.#preview.offsetTop,\r\n                unit: \"px\"\r\n            },\r\n            left: {\r\n                from: this.#preview.offsetLeft,\r\n                to: box.left > 0 ? box.left : this.#preview.offsetLeft,\r\n                unit: \"px\"\r\n            }\r\n        }\r\n    }\r\n}","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport { CuiInstance } from \"./instance\";\r\nimport { ICONS } from \"../core/utils/statics\";\r\nimport { ICuiPlugin, CuiInitData, CuiInitResult, ICuiComponent } from \"../core/models/interfaces\";\r\nimport { CuiAutoLightModePlugin } from \"../plugins/light/light\";\r\nimport { CuiIconComponent } from \"../components/icon/icon\";\r\nimport { CuiCircleComponent } from \"../components/circle/circle\";\r\nimport { CuiSpinnerComponent } from \"../components/spinner/spinner\";\r\nimport { CuiDummyComponent } from \"../components/dummy/dummy\";\r\nimport { CuiScrollComponent } from \"../components/scroll/scroll\";\r\nimport { CuiScrollspyComponent } from \"../components/scrollspy/scrollspy\";\r\nimport { CuiAutoPrintModePlugin } from \"../plugins/print/print\";\r\nimport { CuiIntersectionComponent } from \"../components/intersection/intersection\";\r\nimport { CuiOpenComponent } from \"../components/open/open\";\r\nimport { CuiCloseComponent } from \"../components/close/close\";\r\nimport { CuiToggleComponent } from \"../components/toggle/toggle\";\r\nimport { CuiResizeComponent } from \"../components/resize/resize\";\r\nimport { CuiKeysObserverPlugin } from \"../plugins/keys/keys\";\r\nimport { CuiDialogComponent } from \"../components/dialog/dialog\";\r\nimport { CuiOffCanvasArgs, CuiOffCanvasComponent } from \"../components/offcanvas/offcanvas\";\r\nimport { CuiAccordionComponent } from \"../components/accordion/accordion\";\r\nimport { CuiDropComponenet } from \"../components/drop/drop\";\r\nimport { CuiWindowClickPlugin } from \"../plugins/click/click\";\r\nimport { CuiOffsetComponent } from \"../components/offset/offset\";\r\nimport { CuiSwitchArgs, CuiSwitchComponent } from \"../components/switch/switch\";\r\nimport { CuiSwitcherComponent } from \"../components/switch/switcher\";\r\nimport { CuiFloatComponent } from \"../components/float/float\";\r\nimport { CuiSliderComponent } from \"../components/switch/slider\";\r\nimport { SWIPE_ANIMATIONS_DEFINITIONS } from \"./animation/definitions\";\r\nimport { CuiBanerComponent } from \"../components/banner/banner\";\r\nimport { CuiCoverComponent } from \"../components/cover/cover\";\r\nimport { CuiSortableComponent } from \"../components/sortable/sortable\";\r\n\r\nexport class CuiInitializer {\r\n    #window: any;\r\n    constructor() {\r\n        this.#window = window;\r\n    }\r\n\r\n    async init(setup: CuiInitData): Promise<CuiInitResult> {\r\n        let settings: CuiSetupInit = { ... new CuiSetupInit(), ...setup.setup }\r\n        const appPrefix: string = settings.app;\r\n        const result: CuiInitResult = {\r\n            result: false\r\n        }\r\n        if (is(this.#window[appPrefix])) {\r\n            result.message = \"Instance is already initialized\";\r\n            return result;\r\n        }\r\n        if (is(setup.icons)) {\r\n            for (let icon in setup.icons) {\r\n                ICONS[icon] = setup.icons[icon];\r\n            }\r\n        }\r\n        if (is(setup.swipeAnimations)) {\r\n            for (let animation in setup.swipeAnimations) {\r\n                SWIPE_ANIMATIONS_DEFINITIONS[animation] = setup.swipeAnimations[animation];\r\n            }\r\n\r\n        }\r\n        try {\r\n            this.#window[appPrefix] = new CuiInstance(settings, setup.plugins, setup.components)\r\n            this.#window[appPrefix].init();\r\n        } catch (e) {\r\n            console.error(e);\r\n            result.message = \"An error occured during initialization\";\r\n            return result;\r\n        }\r\n        result.result = true;\r\n        return result;\r\n    }\r\n}\r\n\r\nexport class CuiInit {\r\n    #isInitialized: boolean;\r\n    constructor() {\r\n        this.#isInitialized = false;\r\n    }\r\n\r\n    async init(data: CuiInitData): Promise<boolean> {\r\n        if (this.#isInitialized) {\r\n            console.log(\"Module is already initialized\")\r\n            return false;\r\n        }\r\n        const initializer = new CuiInitializer();\r\n        const pluginList: ICuiPlugin[] = [\r\n            new CuiAutoLightModePlugin({ autoLight: true }),\r\n            new CuiAutoPrintModePlugin({ autoPrint: true }),\r\n            new CuiKeysObserverPlugin(null),\r\n            new CuiWindowClickPlugin()\r\n        ];\r\n\r\n        const componentList: ICuiComponent[] = [\r\n            new CuiIconComponent(),\r\n            new CuiCircleComponent(),\r\n            new CuiSpinnerComponent(),\r\n            new CuiDummyComponent(),\r\n            new CuiScrollComponent(),\r\n            new CuiScrollspyComponent(),\r\n            new CuiIntersectionComponent(),\r\n            new CuiOpenComponent(),\r\n            new CuiCloseComponent(),\r\n            new CuiToggleComponent(),\r\n            new CuiResizeComponent(),\r\n            new CuiDialogComponent(),\r\n            new CuiOffCanvasComponent(),\r\n            new CuiAccordionComponent(),\r\n            new CuiDropComponenet(),\r\n            new CuiOffsetComponent(),\r\n            new CuiSwitchComponent(),\r\n            new CuiSwitcherComponent(),\r\n            new CuiFloatComponent(),\r\n            new CuiSliderComponent(),\r\n            new CuiBanerComponent(),\r\n            new CuiCoverComponent(),\r\n            new CuiSortableComponent()\r\n        ];\r\n\r\n        let result = await initializer.init({\r\n            setup: data.setup,\r\n            icons: data.icons,\r\n            plugins: is(data.plugins) ? [...pluginList, ...data.plugins] : pluginList,\r\n            components: is(data.components) ? [...componentList, ...data.components] : componentList,\r\n            swipeAnimations: data.swipeAnimations\r\n        })\r\n        if (result.result) {\r\n            this.#isInitialized = true;\r\n            return true;\r\n        } else {\r\n            console.error(`A cUI instance failed to initialize: [${result.message ?? \"#\"}]`);\r\n        }\r\n        console.log(\"Cui Light failed to init\")\r\n        return false;\r\n\r\n    }\r\n}","import { is, are } from \"../../core/utils/functions\";\r\nimport { ICuiLogger, IUIInteractionProvider, CuiCachable, CuiElement, CuiContext } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiClassAction } from \"../../core/utils/actions\";\r\n\r\nexport class ElementManager implements CuiCachable {\r\n    #elements: Element[];\r\n    #isLocked: boolean;\r\n    #logger: ICuiLogger;\r\n    #cDt: number;\r\n    #utils: CuiUtils;\r\n    #actionsHelper: CuiActionsHelper;\r\n    constructor(elements: Element[], utils: CuiUtils) {\r\n        this.#elements = elements;\r\n        this.#isLocked = false;\r\n        this.#logger = CuiLoggerFactory.get(\"ElementManager\");\r\n        this.#utils = utils;\r\n        this.#cDt = Date.now();\r\n        this.#actionsHelper = new CuiActionsHelper(utils.interactions);\r\n    }\r\n\r\n    async toggleClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className);\r\n            } else {\r\n                element.classList.remove(className);\r\n            }\r\n        }, 'toggleClass');\r\n    }\r\n\r\n    async toggleClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                } else {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleClassAs');\r\n    }\r\n\r\n    async setClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className)\r\n            }\r\n        }, 'setClass');\r\n    }\r\n\r\n    async setClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'setClassAs');\r\n    }\r\n\r\n    async removeClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.classList.contains(className)) {\r\n                element.classList.remove(className)\r\n            }\r\n        }, 'removeClass');\r\n    }\r\n\r\n    async removeClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n        }, 'removeClass');\r\n    }\r\n\r\n    getAttribute(attributeName: string): string[] {\r\n        if (!is(attributeName)) {\r\n            return null;\r\n        }\r\n        return this.#elements.reduce<string[]>((val: string[], current: Element) => {\r\n            if (current.hasAttribute(attributeName)) {\r\n                val.push(current.getAttribute(attributeName))\r\n            } else {\r\n                val.push(null);\r\n            }\r\n            return val;\r\n        }, []);\r\n    }\r\n\r\n    async setAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.setAttribute(attributeName, attributeValue ?? \"\")\r\n        }, 'setAttribute');\r\n    }\r\n\r\n    async setAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n        }, 'setAttributeAs');\r\n    }\r\n\r\n    async removeAttribute(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.removeAttribute(attributeName)\r\n        }, 'removeAttribute');\r\n    }\r\n\r\n    async removeAttributeAs(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n        }, 'removeAttributeAs');\r\n    }\r\n\r\n    async toggleAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.hasAttribute(attributeName)) {\r\n                element.removeAttribute(attributeName)\r\n            } else {\r\n                element.setAttribute(attributeName, attributeValue ?? \"\")\r\n            }\r\n        }, 'toggleAttribute');\r\n    }\r\n\r\n    async toggleAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.fetch(() => {\r\n                if (element.hasAttribute(attributeName)) {\r\n                    this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n                } else {\r\n                    this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleAttributeAs');\r\n    }\r\n\r\n    async click(onClick: (ev: MouseEvent) => void): Promise<boolean> {\r\n        if (!is(onClick)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener('click', onClick);\r\n        }, 'click');\r\n    }\r\n\r\n    async event(eventName: string, callback: any): Promise<boolean> {\r\n        if (!is(eventName) || !is(callback)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener(eventName, callback);\r\n        }, 'event');\r\n    }\r\n\r\n    async call(callback: (element: Element, index: Number) => void, functionName?: string): Promise<boolean> {\r\n        if (this.#isLocked) {\r\n            this.#logger.error(\"Element is locked\", functionName)\r\n        }\r\n        this.lock();\r\n        this.#elements.forEach((element, index) => {\r\n            callback(element, index)\r\n        })\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async animate(className: string, timeout?: number): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        return this.call((element) => {\r\n            this.change(() => {\r\n                element.classList.add(className);\r\n                element.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.change(() => {\r\n                        element.classList.remove(className);\r\n                        element.classList.remove(CLASSES.animProgress);\r\n                    })\r\n                }, delay)\r\n            })\r\n        });\r\n    }\r\n\r\n    async open(openClass: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!are(openClass, animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            this.#actionsHelper.performAction(element, action, delay).then(() => {\r\n                element.classList.add(openClass);\r\n            })\r\n        });\r\n    }\r\n\r\n    async close(closeClass: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!are(closeClass, animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            this.#actionsHelper.performAction(element, action, delay).then(() => {\r\n                element.classList.remove(closeClass);\r\n            })\r\n        });\r\n    }\r\n\r\n    emit(event: string, ...args: any[]): void {\r\n        if (!is(event)) {\r\n            this.#logger.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuid = (<CuiElement>(element as any)).$cuid;\r\n            if (is(cuid)) {\r\n                this.#logger.debug(`Emitting event ${event} to ${cuid}`)\r\n                this.#utils.bus.emit(event, cuid, ...args);\r\n            }\r\n        }, \"emit\")\r\n    }\r\n\r\n    on(event: string, callback: any): string[] {\r\n        let ids: string[] = []\r\n        if (!are(event, callback)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"on\")\r\n            return ids;\r\n        }\r\n\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                ids.push(this.#utils.bus.on(event, callback, cuiElement));\r\n            }\r\n        }, \"on\")\r\n        return ids;\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                this.#utils.bus.detach(event, id, cuiElement);\r\n            }\r\n        }, \"detach\")\r\n    }\r\n\r\n    read(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    change(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    count() {\r\n        return this.#elements.length;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false;\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return (Date.now() - this.#cDt) < 360000;\r\n    }\r\n}","import { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { is, sleep } from \"../../core/utils/functions\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToastHandler {\r\n    #interactions: IUIInteractionProvider;\r\n    #selector: string;\r\n    #className: string;\r\n    #activeCls: string;\r\n    #animationTime: number;\r\n    #lock: boolean;\r\n    #animClsIn: string;\r\n    #animClsOut: string;\r\n    constructor(interaction: IUIInteractionProvider, prefix: string, animationTime: number) {\r\n        this.#interactions = interaction;\r\n        this.#selector = `.${prefix}-toast`;\r\n        this.#className = `${prefix}-toast`;\r\n        this.#activeCls = `${prefix}-active`;\r\n        this.#animationTime = animationTime;\r\n        this.#lock = false;\r\n        this.#animClsIn = `${prefix}-toast-animation-in`;\r\n        this.#animClsOut = `${prefix}-toast-animation-out`\r\n    }\r\n\r\n    async show(message: string): Promise<boolean> {\r\n        if (this.#lock) {\r\n            return false;\r\n        }\r\n        this.#lock = true;\r\n        let toastElement = document.querySelector(this.#selector);\r\n        if (!is(toastElement)) {\r\n            toastElement = document.createElement('div');\r\n            toastElement.classList.add(this.#className);\r\n            document.body.appendChild(toastElement);\r\n            await sleep(10);\r\n        }\r\n\r\n        this.#interactions.mutate(() => {\r\n            toastElement.textContent = message;\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            toastElement.classList.add(this.#animClsIn);\r\n        }, this);\r\n\r\n        await sleep(this.#animationTime);\r\n        this.#interactions.mutate(() => {\r\n            toastElement.classList.remove(CLASSES.animProgress);\r\n            toastElement.classList.remove(this.#animClsIn);\r\n            toastElement.classList.add(this.#activeCls);\r\n        }, this)\r\n        await sleep(3000);\r\n        this.#interactions.mutate(() => {\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            toastElement.classList.add(this.#animClsOut);\r\n        }, this)\r\n\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(() => {\r\n                toastElement.classList.remove(CLASSES.animProgress);\r\n                toastElement.classList.remove(this.#animClsOut);\r\n                toastElement.classList.remove(this.#activeCls);\r\n            }, this)\r\n            this.#lock = false;\r\n        }, this.#animationTime);\r\n        return true;\r\n    }\r\n}","import { CLASSES } from \"../../core/utils/statics\";\r\nimport { ICuiLogger, IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CollectionManagerHelper {\r\n    #elements: Element[];\r\n    #log: ICuiLogger;\r\n    #isLocked: boolean;\r\n    #toggleClass: string;\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n        this.#log = CuiLoggerFactory.get('CollectionManager');\r\n    }\r\n\r\n    setElements(elements: Element[]) {\r\n        this.#elements = elements;\r\n    }\r\n\r\n    setToggle(className: string) {\r\n        this.#toggleClass = className;\r\n    }\r\n\r\n    addAnimationClass(currentElement: Element, nextElement: Element, animIn: string, animOut: string,): void {\r\n        nextElement.classList.add(CLASSES.animProgress);\r\n        currentElement.classList.add(animOut);\r\n        nextElement.classList.add(animIn);\r\n    }\r\n\r\n    setFinalClasses(currentElement: Element, nextElement: Element, animIn: string, animOut: string): void {\r\n        nextElement.classList.remove(CLASSES.animProgress);\r\n        currentElement.classList.remove(animOut);\r\n        nextElement.classList.remove(animIn);\r\n        currentElement.classList.remove(this.#toggleClass);\r\n        nextElement.classList.add(this.#toggleClass);\r\n    }\r\n\r\n    verifyIndex(index: number, current: number, count: number): boolean {\r\n        return index >= 0 && index !== current && index < count\r\n    }\r\n\r\n    async setCurrent(newIndex: number, current: number): Promise<boolean> {\r\n        this.lock();\r\n        this.#log.debug(`Switching index from: ${current} to ${newIndex}`)\r\n        if (current > -1)\r\n            this.#elements[current].classList.remove(this.#toggleClass);\r\n        this.#elements[newIndex].classList.add(this.#toggleClass);\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async setCurrentWithAnimation(newIndex: number, animClassIn: string, animClassOut: string, duration: number, current: number): Promise<boolean> {\r\n        this.lock()\r\n        this.#log.debug(`Switching index from: ${current} to ${newIndex}`)\r\n\r\n        const currentElement = this.#elements[current];\r\n        const nextElement = this.#elements[newIndex];\r\n        this.#interactions.mutate(this.addAnimationClass, this, currentElement, nextElement, animClassIn, animClassOut);\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(this.setFinalClasses, this, currentElement, nextElement, animClassIn, animClassOut)\r\n            this.unlock();\r\n        }, duration)\r\n        return true;\r\n    }\r\n\r\n    getCurrentIndex(): number {\r\n        if (!is(this.#toggleClass)) {\r\n            return -1;\r\n        }\r\n        let len = this.count();\r\n        for (let i = 0; i < len; i++) {\r\n            if (this.#elements[i].classList.contains(this.#toggleClass)) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    check(): boolean {\r\n        if (this.#isLocked) {\r\n            this.#log.warning(\"Object locked. Operation in progress\", \"Check\");\r\n            return false;\r\n        } else if (!is(this.#toggleClass)) {\r\n            this.#log.warning(\"Toggle is not set. Call setToggleClass\", \"Check\");\r\n            return false;\r\n        } else if (this.count() <= 0) {\r\n            this.#log.warning(\"Elements list is empty\", \"Check\");\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    count(): number {\r\n        return this.#elements ? this.#elements.length : -1;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false\r\n    }\r\n\r\n\r\n}","import { IUIInteractionProvider, ICuiLogger, CuiCachable } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CollectionManagerHelper } from \"../helpers/collection\";\r\n\r\nexport class CollectionManager implements CuiCachable {\r\n    #log: ICuiLogger;\r\n\r\n    #cDt: number;\r\n    #helper: CollectionManagerHelper;\r\n\r\n    constructor(elements: Element[], interactions: IUIInteractionProvider) {\r\n        this.#log = CuiLoggerFactory.get('CollectionManager');\r\n        this.#helper = new CollectionManagerHelper(interactions);\r\n        this.#helper.setElements(elements);\r\n        this.#cDt = Date.now();\r\n    }\r\n\r\n    setToggle(className: string) {\r\n        this.#helper.setToggle(className)\r\n    }\r\n\r\n    setElements(elements: Element[]) {\r\n        this.#helper.setElements(elements);\r\n    }\r\n\r\n    click(callback: (element: Element, index: number) => void): void {\r\n        this.#helper.elements().forEach((element, index) => {\r\n            element.addEventListener('click', () => {\r\n                this.set(index).then(() => {\r\n                    if (callback) {\r\n                        callback(element, index)\r\n                    }\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    async next(): Promise<boolean> {\r\n        if (!this.#helper.check()) {\r\n            return false;\r\n        }\r\n        let newIdx = this.#helper.getCurrentIndex() + 1;\r\n        return this.set(newIdx >= this.length() ? 0 : newIdx);\r\n    }\r\n\r\n    async previous(): Promise<boolean> {\r\n        if (!this.#helper.check()) {\r\n            return false;\r\n        }\r\n        let newIdx = this.#helper.getCurrentIndex() - 1;\r\n        return this.set(newIdx < 0 ? this.length() - 1 : newIdx)\r\n    }\r\n\r\n    async set(index: number): Promise<boolean> {\r\n        let current = this.#helper.getCurrentIndex();\r\n        if (!this.#helper.check() || !this.#helper.verifyIndex(index, current, this.length())) {\r\n            return false;\r\n        }\r\n        return this.#helper.setCurrent(index, current)\r\n    }\r\n\r\n    async setWithAnimation(index: number, animClassIn: string, animClassOut: string, duration: number): Promise<boolean> {\r\n        let current = this.#helper.getCurrentIndex();\r\n        if (!this.#helper.check() || !this.#helper.verifyIndex(index, current, this.length())) {\r\n            return false;\r\n        }\r\n        return this.#helper.setCurrentWithAnimation(index, animClassIn, animClassOut, duration, current)\r\n    }\r\n\r\n    getCurrentIndex(): number {\r\n        return this.#helper.getCurrentIndex();\r\n    }\r\n\r\n    length() {\r\n        return this.#helper.count();\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return this.length() > 0 && Date.now() - this.#cDt > 360000;\r\n    }\r\n}","import { ICuiPluginManager, ICuiPlugin, ICuiLogger, ICuiMutiationPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiPluginManager implements ICuiPluginManager {\r\n    #plugins: ICuiPlugin[];\r\n    #mutated: ICuiMutiationPlugin[];\r\n    #log: ICuiLogger;\r\n    constructor(plugins: ICuiPlugin[]) {\r\n        this.#plugins = plugins ?? [];\r\n        this.#log = CuiLoggerFactory.get(\"CuiPluginManager\")\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#log.debug(\"Plugins initialization started: \" + this.#plugins.length)\r\n        this.#mutated = this.#plugins.filter((plugin: any) => {\r\n            return is(plugin.mutation);\r\n        }) as any;\r\n        this.#plugins.forEach(plugin => {\r\n            plugin.init(utils);\r\n            utils.setup.plugins[plugin.description] = plugin.setup;\r\n        })\r\n        this.#log.debug(\"Plugins have been initialized\");\r\n    }\r\n\r\n    get(name: string): ICuiPlugin {\r\n        if (!is(name)) {\r\n            return undefined;\r\n        }\r\n        return this.#plugins.find(p => p.name === name);\r\n    }\r\n\r\n    async onMutation(mutation: MutationRecord): Promise<boolean> {\r\n        let tasks: Promise<boolean>[] = [];\r\n        this.#mutated.forEach((plugin: any) => {\r\n            tasks.push(plugin.mutation(mutation))\r\n        })\r\n        let result: boolean[] = await Promise.all(tasks);\r\n        return result.find(val => {\r\n            val === false\r\n        }) ? false : true;\r\n    }\r\n\r\n}","import { ElementBuilder } from \"./element\";\r\nimport { is } from \"../../core/index\";\r\n\r\nexport class DialogBuilder {\r\n    #header: Element;\r\n    #body: Element;\r\n    #footer: Element;\r\n    #prefix: string;\r\n    #switches: string;\r\n    #reverse: boolean;\r\n    constructor(prefix: string, reverse: boolean, switches?: string) {\r\n        this.#prefix = prefix;\r\n        this.#header = this.#footer = this.#body = null;\r\n        this.#switches = switches ?? \"\";\r\n        this.#reverse = reverse;\r\n    }\r\n\r\n    createHeader(title: string, classes: string[], elements?: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        let headerBuilder = new ElementBuilder('div');\r\n        headerBuilder.setClasses(`${this.#prefix}-dialog-header`, ...classes)\r\n        this.#header = headerBuilder.build();\r\n\r\n        let titleElement = new ElementBuilder('span').setClasses(this.getPrefixedString(\"-dialog-title\")).build(title)\r\n\r\n        this.#header.appendChild(titleElement);\r\n        this.appendChildrens(this.#header, ...elements);\r\n\r\n    }\r\n\r\n    createFooter(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#footer = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-footer\"), ...classes).build();\r\n        this.appendChildrens(this.#footer, ...elements);\r\n    }\r\n\r\n    createBody(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#body = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-body\"), ...classes).build();\r\n        this.appendChildrens(this.#body, ...elements);\r\n    }\r\n\r\n    build(id: string): HTMLElement {\r\n        let classes = [this.getPrefixedString(\"-dialog\")]\r\n        if (this.#reverse) {\r\n            classes.push(this.getPrefixedString('-reverse-auto'));\r\n        }\r\n        let dialog = new ElementBuilder('div').setId(id).setClasses(...classes).setAttributes({\r\n            [this.getPrefixedString('-dialog')]: this.#switches\r\n        }).build();\r\n        let container = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-container\")).build();\r\n        container.appendChild(this.#header);\r\n        container.appendChild(this.#body);\r\n        container.appendChild(this.#footer);\r\n        dialog.appendChild(container);\r\n        return dialog;\r\n    }\r\n\r\n    private appendChildrens(parent: Element, ...elements: Element[]) {\r\n        if (is(elements)) {\r\n            elements.forEach((element) => parent.appendChild(element));\r\n        }\r\n    }\r\n    private getPrefixedString(str: string) {\r\n        return this.#prefix + str\r\n    }\r\n}","import { is, CuiSetup, CuiUtils, CuiAlertType, CuiAlertData, CuiContext } from \"../../core/index\";\r\nimport { ElementManager } from \"../managers/element\";\r\nimport { DialogBuilder } from \"../builders/dialog\";\r\nimport { ElementBuilder } from \"../builders/element\";\r\n\r\nexport interface ICuiAlertHandler {\r\n    show(root: Element): void;\r\n}\r\n\r\ninterface AlertCallbacks {\r\n    [name: string]: () => void\r\n}\r\n\r\nabstract class CuiAlertHandlerBase implements ICuiAlertHandler, CuiContext {\r\n    #callbacks: AlertCallbacks;\r\n    #utils: CuiUtils;\r\n    #id: string;\r\n    #manager: ElementManager;\r\n    closeStr: string;\r\n    iconStr: string;\r\n    content: string;\r\n    title: string;\r\n    prefix: string;\r\n    reverse: boolean;\r\n    #attid: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        this.#callbacks = {\r\n            \"yes\": data.onYes,\r\n            \"no\": data.onNo,\r\n            \"cancel\": data.onCancel,\r\n            \"ok\": data.onOk\r\n        }\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.#utils = setup;\r\n        this.#id = id;\r\n        this.reverse = false;\r\n        this.#attid = null;\r\n        this.closeStr = `${this.#utils.setup.prefix}-close`;\r\n        this.iconStr = `${this.#utils.setup.prefix}-icon`;\r\n    }\r\n\r\n    getId(): string {\r\n        return this.#id;\r\n    }\r\n\r\n    show(root: Element): void {\r\n        let element = document.getElementById(this.#id);\r\n        if (!is(element)) {\r\n            element = this.createElement();\r\n            root.appendChild(element);\r\n        } else {\r\n            this.updateElement(element);\r\n        }\r\n        setTimeout(() => {\r\n            this.#manager = new ElementManager([element], this.#utils);\r\n            let ids = this.#manager.on('closed', this.onClose.bind(this));\r\n            this.#attid = ids.length > 0 ? ids[0] : null;\r\n            this.#manager.emit(\"open\");\r\n        }, 100);\r\n    }\r\n\r\n    updateElement(element: HTMLElement) {\r\n        let title = element.querySelector(`.${this.prefix}-dialog-title`);\r\n        let content = element.querySelector(`.${this.prefix}-dialog-body>p`);\r\n        this.#utils.interactions.mutate(() => {\r\n            if (title) {\r\n                title.innerHTML = this.title;\r\n            }\r\n            if (content) {\r\n                content.innerHTML = this.content;\r\n            }\r\n        }, null)\r\n    }\r\n\r\n    onClose(arg: any) {\r\n        try {\r\n            if (is(arg) && (arg.state)) {\r\n                if (is(this.#callbacks[arg.state])) {\r\n                    this.#callbacks[arg.state]();\r\n                }\r\n            }\r\n        } finally {\r\n            if (this.#attid != null) {\r\n                this.#manager.detach('closed', this.#attid);\r\n                this.#attid = null;\r\n            }\r\n\r\n            this.#manager = null;\r\n        }\r\n    }\r\n\r\n    abstract createElement(): HTMLElement;\r\n\r\n\r\n}\r\n\r\nexport class CuiAlertHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, null, [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: cancel\" }).build(\"Cancel\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiInfoAlertUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n        dialogBuilder.createHeader(this.title, null, null);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiYesNoPopUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, null, [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: no\" }).build(\"No\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: yes\" }).build(\"Yes\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiAlertFactory {\r\n    static get(id: string, type: CuiAlertType, data: CuiAlertData, utils: CuiUtils) {\r\n        if (type === \"Info\") {\r\n            return new CuiInfoAlertUpHandler(utils, id, data);\r\n        } else if (type === 'YesNoCancel') {\r\n            return new CuiYesNoPopUpHandler(utils, id, data);\r\n        } else if (type === 'OkCancel') {\r\n            return new CuiAlertHandler(utils, id, data);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","import { EVENTS, ICuiEventBus } from \"../../core/index\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\n\r\nexport class CuiMoveObserver {\r\n    #bus: ICuiEventBus;\r\n    #moveListener: CuiMoveEventListener;\r\n    #isLocked: boolean;\r\n    #eventId: string;\r\n    #firstEvent: ICuiMoveEvent;\r\n    constructor(bus: ICuiEventBus) {\r\n        this.#bus = bus;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#firstEvent = null;\r\n    }\r\n\r\n    attach() {\r\n        if (!this.#moveListener.isAttached()) {\r\n            this.#moveListener.attach();\r\n            this.#eventId = this.#bus.on(EVENTS.MOVE_LOCK, this.onMoveLock.bind(this))\r\n        }\r\n    }\r\n\r\n    detach() {\r\n        if (this.#moveListener.isAttached()) {\r\n            this.#moveListener.detach();\r\n            this.#eventId && this.#bus.detach(EVENTS.MOVE_LOCK, this.#eventId);\r\n        }\r\n\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#moveListener.isAttached();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        switch (data.type) {\r\n            case \"down\":\r\n                this.#firstEvent = data;\r\n                break;\r\n            case \"move\":\r\n                if (this.#firstEvent) {\r\n                    this.#bus.emit(EVENTS.GLOBAL_MOVE, null, this.#firstEvent);\r\n                    this.#firstEvent = null;\r\n                }\r\n                this.#bus.emit(EVENTS.GLOBAL_MOVE, null, data);\r\n                break;\r\n            case \"up\":\r\n                if (this.#firstEvent) {\r\n                    this.#firstEvent = null;\r\n                    return;\r\n                }\r\n\r\n                this.#bus.emit(EVENTS.GLOBAL_MOVE, null, data);\r\n                break;\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n    private onMoveLock(flag: boolean) {\r\n        this.#isLocked = flag;\r\n    }\r\n}","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is, joinAttributesForQuery, are, registerCuiElement } from \"../core/utils/functions\";\r\nimport { ElementManager } from \"./managers/element\";\r\nimport { STATICS, EVENTS, CSS_VARIABLES } from \"../core/utils/statics\";\r\nimport { ICuiLogger, ICuiPlugin, ICuiComponent, ICuiPluginManager, CuiContext, CuiElement, CuiAlertData } from \"../core/models/interfaces\";\r\nimport { ICuiMutionObserver, CuiMutationObserver } from \"./observers/mutations\";\r\nimport { CuiLoggerFactory } from \"../core/factories/logger\";\r\nimport { CuiToastHandler } from \"./managers/toast\";\r\nimport { CollectionManager } from \"./managers/collection\";\r\nimport { CuiUtils } from \"../core/models/utils\";\r\nimport { CuiInstanceInitError } from \"../core/models/errors\";\r\nimport { CuiPluginManager } from \"./managers/plugins\";\r\nimport { CuiAlertHandler, CuiAlertFactory } from \"./handlers/alert\";\r\nimport { CuiAlertType } from \"../core/index\";\r\nimport { CuiMoveObserver } from \"./observers/move\";\r\n\r\n\r\nexport class CuiInstance {\r\n    #log: ICuiLogger;\r\n    #mutationObserver: ICuiMutionObserver;\r\n    #toastManager: CuiToastHandler;\r\n    #utils: CuiUtils;\r\n    plugins: ICuiPluginManager;\r\n    #components: ICuiComponent[];\r\n    #rootElement: HTMLElement;\r\n    #moveObserver: CuiMoveObserver;\r\n    constructor(setup: CuiSetupInit, plugins: ICuiPlugin[], components: ICuiComponent[]) {\r\n        STATICS.prefix = setup.prefix;\r\n        STATICS.logLevel = setup.logLevel;\r\n        this.plugins = new CuiPluginManager(plugins);\r\n        this.#components = components ?? [];\r\n        this.#utils = new CuiUtils(setup);\r\n        this.#log = CuiLoggerFactory.get('CuiInstance')\r\n        this.#rootElement = setup.root;\r\n        this.#moveObserver = new CuiMoveObserver(this.#utils.bus);\r\n    }\r\n\r\n    init(): CuiInstance {\r\n        this.#log.debug(\"Instance started\", \"init\")\r\n        // Init elements\r\n        if (!is(window.MutationObserver)) {\r\n            throw new CuiInstanceInitError(\"Mutation observer does not exists\");\r\n        }\r\n        this.#toastManager = new CuiToastHandler(this.#utils.interactions, this.#utils.setup.prefix, this.#utils.setup.animationTimeLong);\r\n        const mutatedAttributes: string[] = this.#components.map(x => { return x.attribute }); // MUTATED_ATTRIBUTES; \r\n        const initElements = is(mutatedAttributes) ? this.#rootElement.querySelectorAll(joinAttributesForQuery(mutatedAttributes)) : null\r\n        if (is(initElements)) {\r\n            this.#log.debug(`Initiating ${initElements.length} elements`)\r\n            try {\r\n                initElements.forEach((item: any) => {\r\n                    registerCuiElement(item, this.#components, mutatedAttributes, this.#utils);\r\n                })\r\n            } catch (e) {\r\n                this.#log.exception(e);\r\n            }\r\n        }\r\n        this.#log.debug(\"Init plugins\", \"init\")\r\n        // Init plugins\r\n        this.plugins.init(this.#utils);\r\n\r\n        if (are(this.#components, mutatedAttributes)) {\r\n            this.#log.debug(\"Init mutation observer\", \"init\")\r\n            this.#mutationObserver = new CuiMutationObserver(this.#rootElement, this.#utils)\r\n            this.#mutationObserver.setComponents(this.#components).setAttributes(mutatedAttributes)\r\n            this.#mutationObserver.setPlugins(this.plugins);\r\n            this.#mutationObserver.start();\r\n        }\r\n\r\n        this.#log.debug(\"Setting CSS globals\", 'init')\r\n        this.#utils.interactions.mutate(() => {\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeLong, `${this.#utils.setup.animationTimeLong}ms`)\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTime, `${this.#utils.setup.animationTime}ms`);\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeShort, `${this.#utils.setup.animationTimeShort}ms`);\r\n        }, null)\r\n        this.#moveObserver.attach();\r\n\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_INITIALIZED, null)\r\n        return this;\r\n    }\r\n\r\n    finish(): void {\r\n        this.#mutationObserver.stop();\r\n        this.#moveObserver.detach();\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_FINISHED, null)\r\n    }\r\n\r\n    get(selector: string): ElementManager {\r\n        const elements = this.all(selector);\r\n        if (!elements) {\r\n            return undefined\r\n        }\r\n        const newElement = new ElementManager(elements, this.#utils);\r\n        return newElement\r\n    }\r\n\r\n    collection(selector: string): CollectionManager {\r\n        const elements = this.all(selector);\r\n        if (!is(elements)) {\r\n            return undefined;\r\n        }\r\n        let manager = new CollectionManager(elements, this.#utils.interactions);\r\n        return manager;\r\n    }\r\n\r\n\r\n    async toast(message: string): Promise<boolean> {\r\n        if (!is(message)) {\r\n            return false;\r\n        }\r\n        return this.#toastManager.show(message)\r\n    }\r\n\r\n    select(selector: string): Element {\r\n        return document.querySelector(selector)\r\n    }\r\n\r\n    all(selector: string): Element[] {\r\n        const nodes: NodeListOf<Element> = document.querySelectorAll(selector);\r\n        if (!is(nodes)) {\r\n            return undefined;\r\n        }\r\n        return [...nodes];\r\n    }\r\n\r\n    getUtils(): CuiUtils {\r\n        return this.#utils;\r\n    }\r\n\r\n    on(event: string, callback: any, element?: CuiElement): void {\r\n        if (!are(event, callback)) {\r\n            this.#log.error(\"Incorrect arguments\", \"on\")\r\n        }\r\n        this.#utils.bus.on(event, callback, element);\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.#utils.bus.detach(event, id);\r\n    }\r\n\r\n    detachAll(event: string): void {\r\n        if (!is(event)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detachAll\")\r\n        }\r\n        this.#utils.bus.detachAll(event);\r\n    }\r\n\r\n    emit(event: string, element: Element | string, ...args: any[]): void {\r\n        if (!are(event, element)) {\r\n            this.#log.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        let el = typeof element === 'string' ? document.querySelector(element) : element;\r\n        let cuid = (<CuiElement>(el as any)).$cuid;\r\n        if (!is(cuid)) {\r\n            this.#log.warning(\"Element is not a cUI element\", \"emit\")\r\n            return\r\n        }\r\n        this.#utils.bus.emit(event, cuid, ...args);\r\n    }\r\n\r\n    alert(id: string, type: CuiAlertType, data: CuiAlertData): void {\r\n        let popup = CuiAlertFactory.get(id, type, data, this.#utils);\r\n        popup.show(this.#rootElement);\r\n    }\r\n}","import { ICuiLogger, IUIInteractionProvider, ICuiMutiationPlugin, ICuiComponent, ICuiPluginManager, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is, getMatchingAttribute, are, getMatchingAttributes, generateCUID, registerCuiElement, joinAttributesForQuery, parseAttribute } from \"../../core/utils/functions\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\n\r\nexport interface ICuiMutionObserver {\r\n    // setOptions(options: MutationObserverInit): ICuiMutionObserver;\r\n    setPlugins(plugins: ICuiPluginManager): ICuiMutionObserver;\r\n    setComponents(components: ICuiComponent[]): ICuiMutionObserver;\r\n    setAttributes(attributes: string[]): ICuiMutionObserver;\r\n    start(): ICuiMutionObserver;\r\n    stop(): ICuiMutionObserver;\r\n}\r\n\r\nexport interface ICuiComponentMutationObserver {\r\n    observe(): void;\r\n    unobserve(): void;\r\n    isObserving(): boolean;\r\n    onMutation(callback: (record: MutationRecord[]) => void): void;\r\n    disable(flag: boolean): void;\r\n}\r\n\r\n\r\nexport class CuiMutationObserver implements ICuiMutionObserver {\r\n    _log: ICuiLogger;\r\n    #observer: MutationObserver;\r\n    #options: MutationObserverInit;\r\n    #element: HTMLElement;\r\n    plugins: ICuiPluginManager;\r\n    #components: ICuiComponent[];\r\n    #attributes: string[];\r\n    #utils: CuiUtils;\r\n    #queryString: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils) {\r\n        this.#observer = null\r\n        this.#element = element\r\n        this._log = CuiLoggerFactory.get('CuiMutationObserver')\r\n        this.plugins = null;\r\n        this.#components = [];\r\n        this.#attributes = [];\r\n        this.#utils = utils;\r\n        this.#queryString = \"\";\r\n\r\n    }\r\n\r\n    setPlugins(plugins: ICuiPluginManager) {\r\n        this.plugins = plugins;\r\n        return this;\r\n    }\r\n\r\n    setComponents(components: ICuiComponent[]) {\r\n        this.#components = components;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: string[]) {\r\n        this.#options = {\r\n            attributes: true,\r\n            subtree: true,\r\n            childList: true,\r\n            attributeFilter: attributes\r\n        }\r\n        this.#attributes = attributes;\r\n        this.#queryString = joinAttributesForQuery(attributes);\r\n        return this;\r\n    }\r\n\r\n    start() {\r\n        this._log.debug(\"Starting\")\r\n        this.#observer = new MutationObserver(this.mutationCallback.bind(this));\r\n        this.#observer.observe(this.#element, this.#options)\r\n        this._log.debug(\"Started\")\r\n        return this;\r\n    }\r\n\r\n    stop() {\r\n        this._log.debug(\"Stopping\")\r\n        if (this.#observer !== null)\r\n            this._log.debug(\"Observer available\")\r\n        this.#observer.disconnect()\r\n        this.#observer = null;\r\n        this._log.debug(\"Stopped\")\r\n        return this\r\n    }\r\n\r\n    private mutationCallback(mutations: MutationRecord[], observer: MutationObserver) {\r\n        mutations.forEach((mutation: MutationRecord) => {\r\n            switch (mutation.type) {\r\n                case 'attributes':\r\n                    const item = mutation.target as any;\r\n                    if (are(item.$handlers, item.$handlers[mutation.attributeName])) {\r\n                        item.$handlers[mutation.attributeName].refresh(parseAttribute(item, mutation.attributeName));\r\n                    }\r\n                    break;\r\n\r\n                case 'childList':\r\n                    this.handleChildListMutation(mutation);\r\n                    break;\r\n            }\r\n            if (is(this.plugins)) {\r\n                this.plugins.onMutation(mutation).then(() => {\r\n                    //\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    private handleChildListMutation(mutation: MutationRecord) {\r\n        const addedLen = mutation.addedNodes.length;\r\n        const removedLen = mutation.removedNodes.length;\r\n        if (addedLen > 0) {\r\n            this._log.debug(\"Registering added nodes: \" + addedLen)\r\n            this.handleAddedNodes(mutation.addedNodes);\r\n        } else if (removedLen > 0) {\r\n            this._log.debug(\"Removing nodes: \" + removedLen);\r\n            this.handleRemovedNodes(mutation.removedNodes);\r\n        }\r\n    }\r\n\r\n    private handleAddedNodes(nodes: NodeList) {\r\n        nodes.forEach((node: any) => {\r\n            try {\r\n                registerCuiElement(node, this.#components, this.#attributes, this.#utils);\r\n                let childrens = node.hasChildNodes() ? node.querySelectorAll(this.#queryString) : null;\r\n                if (is(childrens)) {\r\n                    childrens.forEach((child: any) => {\r\n                        registerCuiElement(child, this.#components, this.#attributes, this.#utils);\r\n                    })\r\n                }\r\n            } catch (e) {\r\n                this._log.exception(e);\r\n            }\r\n        })\r\n    }\r\n\r\n    private handleRemovedNodes(nodes: NodeList) {\r\n        nodes.forEach((node: any) => {\r\n            this.destroySingleElement(node);\r\n            let childrens = node.hasChildNodes() ? node.querySelectorAll(this.#queryString) : null;\r\n            if (is(childrens)) {\r\n                childrens.forEach((child: any) => {\r\n                    this.destroySingleElement(child);\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    private destroySingleElement(node: any) {\r\n        let element = node as CuiElement;\r\n        if (element.$handlers) {\r\n            for (let name in element.$handlers) {\r\n                if (element.$handlers.hasOwnProperty(name)) {\r\n                    try {\r\n                        element.$handlers[name].destroy();\r\n                    } catch (e) {\r\n                        this._log.exception(e, 'remove - ' + name)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class CuiComponentMutationHandler implements ICuiComponentMutationObserver {\r\n    #isObserving: boolean;\r\n    #observer: MutationObserver;\r\n    #element: Element;\r\n    #disabled: boolean;\r\n    #options: MutationObserverInit = {\r\n        childList: true,\r\n        subtree: true\r\n    }\r\n    constructor(target: Element) {\r\n        this.#observer = null;\r\n        this.#isObserving = false;\r\n        this.#element = target;\r\n    }\r\n\r\n    observe(): void {\r\n        if (!this.#isObserving && !this.#disabled) {\r\n            this.#observer.observe(this.#element, this.#options);\r\n            this.#isObserving = true;\r\n        }\r\n    }\r\n    unobserve(): void {\r\n        if (this.#isObserving) {\r\n            this.#observer.disconnect();\r\n            this.#isObserving = false;\r\n        }\r\n    }\r\n\r\n    isObserving(): boolean {\r\n        return this.#isObserving;\r\n    }\r\n\r\n    disable(flag: boolean): void {\r\n        this.#disabled = flag;\r\n        if (this.#disabled) {\r\n            this.unobserve();\r\n        }\r\n    }\r\n\r\n    onMutation(callback: (record: MutationRecord[]) => void): void {\r\n        if (this.#isObserving)\r\n            this.unobserve();\r\n        this.#observer = new MutationObserver(callback)\r\n    }\r\n\r\n}","import { CuiInit } from './app/initializer';\r\n\r\nexport const CUI_LIGHT_VERSION = \"0.1.30\";\r\n\r\ndeclare global {\r\n    interface Window {\r\n        cuiInit: CuiInit;\r\n    }\r\n}\r\n\r\nexport * from \"./core/models/interfaces\";\r\nexport * from './core/models/events';\r\nexport * from './core/models/setup';\r\nexport * from './core/models/utils';\r\nexport * from './app/initializer'\r\nexport { CuiInstance } from './app/instance';\r\n\r\nwindow.cuiInit = new CuiInit();"],"sourceRoot":""}