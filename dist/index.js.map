{"version":3,"sources":["webpack://cui-light/webpack/universalModuleDefinition","webpack://cui-light/webpack/bootstrap","webpack://cui-light/./src/core/utils/functions.ts","webpack://cui-light/./src/core/utils/statics.ts","webpack://cui-light/./src/core/index.ts","webpack://cui-light/./src/core/utils/actions.ts","webpack://cui-light/./src/core/factories/logger.ts","webpack://cui-light/./src/core/models/errors.ts","webpack://cui-light/./src/core/models/setup.ts","webpack://cui-light/./src/app/managers/cache.ts","webpack://cui-light/./src/app/handlers/colors.ts","webpack://cui-light/./src/app/observers/resize.ts","webpack://cui-light/./src/core/models/utils.ts","webpack://cui-light/./src/core/listeners/media.ts","webpack://cui-light/./src/core/listeners/scroll.ts","webpack://cui-light/./src/core/utils/interactions.ts","webpack://cui-light/./src/core/utils/logger.ts","webpack://cui-light/./src/core/helpers/helpers.ts","webpack://cui-light/./src/core/factories/interactions.ts","webpack://cui-light/./src/core/utils/dictionary.ts","webpack://cui-light/./src/core/bus/bus.ts","webpack://cui-light/./src/core/bus/handlers.ts","webpack://cui-light/./src/core/bus/executors.ts","webpack://cui-light/./src/core/styles/appender.ts","webpack://cui-light/./src/core/listeners/keys.ts","webpack://cui-light/./src/plugins/light/light.ts","webpack://cui-light/./src/app/handlers/base.ts","webpack://cui-light/./src/components/icon/icon.ts","webpack://cui-light/./src/components/circle/circle.ts","webpack://cui-light/./src/components/spinner/spinner.ts","webpack://cui-light/./src/components/dummy/dummy.ts","webpack://cui-light/./src/components/scroll/scroll.ts","webpack://cui-light/./src/components/scrollspy/scrollspy.ts","webpack://cui-light/./src/plugins/print/print.ts","webpack://cui-light/./src/app/observers/intersection.ts","webpack://cui-light/./src/components/intersection/intersection.ts","webpack://cui-light/./src/components/open/open.ts","webpack://cui-light/./src/components/close/close.ts","webpack://cui-light/./src/components/toggle/toggle.ts","webpack://cui-light/./src/components/resize/resize.ts","webpack://cui-light/./src/plugins/keys/observer.ts","webpack://cui-light/./src/plugins/keys/keys.ts","webpack://cui-light/./src/core/utils/aria.ts","webpack://cui-light/./src/components/dialog/dialog.ts","webpack://cui-light/./src/components/offcanvas/offcanvas.ts","webpack://cui-light/./src/components/accordion/accordion.ts","webpack://cui-light/./src/core/listeners/hover.ts","webpack://cui-light/./src/components/drop/drop.ts","webpack://cui-light/./src/plugins/click/click.ts","webpack://cui-light/./src/components/offset/offset.ts","webpack://cui-light/./src/core/utils/task.ts","webpack://cui-light/./src/components/switch/switch.ts","webpack://cui-light/./src/components/switch/switcher.ts","webpack://cui-light/./src/core/listeners/move.ts","webpack://cui-light/./src/components/float/helpers.ts","webpack://cui-light/./src/components/float/float.ts","webpack://cui-light/./src/core/animation/animators.ts","webpack://cui-light/./src/core/animation/engine.ts","webpack://cui-light/./src/components/switch/slider/animations.ts","webpack://cui-light/./src/components/switch/slider.ts","webpack://cui-light/./src/app/initializer.ts","webpack://cui-light/./src/app/managers/element.ts","webpack://cui-light/./src/app/managers/toast.ts","webpack://cui-light/./src/app/helpers/collection.ts","webpack://cui-light/./src/app/managers/collection.ts","webpack://cui-light/./src/app/managers/plugins.ts","webpack://cui-light/./src/app/builders/element.ts","webpack://cui-light/./src/app/builders/dialog.ts","webpack://cui-light/./src/app/handlers/alert.ts","webpack://cui-light/./src/app/instance.ts","webpack://cui-light/./src/app/observers/mutations.ts","webpack://cui-light/./src/index.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","is","val","typecheck","length","Array","isArray","isEmpty","getName","prefix","sleep","timeout","Promise","resolve","setTimeout","createElementFromString","htmlString","template","document","createElement","innerHTML","content","children","getRangeValue","min","max","getRangeValueOrDefault","def","isNaN","increaseValue","amount","decreaseValue","joinAttributesForQuery","attributes","join","getSystemLightMode","matchMedia","matches","getSystemPrintMode","are","calcWindowSize","width","parseAttributeString","attribute","ret","out","startsWith","endsWith","JSON","parse","jsonify","e","console","error","message","component","functionName","Date","toLocaleString","parseJsonString","trim","includes","split","forEach","sp","getOffsetTop","element","offsetTop","parseInt","getStyleValue","getOffsetLeft","offsetLeft","getIntOrDefault","integer","target","currentStyle","getComputedStyle","getPropertyValue","isInRange","getActiveClass","parseAttribute","getAttribute","isStringTrue","toLowerCase","getStringOrDefault","isString","replacePrefix","replace","generateRandomString","rand","getRandomInt","rand2","Math","floor","random","ceil","registerCuiElement","node","components","utils","$handlers","matching","hasAttribute","filter","a","getMatchingAttributes","$cuid","next","generateCUID","tagName","setAttribute","match","find","styleAppender","append","getStyle","handler","handle","counter","idx","getHandlerExtendingOrNull","fName","h","hasFunction","obj","getParentCuiElement","parent","parentElement","getChildrenHeight","height","from","child","offsetHeight","enumerateObject","callback","prop","CUID_ATTRIBUTE","CLASSES","dark","animProgress","print","active","ICONS","close","accordion","special_menu","special_fail","special_success","CSS_APP_BACKGROUND_COLORS","light","CSS_COMPONENT_BACKGROUND_COLORS","CSS_COMPONENT_BORDER_COLORS","CSS_THEMES","base","muted","accent","secondary","success","warning","SCOPE_SELECTOR","CSS_VARIABLES","fontSize","lineHeight","animationTime","animationTimeLong","animationTimeShort","colorLightAppBackground","colorLightBackground","colorLightBorder","colorLightBase","colorLightActive","colorLightMuted","colorDarkAppBackground","colorDarkBackground","colorDarkBorder","colorDarkBase","colorDarkActive","colorDarkMuted","colorAccent","colorAccentActive","colorAccentMuted","colorAccentShade","colorAccentShadeDark","colorSecondary","colorSecondaryActive","colorSecondaryMuted","colorSecondaryShade","colorSecondaryShadeDark","colorWarning","colorWarningActive","colorWarningMuted","colorWarningShade","colorWarningShadeDark","colorSuccess","colorSuccessActive","colorSuccessMuted","colorSuccessShade","colorSuccessShadeDark","colorError","colorErrorActive","colorErrorMuted","colorErrorShade","colorErrorShadeDark","inputBackground","colorShade","colorShadeDarker","colorShadeLight","colorShadeLighter","outline","borderRadius","padding","margin","scrollbarWidth","componentSpace","STATICS","logLevel","EVENTS","INSTANCE_INITIALIZED","INSTANCE_FINISHED","RESIZE","OPEN","OPENED","CLOSE","CLOSED","TOGGLE","TOGGLED","SWITCH","SWITCHED","ON_SCROLL","TARGET_CHANGE","INTERSECTION","KEYDOWN","SCROLLBY","WINDOW_CLICK","OFFSET","PROGRESS_CHANGE","PROGRESS_CHANGED","CHANGE","CHANGED","COMPONENTS_COUNTER","CuiClassAction","className","this","classList","contains","add","remove","CuiInboundAction","setLightMode","setDarkMode","getLightMode","DummyAction","CuiActionsFatory","substring","CuiActionsListFactory","map","single","CuiLoggerFactory","ErrorBase","Error","super","setPrototypeOf","ItemNotFoundError","ArgumentError","CuiInstanceInitError","CuiScrollSpyOutOfRangeError","RegisterElementError","CuiSetup","autoLightMode","scrollThreshold","resizeThreshold","plugins","init","cacheSize","CuiSetupInit","app","interaction","body","maxSize","has","update","clean","item","refresh","containsKey","clear","keys","interactions","documentElement","setPropertyIn","toCssString","type","set","colors","baseColor","mutedColor","clone","lighten","activeColor","darken","mutate","setProperty","factor","propertyName","style","bus","threshold","innerWidth","findIndex","x","push","splice","addEventListener","listener","removeEventListener","ev","diff","abs","currentSize","resizeData","current","previous","innerHeight","timestamp","now","emit","resize","all","initialSetup","setup","fromInit","cache","connect","classes","flag","CuiMediaQueryListener","mediaQuery","event","CuiScrollListener","Window","left","getLeft","top","getTop","passedThreshold","requestAnimationFrame","pageYOffset","scrollTop","pageXOffset","scrollLeft","FastDom","isScheduled","raf","writes","reads","ctx","args","createTask","schedule","tasks","task","shift","recursion","flush","rec","run","SyncInteractions","isRunning","CuiLogger","level","id","log","prepString","warn","stack","start","CuiActionsHelper","action","inTarget","outTarget","inAction","outAction","onFinish","CuiInteractionsFactory","CuiDictionary","throwOnEmptyKey","index","indexOf","CuiEventBus","emitHandler","cui","isAttached","debug","getCuid","cuid","getId","EmitHandlerBase","queue","isBusy","emitId","handleId","TaskedEventEmitHandler","executor","events","perform","promises","idMatches","execute","CuiCallbackExecutor","CuiDocumentStyleAppender","head","getElementsByTagName","text","createTextNode","appendChild","CuiKeyPressListener","singleEmit","onKeyDown","onKeyUp","code","autoLightInit","description","autoLight","setCallback","onChange","attach","detach","autoLightSetup","cls","setClasses","removeClasses","attributeName","removeAttribute","componentName","_log","isLocked","setId","activeClassName","helper","fetch","data","on","actionsHelper","prevArgs","isInitialized","onHandle","onRefresh","onRemove","CuiHandler","onInit","onUpdate","onDestroy","performAction","onMutation","mutation","observe","unobserve","records","reduce","result","addedNodes","added","removedNodes","removed","icon","CuiIconComponent","addIcon","svg","querySelector","iconStr","iconSvg","build","childNodes","insertBefore","iconElement","firstChild","svgString","scale","created","IconScaleAppender","toString","progress","getTotalLength","readStyle","onEvent","onSetProgress","emitEvent","detachEvent","strokeDashoffset","updateStyle","spinner","svgIcon","addSpinner","CuiDummyComponent","behavior","onClick","setTargets","to","by","scrollBy","preventDefault","offset","selector","link","linkAction","CuiScrollspyComponent","calculateCurrent","setCurrent","setCurrentLink","onScroll","calculateCurrentLeft","newTarget","querySelectorAll","scroll","ratio","clientHeight","clientWidth","prev","autoPrintInit","autoPrint","setPrintMode","CuiIntersectionObserver","observer","IntersectionObserver","rootMargin","disconnect","CuiIntersectionComponent","parseArguments","onIntersection","entries","entry","getAction","isIntersecting","intersectionRatio","emitIntersection","prevent","state","CuiOpenComponent","onOpen","then","activateTarget","catch","exception","finally","openable","open","shouldEmit","hasClass","setClassesAs","emitOpen","CuiCloseComponent","onClose","getTarget","onActionFinish","closable","removeClassesAs","emitClose","CuiToggleComponent","toggle","CuiResizeArgs","CuiResizeComponent","keySetup","AriaAttributes","label","attr","escClose","outClose","CuiDialogComponent","setAria","checkLockAndWarn","isAnyActive","isActive","scrollY","setClass","removeClass","scrollTo","onEscClose","onWindowClick","position","getDefaultOpenClass","getDefaultCloseClass","openCls","closeCls","CuiOffCanvasComponent","setPositionLeft","items","animation","CuiAccordionComponent","isValid","initTargets","onSwitch","mutations","queryItems","closeAllExcept","currentTarget","switch","setListener","onMouseOver","onMouseMove","onMouseOut","mouseEvent","force","invoke","isHovering","trigger","autoClose","CuiDropComponenet","onTargetHover","setTriggerEvent","onTriggerClick","findAndCloseOpenedDrop","runAutoCloseTask","clearTimeout","opened","onHoverEvent","offsetX","offsetY","CuiOffsetComponent","checkAndPerformActions","getRoot","matchesOffset","callEvent","autoRenew","canRun","stop","targets","in","links","autoTimeout","CuiSwitchComponent","onPushSwitch","getTargets","getLinks","getActiveIndex","getSwitches","setSwitchesActive","setLinkActive","setStyle","getElementHeight","startTask","record","nextIdx","getNextIndex","nextItem","performSwitchAction","sw","setLinkSwitch","CuiSwitcherComponent","setEvents","removeEvents","el","onListItemClick","onClickEvent","onMouseDown","onMouseUp","onTouchStart","onTouchEnd","onTouchMove","publishMouseEvent","publishTouchEvent","cancelable","clientX","y","clientY","moveX","movementX","moveY","movementY","touch","touches","changedTouches","BasePositionCalculator","diffX","diffY","BaseResizeCalculator","CuiFloatComponent","onMove","peform","move","newWidth","newHeight","calculate","fitsWindow","newX","newY","offsetWidth","OpacityAnimator","lenght","rtl","opacity","PropertyAnimator","unit","createValue","TransformAnimator","undefined","props","cur","buildSingle","transform","CuiAnimationEngine","cleanOnFinish","animators","revert","animationProgress","shouldCalcRevert","animateAsync","initialProgress","pr","currProgress","callUpdate","endAnimation","reverted","animator","CuiSwipeAnimationEngine","shouldCleanOnFinish","setElement","setAnimators","animate","PushAnimationDefnition","translateX","right","CuiSliderComponent","setOnFinish","onAnimationFinish","back","finish","setProps","errorOccured","settings","appPrefix","icons","initializer","pluginList","componentList","elements","attributeValue","eventName","lock","unlock","delay","change","openClass","animationClass","closeClass","ids","cuiElement","toastElement","textContent","currentElement","nextElement","animIn","animOut","count","newIndex","animClassIn","animClassOut","duration","addAnimationClass","setFinalClasses","len","setElements","setToggle","check","newIdx","getCurrentIndex","verifyIndex","setCurrentWithAnimation","plugin","tag","reverse","switches","title","headerBuilder","titleElement","getPrefixedString","appendChildrens","dialog","setAttributes","container","str","onYes","onNo","onCancel","onOk","closeStr","getElementById","updateElement","arg","dialogBuilder","createHeader","createBody","createFooter","MutationObserver","mutatedAttributes","initElements","setComponents","setPlugins","show","nodes","detachAll","CuiMutationObserver","subtree","childList","attributeFilter","mutationCallback","handleChildListMutation","addedLen","removedLen","handleAddedNodes","handleRemovedNodes","childrens","hasChildNodes","destroySingleElement","destroy","CuiComponentMutationHandler","CUI_LIGHT_VERSION","cuiInit"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cui-light\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cui-light\"] = factory();\n\telse\n\t\troot[\"cui-light\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 27);\n","import { CuiLightMode, CuiWindowSize } from \"./types\";\r\nimport { ArgumentError, RegisterElementError } from \"../models/errors\";\r\nimport { ICuiComponent, CuiElement } from \"../models/interfaces\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { COMPONENTS_COUNTER, CUID_ATTRIBUTE } from \"./statics\";\r\n\r\n/**\r\n * Checks if value is defined an is not null\r\n * Additionally with type check it can check value if it is not empty string or collection or object\r\n * \r\n * @param val - value\r\n * @param typecheck - default true - additional check whether value is not empty (string, collection, object)\r\n * @returns whether value passed all conditions\r\n */\r\nexport function is(val: any, typecheck: boolean = true): boolean {\r\n    if (typeof val !== 'undefined' && val !== null) {\r\n        if (!typecheck) {\r\n            return true;\r\n        } else {\r\n            return !isEmpty(val)\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Checks if value is empty string, array or object\r\n *\r\n *\r\n * @param val - value\r\n * @returns whether value passed all conditions\r\n */\r\nexport function isEmpty(val: any): boolean {\r\n    if (typeof val === \"string\") {\r\n        return val.length === 0\r\n    }\r\n    if (typeof val === \"boolean\") {\r\n        return val;\r\n    }\r\n    else if (Array.isArray(val)) {\r\n        return val.length === 0\r\n    }\r\n    return false\r\n}\r\n\r\nexport function getName(prefix: string, name: string) {\r\n    if (!is(prefix) || !is(name)) {\r\n        throw new ArgumentError(\"Missing argument value\")\r\n    }\r\n    return `${prefix}-${name}`\r\n}\r\n\r\nexport function sleep(timeout: number): Promise<boolean> {\r\n    return new Promise(resolve => setTimeout(() => {\r\n        resolve(true)\r\n    }, timeout));\r\n}\r\n\r\n/**\r\n * Creates proper html element from given string\r\n * @param htmlString - string containing html\r\n */\r\nexport function createElementFromString(htmlString: string): Element {\r\n    if (!is(htmlString)) {\r\n        return null;\r\n    }\r\n    let template = document.createElement('template')\r\n    template.innerHTML = htmlString\r\n    return template.content.children.length > 0 ? template.content.children[0] : null;\r\n}\r\n\r\nexport function getMatchingAttribute(element: any, attributes: string[]): string {\r\n    let attr = null;\r\n    let len = attributes.length;\r\n    for (let i = 0; i < len; i++) {\r\n        let attribute = attributes[i];\r\n        if (element.hasAttribute(attribute)) {\r\n            attr = attribute\r\n            break;\r\n        }\r\n    }\r\n    return attr;\r\n}\r\n\r\nexport function getMatchingAttributes(element: any, attributes: string[]): string[] {\r\n    if (!element || !is(element.hasAttribute)) {\r\n        return null;\r\n    }\r\n    return attributes.filter(a => {\r\n        return element.hasAttribute(a);\r\n    });\r\n}\r\n\r\nexport function getRangeValue(value: number, min: number, max: number) {\r\n    if (value < min) {\r\n        return min;\r\n    } else if (value > max) {\r\n        return max;\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function getRangeValueOrDefault(value: number, min: number, max: number, def: number) {\r\n    if (value === null || typeof value === 'undefined' || isNaN(value)) {\r\n        return def;\r\n    }\r\n    return getRangeValue(value, min, max)\r\n}\r\n\r\nexport function increaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value + (value * amount);\r\n}\r\n\r\nexport function decreaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value - (value * amount);\r\n}\r\n\r\nexport function clone(object: any): any {\r\n    if (!is(object)) {\r\n        return null;\r\n    }\r\n    return Object.assign({}, object);\r\n}\r\n\r\nexport function getSingleColorRatio(first: number, second: number, max: number): number {\r\n    return Math.abs(((first - second) / max) * 100)\r\n}\r\n\r\n/**\r\n * Creates string containg css selector for array of attributes\r\n * @param attributes - attributes values\r\n */\r\nexport function joinAttributesForQuery(attributes: string[]): string {\r\n    if (!is(attributes)) {\r\n        return \"\"\r\n    }\r\n    return `[${attributes.join('],[')}]`\r\n}\r\n\r\n/**\r\n * Checks light system light mode\r\n * @returns Light Mode - dark/light\r\n */\r\nexport function getSystemLightMode(): CuiLightMode {\r\n    return window.matchMedia &&\r\n        window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n}\r\n\r\n/**\r\n * Check print mode in the browser window\r\n * @returns true if window is displayed in print mode\r\n */\r\nexport function getSystemPrintMode(): boolean {\r\n    return window.matchMedia &&\r\n        window.matchMedia('print').matches;\r\n}\r\n\r\n/**\r\n * Verifies whether attributes exist and have some values\r\n * @param attributes attributes list\r\n */\r\nexport function are(...attributes: any[]): boolean {\r\n    if (!is(attributes)) {\r\n        return false\r\n    }\r\n    let c = attributes.length;\r\n    for (let i = 0; i < c; i++) {\r\n        if (!is(attributes[i])) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function calcWindowSize(width: number): CuiWindowSize {\r\n    if (width <= 640) {\r\n        return 'small';\r\n    } else if (width > 640 && width <= 960) {\r\n        return \"medium\"\r\n    } else if (width > 960 && width <= 1200) {\r\n        return \"large\"\r\n    }\r\n    return 'xlarge';\r\n}\r\n\r\n/**\r\n * Creates object from string.\r\n * Supported syntaxes are:\r\n * - JSON\r\n * - single value\r\n * - key:value,value;key=value\r\n * \r\n * @param attribute - attribute value\r\n */\r\nexport function parseAttributeString(attribute: string): any {\r\n    let ret: any = parseJsonString(attribute.trim())\r\n\r\n    if (!is(ret)) {\r\n        if (!attribute.includes(';') && !attribute.includes(':')) {\r\n            ret = attribute;\r\n        } else {\r\n            ret = {}\r\n            attribute.split(';').forEach(val => {\r\n                let sp = val.split(':')\r\n                if (sp.length === 2) {\r\n                    ret[sp[0].trim()] = sp[1].trim()\r\n                }\r\n            })\r\n        }\r\n    }\r\n    return ret\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n* String must start with { and end with }\r\n *\r\n * @param attribute - attribute value\r\n * @returns object if string passes test, null otherwise\r\n */\r\n\r\nexport function parseJsonString(attribute: string): any | null {\r\n    let out = null;\r\n    if (is(attribute) && attribute.startsWith('{') && attribute.endsWith('}')) {\r\n        try {\r\n            out = jsonify(attribute);\r\n        } catch (e) {\r\n            console.error(prepLogString(\"An exception occured\", 'Functions', 'parseJsonString'), e)\r\n        }\r\n        return out;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n * @param attribute - JSON string\r\n */\r\nexport function jsonify(attribute: string): any {\r\n    return attribute && attribute.length > 0 ? JSON.parse(attribute) : {}\r\n}\r\n\r\nexport function getOffsetTop(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetTop - parseInt(getStyleValue(element, 'margin-top')) - parseInt(getStyleValue(element, 'padding-top')) - parseInt(getStyleValue(element, 'border-top-width'))\r\n    return val < 0 ? element.offsetTop : val;\r\n}\r\n\r\nexport function getOffsetLeft(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetLeft - parseInt(getStyleValue(element, 'margin-left')) - parseInt(getStyleValue(element, 'padding-left')) - parseInt(getStyleValue(element, 'border-left-width'))\r\n    return val < 0 ? element.offsetLeft : val;\r\n}\r\n\r\nexport function getIntOrDefault(value: any, def: number): number {\r\n    let integer = parseInt(value);\r\n    return isNaN(integer) ? def : integer;\r\n}\r\n\r\nexport function getStyleValue(target: any, property: string): any {\r\n    if (!is(target) || !is(property)) {\r\n        return null;\r\n    }\r\n    if (target.currentStyle) {\r\n        return target.currentStyle[property];\r\n    } else if (window.getComputedStyle) {\r\n        return window.getComputedStyle(target, null).getPropertyValue(property)\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function prepLogString(message: string, component: string, functionName?: string) {\r\n    return `[${new Date().toLocaleString()}][${component ?? \"-\"}][${functionName ?? '-'}][${message}]`\r\n}\r\n\r\nexport function isInRange(value: number, min: number, max: number): boolean {\r\n    return is(value) && value >= min && value <= max;\r\n}\r\n\r\nexport function getActiveClass(prefix: string) {\r\n    return `${prefix ?? \"\"}-active`;\r\n}\r\n\r\nexport function parseAttribute(element: Element, attribute: string): any {\r\n    return are(element, attribute) ? parseAttributeString(element.getAttribute(attribute)) : null;\r\n}\r\n\r\n\r\n/**\r\n *  Checks whether string value contains synonym of true\r\n * @param value - string to check\r\n */\r\nexport function isStringTrue(value: string): boolean {\r\n    return is(value) ? ['y', 't', 'true', 'yes'].includes(value.toLowerCase()) : false\r\n}\r\n\r\nexport function boolStringOrDefault(prop: any, def: boolean): boolean {\r\n    return is(prop) ? isStringTrue(prop) : def;\r\n}\r\n\r\nexport function getStringOrDefault(value: any, def: string) {\r\n    return is(value) ? value.toLowerCase() : def;\r\n}\r\n\r\n/**\r\n * Checks whether device supports touch\r\n */\r\nexport function isTouchSupported(): boolean {\r\n    return ('ontouchstart' in window) ||\r\n        (navigator.maxTouchPoints > 0) ||\r\n        (navigator.msMaxTouchPoints > 0);\r\n}\r\n\r\n/**\r\n * Checks whether value is type of string\r\n * @param {any} value - value to be checked\r\n */\r\nexport function isString(value: any): boolean {\r\n    return typeof value === 'string';\r\n}\r\n\r\n\r\n/**\r\n * Replaces mask {prefix} with actual value in the string\r\n * @param {string} value - text containg a mask\r\n * @param {string} prefix - value to be put in place of mask\r\n */\r\nexport function replacePrefix(value: string, prefix: string): string {\r\n    return !is(value) ? value : value.replace(\"{prefix}\", prefix ?? \"\");\r\n}\r\n\r\n/**\r\n * Generates identifier for Cui element\r\n * \r\n * @param element - Cui element selector\r\n * @returns generated identifier\r\n */\r\nexport function generateCUID(element?: string) {\r\n    let starter = is(element) ? element : \"cui-element\"\r\n    return `${starter}-${COMPONENTS_COUNTER.next().value}`;\r\n}\r\n\r\n/**\r\n * Generates random string\r\n */\r\nexport function generateRandomString(): string {\r\n    let rand = getRandomInt(1, 1000)\r\n    let rand2 = getRandomInt(1, 100)\r\n    return `${Math.floor(Math.random() * rand2)}-${Math.floor(rand)}`;\r\n}\r\n/**\r\n * Generates random integer\r\n * @param min - min number\r\n * @param max - max number\r\n * @returns random integer\r\n */\r\nexport function getRandomInt(min: number, max: number): number {\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n/**\r\n * Registers Element as Cui element, initializes handlers, sets component style to document header and sets $cuid\r\n * @param {any} node - document node\r\n * @param {ICuiComponent[]} components -supported components array\r\n * @param {string[]} attributes - supported attributes array\r\n * @param {CuiUtils} utils - Cui Utils instance\r\n */\r\nexport function registerCuiElement(node: any, components: ICuiComponent[], attributes: string[], utils: CuiUtils) {\r\n    let element = node as CuiElement;\r\n    element.$handlers = {};\r\n    let matching: string[] = getMatchingAttributes(node, attributes)\r\n    if (is(matching)) {\r\n        element.$cuid = node.hasAttribute(CUID_ATTRIBUTE) ? node.getAttribute(CUID_ATTRIBUTE) : generateCUID(node.tagName)\r\n        node.setAttribute(CUID_ATTRIBUTE, element.$cuid);\r\n        matching.forEach(match => {\r\n            let component = components.find(c => { return c.attribute === match });\r\n            if (is(component)) {\r\n                try {\r\n                    utils.styleAppender.append(component.getStyle());\r\n                    let handler = component.get(node, utils);\r\n                    element.$handlers[component.attribute] = handler;\r\n                    element.$handlers[component.attribute].handle(parseAttribute(node, component.attribute));\r\n                } catch (e) {\r\n                    throw new RegisterElementError(e.message);\r\n                }\r\n            }\r\n        })\r\n\r\n    }\r\n}\r\n\r\nexport function* counter() {\r\n    let idx = 0;\r\n    while (true) {\r\n        let reset = yield idx++;\r\n        if (reset || idx > 200000) {\r\n            idx = 0\r\n        }\r\n    }\r\n}\r\n\r\nexport function getHandlerExtendingOrNull<T>(target: CuiElement, fName: string): T {\r\n    if (!is(target.$handlers)) {\r\n        return null;\r\n    }\r\n\r\n    for (let handler in target.$handlers) {\r\n\r\n        if (target.$handlers.hasOwnProperty(handler)) {\r\n            let h: any = target.$handlers[handler];\r\n            if (hasFunction(h, fName))\r\n                return h;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Checks whether property exists on the object and it is a function\r\n * @param obj - object\r\n * @param fName - property name\r\n */\r\nexport function hasFunction(obj: any, fName: string) {\r\n    return is(obj[fName]) && typeof obj[fName] === 'function'\r\n}\r\n\r\n/**\r\n * Gets closest parent element which is a cUI element\r\n * @param element \r\n */\r\nexport function getParentCuiElement(element: Element): Element {\r\n    let parent = element.parentElement as any;\r\n    return is(parent) && is(parent.$cuid) ? parent : getParentCuiElement(parent);\r\n}\r\n\r\n/**\r\n * Calculates element height by calculating childerns heights\r\n * @param element\r\n */\r\nexport function getChildrenHeight(element: Element): number {\r\n    let height: number = 0;\r\n    if (!element) {\r\n        return -1;\r\n    }\r\n    Array.from(element.children).forEach((child: HTMLElement) => {\r\n        height += child.offsetHeight;\r\n    })\r\n    return height > 0 ? height + 2 : height;\r\n}\r\n\r\nexport function enumerateObject<T>(object: T, callback: (property: string, value: any) => void) {\r\n    if (!are(object, callback)) {\r\n        return;\r\n    }\r\n    for (let prop in object) {\r\n        if (object.hasOwnProperty(prop)) {\r\n            callback(prop, object[prop]);\r\n        }\r\n    }\r\n}\r\n\r\nexport function round(value: number, decimalPlaces: number): number {\r\n    const multiplier = 10 ** decimalPlaces;\r\n    const semiValue = value * multiplier;\r\n    return Math.floor(value) / multiplier;\r\n}","import { CuiLogLevel } from \"./types\";\r\nimport { CuiColorPair } from \"../models/colors\";\r\nimport { counter } from \"./functions\";\r\nexport const CUID_ATTRIBUTE = \"cuid\";\r\n\r\nexport const CLASSES = {\r\n    dark: 'dark',\r\n    animProgress: 'animation-progress',\r\n    print: 'print',\r\n    active: 'active'\r\n}\r\n\r\nexport const ICONS: any = {\r\n    close: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 1.9999999,1.9999999 18,18\\\"></path><path d=\\\"M 18,1.9999999 1.9999999,18\\\"></path></svg>\",\r\n    accordion: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 5.0000475,7.4490018 10.000024,12.551028 15,7.4490018\\\"></path></svg>\",\r\n    special_menu: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path class=\\\"menu_handle_2\\\" d=\\\"M 1,10 H 19\\\"></path><path class=\\\"menu_handle_1\\\" d=\\\"M 1,4.8571429 H 19\\\"></path><path  class=\\\"menu_handle_3\\\" d=\\\"M 1,15.142857 H 19\\\"></path></svg>\",\r\n    special_fail: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-fail\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7.000001 A 43,43 0 0 1 92.999999,50 43,43 0 0 1 50,92.999999 43,43 0 0 1 7.0000011,50 43,43 0 0 1 50,7.000001 Z\\\"></path><path class=\\\"arm_1\\\" d=\\\"M 28.536809,28.536809 71.342023,71.342023\\\"></path><path class=\\\"arm_2\\\" d=\\\"M 71.342023,28.536809 28.536809,71.342023\\\"></path></svg>\",\r\n    special_success: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-success\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7 A 43,43 0 0 1 93,50 43,43 0 0 1 50,93 43,43 0 0 1 7,50 43,43 0 0 1 50,7 Z\\\"></path><path class=\\\"arm\\\" d=\\\"M 22.988405,48.234784 36.946233,72.410453 75.516456,33.84023\\\"></path></svg>\",\r\n};\r\n\r\nexport const COLORS = ['red', 'green', 'blue', 'alpha']\r\n\r\nexport const CSS_APP_BACKGROUND_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-app-background',\r\n    dark: '--cui-color-dark-app-background'\r\n}\r\n\r\nexport const CSS_COMPONENT_BACKGROUND_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-background',\r\n    dark: '--cui-color-dark-background '\r\n}\r\n\r\nexport const CSS_COMPONENT_BORDER_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-border',\r\n    dark: '--cui-color-dark-border'\r\n}\r\n\r\nexport const CSS_THEMES = {\r\n    light: {\r\n        base: '--cui-color-light-base',\r\n        muted: '--cui-color-light-muted',\r\n        active: '--cui-color-light-active'\r\n    },\r\n    dark: {\r\n        base: '--cui-color-dark-base',\r\n        muted: '--cui-color-dark-muted',\r\n        active: '--cui-color-dark-active'\r\n    },\r\n    accent: {\r\n        base: '--cui-color-primary',\r\n        muted: '--cui-color-primary-muted',\r\n        active: '--cui-color-primary-active'\r\n    },\r\n    secondary: {\r\n        base: '--cui-color-secondary',\r\n        muted: '--cui-color-secondary-muted',\r\n        active: '--cui-color-secondary-active'\r\n    },\r\n    success: {\r\n        base: '--cui-color-success',\r\n        muted: '--cui-color-success-muted',\r\n        active: '--cui-color-success-active'\r\n    },\r\n    warning: {\r\n        base: '--cui-color-warning',\r\n        muted: '--cui-color-warning-muted',\r\n        active: '--cui-color-warning-active'\r\n    },\r\n    error: {\r\n        base: '--cui-color-error',\r\n        muted: '--cui-color-error-muted',\r\n        active: '--cui-color-error-active'\r\n    }\r\n}\r\n\r\nexport const SCOPE_SELECTOR = \":scope \";\r\n\r\nexport const CSS_VARIABLES: any = {\r\n    fontSize: \"--{prefix}-font-size\",\r\n    lineHeight: \"--{prefix}-line-height\",\r\n    animationTime: \"--{prefix}-animation-time\",\r\n    animationTimeLong: \"--{prefix}-animation-time-long\",\r\n    animationTimeShort: \"--{prefix}-animation-time-short\",\r\n    colorLightAppBackground: \"--{prefix}-color-light-app-background\",\r\n    colorLightBackground: \"--{prefix}-color-light-background\",\r\n    colorLightBorder: \"--{prefix}-color-light-border\",\r\n    colorLightBase: \"--{prefix}-color-light-base\",\r\n    colorLightActive: \"--{prefix}-color-light-active\",\r\n    colorLightMuted: \"--{prefix}-color-light-muted\",\r\n    colorDarkAppBackground: \"--{prefix}-color-dark-app-background\",\r\n    colorDarkBackground: \"--{prefix}-color-dark-background\",\r\n    colorDarkBorder: \"--{prefix}-color-dark-border\",\r\n    colorDarkBase: \"--{prefix}-color-dark-base\",\r\n    colorDarkActive: \"--{prefix}-color-dark-active\",\r\n    colorDarkMuted: \"--{prefix}-color-dark-muted\",\r\n    colorAccent: \"--{prefix}-color-primary\",\r\n    colorAccentActive: \"--{prefix}-color-primary-active\",\r\n    colorAccentMuted: \"--{prefix}-color-primary-muted\",\r\n    colorAccentShade: \"--{prefix}-color-primary-shade\",\r\n    colorAccentShadeDark: \"--{prefix}-color-primary-shade-dark\",\r\n    colorSecondary: \"--{prefix}-color-secondary\",\r\n    colorSecondaryActive: \"--{prefix}-color-secondary-active\",\r\n    colorSecondaryMuted: \"--{prefix}-color-secondary-muted\",\r\n    colorSecondaryShade: \"--{prefix}-color-secondary-shade\",\r\n    colorSecondaryShadeDark: \"--{prefix}-color-secondary-shade-dark\",\r\n    colorWarning: \"--{prefix}-color-warning\",\r\n    colorWarningActive: \"--{prefix}-color-warning-active\",\r\n    colorWarningMuted: \"--{prefix}-color-warning-muted\",\r\n    colorWarningShade: \"--{prefix}-color-warning-shade\",\r\n    colorWarningShadeDark: \"--{prefix}-color-warning-shade-dark\",\r\n    colorSuccess: \"--{prefix}-color-success\",\r\n    colorSuccessActive: \"--{prefix}-color-success-active\",\r\n    colorSuccessMuted: \"--{prefix}-color-success-muted\",\r\n    colorSuccessShade: \"--{prefix}-color-success-shade\",\r\n    colorSuccessShadeDark: \"--{prefix}-color-success-shade-dark\",\r\n    colorError: \"--{prefix}-color-error\",\r\n    colorErrorActive: \"--{prefix}-color-error-active\",\r\n    colorErrorMuted: \"--{prefix}-color-error-muted\",\r\n    colorErrorShade: \"--{prefix}-color-error-shade\",\r\n    colorErrorShadeDark: \"--{prefix}-color-error-shade-dark\",\r\n    inputBackground: \"--{prefix}-input-background-color\",\r\n    colorShade: \"--{prefix}-color-shade\",\r\n    colorShadeDarker: \"--{prefix}-color-shade-darker\",\r\n    colorShadeLight: \"--{prefix}-color-shade-light\",\r\n    colorShadeLighter: \"--{prefix}-color-shade-light-lighter\",\r\n    outline: \"--{prefix}-outline\",\r\n    borderRadius: \"--{prefix}-border-radius\",\r\n    padding: \"--{prefix}-padding\",\r\n    margin: \"--{prefix}-margin\",\r\n    scrollbarWidth: \"--{prefix}-scrollbar-width\",\r\n    componentSpace: \"--{prefix}-component-space\"\r\n}\r\n\r\n\r\nexport class STATICS {\r\n    static logLevel: CuiLogLevel = 'none';\r\n    static prefix: string = 'cui';\r\n}\r\n\r\nexport const EVENTS = {\r\n    INSTANCE_INITIALIZED: 'instance-initialized',\r\n    INSTANCE_FINISHED: 'instance-finished',\r\n    RESIZE: \"resize\",\r\n    OPEN: \"open\",\r\n    OPENED: \"opened\",\r\n    CLOSE: \"close\",\r\n    CLOSED: \"closed\",\r\n    TOGGLE: \"toggle\",\r\n    TOGGLED: 'toggled',\r\n    SWITCH: \"switch\",\r\n    SWITCHED: \"switched\",\r\n    ON_SCROLL: \"scroll\",\r\n    TARGET_CHANGE: 'targetchange',\r\n    INTERSECTION: 'intersection',\r\n    KEYDOWN: 'keydown',\r\n    SCROLLBY: 'scrollby',\r\n    WINDOW_CLICK: 'windowclick',\r\n    OFFSET: 'offset',\r\n    PROGRESS_CHANGE: \"progresschange\",\r\n    PROGRESS_CHANGED: \"progresschanged\",\r\n    CHANGE: \"change\",\r\n    CHANGED: \"changed\"\r\n}\r\n\r\nexport const OBSERVABLE_SCROLL = \"SCROLL\";\r\nexport const OBSERVABLE_INTERSECTION = \"INTERSECTION\";\r\nexport const COMPONENTS_COUNTER = counter();","export * from \"./models/colors\";\r\nexport * from \"./models/errors\";\r\nexport * from \"./models/events\";\r\nexport * from \"./models/interfaces\";\r\nexport * from \"./models/setup\";\r\nexport * from \"./models/utils\";\r\n// Utils\r\nexport * from \"./utils/actions\";\r\nexport * from \"./utils/dictionary\";\r\nexport * from \"./utils/functions\";\r\nexport * from \"./utils/interactions\";\r\nexport * from \"./utils/logger\";\r\nexport * from \"./utils/types\";\r\nexport * from \"./utils/statics\";\r\n\r\nexport * from \"./styles/appender\";\r\n// Factories\r\nexport * from \"./factories/logger\";\r\nexport * from \"./factories/interactions\";\r\n//Helpers\r\nexport * from \"./helpers/helpers\";\r\n// BUS\r\nexport * from \"./bus/executors\";\r\nexport * from \"./bus/handlers\";\r\nexport * from \"./bus/bus\";\r\n// Listeners\r\nexport * from \"./listeners/keys\";\r\nexport * from \"./listeners/media\";\r\nexport * from \"./listeners/scroll\";\r\n","import { is, are } from \"./functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\n\r\nexport interface ICuiComponentAction {\r\n    add(element: Element, utils?: CuiUtils): void;\r\n    remove(element: Element, utils?: CuiUtils): void;\r\n    toggle(element: Element, utils?: CuiUtils): void;\r\n}\r\n\r\nexport class CuiClassAction implements ICuiComponentAction {\r\n    #class: string;\r\n\r\n    constructor(className: string) {\r\n        this.#class = className;\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && !element.classList.contains(this.#class)) {\r\n            element.classList.add(this.#class);\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && element.classList.contains(this.#class)) {\r\n            element.classList.remove(this.#class);\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class)) {\r\n            if (!element.classList.contains(this.#class)) {\r\n                element.classList.remove(this.#class);\r\n            } else {\r\n                element.classList.add(this.#class);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiInboundAction implements ICuiComponentAction {\r\n    #name: string;\r\n\r\n    constructor(name: string) {\r\n        this.#name = name;\r\n    }\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n            case 'light-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n        }\r\n    }\r\n\r\n    private setDarkMode(utils: CuiUtils) {\r\n        if (utils.getLightMode() === 'dark') {\r\n            utils.setLightMode('light')\r\n        } else {\r\n            utils.setLightMode('dark')\r\n        }\r\n    }\r\n}\r\n\r\nexport class DummyAction implements ICuiComponentAction {\r\n    constructor() {\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n    }\r\n}\r\n\r\nexport class CuiActionsFatory {\r\n    public static get(value: string): ICuiComponentAction {\r\n        if (!is(value)) {\r\n            return new DummyAction();\r\n        }\r\n        let indicator = value[0];\r\n        switch (indicator) {\r\n            case '.':\r\n                return new CuiClassAction(value.substring(1));\r\n            case '~':\r\n                return new CuiInboundAction(value.substring(1))\r\n            default:\r\n                return new CuiClassAction(value);\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiActionsListFactory {\r\n    public static get(value: string): ICuiComponentAction[] {\r\n        if (!is(value)) {\r\n            return [];\r\n        }\r\n        const split = value.split(',');\r\n        return split.map(single => {\r\n            return CuiActionsFatory.get(single.trim());\r\n        })\r\n    }\r\n}","import { CuiLogger } from \"../utils/logger\";\r\nimport { CuiLogLevel } from \"../utils/types\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\nimport { STATICS } from \"../utils/statics\";\r\n\r\n/**\r\n * \r\n */\r\nexport class CuiLoggerFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param name - component name\r\n     */\r\n    public static get(name: string, logLevel?: CuiLogLevel): ICuiLogger {\r\n        return new CuiLogger(name, logLevel ?? STATICS.logLevel)\r\n    }\r\n}","export class ErrorBase extends Error {\r\n    constructor(name: string, message?: string,) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport class ItemNotFoundError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ItemNotFoundError\", message);\r\n    }\r\n}\r\n\r\nexport class ArgumentError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiBusError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiInstanceInitError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiInstanceInitError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiScrollSpyOutOfRangeError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiScrollSpyOutOfRangeError\", message);\r\n    }\r\n}\r\n\r\n\r\nexport class RegisterElementError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"RegisterElementError\", message);\r\n    }\r\n}\r\n","import { CuiLogLevel, CuiInteractionsType } from \"../utils/types\";\r\nimport { CuiColorSet } from \"./colors\";\r\n\r\ninterface CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n}\r\n\r\nexport class CuiSetup implements CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    plugins: any;\r\n\r\n    constructor() {\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.plugins = {};\r\n    }\r\n\r\n    fromInit(init: CuiSetupInit): CuiSetup {\r\n        this.prefix = init.prefix;\r\n        this.logLevel = init.logLevel;\r\n        this.cacheSize = init.cacheSize;\r\n        this.autoLightMode = init.autoLightMode;\r\n        this.animationTime = init.animationTime;\r\n        this.animationTimeShort = init.animationTimeShort;\r\n        this.animationTimeLong = init.animationTimeLong;\r\n        this.scrollThreshold = init.scrollThreshold;\r\n        this.resizeThreshold = init.resizeThreshold;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiSetupInit implements CuiSetupCommon {\r\n    prefix?: string;\r\n    app?: string;\r\n    interaction?: CuiInteractionsType;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n    root: HTMLElement;\r\n\r\n    constructor() {\r\n        this.prefix = 'cui';\r\n        this.app = '$cui';\r\n        this.logLevel = 'warning';\r\n        this.interaction = 'async';\r\n        this.animationTime = 300;\r\n        this.animationTimeShort = 150;\r\n        this.animationTimeLong = 500;\r\n        this.cacheSize = 500;\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.root = document.body;\r\n    }\r\n}","import { ICuiDictionary, CuiCachable, ICuiManager } from \"../../core/models/interfaces\";\r\nimport { CuiDictionary } from \"../../core/utils/dictionary\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiCacheManager implements ICuiManager<CuiCachable> {\r\n    #cache: ICuiDictionary<CuiCachable>;\r\n    #maxSize: number;\r\n    constructor(maxSize?: number) {\r\n        this.#cache = new CuiDictionary<CuiCachable>();\r\n        this.#maxSize = maxSize ?? 500;\r\n    }\r\n    put(key: string, element: CuiCachable): void {\r\n        if (!is(key)) return;\r\n        if (this.has(key)) {\r\n            this.#cache.update(key, element);\r\n            return;\r\n        }\r\n        this.clean();\r\n        this.#cache.add(key, element);\r\n    }\r\n\r\n    get(key: string): CuiCachable {\r\n        if (!is(key)) return null;\r\n        if (this.has(key)) {\r\n            let item = this.#cache.get(key);\r\n            if (item.refresh()) {\r\n                return item;\r\n            }\r\n            this.#cache.remove(key);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    has(key: string): boolean {\r\n        return is(key) ? this.#cache.containsKey(key) : false;\r\n    }\r\n\r\n    remove(key: string): boolean {\r\n        if (!is(key)) return false;\r\n        if (this.has(key)) {\r\n            this.#cache.remove(key);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    clear(): void {\r\n        this.#cache.clear();\r\n    }\r\n\r\n    private clean() {\r\n        if (this.#cache.keys().length >= this.#maxSize) {\r\n            this.#cache.remove(this.#cache.keys()[0]);\r\n        }\r\n    }\r\n}\r\n\r\n","import { CuiColorSetType } from \"../../core/utils/types\";\r\nimport { is, getRangeValue, are } from \"../../core/utils/functions\";\r\nimport { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { CuiColor, CuiColorSet } from \"../../core/models/colors\";\r\nimport { CSS_APP_BACKGROUND_COLORS, CSS_COMPONENT_BACKGROUND_COLORS, CSS_COMPONENT_BORDER_COLORS, CSS_THEMES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiInstanceColorHandler {\r\n    #root: HTMLElement;\r\n    #interactions: IUIInteractionProvider;\r\n    #LIGHTEN_FACTOR: number = 15;\r\n    #DARKEN_FACTOR: number = 15;\r\n\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#root = document.documentElement;\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    setAppBackground(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_APP_BACKGROUND_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_APP_BACKGROUND_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setComponentBackground(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_COMPONENT_BACKGROUND_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_COMPONENT_BACKGROUND_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setBordersColors(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_COMPONENT_BORDER_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_COMPONENT_BORDER_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setColor(type: CuiColorSetType, set: CuiColorSet) {\r\n        const colors = CSS_THEMES[type];\r\n        const baseColor = set.base;\r\n        if (!is(colors) || !is(baseColor)) {\r\n            return\r\n        }\r\n        const mutedColor = set.muted ?? baseColor.clone().lighten(this.#LIGHTEN_FACTOR);\r\n        const activeColor = set.active ?? baseColor.clone().darken(this.#DARKEN_FACTOR);\r\n\r\n        this.#interactions.mutate(() => {\r\n            this.setProperty(colors.base, baseColor.toCssString());\r\n            this.setProperty(colors.active, activeColor.toCssString());\r\n            this.setProperty(colors.muted, mutedColor.toCssString());\r\n        }, this)\r\n\r\n    }\r\n\r\n    setLightenFactor(factor: number) {\r\n        this.#LIGHTEN_FACTOR = getRangeValue(factor, 0, 100);\r\n    }\r\n\r\n    setDarkenFactor(factor: number) {\r\n        this.#DARKEN_FACTOR = getRangeValue(factor, 0, 100);\r\n    }\r\n\r\n    setProperty(propertyName: string, value: string) {\r\n        this.#root.style.setProperty(propertyName, value);\r\n    }\r\n\r\n    setPropertyIn(propertyName: string, value: string) {\r\n        if (!are(value, propertyName)) {\r\n            return;\r\n        }\r\n        this.#interactions.mutate(this.setProperty, this, propertyName, value)\r\n    }\r\n}","import { CuiWindowSize } from \"../../core/utils/types\";\r\nimport { calcWindowSize } from \"../../core/utils/functions\";\r\nimport { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport interface ICuiResizable {\r\n    resize(data: CuiResizeData): Promise<boolean>;\r\n}\r\n\r\nexport interface ICuiResizableObserver {\r\n    observe(target: ICuiResizable): void;\r\n    unobserve(target: ICuiResizable): void;\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport interface CuiResizeData {\r\n    current: CuiWindowSize;\r\n    previous: CuiWindowSize;\r\n    width: number;\r\n    height: number;\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiResizeObserver implements ICuiResizableObserver {\r\n\r\n    #items: ICuiResizable[];\r\n    #promises: Promise<boolean>[];\r\n    #prevYValue: number;\r\n    #inProgress: boolean;\r\n    #previousSize: CuiWindowSize;\r\n    #threshold: number;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus, threshold?: number) {\r\n        this.#items = [];\r\n        this.#promises = [];\r\n        this.#prevYValue = window.innerWidth;\r\n        this.#inProgress = false;\r\n        this.#previousSize = calcWindowSize(window.innerWidth)\r\n        this.#threshold = threshold ?? 0;\r\n        this.#bus = bus;\r\n    }\r\n\r\n    observe(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx < 0) {\r\n            this.#items.push(target);\r\n        }\r\n    }\r\n\r\n    unobserve(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx >= 0) {\r\n            this.#items.splice(idx, 1)\r\n        }\r\n    }\r\n    connect(): void {\r\n        window.addEventListener('resize', this.listener.bind(this))\r\n    }\r\n\r\n    disconnect(): void {\r\n        window.removeEventListener('resize', this.listener.bind(this))\r\n    }\r\n\r\n    private listener(ev: UIEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true\r\n        const diff = window.innerWidth - this.#prevYValue;\r\n\r\n        if (Math.abs(diff) >= this.#threshold) {\r\n            const currentSize = calcWindowSize(window.innerWidth);\r\n            if (currentSize !== this.#previousSize) {\r\n                const resizeData: CuiResizeData = {\r\n                    current: currentSize,\r\n                    previous: this.#previousSize,\r\n                    width: window.innerWidth,\r\n                    height: window.innerHeight,\r\n                    timestamp: Date.now()\r\n                };\r\n                this.#bus.emit(EVENTS.RESIZE, null, resizeData)\r\n                if (this.#items.length > 0) {\r\n                    this.#promises = [];\r\n                    this.#items.forEach(x => {\r\n                        this.#promises.push(x.resize(resizeData))\r\n                    })\r\n                    Promise.all(this.#promises)\r\n                    this.#promises = [];\r\n                }\r\n\r\n                this.#previousSize = currentSize;\r\n            }\r\n        }\r\n        this.#inProgress = false\r\n    }\r\n\r\n\r\n}","import { IUIInteractionProvider, ICuiEventBus, ICuiManager, CuiCachable } from \"./interfaces\";\r\nimport { CuiSetup, CuiSetupInit } from \"./setup\";\r\nimport { CuiLightMode } from \"../utils/types\";\r\nimport { CuiInteractionsFactory } from \"../factories/interactions\";\r\nimport { CuiCacheManager } from \"../../app/managers/cache\";\r\nimport { CuiEventBus } from \"../bus/bus\";\r\nimport { TaskedEventEmitHandler } from \"../bus/handlers\";\r\nimport { CuiCallbackExecutor } from \"../bus/executors\";\r\nimport { getName, replacePrefix } from \"../utils/functions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { ICuiDocumentStyleAppender, CuiDocumentStyleAppender } from \"../styles/appender\";\r\nimport { CuiInstanceColorHandler } from \"../../app/handlers/colors\";\r\nimport { ICuiResizableObserver, CuiResizeObserver } from \"../../app/observers/resize\";\r\n\r\nexport class CuiUtils {\r\n    interactions: IUIInteractionProvider;\r\n    bus: ICuiEventBus;\r\n    setup: CuiSetup;\r\n    cache: ICuiManager<CuiCachable>;\r\n    colors: CuiInstanceColorHandler;\r\n    styleAppender: ICuiDocumentStyleAppender;\r\n    #resizeObserver: ICuiResizableObserver;\r\n    constructor(initialSetup: CuiSetupInit) {\r\n        this.setup = new CuiSetup().fromInit(initialSetup);\r\n        this.interactions = CuiInteractionsFactory.get(initialSetup.interaction)\r\n        this.cache = new CuiCacheManager(this.setup.cacheSize);\r\n        this.bus = new CuiEventBus(new TaskedEventEmitHandler(new CuiCallbackExecutor()));\r\n        this.colors = new CuiInstanceColorHandler(this.interactions);\r\n        this.styleAppender = new CuiDocumentStyleAppender(this.interactions);\r\n        this.#resizeObserver = new CuiResizeObserver(this.bus, this.setup.resizeThreshold);\r\n        this.#resizeObserver.connect();\r\n    }\r\n\r\n    setLightMode(mode: CuiLightMode) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        const classes = document.body.classList;\r\n        if (mode === 'dark' && !classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.add(name);\r\n            }, this)\r\n\r\n        } else if (mode === 'light' && classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.remove(name);\r\n            }, this)\r\n        }\r\n    }\r\n\r\n    getLightMode(): CuiLightMode {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        return document.body.classList.contains(name) ? 'dark' : 'light';\r\n    }\r\n\r\n    setPrintMode(flag: boolean) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        const classes = document.body.classList;\r\n        if (flag && !classes.contains(name)) {\r\n            classes.add(name);\r\n\r\n        } else if (!flag && classes.contains(name)) {\r\n            classes.remove(name);\r\n        }\r\n    }\r\n\r\n    isPrintMode(): boolean {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        return document.body.classList.contains(name);\r\n    }\r\n\r\n    setProperty(name: string, value: string) {\r\n        let prop = replacePrefix(name, this.setup.prefix);\r\n        document.documentElement.style.setProperty(prop, value);\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\n\r\nexport class CuiMediaQueryListener implements ICuiEventListener<MediaQueryListEvent> {\r\n\r\n    #mediaQuery: string;\r\n    #callback: (t: MediaQueryListEvent) => void;\r\n    #isInitialized: boolean;\r\n    #inProgress: boolean;\r\n    constructor(mediaQuery: string) {\r\n        this.#mediaQuery = mediaQuery;\r\n        this.#isInitialized = false;\r\n    }\r\n    setCallback(callback: (t: MediaQueryListEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        if (!window.matchMedia || this.#isInitialized || !this.#mediaQuery) {\r\n            return;\r\n        }\r\n        window.matchMedia(this.#mediaQuery)\r\n            .addEventListener('change', this.event.bind(this))\r\n        this.#isInitialized = true\r\n    }\r\n\r\n    detach(): void {\r\n        if (this.#isInitialized) {\r\n            window.matchMedia(this.#mediaQuery).removeEventListener('change', this.event.bind(this));\r\n            this.#isInitialized = false\r\n        }\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isInitialized;\r\n    }\r\n\r\n    private event(ev: MediaQueryListEvent): void {\r\n        if (this.#inProgress) {\r\n            return\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            this.#callback(ev);\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            this.#inProgress = false;\r\n        }\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { getRangeValueOrDefault } from \"../utils/functions\";\r\n\r\nexport interface CuiScrollEvent {\r\n    base: Event;\r\n    top: number;\r\n    left: number;\r\n}\r\n\r\nexport class CuiScrollListener implements ICuiEventListener<CuiScrollEvent> {\r\n    #target: Element;\r\n    #inProgress: boolean;\r\n    #threshold: number;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #callback: (ev: CuiScrollEvent) => void;\r\n    #isAttached: boolean;\r\n    #isRoot: boolean;\r\n    constructor(target: Element, threshold?: number) {\r\n        this.#target = target;\r\n        this.#inProgress = false;\r\n        this.#threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n        this.#prevX = this.#prevY = 0;\r\n        this.#isAttached = false;\r\n        this.#isRoot = target instanceof Window;\r\n    }\r\n\r\n    setCallback(callback: (ev: CuiScrollEvent) => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#target.addEventListener('scroll', this.listener.bind(this))\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach() {\r\n        this.#target.removeEventListener('scroll', this.listener.bind(this))\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    private listener(ev: Event) {\r\n        let left = this.getLeft();\r\n        let top = this.getTop();\r\n        this.#prevX += left;\r\n        this.#prevY += top;\r\n        if (this.#inProgress || !this.passedThreshold()) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n\r\n        requestAnimationFrame(() => {\r\n            this.#callback({\r\n                base: ev,\r\n                top: top,\r\n                left: left\r\n            })\r\n            this.#inProgress = false\r\n            this.#prevX = 0;\r\n            this.#prevY = 0;\r\n        })\r\n    }\r\n\r\n    private passedThreshold() {\r\n        return this.#threshold <= 0 || (this.#prevX >= this.#threshold || this.#prevY >= this.#threshold);\r\n    }\r\n\r\n    getTop() {\r\n        return this.#isRoot ? window.pageYOffset : this.#target.scrollTop;\r\n    }\r\n\r\n    getLeft(): number {\r\n        return this.#isRoot ? window.pageXOffset : this.#target.scrollLeft;\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport class FastDom implements IUIInteractionProvider {\r\n    private writes: any[];\r\n    private reads: any[];\r\n    private raf: any;\r\n    private isScheduled: boolean = false;\r\n    #limit: number;\r\n\r\n    constructor() {\r\n        this.raf = window.requestAnimationFrame.bind(window)\r\n        this.writes = []\r\n        this.reads = []\r\n        this.#limit = 5;\r\n    }\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.reads.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.writes.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n    private run(tasks: any[]) {\r\n        let task = null\r\n        while (task = tasks.shift()) {\r\n            task()\r\n        }\r\n    }\r\n\r\n    private schedule(recursion?: number) {\r\n        if (!this.isScheduled) {\r\n            this.isScheduled = true;\r\n            if (recursion >= this.#limit) {\r\n                throw new Error(\"Fast Dom limit reached\")\r\n            } else {\r\n                this.raf(this.flush.bind(this, recursion));\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private flush(recursion?: number) {\r\n        let rec: number = recursion ?? 0;\r\n        let error = null;\r\n        let writes = this.writes;\r\n        let reads = this.reads;\r\n\r\n        try {\r\n            this.run(reads);\r\n            this.run(writes);\r\n        } catch (e) {\r\n            error = e\r\n            console.error(e)\r\n        }\r\n        this.isScheduled = false;\r\n\r\n        if (error) {\r\n            this.schedule(rec + 1)\r\n        }\r\n        if (this.writes.length || this.reads.length) {\r\n            this.schedule(recursion + 1);\r\n        }\r\n    }\r\n}\r\n\r\nexport class SyncInteractions implements IUIInteractionProvider {\r\n    tasks: any[];\r\n    raf: any;\r\n    isRunning: boolean = false;\r\n    constructor() {\r\n        this.tasks = [];\r\n        this.raf = window.requestAnimationFrame.bind(window)\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private schedule() {\r\n        if (!this.isRunning) {\r\n            this.isRunning = true;\r\n            this.raf(this.flush.bind(this))\r\n        }\r\n    }\r\n\r\n    private flush() {\r\n        let task = null\r\n        while (task = this.tasks.shift()) {\r\n            try {\r\n                task()\r\n            }\r\n            catch (e) {\r\n            }\r\n        }\r\n        this.isRunning = false\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n}","import { CuiLogLevel } from \"./types\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\n\r\nexport class CuiLogger implements ICuiLogger {\r\n    level: CuiLogLevel\r\n    component: string;\r\n    id: string;\r\n    constructor(name: string, level: CuiLogLevel) {\r\n        this.level = level\r\n        this.component = name\r\n        this.id = \"-\";\r\n    }\r\n\r\n    setLevel(level: CuiLogLevel) {\r\n        this.level = level\r\n    }\r\n\r\n    setId(id: string) {\r\n        this.id = id\r\n    }\r\n    debug(message: string, functionName?: string): void {\r\n        if (this.level === 'debug') {\r\n            console.log(this.prepString(message, functionName))\r\n        }\r\n    }\r\n    error(message: string, functionName?: string): void {\r\n        if (this.level === 'error' || this.level === 'debug' || this.level === 'warning')\r\n            console.error(this.prepString(message, functionName))\r\n    }\r\n\r\n    warning(message: string, functionName?: string): void {\r\n        if (this.level === 'warning' || this.level === 'debug')\r\n            console.warn(this.prepString(message, functionName))\r\n    }\r\n\r\n    exception(e: Error, functionName?: string): void {\r\n        console.error(this.prepString(`An exception occured: ${e.name}: ${e.message}`, functionName))\r\n        if (this.level === 'debug')\r\n            console.error(e.stack)\r\n    }\r\n\r\n    performance(callback: () => void, functionName?: string): void {\r\n        if (this.level !== 'debug') {\r\n            return;\r\n        }\r\n        let start = Date.now();\r\n        callback();\r\n        console.log(this.prepString(`Performance measure: ${Date.now() - start}ms`, functionName))\r\n    }\r\n\r\n    private prepString(message: string, functionName?: string) {\r\n        return `[${new Date().toLocaleString()}][${this.component}][${functionName ?? '-'}][${this.id}][${message}]`\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { ICuiComponentAction } from \"../utils/actions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiActionsHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    async performAction(target: Element, action: ICuiComponentAction, timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                action.add(target);\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        action.remove(target);\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performSwitchAction(inTarget: Element, outTarget: Element, inAction: ICuiComponentAction, outAction: ICuiComponentAction, onFinish: () => void, timeout: number): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                inAction.add(inTarget);\r\n                inTarget.classList.add(CLASSES.animProgress);\r\n                if (is(outTarget)) {\r\n                    outAction.add(outTarget);\r\n                    outTarget.classList.add(CLASSES.animProgress);\r\n                }\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        inAction.remove(inTarget);\r\n                        outAction.remove(outTarget);\r\n                        inTarget.classList.remove(CLASSES.animProgress);\r\n                        outTarget.classList.remove(CLASSES.animProgress);\r\n                        onFinish();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { CuiInteractionsType } from \"../utils/types\";\r\nimport { FastDom, SyncInteractions } from \"../utils/interactions\";\r\n\r\nexport class CuiInteractionsFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param type - Interactions type\r\n     */\r\n    public static get(type: CuiInteractionsType): IUIInteractionProvider {\r\n        const interactionType = type;\r\n        switch (interactionType) {\r\n            case 'async':\r\n                return new FastDom();\r\n            default:\r\n                return new SyncInteractions();\r\n        }\r\n    }\r\n}","import { ICuiDictionary, ICuiDictionaryItem } from \"../models/interfaces\";\r\nimport { ItemNotFoundError, ArgumentError } from \"../models/errors\";\r\nimport { is } from \"./functions\";\r\n\r\nexport class CuiDictionary<T> implements ICuiDictionary<T> {\r\n\r\n    #keys: string[];\r\n    #values: T[];\r\n\r\n    constructor(init?: ICuiDictionaryItem<T>[]) {\r\n        this.#keys = []\r\n        this.#values = []\r\n\r\n        if (init) {\r\n            init.forEach(x => {\r\n                if (!is(x.key)) {\r\n                    this.#keys = []\r\n                    this.#values = []\r\n                    throw new ArgumentError(\"Key is empty\");\r\n                }\r\n                this.add(x.key, x.value)\r\n            })\r\n        }\r\n    }\r\n\r\n    add(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        if (this.containsKey(key))\r\n            throw new Error(\"Key already exists\");\r\n        this.#keys.push(key)\r\n        this.#values.push(value)\r\n    }\r\n\r\n    remove(key: string): void {\r\n        if (!is(key)) {\r\n            return\r\n        }\r\n        let index = this.#keys.indexOf(key);\r\n        if (index >= 0) {\r\n            this.#keys.splice(index, 1)\r\n            this.#values.splice(index, 1)\r\n        }\r\n    }\r\n    get(key: string): T {\r\n        this.throwOnEmptyKey(key)\r\n        let index = this.indexOf(key)\r\n        if (index < 0) {\r\n            return undefined;\r\n        }\r\n        return this.#values[index];\r\n    }\r\n    containsKey(key: string): boolean {\r\n        return is(key) && this.indexOf(key) >= 0\r\n    }\r\n    keys(): string[] {\r\n        return this.#keys\r\n    }\r\n    values(): T[] {\r\n        return this.#values;\r\n    }\r\n\r\n    indexOf(key: string): number {\r\n        return is(key) ? this.#keys.indexOf(key) : -1;\r\n    }\r\n\r\n    update(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        let index = this.indexOf(key)\r\n        if (index < 0) {\r\n            throw new ItemNotFoundError(`Item with key [${key}] not found`)\r\n        }\r\n        this.#values[index] = value\r\n    }\r\n\r\n    clear() {\r\n        this.#values = [];\r\n        this.#keys = [];\r\n    }\r\n\r\n    private throwOnEmptyKey(key: string) {\r\n        if (!is(key)) {\r\n            throw new ArgumentError(\"Key is empty\");\r\n        }\r\n    }\r\n}","import { ICuiEventBus, CuiEventReceiver, ICuiLogger, ICuiEventEmitHandler, CuiContext, CuiElement } from \"../models/interfaces\";\r\nimport { is, are, generateRandomString } from \"../utils/functions\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\n\r\nexport class CuiEventBus implements ICuiEventBus {\r\n    #events: { [event: string]: CuiEventReceiver }\r\n    #log: ICuiLogger;\r\n    #eventHandler: ICuiEventEmitHandler;\r\n\r\n    constructor(emitHandler: ICuiEventEmitHandler) {\r\n        this.#events = {};\r\n        this.#eventHandler = emitHandler;\r\n        this.#log = CuiLoggerFactory.get(\"CuiEventBus\");\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on(name: string, callback: any, cui?: CuiElement): string {\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        // When context is not provided (e.g. anonymous function) then generate random\r\n        let id = generateRandomString();\r\n\r\n\r\n        if (!this.#events[name]) {\r\n            this.#events[name] = {}\r\n        }\r\n        if (this.isAttached(this.#events[name], id, cui)) {\r\n            return null;\r\n        }\r\n        this.#log.debug(`Attaching new event: [${name}] for: [${id}]`)\r\n\r\n        this.#events[name][id] = { callback: callback, $cuid: this.getCuid(cui) }\r\n        return id;\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string, cui?: CuiElement): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        let ev = this.#events[name]\r\n        this.#log.debug(`Detaching item: [${id}] from [${name}]`)\r\n        if (this.isAttached(ev, id)) {\r\n            delete ev[id];\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        if (is(name) && this.#events[name]) {\r\n            delete this.#events[name]\r\n        } else {\r\n            this.#log.error(`Event name is missing or incorrect`, \"detachAll\")\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit(event: string, cuid: string, ...args: any[]): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n        this.#log.debug(`Emit: [${event}]`)\r\n        await this.#eventHandler.handle(this.#events[event], cuid, args)\r\n        return true;\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        let ev = this.#events[name]\r\n        return this.isAttached(ev, id, cui)\r\n    }\r\n\r\n    private isAttached(ev: CuiEventReceiver, id: string, cui?: CuiElement): boolean {\r\n        if (is(cui)) {\r\n            return is(ev) && is(id) && is(ev[id]) && ev[id].$cuid == cui.$cuid;\r\n        }\r\n        return is(ev) && is(id) && is(ev[id]);\r\n    }\r\n\r\n    private getCuid(cui: CuiElement) {\r\n        return is(cui) ? cui.$cuid : null;\r\n    }\r\n\r\n    private prepareEventId(ctx: CuiContext) {\r\n        return are(ctx) ? ctx.getId() : generateRandomString();\r\n    }\r\n}   ","import { ICuiEventEmitHandler, ICuiLogger, ICuiCallbackExecutor, CuiEventReceiver } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\n\r\ninterface EmitHandlerData {\r\n    events: CuiEventReceiver;\r\n    cuid: string;\r\n    args: any[];\r\n}\r\n\r\nclass EmitHandlerBase {\r\n    isBusy: boolean;\r\n    queue: EmitHandlerData[];\r\n    constructor() {\r\n        this.queue = [];\r\n        this.isBusy = false;\r\n    }\r\n    idMatches(emitId: string, handleId: string) {\r\n        return !is(emitId) || (is(emitId) && emitId == handleId);\r\n    }\r\n}\r\n\r\nexport class SimpleEventEmitHandler extends EmitHandlerBase implements ICuiEventEmitHandler {\r\n    #log: ICuiLogger;\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        super();\r\n        this.#executor = executor;\r\n        this.#log = CuiLoggerFactory.get(\"SimpleEventEmitHandler\");\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args: any[]): Promise<void> {\r\n        if (!is(events)) {\r\n            this.#log.warning(\"No events provided\")\r\n            return\r\n        }\r\n        this.queue.push({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        if (!this.isBusy) {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.perform();\r\n                if (this.queue.length > 0) {\r\n                    await this.perform();\r\n                }\r\n                this.isBusy = false;\r\n            }\r\n        }\r\n        return;\r\n    }\r\n\r\n    private async perform() {\r\n        let task = this.queue.shift();\r\n        for (let id in task.events) {\r\n            let event = task.events[id]\r\n            try {\r\n                if (this.idMatches(task.cuid, event.$cuid))\r\n                    await this.#executor.execute(event.callback, task.args)\r\n            }\r\n            catch (e) {\r\n                this.#log.error(e)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class TaskedEventEmitHandler extends EmitHandlerBase implements ICuiEventEmitHandler {\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        super();\r\n        this.#executor = executor;\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args: any[]): Promise<void> {\r\n        if (!is(events)) {\r\n            return\r\n        }\r\n        this.queue.push({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        if (!this.isBusy) {\r\n            this.isBusy = true;\r\n            this.perform();\r\n            if (this.queue.length > 0) {\r\n                this.perform();\r\n            }\r\n            this.isBusy = false;\r\n        }\r\n        return;\r\n    }\r\n\r\n    private async perform(): Promise<void[]> {\r\n        let task = this.queue.shift();\r\n        let promises: Promise<void>[] = []\r\n        for (let id in task.events) {\r\n            let event = task.events[id]\r\n            if (this.idMatches(task.cuid, event.$cuid))\r\n                promises.push(this.#executor.execute(event.callback, task.args))\r\n        }\r\n        return Promise.all(promises)\r\n    }\r\n}\r\n","import { ICuiCallbackExecutor } from \"../models/interfaces\"\r\nimport { is } from \"../utils/functions\"\r\n\r\nexport class CuiCallbackExecutor implements ICuiCallbackExecutor {\r\n    async execute(callback: any, args: any[]): Promise<void> {\r\n        args = args ?? []\r\n        // if (is(ctx)) {\r\n        //     callback.apply(ctx, args)\r\n        // } else {\r\n        callback(...args)\r\n        return;\r\n    }\r\n}","import { is } from \"../utils/functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport interface ICuiDocumentStyleAppender {\r\n    append(style: string): boolean;\r\n}\r\n\r\nexport class CuiDocumentStyleAppender implements ICuiDocumentStyleAppender {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    append(style: string): boolean {\r\n        if (is(style)) {\r\n            const head = document.head || document.getElementsByTagName('head')[0]\r\n            const node = document.createElement('style');\r\n            const text = document.createTextNode(style);\r\n            node.type = 'text/css';\r\n            node.appendChild(text);\r\n            head.appendChild(node);\r\n        }\r\n        return true;\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiKeyPressListener implements ICuiEventListener<KeyboardEvent> {\r\n    #callback: (t: KeyboardEvent) => void;\r\n    #keys: string[];\r\n    #inProgress: boolean;\r\n    #singleEmit: boolean;\r\n    #isAttached: boolean;\r\n    constructor(singleEmit: boolean, keys?: string[]) {\r\n        this.#keys = keys;\r\n        this.#inProgress = false;\r\n        this.#singleEmit = true;\r\n    }\r\n\r\n    setCallback(callback: (t: KeyboardEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    attach(): void {\r\n        document.addEventListener('keydown', this.onKeyDown.bind(this))\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.onKeyUp.bind(this))\r\n        }\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        document.removeEventListener('keydown', this.onKeyDown.bind(this))\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.onKeyUp.bind(this))\r\n        }\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            if (!is(this.#keys) || this.#keys.includes(ev.code)) {\r\n                this.#callback(ev);\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            if (!this.#singleEmit)\r\n                this.#inProgress = false;\r\n        }\r\n    }\r\n\r\n    onKeyUp(ev: KeyboardEvent) {\r\n        this.#inProgress = false;\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemLightMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoLightPluginSetup {\r\n    autoLight: boolean;\r\n}\r\n\r\nexport class CuiAutoLightModePlugin implements ICuiPlugin {\r\n    description: string = 'Dark vs Light mode auto switcher';\r\n    name: string = 'auto-light';\r\n    setup: AutoLightPluginSetup;\r\n    #listener: CuiMediaQueryListener;\r\n    #utils: CuiUtils;\r\n    constructor(autoLightInit: AutoLightPluginSetup) {\r\n        this.description = \"CuiAutoLightModePlugin\";\r\n        this.setup = autoLightInit;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils\r\n        if (this.setup.autoLight && getSystemLightMode() === 'dark') {\r\n            this.#utils.setLightMode('dark')\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('(prefers-color-scheme: dark)')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        let autoLightSetup = this.#utils.setup.plugins[this.description] as AutoLightPluginSetup;\r\n        let autoLight = autoLightSetup?.autoLight ?? false;\r\n        if (autoLight) {\r\n            if (ev.matches) {\r\n                this.#utils.setLightMode('dark')\r\n            } else {\r\n                this.#utils.setLightMode('light')\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { ICuiLogger, IUIInteractionProvider, CuiElement, CuiContext, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getActiveClass, CuiActionsHelper, ICuiComponentAction, is } from \"../../core/index\";\r\nimport { ICuiComponentMutationObserver, CuiComponentMutationHandler } from \"../observers/mutations\";\r\nimport { ICuiIntersectionHandler } from \"../observers/intersection\";\r\n\r\nexport interface CuiChildMutation {\r\n    removed: Node[];\r\n    added: Node[];\r\n}\r\n\r\nexport class ComponentHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    hasClass(cls: string, element: Element) {\r\n        return cls && element.classList.contains(cls)\r\n    }\r\n\r\n    setClass(cls: string, element: Element) {\r\n        this.setClasses([cls], element);\r\n    }\r\n\r\n    setClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.add(...classes)\r\n        }\r\n    }\r\n\r\n    setClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.setClasses, this, classes, element);\r\n    }\r\n\r\n    removeClass(cls: string, element: Element) {\r\n        this.removeClasses([cls], element);\r\n    }\r\n\r\n    removeClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.remove(...classes)\r\n        }\r\n    }\r\n\r\n    removeClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.removeClasses, this, classes, element);\r\n    }\r\n\r\n    removeAttribute(attributeName: string, element: Element) {\r\n        if (element.hasAttribute(attributeName))\r\n            element.removeAttribute(attributeName);\r\n    }\r\n\r\n    setStyle(element: any, property: string, value: string) {\r\n        if (element[\"style\"] && is(value)) {\r\n            element.style[property] = value\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiComponentBase implements CuiContext {\r\n    _log: ICuiLogger;\r\n    utils: CuiUtils;\r\n    element: Element;\r\n    cuid: string;\r\n    isLocked: boolean;\r\n    activeClassName: string;\r\n    helper: ComponentHelper;\r\n    constructor(componentName: string, element: Element, utils: CuiUtils) {\r\n        this._log = CuiLoggerFactory.get(componentName);\r\n        this.utils = utils;\r\n        this.element = element;\r\n        this.cuid = (<any>element).$cuid;\r\n        this.isLocked = false;\r\n        this._log.setId(this.cuid);\r\n        this.activeClassName = getActiveClass(utils.setup.prefix);\r\n        this.helper = new ComponentHelper(utils.interactions);\r\n    }\r\n\r\n\r\n    mutate(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    fetch(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    getEventName(name: string) {\r\n        return [name, this.cuid].join('-');\r\n    }\r\n\r\n    emitEvent(event: string, ...data: any[]) {\r\n        this.utils.bus.emit(event, this.cuid, ...data)\r\n    }\r\n\r\n    onEvent(event: string, callback: any): string {\r\n        return this.utils.bus.on(event, callback, this.element as any)\r\n    }\r\n\r\n    detachEvent(event: string, id: string) {\r\n        if (id != null) {\r\n            this.utils.bus.detach(event, id);\r\n            id = null;\r\n        }\r\n    }\r\n\r\n    getId(): string {\r\n        return this.cuid;\r\n    }\r\n\r\n    checkLockAndWarn(fName?: string): boolean {\r\n        if (this.isLocked) {\r\n            this._log.warning(\"Component is locked\", fName)\r\n            return true\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Helper which checks whether element has an active flag set\r\n     */\r\n    isActive(): boolean {\r\n        return this.element.classList.contains(this.activeClassName);\r\n    }\r\n\r\n}\r\n\r\nabstract class CuiHandlerBase<T extends ICuiParsable> extends CuiComponentBase implements ICuiComponentHandler {\r\n    args: T;\r\n    prevArgs: T;\r\n    isInitialized: boolean;\r\n    activeClassName: string;\r\n    actionsHelper: CuiActionsHelper;\r\n    #attribute: string;\r\n    constructor(componentName: string, element: Element, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, utils);\r\n        this.args = args;\r\n\r\n        this.actionsHelper = new CuiActionsHelper(utils.interactions)\r\n        this.prevArgs = null;\r\n        this.isInitialized = false;\r\n        this.#attribute = attribute;\r\n    }\r\n\r\n    handle(args: any): void {\r\n        this._log.debug(\"Init\", 'handle');\r\n        if (this.isInitialized) {\r\n            this._log.warning(\"Trying to initialize component again\", 'handle');\r\n            return;\r\n        }\r\n        this.args.parse(args);\r\n        if (!this.element.classList.contains(this.#attribute)) {\r\n            this.element.classList.add(this.#attribute);\r\n        }\r\n        this.onHandle();\r\n        this.isInitialized = true;\r\n    }\r\n\r\n    refresh(args: any): void {\r\n        this._log.debug(\"Update\", 'refresh')\r\n        if (!this.isInitialized) {\r\n            this._log.error(\"Cannot update not initialized component\", 'refresh');\r\n            return;\r\n        }\r\n        this.prevArgs = { ...this.args };\r\n        this.args.parse(args);\r\n        this.onRefresh();\r\n    }\r\n\r\n    destroy(): void {\r\n        this._log.debug(\"Destroy\", \"destroy\");\r\n        this.onRemove();\r\n        this.isInitialized = false;\r\n    }\r\n\r\n\r\n\r\n    // Abstract\r\n    abstract onHandle(): void;\r\n    abstract onRefresh(): void;\r\n    abstract onRemove(): void;\r\n}\r\n\r\n\r\nexport abstract class CuiHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    args: T;\r\n    prevArgs: T;\r\n    isInitialized: boolean;\r\n\r\n    actionsHelper: CuiActionsHelper;\r\n    constructor(componentName: string, element: Element, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n    }\r\n\r\n    onHandle() {\r\n        this.onInit();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        this.onUpdate();\r\n    }\r\n\r\n    onRemove() {\r\n        this.onDestroy();\r\n    }\r\n\r\n    /**\r\n     * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n     * \r\n     * @param action - action to perfrom\r\n     * @param timeout - timeout specified for action removal\r\n     * @param onFinish - callback to be performed after action is finished after removal\r\n     * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n     */\r\n    async performAction(action: ICuiComponentAction, timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performAction(this.element, action, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Abstract\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n\r\n}\r\n\r\nexport abstract class CuiMutableHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    #mutionHandler: ICuiComponentMutationObserver;\r\n    constructor(componentName: string, element: Element, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n        this.#mutionHandler = new CuiComponentMutationHandler(element);\r\n        this.#mutionHandler.onMutation(this.mutation.bind(this))\r\n    }\r\n\r\n    onHandle() {\r\n        this.onInit();\r\n        this.#mutionHandler.observe();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        this.#mutionHandler.unobserve();\r\n        this.onUpdate();\r\n        this.#mutionHandler.observe();\r\n    }\r\n\r\n    onRemove() {\r\n        this.#mutionHandler.unobserve();\r\n        this.onDestroy();\r\n    }\r\n\r\n    /**\r\n     * Callback attached to mutation observer set on root element\r\n     * \r\n     * @param record - mutation records\r\n     */\r\n    mutation(records: MutationRecord[]): void {\r\n        this._log.debug(\"Element mutation\", \"mutation\")\r\n        this.onMutation(records.reduce<CuiChildMutation>((result: CuiChildMutation, item: MutationRecord) => {\r\n            if (item.type !== \"childList\") {\r\n                return result;\r\n            }\r\n            if (item.addedNodes.length > 0) {\r\n                result.added.push(...item.addedNodes)\r\n            }\r\n            if (item.removedNodes.length > 0) {\r\n                result.removed.push(...item.removedNodes)\r\n            }\r\n            return result;\r\n        }, {\r\n            added: [],\r\n            removed: []\r\n        }));\r\n    }\r\n\r\n    abstract onMutation(record: CuiChildMutation): void;\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { ICONS } from \"../../core/utils/statics\";\r\nimport { is, createElementFromString, isString, getStringOrDefault, isTouchSupported } from \"../../core/utils/functions\";\r\n\r\nexport class CuiIconArgs implements ICuiParsable {\r\n    icon: string;\r\n\r\n    parse(val: any) {\r\n        if (!is(val)) {\r\n            this.icon = null;\r\n        }\r\n        if (isString(val)) {\r\n            this.icon = val\r\n            return;\r\n        }\r\n        this.icon = getStringOrDefault(val.icon, \"\");\r\n    }\r\n}\r\n\r\nexport class CuiIconComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-icon`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIconHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiIconHandler extends CuiHandler<CuiIconArgs> {\r\n\r\n    #currentIcon: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIconHandler\", element, attribute, new CuiIconArgs(), utils);\r\n        this.#currentIcon = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        if (this.#currentIcon !== null) {\r\n            this._log.debug(\"Icon already initialized\")\r\n            return;\r\n        }\r\n        this.addIcon(this.args.icon)\r\n        this.#currentIcon = this.args.icon;\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.args.icon === this.#currentIcon) {\r\n            return;\r\n        }\r\n        this.addIcon(this.args.icon);\r\n        this.#currentIcon = this.args.icon;\r\n    }\r\n\r\n    onDestroy(): void {\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n        this.#currentIcon = null;\r\n    }\r\n\r\n    private addIcon(icon: string) {\r\n        const iconStr = icon ? ICONS[icon] : null;\r\n        if (!iconStr) {\r\n            return;\r\n        }\r\n        const iconSvg = new IconBuilder(iconStr).build();\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n\r\n        if (this.element.childNodes.length > 0) {\r\n            this.mutate(this.insertBefore, iconSvg)\r\n        } else {\r\n            this.mutate(this.appendChild, iconSvg)\r\n        }\r\n    }\r\n\r\n    private insertBefore(iconElement: Element) {\r\n        this.element.insertBefore(iconElement, this.element.firstChild);\r\n    }\r\n\r\n    private appendChild(iconElement: Element) {\r\n        this.element.appendChild(iconElement);\r\n    }\r\n}\r\n\r\nexport class IconBuilder {\r\n    #element: string;\r\n    #scale: number;\r\n    #style: string;\r\n\r\n    constructor(svgString: string) {\r\n        this.#element = svgString;\r\n        this.#scale = 1;\r\n    }\r\n\r\n    setStyle(style: string): IconBuilder {\r\n        this.#style = style;\r\n        return this\r\n    }\r\n\r\n    setScale(scale: number): IconBuilder {\r\n        this.#scale = scale\r\n        return this\r\n    }\r\n\r\n    build(): Element {\r\n        let created = createElementFromString(this.#element)\r\n        if (is(created) && this.#scale) {\r\n            let appender = new IconScaleAppender();\r\n            appender.append(created, this.#scale)\r\n        }\r\n        return created\r\n    }\r\n}\r\n\r\nexport class IconScaleAppender {\r\n    append(element: Element, value: number): void {\r\n        let width = element.hasAttribute(\"width\") ? parseInt(element.getAttribute(\"width\")) : 20;\r\n        let height = element.hasAttribute(\"height\") ? parseInt(element.getAttribute(\"height\")) : 20;\r\n        element.setAttribute(\"width\", (width * value).toString())\r\n        element.setAttribute(\"height\", (height * value).toString())\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, CuiObservables, CuiContext, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { is, getRangeValue, isString, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../icon/icon\";\r\nimport { ICONS, EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport interface CuiCircleProgressChnaged {\r\n    timestamp: number;\r\n    progress: number;\r\n}\r\n\r\nexport class CuiCircleArgs implements ICuiParsable {\r\n    progress: number;\r\n    constructor() {\r\n        this.progress = 0;\r\n    }\r\n\r\n    parse(val: any): void {\r\n        if (!is(val)) {\r\n            this.progress = 0;\r\n        }\r\n        else if (isString(val)) {\r\n            this.progress = getIntOrDefault(val, 0);\r\n        } else {\r\n            this.progress = getIntOrDefault(val.progress, 0);\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nexport class CuiCircleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = (prefix ?? 'cui') + '-circle-progress';\r\n        ICONS['special_circle_progress'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"  class=\\\"circle-progress\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle-progress-path\\\" d=\\\"M 50,5.3660047 A 44.867708,44.633994 0 0 1 94.867709,49.999997 44.867708,44.633994 0 0 1 50,94.633995 44.867708,44.633994 0 0 1 5.1322908,50.000001 44.867708,44.633994 0 0 1 50,5.3660047\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCircleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiCircleHandler extends CuiHandler<CuiCircleArgs> {\r\n    #factor: number;\r\n    #full: number;\r\n    #path: any;\r\n    #attr: string;\r\n    #progressEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiCircleHandler\", element, attribute, new CuiCircleArgs(), utils);\r\n        this.#factor = this.#full = 0;\r\n        this.#path = null\r\n        this.#attr = attribute;\r\n        this.#progressEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        const iconSvg = new IconBuilder(ICONS['special_circle_progress']).build();\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n        this.element.appendChild(iconSvg);\r\n        this.#path = this.element.querySelector('.circle-progress-path');\r\n        this.#full = this.#path.getTotalLength();\r\n        this.#factor = this.#full / 100;\r\n        this.fetch(this.readStyle)\r\n        this.#progressEventId = this.onEvent(EVENTS.PROGRESS_CHANGE, this.onSetProgress.bind(this))\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.fetch(this.readStyle)\r\n        this.emitEvent(EVENTS.PROGRESS_CHANGED, {\r\n            timestamp: Date.now(),\r\n            progress: this.args.progress\r\n        })\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.PROGRESS_CHANGE, this.#progressEventId);\r\n    }\r\n\r\n    onSetProgress(val: any) {\r\n        if (is(val)) {\r\n            this.element.setAttribute(this.#attr, val);\r\n        }\r\n    }\r\n\r\n    private updateStyle(value: number) {\r\n        this.#path.style.strokeDashoffset = value;\r\n    }\r\n\r\n    private readStyle(): void {\r\n        if (this.prevArgs && this.args.progress === this.prevArgs.progress) {\r\n            return;\r\n        }\r\n        const progress = getRangeValue(this.args.progress, 0, 100);\r\n\r\n        this.mutate(this.updateStyle, this.#full - this.#factor * progress);\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, CuiObservables, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { IconBuilder } from \"../icon/icon\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICONS } from \"../../core/utils/statics\";\r\nimport { is, isString, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { CuiCloseHandler } from \"../close/close\";\r\n\r\nexport class CuiSpinnerArgs implements ICuiParsable {\r\n    spinner: string;\r\n\r\n    constructor() {\r\n        this.spinner = null;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (isString(args)) {\r\n            this.spinner = args\r\n        } else {\r\n            this.spinner = getStringOrDefault(args.spinner, null);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSpinnerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor() {\r\n        this.attribute = 'data-spinner';\r\n        ICONS['special_circle_double'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"circle-double\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle-double-outer\\\" d=\\\"M 50.000002,6.1070619 A 44.867709,44.126654 0 0 1 94.867708,50.233712 44.867709,44.126654 0 0 1 50.000002,94.36037 44.867709,44.126654 0 0 1 5.132292,50.233717 44.867709,44.126654 0 0 1 50.000002,6.1070619\\\"></path><path class=\\\"circle-double-inner\\\" d=\\\"M 50.000001,15.59972 A 35.383463,34.633995 0 0 1 85.383464,50.233711 35.383463,34.633995 0 0 1 50.000001,84.86771 35.383463,34.633995 0 0 1 14.616536,50.233716 35.383463,34.633995 0 0 1 50.000001,15.59972\\\"></path></svg>\"\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSpinnerHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSpinnerHandler extends CuiHandler<CuiSpinnerArgs> {\r\n\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSpinnerHandler\", element, attribute, new CuiSpinnerArgs(), utils);\r\n    }\r\n\r\n    onInit(): void {\r\n        const svgIcon = is(this.args.spinner) ? ICONS[`spinner_${this.args.spinner}`] : null;\r\n        if (!is(svgIcon)) {\r\n            return;\r\n        }\r\n        const iconElement = new IconBuilder(svgIcon).build();\r\n        this.element.innerHTML = \"\";\r\n        this.mutate(this.addSpinner, iconElement, this.args.spinner);\r\n    }\r\n\r\n    onUpdate(): void {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.element.innerHTML = \"\";\r\n    }\r\n\r\n    private addSpinner(iconElement: Element, name: string) {\r\n        this.element.appendChild(iconElement);\r\n        this.element.classList.add(`animation-spinner-${name}`);\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase } from \"../../app/handlers/base\";\r\n\r\nexport class CuiDummyComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor() {\r\n        this.attribute = 'cui-dummy';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDummyHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiDummyHandler extends CuiComponentBase implements ICuiComponentHandler {\r\n\r\n    #attribute: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiDummyHandler\", element, utils);\r\n\r\n        this.#attribute = attribute\r\n    }\r\n\r\n    handle(args: any): void {\r\n\r\n    }\r\n\r\n    refresh(args: any): void {\r\n\r\n    }\r\n\r\n    destroy(): void {\r\n\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { is, getOffsetTop, getStringOrDefault } from \"../../core/utils/functions\";\r\n\r\n/**\r\n * Component scrolls to specified target in the document\r\n * Arguments: \r\n * target - selector to target element where page should be scrolled to.\r\n * parent - set parent selector if parent should be different than html parent\r\n * behavior - auto/smooth - choose between step and smooth scrolling\r\n * \r\n */\r\n\r\nexport class CuiScrollComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = is(prefix) ? prefix + 'scroll' : 'cui-scroll';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport interface CuiScrollAttribute {\r\n    target?: string;\r\n    parent?: string;\r\n    behavior?: 'auto' | 'smooth';\r\n}\r\n\r\nexport class CuiScrollArgs implements ICuiParsable {\r\n    target?: string;\r\n    parent?: string;\r\n    behavior?: 'auto' | 'smooth';\r\n\r\n    constructor() {\r\n        this.target = null;\r\n        this.parent = null;\r\n        this.behavior = 'auto';\r\n    }\r\n\r\n    parse(val: any): void {\r\n        this.target = getStringOrDefault(val.target, \"\");\r\n        this.parent = getStringOrDefault(val.parent, \"\");\r\n        this.behavior = is(val.behavior) && val.behavior.toLowerCase() === 'smooth' ? 'smooth' : 'auto';\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiScrollHandler extends CuiHandler<CuiScrollArgs> {\r\n    #parent: HTMLElement;\r\n    #target: HTMLElement;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollHandler\", element, attribute, new CuiScrollArgs(), utils);\r\n        this.element = element;\r\n        this.#parent = null;\r\n        this.#target = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick.bind(this));\r\n        this.setTargets();\r\n    }\r\n    onUpdate(): void {\r\n        this.setTargets();\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick.bind(this));\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        if (!is(this.#target)) {\r\n            return;\r\n        }\r\n        let to = getOffsetTop(this.#target) - this.#parent.offsetTop;\r\n        let from = this.#parent.scrollTop;\r\n        let by = to - from;\r\n        this.#parent.scrollBy({\r\n            top: by,\r\n            behavior: this.args.behavior\r\n        });\r\n        this.emitEvent(EVENTS.ON_SCROLL, {\r\n            to: to,\r\n            by: by,\r\n            target: this.#target,\r\n            parent: this.#parent,\r\n            timestamp: Date.now(),\r\n        })\r\n        ev.preventDefault();\r\n    }\r\n\r\n    private setTargets(): void {\r\n        this.#target = document.querySelector(this.args.target) as HTMLElement;\r\n        if (is(this.#target)) {\r\n            this.#parent = is(this.args.parent) ? document.querySelector(this.args.parent) : this.#target.parentElement;\r\n        }\r\n    }\r\n}\r\n\r\n","import { ICuiComponent, ICuiComponentHandler, CuiObservables } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiScrollListener, CuiScrollEvent } from \"../../core/listeners/scroll\";\r\nimport { ICuiComponentAction, CuiActionsFatory } from \"../../core/utils/actions\";\r\nimport { parseAttributeString, getRangeValue, is, getOffsetTop, getRangeValueOrDefault, isInRange, getOffsetLeft, clone } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiScrollSpyOutOfRangeError } from \"../../core/models/errors\";\r\n\r\nexport interface CuiScrollSpyAttribute {\r\n    selector?: string;\r\n    action?: string;\r\n    link?: string;\r\n    linkAction: string;\r\n    offset: number;\r\n}\r\n\r\n\r\nexport class CuiScrollSpyArgs {\r\n    selector: string;\r\n    action: ICuiComponentAction;\r\n    link?: string;\r\n    linkAction?: ICuiComponentAction;\r\n    offset?: number;\r\n\r\n    constructor() {\r\n        this.offset = 0;\r\n    }\r\n    parse(args: any) {\r\n        if (!args.selector) {\r\n            throw new Error(\"Incorrect arguments\");\r\n        }\r\n        this.selector = args.selector;\r\n        this.action = CuiActionsFatory.get(args.action);\r\n        this.link = args.link;\r\n        this.linkAction = CuiActionsFatory.get(args.linkAction);\r\n        this.offset = getRangeValueOrDefault(parseInt(args.offset), -1, 1, 0);\r\n    }\r\n}\r\nexport class CuiScrollspyComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-scrollspy`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollspyHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiScrollspyHandler extends CuiHandler<CuiScrollSpyArgs> {\r\n\r\n    #listener: CuiScrollListener;\r\n    #links: Element[];\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #targetsLength: number;\r\n    #linksLength: number;\r\n    #prevScrollTop: number;\r\n    #prevScrollLeft: number;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollspyHandler\", element, attribute, new CuiScrollSpyArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n        this.#listener = new CuiScrollListener(this.element, this.utils.setup.scrollThreshold);\r\n        this.#links = [];\r\n        this.#targets = [];\r\n        this.#currentIdx = this.#targetsLength = this.#linksLength = -1;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#prevScrollTop = this.element.scrollTop;\r\n        this.#prevScrollLeft = this.element.scrollLeft;\r\n        this.parseAttribute();\r\n        let current = this.calculateCurrent(this.#prevScrollTop);\r\n        this.setCurrent(current);\r\n        this.setCurrentLink(current, -1);\r\n        this.#currentIdx = current;\r\n        this.#listener.setCallback(this.onScroll.bind(this));\r\n        this.#listener.attach();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.#prevScrollTop = this.element.scrollTop;\r\n        this.#prevScrollLeft = this.element.scrollLeft;\r\n        this.parseAttribute();\r\n        this.calculateCurrent(this.#prevScrollTop);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        let idx = -1;\r\n        if (Math.abs(ev.left - this.#prevScrollLeft) > Math.abs(ev.top - this.#prevScrollTop)) {\r\n            idx = this.calculateCurrentLeft(ev.left);\r\n        } else {\r\n            idx = this.calculateCurrent(ev.top);\r\n        }\r\n        if (idx !== this.#currentIdx) {\r\n            let newTarget = this.setCurrent(idx)\r\n            this.setCurrentLink(idx, this.#currentIdx);\r\n            this.#currentIdx = idx;\r\n            this.emitEvent(EVENTS.TARGET_CHANGE, {\r\n                top: ev.top,\r\n                left: ev.left,\r\n                target: newTarget,\r\n                timestamp: Date.now()\r\n            })\r\n        }\r\n\r\n        this.#prevScrollTop = this.element.scrollTop;\r\n        this.#prevScrollLeft = this.element.scrollLeft;\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#targets = [...this.element.querySelectorAll(this.args.selector)];\r\n        this.#links = this.args.link ? [...document.querySelectorAll(this.args.link)] : [];\r\n        this.#targetsLength = this.#targets.length;\r\n        this.#linksLength = this.#links.length;\r\n    }\r\n\r\n    private calculateCurrent(scroll: number): number {\r\n        return this.#targets.findIndex((target: HTMLElement) => {\r\n            let offset = getOffsetTop(target) - (<any>this.element).offsetTop;\r\n            let ratio = offset * this.args.offset\r\n            return offset + ratio <= scroll && scroll < offset + target.clientHeight + ratio;\r\n        })\r\n    }\r\n\r\n    private calculateCurrentLeft(scroll: number): number {\r\n        return this.#targets.findIndex((target: HTMLElement) => {\r\n            let offset = getOffsetLeft(target) - (<any>this.element).offsetLeft;\r\n            let ratio = offset * this.args.offset\r\n            return offset + ratio <= scroll && scroll < offset + target.clientWidth + ratio;\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Performs action on current, new target and on links if there are any.\r\n     * Returns new target element or null if index is out of range\r\n     * \r\n     * @param idx - new target index\r\n     * @returns New target item\r\n     */\r\n    private setCurrent(idx: number): Element {\r\n        if (!isInRange(idx, 0, this.#targetsLength)) {\r\n            throw new CuiScrollSpyOutOfRangeError(\"New index is out of targets length\")\r\n        }\r\n        let ret = this.#targets[idx]\r\n        this.args.action.add(ret)\r\n        this.args.action.remove(this.#targets[this.#currentIdx]);\r\n        return ret;\r\n    }\r\n\r\n    private setCurrentLink(idx: number, prev: number) {\r\n        if (this.#linksLength > 0) {\r\n            if (isInRange(idx, 0, this.#linksLength)) {\r\n                this.args.linkAction.add(this.#links[idx]);\r\n            }\r\n            if (isInRange(prev, 0, this.#linksLength)) {\r\n                this.args.linkAction.remove(this.#links[prev]);\r\n            }\r\n        }\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemPrintMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoPrintPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport class CuiAutoPrintModePlugin implements ICuiPlugin {\r\n    description: string = 'Auto print mode';\r\n    name: string = 'auto-print';\r\n    setup: AutoPrintPluginSetup;\r\n    #listener: CuiMediaQueryListener;\r\n    #utils: CuiUtils;\r\n    constructor(autoPrintInit: AutoPrintPluginSetup) {\r\n        this.description = \"CuiAutoPrintModePlugin\";\r\n        this.setup = autoPrintInit;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils\r\n        if (this.setup.autoPrint && getSystemPrintMode()) {\r\n            this.#utils.setPrintMode(true)\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('print')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        this.setup = this.#utils.setup.plugins[this.description] as AutoPrintPluginSetup;\r\n        let autoPrint = this.setup?.autoPrint ?? false;\r\n        if (autoPrint) {\r\n            console.log(ev.matches)\r\n            if (ev.matches) {\r\n                this.#utils.setPrintMode(true)\r\n            } else {\r\n                this.#utils.setPrintMode(false)\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { ICuiObserver } from \"../../core/models/interfaces\";\r\n\r\nexport interface ICuiIntersectionObserver {\r\n    observe(target: Element): void;\r\n    unobserve(target: Element): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport class CuiIntersectionEntry {\r\n    isInView: boolean;\r\n    ratio: number;\r\n}\r\n\r\nexport interface ICuiIntersectionHandler {\r\n    onIntersection(entry: CuiIntersectionEntry): Promise<boolean>;\r\n}\r\n\r\n/**\r\n * Creates a wrapper for intersection observer\r\n * Constructor gets a root element for observer and optional array of threshold values [0...1]\r\n */\r\nexport class CuiIntersectionObserver implements ICuiObserver {\r\n    private observer: IntersectionObserver\r\n    #root: Element;\r\n    #threshold: number[];\r\n    #callback: IntersectionObserverCallback;\r\n    constructor(root: Element, threshold?: number[]) {\r\n        this.#root = root;\r\n        this.#threshold = threshold ?? [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1];\r\n    }\r\n\r\n    setCallback(callback: IntersectionObserverCallback) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    connect(): void {\r\n        this.observer = new IntersectionObserver(this.#callback, {\r\n            root: this.#root,\r\n            rootMargin: '0px',\r\n            threshold: this.#threshold\r\n        })\r\n    }\r\n\r\n    observe(target: Element): void {\r\n        this.observer.observe(target)\r\n    }\r\n\r\n    unobserve(target: Element): void {\r\n        this.observer.unobserve(target)\r\n    }\r\n\r\n    disconnect() {\r\n        this.observer.disconnect()\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiIntersectionObserver } from \"../../app/observers/intersection\";\r\nimport { CuiActionsFatory, ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { is, getRangeValueOrDefault, clone } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\n/**\r\n * Intersection\r\n * Toggles action in/out when target is intersecting with the screen\r\n * \r\n * Set this on scrollable element\r\n * target - children selector\r\n * offset - 0...1 - tells how much target must intersecting with the screen\r\n * action - action to trigger\r\n */\r\n\r\nexport class CuiIntersectionAttributes {\r\n    target: string;\r\n    action: ICuiComponentAction;\r\n    offset: number\r\n    constructor() {\r\n        this.target = \"div\";\r\n        this.action = CuiActionsFatory.get('dummy');\r\n        this.offset = 0;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.target = is(args.target) ? args.target : 'div';\r\n        this.action = is(args.action) ? CuiActionsFatory.get(args.action) : CuiActionsFatory.get('dummy');\r\n        this.offset = getRangeValueOrDefault(parseInt(args.offset), 0, 1, 0);\r\n    }\r\n}\r\n\r\nexport class CuiIntersectionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-intersection`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIntersectionHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiIntersectionHandler extends CuiHandler<CuiIntersectionAttributes> {\r\n\r\n    #observer: CuiIntersectionObserver;\r\n    #targets: Element[];\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIntersectionHandler\", element, attribute, new CuiIntersectionAttributes(), utils);\r\n        this.#observer = new CuiIntersectionObserver(this.element);\r\n        this.#targets = []\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseArguments();\r\n        this.#observer.setCallback(this.onIntersection.bind(this))\r\n        this.#observer.connect();\r\n        this.#targets.forEach(target => {\r\n            this.#observer.observe(target);\r\n        })\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.parseArguments();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#observer.disconnect();\r\n    }\r\n\r\n    parseArguments() {\r\n        if (this.prevArgs === null || this.prevArgs.target !== this.args.target) {\r\n            this.#targets = [...document.querySelectorAll(this.args.target)];\r\n        }\r\n    }\r\n\r\n    onIntersection(entries: IntersectionObserverEntry[], observer: IntersectionObserver): void {\r\n        if (!is(this.#targets)) {\r\n            return;\r\n        }\r\n        let action = null;\r\n        entries.forEach(entry => {\r\n            action = this.getAction(entry.target);\r\n            if (entry.isIntersecting && entry.intersectionRatio >= this.args.offset) {\r\n                action.add(entry.target)\r\n            } else {\r\n                action.remove(entry.target)\r\n            }\r\n            this.emitIntersection(entry)\r\n        })\r\n    }\r\n\r\n    getAction(element: Element) {\r\n        return element.hasAttribute('action') ? CuiActionsFatory.get(element.getAttribute('action')) : this.args.action;\r\n    }\r\n\r\n    emitIntersection(entry: IntersectionObserverEntry) {\r\n        this.emitEvent(EVENTS.INTERSECTION, {\r\n            entry: entry,\r\n            offset: this.args.offset,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { getStringOrDefault, getIntOrDefault, is, getActiveClass, isString, getHandlerExtendingOrNull, isStringTrue } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiActionsFatory } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiOpenArgs {\r\n    target: string;\r\n    action: ICuiComponentAction;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n\r\n    #defTimeout: number;\r\n    constructor(timeout: number) {\r\n        this.target = \"\";\r\n        this.action = CuiActionsFatory.get(\"dummy\");\r\n        this.timeout = 0;\r\n        this.prevent = false;\r\n        this.state = \"\";\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.target = args;\r\n            this.action = CuiActionsFatory.get(\"dummy\");\r\n            this.timeout = this.#defTimeout;\r\n            this.prevent = false;\r\n            this.state = \"\";\r\n            return;\r\n        }\r\n        this.target = getStringOrDefault(args.target, null);\r\n        this.action = CuiActionsFatory.get(args.action)\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.prevent = isStringTrue(args.prevent)\r\n        this.state = args.state;\r\n    }\r\n}\r\n\r\nexport class CuiOpenComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-open`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOpenHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOpenHandler extends CuiHandler<CuiOpenArgs> {\r\n    #eventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOpenHandler\", element, attribute, new CuiOpenArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick.bind(this))\r\n        this.#eventId = this.onEvent(EVENTS.OPEN, this.onOpen.bind(this));\r\n    }\r\n    onUpdate(): void {\r\n        //\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick.bind(this))\r\n        this.detachEvent(EVENTS.OPEN, this.#eventId);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.onOpen(ev);\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n\r\n    onOpen(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = document.querySelector(this.args.target);\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.run(target).then((result) => {\r\n            this.activateTarget(ev, target, result);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n\r\n    private async run(target: Element): Promise<boolean> {\r\n        let openable = getHandlerExtendingOrNull<ICuiOpenable>(target as any, 'open');\r\n        if (is(openable)) {\r\n            await openable.open(this.args.state);\r\n            return false;\r\n        } else {\r\n            await this.actionsHelper.performAction(target, this.args.action, this.args.timeout);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    private activateTarget(ev: MouseEvent, target: Element, shouldEmit: boolean): void {\r\n        if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.setClassesAs(target, this.activeClassName);\r\n        }\r\n        if (shouldEmit)\r\n            this.emitOpen(ev);\r\n    }\r\n\r\n    emitOpen(ev: MouseEvent) {\r\n        this.emitEvent(EVENTS.OPENED, {\r\n            event: ev,\r\n            state: this.args.state,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiClosable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { getStringOrDefault, getIntOrDefault, parseAttribute, is, getActiveClass, isString, isStringTrue, getHandlerExtendingOrNull, getParentCuiElement } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiActionsFatory } from \"../../core/utils/actions\";\r\nimport { CLASSES, EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\n\r\nexport class CuiCloseArgs {\r\n    target: string;\r\n    action: ICuiComponentAction;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n    #defTimeout: number;\r\n\r\n    constructor(timeout: number) {\r\n        this.target = \"\";\r\n        this.action = null;\r\n        this.timeout = timeout;\r\n        this.prevent = false;\r\n        this.state = null;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.target = args\r\n            this.action = null\r\n            this.timeout = this.#defTimeout;\r\n            this.prevent = false\r\n            this.state = null;\r\n            return;\r\n        }\r\n        this.target = getStringOrDefault(args.target, null);\r\n        this.action = CuiActionsFatory.get(args.action)\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.prevent = args.prevent && isStringTrue(args.prevent)\r\n        this.state = args.state;\r\n    }\r\n}\r\n\r\nexport class CuiCloseComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-close`;\r\n\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCloseHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCloseHandler extends CuiHandler<CuiCloseArgs> {\r\n    #actionHelper: CuiActionsHelper;\r\n    #eventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiCloseHandler\", element, attribute, new CuiCloseArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick.bind(this))\r\n        this.#eventId = this.onEvent(EVENTS.CLOSE, this.onClose.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        //\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick.bind(this))\r\n        this.detachEvent(EVENTS.CLOSE, this.#eventId);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.onClose(ev);\r\n        if (this.args.prevent)\r\n            ev.preventDefault();\r\n    }\r\n\r\n    onClose(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget();\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.run(target).then((result) => {\r\n            this.onActionFinish(ev, target, result);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n\r\n    private async run(target: Element): Promise<boolean> {\r\n        let closable = getHandlerExtendingOrNull<ICuiClosable>(target as any, 'close');\r\n        if (closable) {\r\n            await closable.close(this.args.state);\r\n            return false;\r\n        } else if (this.args.action) {\r\n            await this.#actionHelper.performAction(target, this.args.action, this.args.timeout);\r\n            return true\r\n        } else {\r\n            return true;\r\n        }\r\n    }\r\n\r\n    private onActionFinish(ev: MouseEvent, target: Element, shouldEmit: boolean) {\r\n        if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.removeClassesAs(target, this.activeClassName);\r\n        }\r\n        if (shouldEmit)\r\n            this.emitClose(ev);\r\n    }\r\n\r\n    private getTarget(): Element {\r\n        return is(this.args.target) ? document.querySelector(this.args.target) : getParentCuiElement(this.element);\r\n    }\r\n\r\n    private emitClose(ev: MouseEvent) {\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now(),\r\n            state: this.args.state,\r\n            event: ev\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsFatory } from \"../../core/utils/actions\";\r\nimport { is, isString, getStringOrDefault, getName, parseAttribute } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToggleArgs {\r\n    target: string;\r\n    action: ICuiComponentAction;\r\n    constructor() {\r\n        this.action = null;\r\n        this.target = null;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.action = CuiActionsFatory.get(args)\r\n        } else {\r\n            this.target = getStringOrDefault(args.target, null);\r\n            this.action = CuiActionsFatory.get(args.action)\r\n        }\r\n    }\r\n}\r\nexport class CuiToggleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? \"cui\"}-toggle`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiToggleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiToggleHandler extends CuiHandler<CuiToggleArgs> {\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #toggleEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiToggleHandler\", element, attribute, new CuiToggleArgs(), utils);\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#toggleEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#target = this.getTarget();\r\n        this.element.addEventListener('click', this.onClick.bind(this));\r\n        this.#toggleEventId = this.onEvent(EVENTS.TOGGLE, this.toggle.bind(this));\r\n\r\n    }\r\n    onUpdate(): void {\r\n        this.#target = this.getTarget();\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick.bind(this));\r\n        this.detachEvent(EVENTS.TOGGLE, this.#toggleEventId);\r\n    }\r\n\r\n    toggle() {\r\n        this.args.action.toggle(this.#target, this.#utils)\r\n        this.emitEvent(EVENTS.TOGGLED, {\r\n            action: this.args.action,\r\n            target: this.#target,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.toggle();\r\n        ev.preventDefault();\r\n    }\r\n\r\n    getTarget(): Element {\r\n        return is(this.args.target) ? document.querySelector(this.args.target) : this.element;\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, CuiContext, ICuiEventBus, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICuiResizable, CuiResizeData } from \"../../app/observers/resize\";\r\nimport { generateCUID } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiResizeArgs implements ICuiParsable {\r\n    constructor() {\r\n\r\n    }\r\n\r\n    parse(args: any) {\r\n\r\n    }\r\n}\r\n\r\nexport class CuiResizeComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor() {\r\n        this.attribute = 'cui-resize';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiResizeHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiResizeHandler extends CuiHandler<CuiResizeArgs> {\r\n    #eventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiResizeHandler\", element, attribute, new CuiResizeArgs(), utils);\r\n        this.#eventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#eventId = this.utils.bus.on(EVENTS.RESIZE, this.resize.bind(this));\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n    onDestroy(): void {\r\n        if (this.#eventId !== null) {\r\n            this.utils.bus.detach(EVENTS.RESIZE, this.#eventId);\r\n            this.#eventId = null\r\n        }\r\n    }\r\n\r\n    resize(data: CuiResizeData) {\r\n        console.log(data);\r\n    }\r\n}","import { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { CuiKeyPressListener } from \"../../core/listeners/keys\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nexport interface KeyDownEvent {\r\n    timestamp: number;\r\n    event: KeyboardEvent;\r\n}\r\nexport interface ICuiKeysObserver {\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\nexport class CuiKeysObserver {\r\n    #listener: CuiKeyPressListener;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus) {\r\n        this.#bus = bus;\r\n        this.#listener = new CuiKeyPressListener(true);\r\n        this.#listener.setCallback(this.onKeyDown.bind(this))\r\n    }\r\n    connect(): void {\r\n        this.#listener.attach();\r\n    }\r\n    disconnect(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        this.#bus.emit(EVENTS.KEYDOWN, null, {\r\n            timestamp: Date.now(),\r\n            event: ev\r\n        })\r\n    }\r\n\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiKeysObserver, CuiKeysObserver } from \"./observer\";\r\n\r\n\r\nexport interface CuiKeysObserverPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport class CuiKeysObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'keys-observer';\r\n    setup: CuiKeysObserverPluginSetup;\r\n    #keysObserver: ICuiKeysObserver;\r\n    constructor(keySetup: CuiKeysObserverPluginSetup) {\r\n        this.description = \"CuiKeysObserverPlugin\";\r\n        this.setup = keySetup;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#keysObserver = new CuiKeysObserver(utils.bus);\r\n        this.#keysObserver.connect();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#keysObserver.disconnect();\r\n    }\r\n}","export class AriaAttributes {\r\n    public static setLabel(element: Element, label: string): void {\r\n        if (!element.hasAttribute('aria-label')) {\r\n            element.setAttribute('aria-label', label);\r\n        }\r\n    }\r\n\r\n    public static setAria(element: Element, attr: string, value: string) {\r\n        if (!element.hasAttribute(attr)) {\r\n            element.setAttribute(attr, value);\r\n        }\r\n    }\r\n\r\n    public static removeAria(element: Element, attr: string) {\r\n        if (element.hasAttribute(attr)) {\r\n            element.removeAttribute(attr);\r\n        }\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable, ICuiClosable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiActionsFatory, CuiClassAction } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { KeyDownEvent } from \"../../plugins/keys/observer\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\n\r\nconst DIALOG_OPEN_ANIMATION_CLASS = '{prefix}-dialog-default-in';\r\nconst DIALOG_CLOSE_ANIMATION_CLASS = '{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-dialog-open';\r\nconst CONTAINER = '.{prefix}-dialog-container';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDialogArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    constructor() {\r\n        this.escClose = false;\r\n        this.outClose = false;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.outClose = isStringTrue(args.outClose)\r\n    }\r\n}\r\n\r\nexport class CuiDialogComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-dialog`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDialogHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDialogHandler extends CuiHandler<CuiDialogArgs> implements ICuiComponentHandler, ICuiOpenable, ICuiClosable {\r\n\r\n    #prefix: string;\r\n    #timeout: number;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #openEventId: string;\r\n    #closeEventId: string;\r\n    #keyEventId: string;\r\n    #windowClickEventId: string;\r\n\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiDialogArgs(), utils);\r\n\r\n        this.#prefix = prefix;\r\n        this.#timeout = utils.setup.animationTimeLong;\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#scrollY = 0;\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n        this.#keyEventId = null;\r\n        this.#windowClickEventId = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.close.bind(this));\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.open.bind(this));\r\n        this._log.debug(\"Initialized\", \"handle\")\r\n    }\r\n\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId);\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n\r\n    }\r\n\r\n    async open(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn('open')) {\r\n            return false;\r\n        }\r\n        if (this.isAnyActive() || this.isActive()) {\r\n            this._log.warning(\"Dialog is already opened\");\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Dialog ${this.cuid}`, 'open')\r\n        let action = this.getAction(DIALOG_OPEN_ANIMATION_CLASS);\r\n        let scrollY = window.pageYOffset;\r\n        return this.performAction(action, this.#timeout, this.onOpen.bind(this, args), () => {\r\n            this.helper.setClass(this.activeClassName, this.element)\r\n            this.helper.setClass(this.#bodyClass, document.body)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'true');\r\n            document.body.style.top = `-${scrollY}px`;\r\n        });\r\n    }\r\n\r\n    async close(args: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\") || !this.isActive()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Dialog ${this.cuid}`, 'close')\r\n        let action = this.getAction(DIALOG_CLOSE_ANIMATION_CLASS);\r\n        return this.performAction(action, this.#timeout, this.onClose.bind(this, args), () => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            this.helper.removeClass(this.#bodyClass, document.body)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        });\r\n    }\r\n\r\n    onClose(state: any) {\r\n        const scrollY = document.body.style.top;\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, parseInt(scrollY || '0') * -1);\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#keyEventId);\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now(),\r\n            state: state\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    onOpen(state?: any) {\r\n        if (this.args.escClose) {\r\n            this.#keyEventId = this.onEvent(EVENTS.KEYDOWN, this.onEscClose.bind(this))\r\n        }\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.emitEvent(EVENTS.OPENED, {\r\n            timestamp: Date.now(),\r\n            state: state\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    async onEscClose(ev: KeyDownEvent) {\r\n        if (ev.event.key === \"Escape\") {\r\n            await this.close('Clesed by key');\r\n        }\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        let container = this.element.querySelector(replacePrefix(CONTAINER, this.#prefix));\r\n        if (!container.contains((ev.target as Node))) {\r\n            this.close('out').then(() => {\r\n                this._log.debug(\"Closed by click outside\")\r\n            });\r\n        }\r\n    }\r\n\r\n    isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    getAction(className: string): ICuiComponentAction {\r\n        return new CuiClassAction(replacePrefix(className, this.#prefix));\r\n    }\r\n}","import { isStringTrue, replacePrefix, EVENTS, ICuiComponentAction, CuiClassAction, is, getStringOrDefault, getIntOrDefault, CuiActionsFatory, getName } from \"../../core/index\";\r\nimport { ICuiComponent, CuiUtils, ICuiComponentHandler, ICuiOpenable, ICuiClosable } from \"../../index\";\r\nimport { CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { KeyDownEvent } from \"../../plugins/keys/observer\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\n\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-right-in\";\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-right-out\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-left-in\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-left-out\";\r\n\r\nconst OFFCANVAS_BODY = \"{prefix}-off-canvas-open\";\r\nconst OFFCANVAS_CONTAINER_CLS = '.{prefix}-off-canvas-container';\r\n\r\nexport class CuiOffCanvasArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    open: string;\r\n    close: string;\r\n    position: 'left' | 'right';\r\n    timeout: number;\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.escClose = false;\r\n        this.position = 'right';\r\n        this.open = this.getDefaultOpenClass();\r\n        this.close = this.getDefaultCloseClass();\r\n        this.#defTimeout = timeout;\r\n        this.timeout = timeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args)) {\r\n            this.escClose = isStringTrue(args.escClose);\r\n            this.outClose = isStringTrue(args.outClose);\r\n            this.position = getStringOrDefault(args.position, 'right');\r\n            this.open = getStringOrDefault(args.openCls, this.getDefaultOpenClass())\r\n            this.close = getStringOrDefault(args.closeCls, this.getDefaultCloseClass());\r\n            this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        }\r\n    }\r\n\r\n    getDefaultOpenClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_IN : OFFCANVAS_LEFT_ANIM_DEFAULT_IN, this.#prefix);\r\n    }\r\n\r\n    getDefaultCloseClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT : OFFCANVAS_LEFT_ANIM_DEFAULT_OUT, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-off-canvas`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffCanvasHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasHandler extends CuiHandler<CuiOffCanvasArgs> implements ICuiOpenable, ICuiClosable {\r\n\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #openEventId: string;\r\n    #closeEventId: string;\r\n    #keyDownEventId: string;\r\n    #windowClickEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOffCanvasHandler\", element, attribute, new CuiOffCanvasArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#prefix = prefix;\r\n        this.#bodyClass = replacePrefix(OFFCANVAS_BODY, prefix);\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n        this.#windowClickEventId = null;\r\n        this.#keyDownEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.mutate(() => {\r\n            this.setPositionLeft();\r\n            AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        })\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.open.bind(this));\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.close.bind(this));\r\n        this._log.debug(\"Initialized\", \"onInit\")\r\n    }\r\n    onUpdate(): void {\r\n        this.setPositionLeft();\r\n    }\r\n    onDestroy(): void {\r\n        //throw new Error(\"Method not implemented.\");\r\n        if (this.#closeEventId !== null)\r\n            this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n        if (this.#openEventId !== null)\r\n            this.detachEvent(EVENTS.OPEN, this.#openEventId);\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n    }\r\n\r\n    async open(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn('open')) {\r\n            return false;\r\n        }\r\n        if (this.isAnyActive() || this.isActive()) {\r\n            this._log.warning(\"Offcanvas is already opened\");\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Offcanvas ${this.cuid}`, 'open')\r\n        let scrollY = window.pageYOffset;\r\n        let action = CuiActionsFatory.get(this.args.open);\r\n        return this.performAction(action, this.args.timeout, this.onOpen.bind(this, args), () => {\r\n            this.helper.setClass(this.activeClassName, this.element)\r\n            this.helper.setClass(this.#bodyClass, document.body)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'true')\r\n            document.body.style.top = `-${scrollY}px`;\r\n        });\r\n    }\r\n\r\n    async close(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\") || !this.isActive()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Offcanvas ${this.cuid}`, 'close')\r\n        let action = CuiActionsFatory.get(this.args.close);\r\n        return this.performAction(action, this.args.timeout, this.onClose.bind(this, args), () => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            this.helper.removeClass(this.#bodyClass, document.body)\r\n            const scrollY = document.body.style.top;\r\n            document.body.style.top = '';\r\n            window.scrollTo(0, parseInt(scrollY || '0') * -1);\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false')\r\n        });\r\n    }\r\n\r\n    onClose(state?: any) {\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#keyDownEventId);\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now(),\r\n            state: state\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    onOpen(state?: any) {\r\n\r\n        if (this.args.escClose) {\r\n            this.onEvent(EVENTS.KEYDOWN, this.onEscClose.bind(this))\r\n        }\r\n        if (this.args.outClose) {\r\n            this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.emitEvent(EVENTS.OPENED, {\r\n            timestamp: Date.now(),\r\n            state: state\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    onEscClose(ev: KeyDownEvent) {\r\n        if (ev.event.key === \"Escape\") {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        const container = this.element.querySelector(replacePrefix(OFFCANVAS_CONTAINER_CLS, this.#prefix));\r\n        if (!container.contains((ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    setPositionLeft() {\r\n        let cls = getName(this.#prefix, 'left');\r\n        if (this.args.position === 'left' && !this.helper.hasClass(cls, this.element)) {\r\n            this.helper.setClass(cls, this.element)\r\n        } else if (this.args.position == 'right' && this.helper.hasClass(cls, this.element)) {\r\n            this.helper.removeClass(cls, this.element)\r\n        }\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { getIntOrDefault, is, getActiveClass, isStringTrue, replacePrefix, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { SCOPE_SELECTOR, EVENTS } from \"../../core/index\";\r\n\r\n/**\r\n * \r\n */\r\n\r\nexport interface CuiAccordionEvent {\r\n    index: number;\r\n    previous: number;\r\n    currentTarget: Element;\r\n    previousTarget: Element;\r\n    timestamp: number;\r\n}\r\n\r\ninterface CuiAccordionTarget {\r\n    element: Element,\r\n    listener?: any\r\n}\r\n\r\nconst ACCORDION_TITLE_CLS = '> * > .{prefix}-accordion-title';\r\nconst ACCORDION_ITEMS_CLS = '> *';\r\n\r\nexport class CuiAccordionArgs {\r\n    single: boolean;\r\n    selector: string;\r\n    items: string;\r\n    timeout: number;\r\n    animation: boolean;\r\n    content: string\r\n\r\n    #defTitleSelector: string;\r\n    #defItemsSelector: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#defTitleSelector = replacePrefix(ACCORDION_TITLE_CLS, prefix);\r\n        this.#defItemsSelector = replacePrefix(ACCORDION_ITEMS_CLS, prefix);\r\n        this.#defTimeout = timeout;\r\n        this.single = false;\r\n        this.selector = SCOPE_SELECTOR + this.#defTitleSelector;\r\n        this.items = SCOPE_SELECTOR + this.#defItemsSelector;\r\n        this.timeout = this.#defTimeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args)) {\r\n            this.single = isStringTrue(args.single);\r\n            this.selector = SCOPE_SELECTOR + getStringOrDefault(args.selector, this.#defTitleSelector);\r\n            this.items = SCOPE_SELECTOR + getStringOrDefault(args.content, this.#defItemsSelector);\r\n            this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n            this.animation = isStringTrue(args.animation);\r\n            return;\r\n        }\r\n\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class CuiAccordionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-accordion`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiAccordionHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiAccordionHandler extends CuiMutableHandler<CuiAccordionArgs> implements ICuiSwitchable {\r\n    #items: Element[];\r\n    #targets: CuiAccordionTarget[];\r\n    #switchEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiAccordionHandler\", element, attribute, new CuiAccordionArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#switchEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        if (this.args.isValid()) {\r\n            try {\r\n                this.initTargets();\r\n                this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onSwitch.bind(this))\r\n            } catch (e) {\r\n                this._log.exception(e, 'handle')\r\n            }\r\n            this._log.debug(\"Initialized\", \"handle\")\r\n        }\r\n    }\r\n\r\n    onUpdate(): void {\r\n        try {\r\n            this.initTargets();\r\n        } catch (e) {\r\n            this._log.exception(e, 'handle')\r\n        }\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(mutations: CuiChildMutation) {\r\n        if (mutations.added.length > 0 || mutations.removed.length > 0)\r\n            this.initTargets();\r\n    }\r\n\r\n    async switch(index: number): Promise<boolean> {\r\n        this._log.debug(\"Switch to: \" + index);\r\n        if (index < 0 || this.isLocked || !this.isInitialized) {\r\n            return false;\r\n        }\r\n\r\n        this.#items = this.queryItems();\r\n        if (this.#items.length <= index) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        const current = this.#items[index]\r\n        if (this.helper.hasClass(this.activeClassName, current)) {\r\n            this.helper.removeClassesAs(current, this.activeClassName)\r\n        } else {\r\n            if (this.args.single) {\r\n                this.closeAllExcept(index)\r\n            }\r\n            this.helper.setClassesAs(current, this.activeClassName)\r\n\r\n        }\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            index: index,\r\n            currentTarget: current,\r\n            timestamp: Date.now()\r\n        })\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n    onSwitch(index: any): void {\r\n        this.switch(getIntOrDefault(index, -1)).then(() => {\r\n            this._log.debug(\"Switch from event to \" + index);\r\n        });\r\n    }\r\n\r\n    initTargets() {\r\n        this.#items = this.queryItems();\r\n        const t = this.element.querySelectorAll(this.args.selector);\r\n        this.#targets = [];\r\n        t.forEach((item: Element, index: number) => {\r\n            let target: CuiAccordionTarget = { element: item };\r\n            this.setListener(target, index)\r\n            this.#targets.push(target);\r\n        })\r\n    }\r\n\r\n    closeAllExcept(current: number) {\r\n        this.mutate(() => {\r\n            this.#items.forEach((item: Element, index: number) => {\r\n                if (current !== index && this.helper.hasClass(this.activeClassName, item)) {\r\n                    item.classList.remove(this.activeClassName)\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    setListener(target: CuiAccordionTarget, index: number) {\r\n        target.listener = () => {\r\n            this.switch(index);\r\n        }\r\n        target.element.addEventListener('click', target.listener)\r\n    }\r\n\r\n    removeListener(target: CuiAccordionTarget) {\r\n        if (target.listener) {\r\n            target.element.removeEventListener('click', target.listener);\r\n        }\r\n    }\r\n\r\n    queryItems(): Element[] {\r\n        return [...this.element.querySelectorAll(this.args.items)]\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are } from \"../utils/functions\";\r\n\r\nexport interface CuiHoverEvent {\r\n    isHovering: boolean;\r\n    event: MouseEvent;\r\n    timestamp: number;\r\n}\r\nexport class CuiHoverListener implements ICuiEventListener<CuiHoverEvent> {\r\n    #target: Element;\r\n    #callback: (t: CuiHoverEvent) => void = null;\r\n    #inProgress: boolean;\r\n    #isHovering: boolean;\r\n    #isAttached: boolean;\r\n    constructor(target: Element) {\r\n        this.#target = target;\r\n        this.#inProgress = false;\r\n        this.#isHovering = false;\r\n    }\r\n\r\n    setCallback(callback: (t: CuiHoverEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        this.#target.addEventListener(\"mouseover\", this.onMouseOver.bind(this));\r\n        this.#target.addEventListener(\"mousemove\", this.onMouseMove.bind(this));\r\n        this.#target.addEventListener(\"mouseout\", this.onMouseOut.bind(this));\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        this.#target.removeEventListener(\"mouseover\", this.onMouseOver.bind(this));\r\n        this.#target.removeEventListener(\"mousemove\", this.onMouseMove.bind(this));\r\n        this.#target.removeEventListener(\"mouseout\", this.onMouseOut.bind(this));\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    emit(mouseEvent: MouseEvent, force: boolean) {\r\n        if (!are(this.#callback)) {\r\n            return;\r\n        }\r\n        if (!force && this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        window.requestAnimationFrame(this.invoke.bind(this, {\r\n            isHovering: this.#isHovering,\r\n            event: mouseEvent,\r\n            timestamp: Date.now()\r\n        }))\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#isAttached;\r\n    }\r\n    invoke(ev: CuiHoverEvent) {\r\n        this.#callback(ev);\r\n        this.#inProgress = false;\r\n    }\r\n\r\n    onMouseOver(ev: MouseEvent) {\r\n        this.#isHovering = true;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    onMouseOut(ev: MouseEvent) {\r\n        this.#isHovering = false;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    onMouseMove(ev: MouseEvent) {\r\n        this.emit(ev, false);\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable, ICuiClosable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { getIntOrDefault, parseAttribute, is, getActiveClass, isString, getName, replacePrefix, isStringTrue, getStringOrDefault, boolStringOrDefault } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiClassAction } from \"../../core/utils/actions\";\r\nimport { CLASSES, EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\nimport { KeyDownEvent } from \"../../plugins/keys/observer\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHoverListener, CuiHoverEvent } from \"../../core/listeners/hover\";\r\n\r\nconst bodyClass = '{prefix}-drop-open';\r\n\r\nconst DROP_DEFAULT_TRIGGER = \"> a, button\";\r\n\r\n\r\nexport interface CuiDropEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDropArgs {\r\n    escClose: boolean;\r\n    mode: \"click\" | \"hover\";\r\n    trigger: string;\r\n    prevent: boolean;\r\n    autoClose: boolean;\r\n    outClose: boolean;\r\n    constructor() {\r\n        this.escClose = false;\r\n        this.mode = \"click\";\r\n        this.trigger = DROP_DEFAULT_TRIGGER;\r\n        this.autoClose = false;\r\n        this.outClose = false;\r\n        this.prevent = false;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.escClose = args.escClose && isStringTrue(args.escClose);\r\n        this.mode = getStringOrDefault(args.mode, 'click').toLowerCase();\r\n        this.trigger = SCOPE_SELECTOR + getStringOrDefault(args.trigger, DROP_DEFAULT_TRIGGER);\r\n        this.prevent = isStringTrue(args.prevent);\r\n        this.autoClose = isStringTrue(args.autoClose);\r\n        this.outClose = args.outClose ? isStringTrue(args.outClose) : true;\r\n    }\r\n}\r\n\r\nexport class CuiDropComponenet implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-drop`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDropHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDropHandler extends CuiHandler<CuiDropArgs> implements ICuiOpenable, ICuiClosable {\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #attribute: string;\r\n    #triggerHoverListener: CuiHoverListener;\r\n    #hoverListener: CuiHoverListener;\r\n    #trigger: Element;\r\n    #clearId: any;\r\n    #keyEventId: string;\r\n    #windowClickEventId: string;\r\n    #openEventId: string;\r\n    #closeEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuidropHandler\", element, attribute, new CuiDropArgs(), utils);\r\n        this.#attribute = attribute;\r\n        this.#prefix = prefix;\r\n        this.#clearId = null;\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#hoverListener = new CuiHoverListener(this.element);\r\n        this.#hoverListener.setCallback(this.onTargetHover.bind(this))\r\n        this.#keyEventId = null;\r\n        this.#windowClickEventId = null;\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#trigger = this.element.parentElement.querySelector(this.args.trigger)\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.setTriggerEvent();\r\n        AriaAttributes.setAria(this.element, 'aria-dropdown', \"\");\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.open.bind(this));\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.close.bind(this));\r\n        this._log.debug(\"Initialized\", \"handle\")\r\n    }\r\n    onUpdate(): void {\r\n        if (this.#triggerHoverListener.isAttached()) {\r\n            this.#triggerHoverListener.detach();\r\n        } else if (this.prevArgs.mode === 'click') {\r\n            this.#trigger.removeEventListener('click', this.onTriggerClick.bind(this))\r\n        }\r\n\r\n        this.#trigger = this.element.parentElement.querySelector(this.args.trigger)\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.setTriggerEvent();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId);\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n    }\r\n\r\n    async open(): Promise<boolean> {\r\n        if (this.checkLockAndWarn('open')) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            return this.close();\r\n        }\r\n        if (this.isAnyActive()) {\r\n            await this.findAndCloseOpenedDrop();\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Drop ${this.cuid}`, 'open');\r\n        this.mutate(this.onOpen, this);\r\n        if (this.args.escClose) {\r\n            this.#keyEventId = this.onEvent(EVENTS.KEYDOWN, this.onEscClose.bind(this))\r\n        }\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.emitEvent(EVENTS.OPEN, {\r\n            timestamp: Date.now()\r\n        })\r\n        this.#hoverListener.attach();\r\n        if (this.args.autoClose) {\r\n            this.runAutoCloseTask();\r\n        }\r\n        this.isLocked = false;\r\n        return true\r\n    }\r\n\r\n    async close(): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\") || !this.isActive()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Drop ${this.cuid}`, 'close');\r\n        this.mutate(this.onClose, this);\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#keyEventId);\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.emitEvent(EVENTS.CLOSE, {\r\n            timestamp: Date.now()\r\n        })\r\n        this.#hoverListener.detach();\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n    onTargetHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering && is(this.#clearId)) {\r\n            clearTimeout(this.#clearId);\r\n            this.#clearId = null;\r\n        } else if (!ev.isHovering && !is(this.#clearId) && this.args.autoClose) {\r\n            this.runAutoCloseTask();\r\n        }\r\n    }\r\n\r\n    onClose() {\r\n        this.helper.removeClass(this.activeClassName, this.element)\r\n        this.helper.removeClass(this.#bodyClass, document.body)\r\n        AriaAttributes.setAria(this.element, 'aria-expanded', 'false')\r\n\r\n\r\n    }\r\n\r\n    onOpen() {\r\n        this.helper.setClass(this.activeClassName, this.element)\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        AriaAttributes.setAria(this.element, 'aria-expanded', 'true')\r\n\r\n    }\r\n\r\n    onEscClose(ev: KeyDownEvent) {\r\n        if (ev.event.key === \"Escape\") {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        if (!this.element.contains((ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    getAction(className: string): ICuiComponentAction {\r\n        return new CuiClassAction(replacePrefix(className, this.#prefix));\r\n    }\r\n\r\n    async findAndCloseOpenedDrop(): Promise<boolean> {\r\n        const opened = document.querySelector(`[${this.#attribute}].${this.activeClassName}`);\r\n        if (!is(opened)) {\r\n            this._log.warning(\"Opened drop was not found\");\r\n            return false;\r\n        }\r\n        const handler = (<CuiElement>(opened as any)).$handlers[this.#attribute] as any;\r\n        if (!is(handler)) {\r\n            this._log.warning(\"Drop handler was not found in the element\");\r\n            return false;\r\n        }\r\n        return handler.close();\r\n    }\r\n\r\n    onTriggerClick(ev: MouseEvent) {\r\n        if (this.isActive()) {\r\n            this.close();\r\n        } else {\r\n            this.open();\r\n        }\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n\r\n    onHoverEvent(ev: CuiHoverEvent) {\r\n        if (ev.isHovering && !this.isActive()) {\r\n            this.open();\r\n        }\r\n        if (this.args.prevent) {\r\n            ev.event.preventDefault();\r\n        }\r\n    }\r\n\r\n    setTriggerEvent() {\r\n        if (this.args.mode === 'hover') {\r\n            this.#triggerHoverListener.setCallback(this.onHoverEvent.bind(this));\r\n            this.#triggerHoverListener.attach();\r\n        } else {\r\n            this.#trigger.addEventListener('click', this.onTriggerClick.bind(this))\r\n        }\r\n    }\r\n\r\n    runAutoCloseTask() {\r\n        this.#clearId = setTimeout(() => {\r\n            this.close();\r\n        }, 5000)\r\n    }\r\n\r\n}","import { ICuiPlugin, ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS } from \"../../core/index\";\r\n\r\nexport class CuiWindowClickPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'click-plugin';\r\n    setup: any;\r\n    #bus: ICuiEventBus;\r\n\r\n    constructor() {\r\n        this.description = \"CuiWindowClickPlugin\";\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#bus = utils.bus;\r\n        window.addEventListener('click', this.onWindowClick.bind(this))\r\n    }\r\n\r\n    destroy(): void {\r\n        window.removeEventListener('click', this.onWindowClick.bind(this));\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        this.#bus.emit(EVENTS.WINDOW_CLICK, null, ev)\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiScrollListener, CuiScrollEvent } from \"../../core/listeners/scroll\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { getIntOrDefault, isStringTrue } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/index\";\r\n\r\n/**\r\n * Toggles an action after specified offset is reached in relation to the element or document\r\n * \r\n * target?: string - target which action shall be triggered on\r\n * action?: string - action to trigger\r\n * offsetY?: number - vertical offset\r\n * offsetX?: number - horizontal offset\r\n * root?: boolean - set true if scroll listener shall be set on document element\r\n */\r\n\r\nexport interface CuiOffsetEvent {\r\n    matches: boolean;\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiOffsetAttribute {\r\n    target?: string;\r\n    action?: string;\r\n    offsetY?: number;\r\n    offsetX?: number;\r\n    root?: boolean;\r\n}\r\n\r\nexport class CuiOffsetArgs {\r\n    target: string;\r\n    action: ICuiComponentAction[];\r\n    offsetY?: number;\r\n    offsetX?: number\r\n    root: boolean;\r\n    constructor() {\r\n        this.offsetX = 0;\r\n        this.offsetY = 0;\r\n        this.target = null;\r\n        this.root = false;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.target = args.target;\r\n        this.action = CuiActionsListFactory.get(args.action);\r\n        this.offsetX = getIntOrDefault(args.offsetX, -1);\r\n        this.offsetY = getIntOrDefault(args.offsetY, -1);\r\n        this.root = isStringTrue(args.root)\r\n    }\r\n}\r\nexport class CuiOffsetComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-offset`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffsetHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiOffsetHandler extends CuiHandler<CuiOffsetArgs> {\r\n\r\n    #listener: CuiScrollListener;\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #matched: boolean;\r\n\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiOffsetHandler\", element, attribute, new CuiOffsetArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#matched = false;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseAttribute();\r\n        this.#listener = new CuiScrollListener(this.args.root ? (window as any) : this.element, this.utils.setup.scrollThreshold);\r\n        this.#listener.setCallback(this.onScroll.bind(this));\r\n        this.#listener.attach();\r\n    }\r\n    onUpdate(): void {\r\n        this.parseAttribute();\r\n    }\r\n    onDestroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        this.checkAndPerformActions(ev.top, ev.left);\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#target = this.args.target ? this.getRoot().querySelector(this.args.target) : this.element;\r\n        this.checkAndPerformActions(this.element.scrollTop, this.element.scrollLeft);\r\n\r\n    }\r\n\r\n    private matchesOffset(top: number, left: number) {\r\n        return (this.args.offsetX > 0 && left >= this.args.offsetX) ||\r\n            (this.args.offsetY > 0 && top >= this.args.offsetY)\r\n    }\r\n\r\n    private checkAndPerformActions(top: number, left: number) {\r\n        let matchesOffset = this.matchesOffset(top, left);\r\n        if (matchesOffset && !this.#matched) {\r\n            this.args.action.forEach(action => action.add(this.#target, this.#utils));\r\n            this.#matched = true;\r\n            this.callEvent();\r\n        } else if (!matchesOffset && this.#matched) {\r\n            this.args.action.forEach(action => action.remove(this.#target, this.#utils));\r\n            this.#matched = false;\r\n            this.callEvent();\r\n        }\r\n    }\r\n\r\n    private callEvent() {\r\n        this.emitEvent(EVENTS.OFFSET, {\r\n            matches: this.#matched,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    getRoot(): Element | Document {\r\n        return this.args.root ? document : this.element;\r\n    }\r\n}","import { are, is } from \"./functions\";\r\n\r\nexport interface ICuiTask {\r\n    start(): void;\r\n    stop(): void;\r\n    getId(): any;\r\n    setCallback(callback: () => void): void;\r\n}\r\n\r\nexport class CuiTaskRunner implements ICuiTask {\r\n    #taskId: any;\r\n    #autoRenew: boolean;\r\n    #timeout: number;\r\n    #callback: () => void;\r\n\r\n    constructor(timeout: number, autoRenew: boolean, callback?: () => void) {\r\n        this.#autoRenew = autoRenew;\r\n        this.#timeout = timeout;\r\n        this.#callback = callback;\r\n    }\r\n    start(): void {\r\n        if (!this.canRun()) {\r\n            return;\r\n        }\r\n        this.stop();\r\n        this.#taskId = setTimeout(() => {\r\n            this.#callback();\r\n            this.#taskId = null;\r\n            if (this.#autoRenew) {\r\n                this.start();\r\n            }\r\n        }, this.#timeout);\r\n    }\r\n\r\n    stop(): void {\r\n        if (this.#taskId) {\r\n            clearTimeout(this.#taskId);\r\n            this.#taskId = null\r\n        }\r\n    }\r\n\r\n    getId() {\r\n        return this.#taskId;\r\n    }\r\n\r\n    private canRun(): boolean {\r\n        return is(this.#callback) && this.#timeout > 0;\r\n    }\r\n\r\n    setCallback(callback: () => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { ICuiComponentAction, is, getStringOrDefault, CuiActionsFatory, replacePrefix, getIntOrDefault, isInRange, isStringTrue, EVENTS, getChildrenHeight, SCOPE_SELECTOR } from \"../../core/index\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\n\r\nconst SWITCH_DEFAULT_ACTION_IN = \".{prefix}-switch-animation-default-in\";\r\nconst SWITCH_DEFAULT_ACTION_OUT = \".{prefix}-switch-animation-default-out\";\r\nconst SWITCH_DEFAULT_TARGETS = \"> li\";\r\n\r\nexport class CuiSwitchArgs implements ICuiParsable {\r\n\r\n    targets: string;\r\n    in: ICuiComponentAction;\r\n    out: ICuiComponentAction;\r\n    timeout: number;\r\n    links: string;\r\n    switch: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.targets = getStringOrDefault(args.targets, SCOPE_SELECTOR + SWITCH_DEFAULT_TARGETS)\r\n        this.in = CuiActionsFatory.get(args.in ?? replacePrefix(SWITCH_DEFAULT_ACTION_IN, this.#prefix))\r\n        this.out = CuiActionsFatory.get(args.out ?? replacePrefix(SWITCH_DEFAULT_ACTION_OUT, this.#prefix))\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.links = args.links;\r\n        this.switch = args.switch;\r\n        this.autoTimeout = getIntOrDefault(args.autoTimeout, -1);\r\n        this.height = getStringOrDefault(args.height, 'auto')\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSwitchComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switch`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitchHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitchHandler extends CuiMutableHandler<CuiSwitchArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #switches: CuiElement[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitchHandler\", element, attribute, new CuiSwitchArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#links = [];\r\n        this.#switches = [];\r\n        this.#switchEventId = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getActiveIndex();\r\n        this.getSwitches();\r\n        this.setSwitchesActive(this.#currentIdx);\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n    }\r\n\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getSwitches();\r\n        this.getActiveIndex();\r\n        let nextIdx = this.getNextIndex(index);\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this._log.warning(`Index ${index} is not within the suitable range`);\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this.setSwitchesActive(nextIdx);\r\n        let nextItem = this.#targets[nextIdx];\r\n\r\n        await this.actionsHelper.performSwitchAction(nextItem,\r\n            this.#currentIdx > -1 ? this.#targets[this.#currentIdx] : null,\r\n            this.args.in,\r\n            this.args.out,\r\n            () => {\r\n                nextItem.classList.add(this.activeClassName);\r\n                if (this.#currentIdx > -1)\r\n                    this.#targets[this.#currentIdx].classList.remove(this.activeClassName)\r\n                this.setLinkActive(this.#currentIdx, nextIdx);\r\n                this.helper.setStyle(this.element, 'height', this.getElementHeight(nextItem))\r\n                this.startTask();\r\n                this.isLocked = false;\r\n            },\r\n            this.args.timeout,\r\n        )\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            timestamp: Date.now(),\r\n            index: nextIdx\r\n        })\r\n        return true;\r\n\r\n    }\r\n\r\n    onPushSwitch(index: string) {\r\n        this.switch(index);\r\n    }\r\n\r\n    getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    getNextIndex(val: any): number {\r\n        let idx = -1;\r\n        switch (val) {\r\n            case 'prev':\r\n                idx = this.#currentIdx <= 0 ? this.#targets.length - 1 : this.#currentIdx - 1;\r\n                break;\r\n            case 'next':\r\n                idx = this.#currentIdx < this.#targets.length - 1 ? this.#currentIdx + 1 : 0\r\n                break;\r\n            case 'first':\r\n                idx = 0;\r\n                break;\r\n            case 'last':\r\n                idx = this.#targets.length - 1;\r\n            default:\r\n                idx = getIntOrDefault(val, -1);\r\n                break;\r\n        }\r\n        return idx;\r\n    }\r\n\r\n    getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n    }\r\n\r\n    getLinks() {\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    getSwitches() {\r\n        let s = is(this.args.switch) ? document.querySelectorAll(this.args.switch) : null;\r\n        this.#switches = [];\r\n        if (s) {\r\n            s.forEach(sw => {\r\n                this.#switches.push(<CuiElement>(sw as any))\r\n            })\r\n        }\r\n    }\r\n\r\n    setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        if (isInRange(current, 0, this.#links.length - 1)) {\r\n            this.helper.removeClass(this.activeClassName, this.#links[current])\r\n        }\r\n        if (isInRange(next, 0, this.#links.length - 1)) {\r\n            this.helper.setClass(this.activeClassName, this.#links[next])\r\n        }\r\n    }\r\n    /**\r\n     * Sets propers active state on attached switches\r\n     * @param index \r\n     */\r\n\r\n    setSwitchesActive(index: number) {\r\n        this.#switches.forEach(sw => {\r\n            this.setLinkSwitch(sw.$cuid, index)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Emits push event to attached switch to set proper index\r\n     * @param id - cuid of element\r\n     * @param index - index to be set on element\r\n     */\r\n    setLinkSwitch(id: string, index: number) {\r\n        if (is(id))\r\n            this.utils.bus.emit(EVENTS.SWITCH, id, index);\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { EVENTS, is } from \"../../core/index\";\r\n\r\nconst SWITCHER_LIST_ITEM_SELECTOR = \"li > a\";\r\n\r\nexport class CuiSwitcherArgs implements ICuiParsable {\r\n\r\n    target: string;\r\n    index: string;\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    parse(args: any): void {\r\n        if (!is(args)) {\r\n            return;\r\n        }\r\n        this.target = args.target;\r\n        this.index = args.index;\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSwitcherComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switcher`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitcherHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitcherHandler extends CuiHandler<CuiSwitcherArgs>  {\r\n    #targetId: string;\r\n    #isList: boolean;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitcherHandler\", element, attribute, new CuiSwitcherArgs(), utils);\r\n        this.#targetId = null;\r\n        this.#isList = element.tagName === 'UL';\r\n    }\r\n\r\n    onInit(): void {\r\n        this.setEvents();\r\n        this.getTarget();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.getTarget();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.removeEvents();\r\n    }\r\n\r\n    getTarget() {\r\n        if (!is(this.args.target)) {\r\n            this.#targetId = null;\r\n        }\r\n\r\n        let target = <CuiElement>(document.querySelector(this.args.target) as any);\r\n        if (is(target)) {\r\n            this.#targetId = target.$cuid;\r\n        }\r\n    }\r\n\r\n    setEvents() {\r\n        if (this.#isList) {\r\n            let elements = this.element.querySelectorAll(SWITCHER_LIST_ITEM_SELECTOR);\r\n            elements.forEach((el: Element, index: number) => {\r\n                el.addEventListener('click', this.onListItemClick.bind(this, index))\r\n            })\r\n        } else {\r\n            this.element.addEventListener('click', this.onClickEvent.bind(this))\r\n        }\r\n    }\r\n\r\n    removeEvents() {\r\n        if (this.#isList) {\r\n            let elements = this.element.querySelectorAll(SWITCHER_LIST_ITEM_SELECTOR);\r\n            elements.forEach((el: Element, index: number) => {\r\n                el.removeEventListener('click', this.onListItemClick.bind(this, index))\r\n            })\r\n        } else {\r\n            this.element.removeEventListener('click', this.onClickEvent.bind(this));\r\n        }\r\n    }\r\n\r\n    onClickEvent(ev: MouseEvent) {\r\n        this.getTarget();\r\n        if (!is(this.args.index)) {\r\n            return;\r\n        }\r\n        this.onClick(this.args.index.trim());\r\n    }\r\n\r\n    onListItemClick(index: number, ev: MouseEvent) {\r\n        this.getTarget();\r\n        this.onClick(index);\r\n    }\r\n\r\n    onClick(index: any) {\r\n        if (!is(this.#targetId)) {\r\n            return;\r\n        }\r\n        this.utils.bus.emit(EVENTS.SWITCH, this.#targetId, index);\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is, round } from \"../utils/functions\";\r\n\r\ninterface OnMoveCallback {\r\n    (ev: ICuiMoveEvent): void;\r\n}\r\n\r\ninterface IMoveListener {\r\n    onMove(data: OnMoveCallback): void\r\n    start(): void;\r\n    stop(): void;\r\n}\r\n\r\nexport type CuiMoveEventState = \"down\" | \"up\" | \"move\";\r\nexport interface ICuiMoveEvent {\r\n    x: number;\r\n    y: number;\r\n    moveX: number;\r\n    moveY: number;\r\n    type: CuiMoveEventState;\r\n    target: EventTarget;\r\n    event: MouseEvent | TouchEvent;\r\n}\r\n\r\nexport class CuiMoveEventListener implements ICuiEventListener<ICuiMoveEvent> {\r\n    #element: HTMLElement | Document;\r\n    #onEvent: (t: ICuiMoveEvent) => void;\r\n    #isLocked: boolean;\r\n    #isAttached: boolean;\r\n    #preventDefault: boolean;\r\n    constructor(element?: HTMLElement) {\r\n        this.#isLocked = false;\r\n        this.#element = element ?? document;\r\n        this.#isAttached = false;\r\n        this.#preventDefault = false;\r\n    }\r\n    setCallback(callback: (t: ICuiMoveEvent) => void): void {\r\n        this.#onEvent = callback;\r\n    }\r\n    isInProgress(): boolean {\r\n        throw new Error(\"Method not implemented.\");\r\n    }\r\n    preventDefault(flag: boolean) {\r\n        this.#preventDefault = flag;\r\n    }\r\n    attach(): void {\r\n        if (this.#isAttached) {\r\n            return;\r\n        }\r\n        this.#element.addEventListener('mousedown', this.onMouseDown.bind(this))\r\n        this.#element.addEventListener('mouseup', this.onMouseUp.bind(this))\r\n        this.#element.addEventListener('mousemove', this.onMouseMove.bind(this))\r\n        this.#element.addEventListener('touchstart', this.onTouchStart.bind(this))\r\n        this.#element.addEventListener('touchend', this.onTouchEnd.bind(this))\r\n        this.#element.addEventListener('touchmove', this.onTouchMove.bind(this))\r\n        this.#isAttached = true;\r\n    }\r\n    detach(): void {\r\n        if (!this.#isAttached) {\r\n            return;\r\n        }\r\n        this.#element.removeEventListener('mousedown', this.onMouseDown.bind(this))\r\n        this.#element.removeEventListener('mouseup', this.onMouseUp.bind(this))\r\n        this.#element.removeEventListener('mousemove', this.onMouseMove.bind(this))\r\n        this.#element.removeEventListener('touchstart', this.onTouchStart.bind(this))\r\n        this.#element.removeEventListener('touchend', this.onTouchEnd.bind(this))\r\n        this.#element.removeEventListener('touchmove', this.onTouchMove.bind(this))\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached\r\n    }\r\n\r\n    onMouseDown(ev: MouseEvent) {\r\n        this.publishMouseEvent(\"down\", ev)\r\n\r\n    }\r\n\r\n    onMouseUp(ev: MouseEvent) {\r\n        this.publishMouseEvent(\"up\", ev)\r\n\r\n    }\r\n\r\n    onMouseMove(ev: MouseEvent) {\r\n        this.publishMouseEvent(\"move\", ev)\r\n    }\r\n\r\n    onTouchStart(ev: TouchEvent) {\r\n        this.publishTouchEvent('down', ev);\r\n    }\r\n\r\n    onTouchEnd(ev: TouchEvent) {\r\n        this.publishTouchEvent('up', ev);\r\n    }\r\n\r\n    onTouchMove(ev: TouchEvent) {\r\n        this.publishTouchEvent('move', ev);\r\n    }\r\n\r\n    private publishMouseEvent(type: CuiMoveEventState, ev: MouseEvent) {\r\n        if (this.#preventDefault && ev.cancelable) {\r\n            ev.preventDefault();\r\n        }\r\n        if (is(this.#onEvent)) {\r\n            this.#onEvent({\r\n                type: type,\r\n                x: ev.clientX,\r\n                y: ev.clientY,\r\n                moveX: ev.movementX,\r\n                moveY: ev.movementY,\r\n                target: ev.target,\r\n                event: ev\r\n            })\r\n        }\r\n    }\r\n\r\n    private publishTouchEvent(type: CuiMoveEventState, ev: TouchEvent) {\r\n        if (this.#preventDefault && ev.cancelable)\r\n            ev.preventDefault();\r\n        if (is(this.#onEvent)) {\r\n            let touch = null;\r\n            if (ev.touches.length > 0) {\r\n                touch = ev.touches[0]\r\n            } else if (ev.changedTouches.length > 0) {\r\n                touch = ev.changedTouches[0]\r\n            }\r\n            this.#onEvent({\r\n                event: ev,\r\n                type: type,\r\n                target: ev.target,\r\n                x: is(touch) ? touch.clientX : -1,\r\n                y: is(touch) ? touch.clientY : -1,\r\n                moveX: -1,\r\n                moveY: -1\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n// export class CuiMoveEventListener implements ICuiEventListener<ICuiMoveEvent> {\r\n//     #isAttached: boolean;\r\n//     #element: HTMLElement | Document;\r\n//     #callback: (t: ICuiMoveEvent) => void;\r\n//     #listeners: IMoveListener[];\r\n//     #prevent: boolean;\r\n//     constructor(element: HTMLElement | Document, trackOutside: boolean = true) {\r\n//         this.#element = element;\r\n//         this.#listeners = [\r\n//             new MouseMoveListener(element, trackOutside),\r\n//             new TouchMoveListener(element, trackOutside)\r\n//         ]\r\n//         this.#listeners.forEach(listener => listener.onMove(this.onMove.bind(this)))\r\n//     }\r\n\r\n//     setCallback(callback: (t: ICuiMoveEvent) => void): void {\r\n//         this.#callback = callback;\r\n\r\n//     }\r\n//     isInProgress(): boolean {\r\n//         return false;\r\n//     }\r\n\r\n//     preventDefault(flag: boolean) {\r\n//         this.#prevent = flag;\r\n//     }\r\n\r\n//     attach(): void {\r\n//         this.#listeners.forEach(listener => listener.start());\r\n//     }\r\n//     detach(): void {\r\n//         this.#listeners.forEach(listener => listener.stop());\r\n//     }\r\n//     isAttached(): boolean {\r\n//         return this.#isAttached;\r\n//     }\r\n\r\n//     private onMove(data: ICuiMoveEvent) {\r\n//         if (this.#callback) {\r\n//             this.#callback(data);\r\n//         }\r\n//     }\r\n// }\r\n\r\n// export class MouseMoveListener implements IMoveListener {\r\n//     #callback: OnMoveCallback;\r\n//     #element: HTMLElement | Document;\r\n//     #isTracking: boolean;\r\n//     #startX: number;\r\n//     #startY: number;\r\n//     #threshold: number;\r\n//     #trackOutside: boolean\r\n//     constructor(element: HTMLElement | Document, trackOutside: boolean = true) {\r\n//         this.#callback = undefined;\r\n//         this.#element = element;\r\n//         this.#isTracking = false;\r\n//         this.#threshold = 4;\r\n//         this.#trackOutside = trackOutside;\r\n//     }\r\n//     start() {\r\n//         this.#element.addEventListener(\"mousedown\", this.onMouseDown.bind(this))\r\n//         this.#element.addEventListener(\"mouseup\", this.onMouseUp.bind(this))\r\n//         this.#element.addEventListener(\"mousemove\", this.onMouseMove.bind(this))\r\n//     }\r\n\r\n//     stop() {\r\n//         this.#element.removeEventListener(\"mousedown\", this.onMouseDown.bind(this))\r\n//         this.#element.removeEventListener(\"mouseup\", this.onMouseUp.bind(this))\r\n//         this.#element.removeEventListener(\"mousemove\", this.onMouseMove.bind(this))\r\n//     }\r\n//     onMove(data: OnMoveCallback): void {\r\n//         this.#callback = data;\r\n//     }\r\n\r\n//     onMouseDown(ev: MouseEvent) {\r\n//         this.#isTracking = true;\r\n//         this.#startX = ev.pageX;\r\n//         this.#startY = ev.pageY;\r\n//         this.emit(ev, \"down\");\r\n//     }\r\n\r\n//     onMouseUp(ev: MouseEvent) {\r\n//         if (!this.#isTracking) {\r\n//             return;\r\n//         }\r\n//         this.#isTracking = false;\r\n//         this.emit(ev, \"up\");\r\n//         this.#startX = 0;\r\n//         this.#startY = 0;\r\n//     }\r\n\r\n//     onMouseMove(ev: MouseEvent) {\r\n//         if (!this.#isTracking) {\r\n//             return;\r\n//         }\r\n//         // if (this.#trackOutside && this.isOutOfElement(ev)) {\r\n//         //     this.onMouseUp(ev);\r\n//         //     return;\r\n//         // }\r\n//         this.emit(ev, \"move\");\r\n//     }\r\n\r\n//     emit(ev: MouseEvent, type: CuiMoveEventState) {\r\n//         if (ev.cancelable) {\r\n//             ev.preventDefault();\r\n//         }\r\n//         let ratio = this.calcRatio(ev);\r\n//         let data: ICuiMoveEvent = {\r\n//             type: type,\r\n//             source: \"mouse\",\r\n//             event: ev,\r\n//             target: ev.target,\r\n//             x: ev.pageX,\r\n//             y: ev.pageY,\r\n//             moveX: ev.movementX,\r\n//             moveY: ev.movementY,\r\n//             ratioX: round(ratio[0], 2),\r\n//             ratioY: round(ratio[1], 2)\r\n//         }\r\n//         this.#callback(data);\r\n//     }\r\n\r\n//     calcRatio(ev: MouseEvent): [number, number] {\r\n//         let width = this.#element.offsetWidth;\r\n//         let height = this.#element.offsetHeight;\r\n//         return [(ev.pageX - this.#startX) / width, (ev.pageY - this.#startY) / height];\r\n//     }\r\n\r\n//     // isOutOfElement(ev: MouseEvent): boolean {\r\n//     //     return this.#element.offsetTop + this.#threshold > ev.pageY ||\r\n//     //         this.#element.offsetTop + this.#element.offsetHeight - this.#threshold < ev.pageY ||\r\n//     //         this.#element.offsetLeft + this.#threshold > ev.pageX ||\r\n//     //         this.#element.offsetLeft + this.#element.offsetWidth - this.#threshold < ev.pageX\r\n//     // }\r\n// }\r\n\r\n// export class TouchMoveListener implements IMoveListener {\r\n//     #element: HTMLElement;\r\n//     #callback: OnMoveCallback;\r\n//     #startX: number;\r\n//     #startY: number;\r\n//     #prevX: number;\r\n//     #prevY: number;\r\n//     #isTracking: boolean;\r\n//     #threshold: number;\r\n//     #trackOutside: boolean;\r\n\r\n//     constructor(element: HTMLElement, trackOutside: boolean = true) {\r\n//         this.#element = element;\r\n//         this.#startX = -1;\r\n//         this.#startY = -1;\r\n//         this.#prevX = -1;\r\n//         this.#prevY = -1;\r\n//         this.#isTracking = false;\r\n//         this.#threshold = 10;\r\n//         this.#trackOutside = trackOutside;\r\n//     }\r\n\r\n//     start() {\r\n//         this.#element.addEventListener(\"touchstart\", this.onTouchStart.bind(this))\r\n//         this.#element.addEventListener(\"touchmove\", this.onTouchMove.bind(this))\r\n//         this.#element.addEventListener(\"touchend\", this.onTouchEnd.bind(this))\r\n//     }\r\n\r\n//     stop() {\r\n//         this.#element.removeEventListener(\"touchstart\", this.onTouchStart.bind(this))\r\n//         this.#element.removeEventListener(\"touchmove\", this.onTouchMove.bind(this))\r\n//         this.#element.removeEventListener(\"touchend\", this.onTouchEnd.bind(this))\r\n//     }\r\n//     onMove(data: OnMoveCallback): void {\r\n//         this.#callback = data;\r\n//     }\r\n\r\n//     onTouchStart(ev: TouchEvent) {\r\n//         if (this.#isTracking) {\r\n//             return;\r\n//         }\r\n//         const touch = ev.changedTouches[0];\r\n//         if (touch) {\r\n//             this.#isTracking = true;\r\n//             this.#startX = touch.pageX;\r\n//             this.#startY = touch.pageY;\r\n//             this.#prevX = touch.pageX;\r\n//             this.#prevY = touch.pageY;\r\n//             this.emit(touch, ev, \"down\");\r\n//         }\r\n\r\n//     }\r\n\r\n//     onTouchMove(ev: TouchEvent) {\r\n//         if (!this.#isTracking) {\r\n//             return;\r\n//         }\r\n//         const touch = ev.changedTouches[0];\r\n//         if (touch) {\r\n//             if (this.#trackOutside && this.isOutOfElement(touch)) {\r\n//                 this.onTouchEnd(ev);\r\n//                 return;\r\n//             }\r\n//             this.emit(touch, ev, \"move\");\r\n//             this.#prevX = touch.pageX;\r\n//             this.#prevY = touch.pageY;\r\n//         }\r\n\r\n//     }\r\n\r\n//     onTouchEnd(ev: TouchEvent) {\r\n//         if (!this.#isTracking) {\r\n//             return;\r\n//         }\r\n//         this.#isTracking = false;\r\n//         const touch = ev.changedTouches[0];\r\n//         this.emit(touch, ev, \"up\");\r\n//         this.#startX = -1;\r\n//         this.#startY = -1;\r\n//     }\r\n\r\n//     emit(ev: Touch, base: TouchEvent, type: CuiMoveEventState) {\r\n//         if (!ev) {\r\n//             return;\r\n//         }\r\n//         if (base.cancelable) {\r\n//             base.preventDefault();\r\n//         }\r\n//         const [ratioX, ratioY] = this.getRatio(ev);\r\n//         let data: ICuiMoveEvent = {\r\n//             source: \"touch\",\r\n//             event: base,\r\n//             target: ev.target,\r\n//             type: type,\r\n//             x: ev.pageX,\r\n//             y: ev.pageY,\r\n//             moveX: ev.pageX - this.#prevX,\r\n//             moveY: ev.pageY - this.#prevY,\r\n//             ratioX: ratioX,\r\n//             ratioY: ratioY\r\n//         }\r\n//         this.#callback(data);\r\n//     }\r\n\r\n//     getRatio(ev: Touch): [number, number] {\r\n//         let width = this.#element.offsetWidth;\r\n//         let height = this.#element.offsetHeight;\r\n//         return [(ev.pageX - this.#startX) / width, (ev.pageY - this.#startY) / height];\r\n//     }\r\n\r\n//     isOutOfElement(ev: Touch): boolean {\r\n//         return this.#element.offsetTop + this.#threshold > ev.pageY ||\r\n//             this.#element.offsetTop + this.#element.offsetHeight - this.#threshold < ev.pageY ||\r\n//             this.#element.offsetLeft + this.#threshold > ev.pageX ||\r\n//             this.#element.offsetLeft + this.#element.offsetWidth - this.#threshold < ev.pageX\r\n//     }\r\n// }","export interface ICuiFloatPositionCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport interface ICuiFloatResizeCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport class BasePositionCalculator implements ICuiFloatPositionCalculator {\r\n\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        return [x, y];\r\n    }\r\n\r\n}\r\n\r\nexport class OptionalPositionCalculator implements ICuiFloatPositionCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let newX = this.#element.offsetLeft + diffX;\r\n        let newY = this.#element.offsetTop + diffY;\r\n        return [newX, newY];\r\n    }\r\n\r\n}\r\n\r\nexport class BaseResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = x - this.#element.offsetLeft;\r\n        let height = y - this.#element.offsetTop;\r\n        return [width, height];\r\n    }\r\n}\r\n\r\nexport class OptionalResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = this.#element.offsetWidth + diffX;\r\n        let height = this.#element.offsetHeight + diffY;\r\n        return [width, height];\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable, ICuiClosable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, getOffsetLeft, is } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiActionsFatory, CuiClassAction } from \"../../core/utils/actions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { KeyDownEvent } from \"../../plugins/keys/observer\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { BasePositionCalculator, BaseResizeCalculator, ICuiFloatPositionCalculator, ICuiFloatResizeCalculator } from \"./helpers\";\r\n\r\nconst FLOAT_OPEN_ANIMATION_CLASS = '{prefix}-float-default-in';\r\nconst FLOAT_CLOSE_ANIMATION_CLASS = '{prefix}-float-default-out';\r\nconst CONTAINER = '.{prefix}-float-container';\r\nconst MOVE = '.{prefix}-float-move';\r\nconst RESIZE = '.{prefix}-float-resize';\r\n\r\n\r\nexport class CuiFloatArgs {\r\n    escClose: boolean;\r\n    constructor() {\r\n        this.escClose = false;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n    }\r\n}\r\n\r\nexport class CuiFloatComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-float`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiFloatHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiFloatHandler extends CuiHandler<CuiFloatArgs> implements ICuiComponentHandler, ICuiOpenable, ICuiClosable {\r\n\r\n    #prefix: string;\r\n    #timeout: number;\r\n    #resizeBtn: HTMLElement;\r\n    #moveBtn: HTMLElement;\r\n    #isMoving: boolean;\r\n    #isResizing: boolean;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #moveListener: CuiMoveEventListener;\r\n    #positionCalculator: ICuiFloatPositionCalculator;\r\n    #resizeCalculator: ICuiFloatResizeCalculator;\r\n    #eventIdOpen: string;\r\n    #eventIdClose: string;\r\n    #eventIdKey: string;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiFloatHandler\", element, attribute, new CuiFloatArgs(), utils);\r\n        this.#eventIdOpen = null;\r\n        this.#eventIdClose = null;\r\n        this.#eventIdKey = null;\r\n        this.#prefix = prefix;\r\n        this.#timeout = utils.setup.animationTimeLong;\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#positionCalculator = new BasePositionCalculator();\r\n        this.#resizeCalculator = new BaseResizeCalculator(element as HTMLElement)\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        this.#eventIdClose = this.onEvent(EVENTS.CLOSE, this.close.bind(this));\r\n        this.#eventIdOpen = this.onEvent(EVENTS.OPEN, this.open.bind(this));\r\n        this.#moveBtn = this.element.querySelector(replacePrefix(MOVE, this.#prefix))\r\n        this.#resizeBtn = this.element.querySelector(replacePrefix(RESIZE, this.#prefix))\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#moveListener.preventDefault(true);\r\n        this.#moveListener.attach();\r\n        this._log.debug(\"Initialized\", \"handle\")\r\n    }\r\n\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#moveListener.detach();\r\n        this.detachEvent(EVENTS.CLOSE, this.#eventIdClose);\r\n        this.detachEvent(EVENTS.OPEN, this.#eventIdOpen);\r\n\r\n    }\r\n\r\n    async open(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn('open')) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            this._log.warning(\"Float is already opened\");\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Float ${this.cuid}`, 'open')\r\n        let action = this.getAction(FLOAT_OPEN_ANIMATION_CLASS);\r\n        return this.performAction(action, this.#timeout, this.onOpen.bind(this, args), () => {\r\n            this.helper.setClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'true');\r\n        });\r\n    }\r\n\r\n    async close(args: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\") || !this.isActive()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Dialog ${this.cuid}`, 'close')\r\n        let action = this.getAction(FLOAT_CLOSE_ANIMATION_CLASS);\r\n        return this.performAction(action, this.#timeout, this.onClose.bind(this, args), () => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        });\r\n    }\r\n\r\n    onClose(state: any) {\r\n\r\n\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#eventIdKey);\r\n\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now(),\r\n            state: state\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    onOpen(state?: any) {\r\n        if (this.args.escClose) {\r\n            this.#eventIdKey = this.onEvent(EVENTS.KEYDOWN, this.onEscClose.bind(this))\r\n        }\r\n        this.emitEvent(EVENTS.OPENED, {\r\n            timestamp: Date.now(),\r\n            state: state\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    async onEscClose(ev: KeyDownEvent) {\r\n        if (ev.event.key === \"Escape\") {\r\n            await this.close('Clesed by key');\r\n        }\r\n    }\r\n\r\n    onMove(ev: ICuiMoveEvent) {\r\n        switch (ev.type) {\r\n            case 'down':\r\n                this.onMouseDown(ev);\r\n                break;\r\n            case 'up':\r\n                this.onMouseUp(ev)\r\n                break;\r\n            case 'move':\r\n                this.onMouseMove(ev);\r\n                break;\r\n        }\r\n    }\r\n\r\n    onMouseMove(ev: ICuiMoveEvent) {\r\n        if (this.#isMoving) {\r\n            this.peform(ev, this.move.bind(this))\r\n        } else if (this.#isResizing) {\r\n            this.peform(ev, this.resize.bind(this))\r\n        }\r\n    }\r\n\r\n    peform(ev: ICuiMoveEvent, callback: (element: HTMLElement, x: number, y: number, diffX: number, diffY: number) => void) {\r\n        this.mutate(() => {\r\n            if (is(callback))\r\n                callback(this.element as HTMLElement, ev.x, ev.y, (ev.x - this.#prevX), (ev.y - this.#prevY));\r\n            this.#prevX = ev.x;\r\n            this.#prevY = ev.y;\r\n        })\r\n    }\r\n\r\n    resize(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newWidth, newHeight] = this.#resizeCalculator.calculate(x, y, diffX, diffY);\r\n        if (this.fitsWindow(element.offsetTop, element.offsetLeft, newWidth, newHeight)) {\r\n            element.style.width = newWidth + \"px\";\r\n            element.style.height = newHeight + \"px\";\r\n        }\r\n    }\r\n\r\n    move(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newX, newY] = this.#positionCalculator.calculate(x, y, diffX, diffY)\r\n        if (this.fitsWindow(newY, newX, element.offsetWidth, element.offsetHeight)) {\r\n            element.style.left = newX + \"px\";\r\n            element.style.top = newY + \"px\";\r\n        }\r\n    }\r\n\r\n    onMouseDown(ev: ICuiMoveEvent) {\r\n        if (ev.target === this.#moveBtn) {\r\n            this.#isMoving = true;\r\n        } else if (ev.target === this.#resizeBtn) {\r\n            this.#isResizing = true;\r\n        }\r\n        this.#prevX = ev.x;\r\n        this.#prevY = ev.y;\r\n    }\r\n\r\n    onMouseUp(ev: ICuiMoveEvent) {\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n\r\n    }\r\n\r\n    getAction(className: string): ICuiComponentAction {\r\n        return new CuiClassAction(replacePrefix(className, this.#prefix));\r\n    }\r\n\r\n    fitsWindow(top: number, left: number, width: number, height: number) {\r\n        return (top + height < window.innerHeight - 10) &&\r\n            (top > 10) && (left > 10) &&\r\n            (left + width < window.innerWidth - 10);\r\n    }\r\n}","import { ICuiPropertyAnimator, AnimatorPropertyValue, TransformAnimatorProperty } from \"./interfaces\";\r\n\r\nexport class OpacityAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    lenght: number;\r\n    from: number;\r\n    to: number;\r\n    rtl: boolean;\r\n    constructor() {\r\n        this.lenght = this.to = this.from = -1;\r\n        this.rtl = false;\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue): void {\r\n        this.from = prop.from;\r\n        this.to = prop.to;\r\n        this.lenght = Math.abs(this.to - this.from);\r\n        this.rtl = this.from > this.to;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        let current = this.lenght * progress\r\n        if (element[\"style\"]) {\r\n            element.style.opacity = this.rtl ? this.from - current : this.from + current;\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport class PropertyAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    lenght: number;\r\n    from: number;\r\n    to: number;\r\n    rtl: boolean;\r\n    property: string;\r\n    #unit: string;\r\n    constructor(property: string) {\r\n        this.property = property;\r\n        this.lenght = this.to = this.from = -1;\r\n        this.rtl = false;\r\n        this.#unit = \"\";\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue) {\r\n        this.from = prop.from;\r\n        this.to = prop.to;\r\n        this.lenght = Math.abs(this.to - this.from);\r\n        this.rtl = this.from > this.to;\r\n        this.#unit = prop.unit;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        let current = this.lenght * progress\r\n        if (element[\"style\"]) {\r\n            element.style[this.property] = this.createValue(this.rtl ? this.from - current : this.from + current, this.#unit);\r\n        }\r\n    }\r\n\r\n    private createValue(value: number, unit: string) {\r\n        return `${value}${unit ?? \"\"}`;\r\n    }\r\n}\r\n\r\nexport class TransformAnimator implements ICuiPropertyAnimator<TransformAnimatorProperty> {\r\n    prop: TransformAnimatorProperty;\r\n    constructor() {\r\n        this.prop = undefined;\r\n    }\r\n\r\n    setProperty(prop: TransformAnimatorProperty) {\r\n        this.prop = prop;\r\n    }\r\n\r\n    build(progress: number) {\r\n        let props: string[] = [];\r\n        for (let name in this.prop) {\r\n            let cur = this.prop[name];\r\n            let diff = Math.abs(cur.to - cur.from);\r\n            let rtl = cur.from > cur.to;\r\n            let val = rtl ? cur.from - (diff * progress) : cur.from + (diff * progress)\r\n            props.push(this.buildSingle(name, val, cur.unit))\r\n        }\r\n\r\n        return props.join(\" \");\r\n    }\r\n\r\n    buildSingle(name: string, value: number, unit: string) {\r\n        return `${name}(${value}${unit})`;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (element[\"style\"]) {\r\n            element.style.transform = this.build(progress);\r\n        }\r\n\r\n    }\r\n}\r\n","import { OpacityAnimator, TransformAnimator, PropertyAnimator } from \"./animators\";\r\nimport { ICuiPropertyAnimator, AnimationProperty, AnimatorPropertyValue, TransformAnimatorProperty, OnAnimationFinishCallback } from \"./interfaces\";\r\n\r\nexport type PropsTypes = AnimatorPropertyValue | TransformAnimatorProperty;\r\n\r\n// export class CuiAnimation {\r\n//     element: Element;\r\n//     start: number;\r\n//     timeout: number;\r\n//     inProgress: boolean;\r\n//     state: \"idle\" | \"running\" | \"cancel\";\r\n//     callback: () => void;\r\n//     animators: ICuiPropertyAnimator<PropsTypes>[];\r\n//     factor: number;\r\n//     constructor(element?: Element) {\r\n//         this.element = element;\r\n//         this.start = undefined;\r\n//         this.callback = undefined;\r\n//         this.animators = [];\r\n//         this.state = 'idle';\r\n//         this.factor = 1;\r\n//     }\r\n\r\n//     setElement(element: Element) {\r\n//         this.element = element;\r\n//     }\r\n\r\n//     setTimeout(timeout: number) {\r\n//         this.timeout = timeout;\r\n//     }\r\n\r\n//     cancel() {\r\n//         if (this.state === 'running') {\r\n//             this.state = 'cancel';\r\n//         }\r\n//     }\r\n\r\n//     onFinish(callback: () => void) {\r\n//         this.callback = callback;\r\n//     }\r\n\r\n//     callEnd() {\r\n//         this.inProgress = false;\r\n//         this.state = 'idle';\r\n//         this.start = undefined;\r\n//         this.factor = 1;\r\n//         this.animators = [];\r\n//         if (this.callback) {\r\n//             this.callback();\r\n//         }\r\n//     }\r\n\r\n//     perform(props: AnimationProperty<PropsTypes>, timeout?: number, factor?: number) {\r\n//         if (this.state === 'running') {\r\n//             return;\r\n//         }\r\n//         for (let prop in props) {\r\n//             let animator = new AnimatorFactory().get(prop);\r\n//             if (!animator) return;\r\n//             animator.setProperty(props[prop]);\r\n//             this.animators.push(animator);\r\n//         }\r\n//         this.timeout = timeout ?? this.timeout;\r\n//         this.factor = factor ?? this.factor;\r\n//         window.requestAnimationFrame(this.animate.bind(this));\r\n//     }\r\n\r\n//     animate(timestamp: number) {\r\n//         if (this.state === 'cancel') {\r\n//             this.callEnd();\r\n//             return;\r\n//         }\r\n//         this.state = 'running';\r\n//         this.inProgress = true;\r\n//         if (!this.start) {\r\n//             this.start = timestamp;\r\n//         }\r\n//         this.factor = this.factor === 1 ? 1 : Math.max(this.factor * 0.85, 1);\r\n//         let progress = timestamp - this.start;\r\n//         this.publishProgress(progress, progress / this.timeout);\r\n//         if (progress < this.timeout) {\r\n//             window.requestAnimationFrame(this.animate.bind(this));\r\n//         } else {\r\n//             this.callEnd();\r\n//         }\r\n//     }\r\n\r\n//     private publishProgress(currentTime: number, progress: number) {\r\n//         this.animators.forEach(animator => animator.perform(this.element, Math.min(progress, 1), this.factor))\r\n//     }\r\n// }\r\n\r\nexport class CuiAnimation {\r\n    #engine: CuiAnimationEngine;\r\n    #timeout: number;\r\n    constructor(element?: Element) {\r\n        this.#engine = new CuiAnimationEngine(true);\r\n        this.#engine.setElement(element);\r\n        this.#timeout = 0;\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#engine.setElement(element);\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#engine.onFinish(callback);\r\n    }\r\n\r\n    perform(props: AnimationProperty<PropsTypes>, timeout?: number, factor?: number) {\r\n        let animators = [];\r\n        for (let prop in props) {\r\n            let animator = new AnimatorFactory().get(prop);\r\n            if (!animator) return;\r\n            animator.setProperty(props[prop]);\r\n            animators.push(animator);\r\n        }\r\n        this.#engine.setAnimators(animators);\r\n        this.#engine.animate(timeout ?? this.#timeout)\r\n    }\r\n}\r\n\r\n\r\n\r\nclass AnimatorFactory {\r\n    get(id: string): ICuiPropertyAnimator<AnimatorPropertyValue | TransformAnimatorProperty> {\r\n        switch (id) {\r\n            case \"opacity\":\r\n                return new OpacityAnimator();\r\n            case \"transform\":\r\n                return new TransformAnimator();\r\n            default:\r\n                return new PropertyAnimator(id);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiAnimationEngine {\r\n    #onFinishCallback: OnAnimationFinishCallback;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #lock: boolean;\r\n    #animStartStamp: number;\r\n    #element: Element;\r\n    #cleanOnFinish: boolean;\r\n    #errorOccured: boolean;\r\n    constructor(cleanOnFinish?: boolean) {\r\n        this.#animators = [];\r\n        this.#element = undefined;\r\n        this.#animStartStamp = undefined;\r\n        this.#cleanOnFinish = cleanOnFinish ?? false;\r\n        this.#lock = false;\r\n    }\r\n\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#onFinishCallback = callback;\r\n    }\r\n\r\n    setAnimators(animators: ICuiPropertyAnimator<PropsTypes>[]) {\r\n        this.#animators = animators;\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    animate(timeout: number, progress?: number, revert?: boolean): void {\r\n        if (this.#lock) {\r\n            return;\r\n        }\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            throw new Error(\"Animation cannot be performed: element or animators are not set\");\r\n        }\r\n        let animationProgress = progress ?? 0;\r\n        let shouldCalcRevert = revert ? revert : false;\r\n        this.#lock = true;\r\n        requestAnimationFrame(this.animateAsync.bind(this, timeout, animationProgress, shouldCalcRevert))\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#lock;\r\n    }\r\n\r\n    private animateAsync(timeout: number, initialProgress: number, revert: boolean, timestamp: number) {\r\n        if (!this.#animStartStamp) {\r\n            this.#animStartStamp = timestamp;\r\n        }\r\n        let pr = timestamp - this.#animStartStamp;\r\n        let animationProgress = pr / timeout;\r\n        let currProgress = 0;\r\n        if (initialProgress === 0) {\r\n            currProgress = animationProgress;\r\n        } else {\r\n            currProgress = revert ? initialProgress - (animationProgress * initialProgress) : initialProgress + (animationProgress * initialProgress)\r\n        }\r\n        this.callUpdate(revert ? Math.max(currProgress, 0) : Math.min(currProgress, 1), 1);\r\n        if (pr < timeout && !this.#errorOccured) {\r\n            requestAnimationFrame(this.animateAsync.bind(this, timeout, initialProgress, revert))\r\n        } else {\r\n            this.endAnimation(revert);\r\n        }\r\n    }\r\n\r\n    private endAnimation(reverted: boolean) {\r\n        if (this.#cleanOnFinish) {\r\n            this.#element.removeAttribute(\"style\");\r\n        }\r\n        if (this.#onFinishCallback) {\r\n            this.#onFinishCallback(this.#element, reverted, this.#errorOccured);\r\n        }\r\n        this.#errorOccured = false;\r\n        this.#animStartStamp = undefined;\r\n        this.#lock = false;\r\n    }\r\n\r\n    private callUpdate(progress: number, factor: number) {\r\n        try {\r\n            this.#animators.forEach(animator => animator.perform(this.#element, progress, factor));\r\n        } catch (e) {\r\n            console.error(e);\r\n            this.#errorOccured = true;\r\n        }\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiSwipeAnimationEngine {\r\n    #element: Element;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #animationEngine: CuiAnimationEngine;\r\n    constructor(shouldCleanOnFinish?: boolean) {\r\n        this.#element = undefined;\r\n        this.#animators = [];\r\n        this.#animationEngine = new CuiAnimationEngine(shouldCleanOnFinish);\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnFinish(callback: OnAnimationFinishCallback) {\r\n        this.#animationEngine.onFinish(callback);\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        this.#animators = [];\r\n        for (let prop in props) {\r\n            let animator = new AnimatorFactory().get(prop);\r\n            if (!animator) return;\r\n            animator.setProperty(props[prop]);\r\n            this.#animators.push(animator);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    update(progress: number) {\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            return;\r\n        }\r\n        this.#animators.forEach(animator => animator.perform(this.#element, Math.min(progress, 1), 1))\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators in RAF\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    updateAsync(progress: number) {\r\n        requestAnimationFrame(this.update.bind(this, progress));\r\n    }\r\n\r\n    /**\r\n     * Finish swipe animation using animation engine\r\n     * @param progress - initial progress value 0..1\r\n     * @param timeout - time for animation to perform\r\n     * @param revert - whether animation should return back to 0 or progress to the end\r\n     */\r\n    finish(progress: number, timeout: number, revert: boolean) {\r\n        this.#animationEngine.setElement(this.#element);\r\n        this.#animationEngine.setAnimators(this.#animators);\r\n        this.#animationEngine.animate(timeout, progress, revert);\r\n    }\r\n\r\n}","import { AnimationDefinition } from \"./interfaces\";\r\n\r\nexport const SlideAnimationDefnition: AnimationDefinition = {\r\n    current: {\r\n        left: {\r\n            transform: {\r\n                translateX: {\r\n                    from: 0,\r\n                    to: -100,\r\n                    unit: \"%\"\r\n                }\r\n            }\r\n        },\r\n        right: {\r\n            transform: {\r\n                translateX: {\r\n                    from: 0,\r\n                    to: 100,\r\n                    unit: \"%\"\r\n                }\r\n            }\r\n        }\r\n    },\r\n    previous: {\r\n        left: {\r\n            transform: {\r\n                translateX: {\r\n                    from: 100,\r\n                    to: 0,\r\n                    unit: \"%\"\r\n                }\r\n            }\r\n        },\r\n        right: {\r\n            transform: {\r\n                translateX: {\r\n                    from: -100,\r\n                    to: 0,\r\n                    unit: \"%\"\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport const FadeAnimationDefnition: AnimationDefinition = {\r\n    current: {\r\n        left: {\r\n            opacity: {\r\n                from: 1,\r\n                to: 0\r\n            }\r\n        },\r\n        right: {\r\n            opacity: {\r\n                from: 1,\r\n                to: 0\r\n            }\r\n        }\r\n    },\r\n    previous: {\r\n        left: {\r\n            opacity: {\r\n                from: 0,\r\n                to: 1\r\n            }\r\n        },\r\n        right: {\r\n            opacity: {\r\n                from: 0,\r\n                to: 1\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport const PushAnimationDefnition: AnimationDefinition = {\r\n    current: {\r\n        left: {\r\n            transform: {\r\n                translateX: {\r\n                    from: 0,\r\n                    to: -10,\r\n                    unit: \"%\"\r\n                }\r\n            }\r\n        },\r\n        right: {\r\n            transform: {\r\n                translateX: {\r\n                    from: 0,\r\n                    to: 10,\r\n                    unit: \"%\"\r\n                }\r\n            }\r\n        }\r\n    },\r\n    previous: {\r\n        left: {\r\n            transform: {\r\n                translateX: {\r\n                    from: 100,\r\n                    to: 0,\r\n                    unit: \"%\"\r\n                }\r\n            }\r\n        },\r\n        right: {\r\n            transform: {\r\n                translateX: {\r\n                    from: -100,\r\n                    to: 0,\r\n                    unit: \"%\"\r\n                }\r\n            }\r\n        }\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { is, getStringOrDefault, getIntOrDefault, isInRange, EVENTS, getChildrenHeight, SCOPE_SELECTOR, CLASSES } from \"../../core/index\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { CuiAnimation, CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { AnimationDefinition } from \"./slider/interfaces\";\r\nimport { FadeAnimationDefnition, PushAnimationDefnition, SlideAnimationDefnition } from \"./slider/animations\";\r\n\r\n\r\nconst SWITCH_DEFAULT_TARGETS = \"> li\";\r\n\r\nexport class CuiSliderArgs implements ICuiParsable {\r\n\r\n    targets: string;\r\n    timeout: number;\r\n    links: string;\r\n    switch: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.targets = getStringOrDefault(args.targets, SCOPE_SELECTOR + SWITCH_DEFAULT_TARGETS)\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.links = args.links;\r\n        this.switch = args.switch;\r\n        this.autoTimeout = getIntOrDefault(args.autoTimeout, -1);\r\n        this.height = getStringOrDefault(args.height, 'auto')\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSliderComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-slider`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: Element, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSliderHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSliderHandler extends CuiMutableHandler<CuiSliderArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string;\r\n    #moveListener: CuiMoveEventListener;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #ratio: number;\r\n    #nextIdx: number;\r\n    #nextElement: HTMLElement;\r\n    #ratioThreshold: number;\r\n    #currSlider: CuiSwipeAnimationEngine;\r\n    #nextSlider: CuiSwipeAnimationEngine;\r\n    #animationDef: AnimationDefinition;\r\n    constructor(element: Element, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSLiderHandler\", element, attribute, new CuiSliderArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#nextIdx = -1;\r\n        this.#links = [];\r\n        this.#switchEventId = null;\r\n        this.#isTracking = false;\r\n        this.#startX = -1;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#ratio = 0;\r\n        this.#nextElement = null;\r\n        this.#ratioThreshold = 0.5;\r\n        this.#currSlider = new CuiSwipeAnimationEngine();\r\n        this.#nextSlider = new CuiSwipeAnimationEngine();\r\n        this.#currSlider.setOnFinish(this.onAnimationFinish.bind(this));\r\n        this.#animationDef = PushAnimationDefnition;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getActiveIndex();\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#moveListener.preventDefault(true);\r\n        this.#moveListener.attach();\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.#moveListener.detach();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n\r\n    }\r\n\r\n    onMove(data: ICuiMoveEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        let current = this.#targets[this.#currentIdx] as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (current.contains((data.target as Node))) {\r\n                    this.#isTracking = true;\r\n                    this.#startX = data.x;\r\n                    this.#currSlider.setElement(current);\r\n                }\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                this.isLocked = true;\r\n                let timeout = Math.abs(this.#ratio * this.args.timeout);\r\n                let back = Math.abs(this.#ratio) <= this.#ratioThreshold;\r\n                this.#currSlider.finish(Math.abs(this.#ratio), timeout, back);\r\n                this.#nextSlider.finish(Math.abs(this.#ratio), timeout, back);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (this.#isTracking) {\r\n                    this.#ratio = (data.x - this.#startX) / current.offsetWidth;\r\n\r\n                    let nextIdx = this.getNextIndex(this.#ratio > 0 ? \"next\" : \"prev\");\r\n                    if (nextIdx !== this.#nextIdx) {\r\n                        this.#nextElement && this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n                        this.#nextElement = this.#targets[nextIdx] as HTMLElement;\r\n                        this.#nextIdx = nextIdx;\r\n                        this.helper.setClass(CLASSES.animProgress, this.#nextElement);\r\n                        this.#nextSlider.setElement(this.#nextElement)\r\n                        this.#nextSlider.setProps(this.#ratio > 0 ? this.#animationDef.previous.right : this.#animationDef.previous.left);\r\n                        this.#currSlider.setProps(this.#ratio > 0 ? this.#animationDef.current.right : this.#animationDef.current.left);\r\n                    }\r\n                    this.mutate(() => {\r\n                        this.#currSlider.update(Math.abs(this.#ratio));\r\n                        this.#nextSlider.update(Math.abs(this.#ratio));\r\n                    })\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.onPushSwitch(index);\r\n        return true;\r\n    }\r\n\r\n    onAnimationFinish(element: Element, reverted: boolean, errorOccured: boolean) {\r\n        console.log(\"Finish\")\r\n        this.isLocked = false;\r\n        // If not go back or from push then switch, else was go back\r\n        let next = this.#targets[this.#nextIdx];\r\n        let current = this.#targets[this.#currentIdx];\r\n        if (!reverted) {\r\n            //if (Math.abs(this.#ratio) > this.#ratioThreshold || this.#ratio === 0) {\r\n            if (this.#nextIdx > -1) {\r\n                this.mutate(() => {\r\n                    this.helper.removeClass(CLASSES.animProgress, next);\r\n                    this.helper.setClass(this.activeClassName, next);\r\n                    this.helper.removeClass(this.activeClassName, current);\r\n                    this.helper.removeAttribute(\"style\", current);\r\n                    this.helper.removeAttribute(\"style\", next);\r\n                    this.emitEvent(EVENTS.SWITCHED, {\r\n                        timestamp: Date.now(),\r\n                        index: this.#nextIdx\r\n                    })\r\n                    this.#currentIdx = this.#nextIdx;\r\n                    this.#nextIdx = -1;\r\n\r\n                })\r\n            }\r\n        } else {\r\n            this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n            this.helper.removeAttribute(\"style\", current);\r\n            this.helper.removeAttribute(\"style\", next);\r\n            this.#nextIdx = -1;\r\n        }\r\n        this.#nextElement = null;\r\n        this.#startX = -1;\r\n        this.#ratio = 0;\r\n\r\n    }\r\n\r\n    onPushSwitch(index: string) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        let nextIdx = this.getNextIndex(index);\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this._log.warning(`Index ${index} is not within the suitable range`);\r\n            return false;\r\n        }\r\n        this.#nextIdx = nextIdx;\r\n        let current = this.#targets[this.#currentIdx];\r\n        let next = this.#targets[this.#nextIdx];\r\n        this.#currSlider.setElement(current);\r\n        this.#nextSlider.setElement(next);\r\n        this.#currSlider.setProps(this.#animationDef.current.right);\r\n        this.#nextSlider.setProps(this.#animationDef.previous.right);\r\n        this.mutate(() => {\r\n            this.helper.setClass(CLASSES.animProgress, next);\r\n            this.#currSlider.finish(0, this.args.timeout, false);\r\n            this.#nextSlider.finish(0, this.args.timeout, false);\r\n        })\r\n\r\n    }\r\n\r\n    getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    getNextIndex(val: any): number {\r\n        let idx = -1;\r\n        switch (val) {\r\n            case 'prev':\r\n                idx = this.#currentIdx <= 0 ? this.#targets.length - 1 : this.#currentIdx - 1;\r\n                break;\r\n            case 'next':\r\n                idx = this.#currentIdx < this.#targets.length - 1 ? this.#currentIdx + 1 : 0\r\n                break;\r\n            case 'first':\r\n                idx = 0;\r\n                break;\r\n            case 'last':\r\n                idx = this.#targets.length - 1;\r\n            default:\r\n                idx = getIntOrDefault(val, -1);\r\n                break;\r\n        }\r\n        return idx;\r\n    }\r\n\r\n    getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n    }\r\n\r\n    getLinks() {\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        if (isInRange(current, 0, this.#links.length - 1)) {\r\n            this.helper.removeClass(this.activeClassName, this.#links[current])\r\n        }\r\n        if (isInRange(next, 0, this.#links.length - 1)) {\r\n            this.helper.setClass(this.activeClassName, this.#links[next])\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Emits push event to attached switch to set proper index\r\n     * @param id - cuid of element\r\n     * @param index - index to be set on element\r\n     */\r\n    setLinkSwitch(id: string, index: number) {\r\n        if (is(id))\r\n            this.utils.bus.emit(EVENTS.SWITCH, id, index);\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n}\r\n","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport { CuiInstance } from \"./instance\";\r\nimport { ICONS } from \"../core/utils/statics\";\r\nimport { ICuiPlugin, CuiInitData, CuiInitResult, ICuiComponent } from \"../core/models/interfaces\";\r\nimport { CuiAutoLightModePlugin } from \"../plugins/light/light\";\r\nimport { CuiIconComponent } from \"../components/icon/icon\";\r\nimport { CuiCircleComponent } from \"../components/circle/circle\";\r\nimport { CuiSpinnerComponent } from \"../components/spinner/spinner\";\r\nimport { CuiDummyComponent } from \"../components/dummy/dummy\";\r\nimport { CuiScrollComponent } from \"../components/scroll/scroll\";\r\nimport { CuiScrollspyComponent } from \"../components/scrollspy/scrollspy\";\r\nimport { CuiAutoPrintModePlugin } from \"../plugins/print/print\";\r\nimport { CuiIntersectionComponent } from \"../components/intersection/intersection\";\r\nimport { CuiOpenComponent } from \"../components/open/open\";\r\nimport { CuiCloseComponent } from \"../components/close/close\";\r\nimport { CuiToggleComponent } from \"../components/toggle/toggle\";\r\nimport { CuiResizeComponent } from \"../components/resize/resize\";\r\nimport { CuiKeysObserverPlugin } from \"../plugins/keys/keys\";\r\nimport { CuiDialogComponent } from \"../components/dialog/dialog\";\r\nimport { CuiOffCanvasArgs, CuiOffCanvasComponent } from \"../components/offcanvas/offcanvas\";\r\nimport { CuiAccordionComponent } from \"../components/accordion/accordion\";\r\nimport { CuiDropComponenet } from \"../components/drop/drop\";\r\nimport { CuiWindowClickPlugin } from \"../plugins/click/click\";\r\nimport { CuiOffsetComponent } from \"../components/offset/offset\";\r\nimport { CuiSwitchArgs, CuiSwitchComponent } from \"../components/switch/switch\";\r\nimport { CuiSwitcherComponent } from \"../components/switch/switcher\";\r\nimport { CuiFloatComponent } from \"../components/float/float\";\r\nimport { CuiSliderComponent } from \"../components/switch/slider\";\r\n\r\nexport class CuiInitializer {\r\n    #window: any;\r\n    constructor() {\r\n        this.#window = window;\r\n    }\r\n\r\n    async init(setup: CuiInitData): Promise<CuiInitResult> {\r\n        let settings: CuiSetupInit = { ... new CuiSetupInit(), ...setup.setup }\r\n        const appPrefix: string = settings.app;\r\n        const result: CuiInitResult = {\r\n            result: false\r\n        }\r\n        if (is(this.#window[appPrefix])) {\r\n            result.message = \"Instance is already initialized\";\r\n            return result;\r\n        }\r\n        if (is(setup.icons)) {\r\n            for (let icon in setup.icons) {\r\n                ICONS[icon] = setup.icons[icon];\r\n            }\r\n        }\r\n        try {\r\n            this.#window[appPrefix] = new CuiInstance(settings, setup.plugins, setup.components)\r\n            this.#window[appPrefix].init();\r\n        } catch (e) {\r\n            console.error(e);\r\n            result.message = \"An error occured during initialization\";\r\n            return result;\r\n        }\r\n        result.result = true;\r\n        return result;\r\n    }\r\n}\r\n\r\nexport class CuiInit {\r\n    #isInitialized: boolean;\r\n    constructor() {\r\n        this.#isInitialized = false;\r\n    }\r\n\r\n    async init(data: CuiInitData): Promise<boolean> {\r\n        if (this.#isInitialized) {\r\n            console.log(\"Module is already initialized\")\r\n            return false;\r\n        }\r\n        const initializer = new CuiInitializer();\r\n        const pluginList: ICuiPlugin[] = [\r\n            new CuiAutoLightModePlugin({ autoLight: true }),\r\n            new CuiAutoPrintModePlugin({ autoPrint: true }),\r\n            new CuiKeysObserverPlugin(null),\r\n            new CuiWindowClickPlugin()\r\n        ];\r\n\r\n        const componentList: ICuiComponent[] = [\r\n            new CuiIconComponent(),\r\n            new CuiCircleComponent(),\r\n            new CuiSpinnerComponent(),\r\n            new CuiDummyComponent(),\r\n            new CuiScrollComponent(),\r\n            new CuiScrollspyComponent(),\r\n            new CuiIntersectionComponent(),\r\n            new CuiOpenComponent(),\r\n            new CuiCloseComponent(),\r\n            new CuiToggleComponent(),\r\n            new CuiResizeComponent(),\r\n            new CuiDialogComponent(),\r\n            new CuiOffCanvasComponent(),\r\n            new CuiAccordionComponent(),\r\n            new CuiDropComponenet(),\r\n            new CuiOffsetComponent(),\r\n            new CuiSwitchComponent(),\r\n            new CuiSwitcherComponent(),\r\n            new CuiFloatComponent(),\r\n            new CuiSliderComponent(),\r\n        ];\r\n\r\n        let result = await initializer.init({\r\n            setup: data.setup,\r\n            icons: data.icons,\r\n            plugins: is(data.plugins) ? [...pluginList, ...data.plugins] : pluginList,\r\n            components: is(data.components) ? [...componentList, ...data.components] : componentList\r\n        })\r\n        if (result.result) {\r\n            this.#isInitialized = true;\r\n            return true;\r\n        } else {\r\n            console.error(`A cUI instance failed to initialize: [${result.message ?? \"#\"}]`);\r\n        }\r\n        console.log(\"Cui Light failed to init\")\r\n        return false;\r\n\r\n    }\r\n}","import { is, are } from \"../../core/utils/functions\";\r\nimport { ICuiLogger, IUIInteractionProvider, CuiCachable, CuiElement, CuiContext } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiClassAction } from \"../../core/utils/actions\";\r\n\r\nexport class ElementManager implements CuiCachable {\r\n    #elements: Element[];\r\n    #isLocked: boolean;\r\n    #logger: ICuiLogger;\r\n    #cDt: number;\r\n    #utils: CuiUtils;\r\n    #actionsHelper: CuiActionsHelper;\r\n    constructor(elements: Element[], utils: CuiUtils) {\r\n        this.#elements = elements;\r\n        this.#isLocked = false;\r\n        this.#logger = CuiLoggerFactory.get(\"ElementManager\");\r\n        this.#utils = utils;\r\n        this.#cDt = Date.now();\r\n        this.#actionsHelper = new CuiActionsHelper(utils.interactions);\r\n    }\r\n\r\n    async toggleClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className);\r\n            } else {\r\n                element.classList.remove(className);\r\n            }\r\n        }, 'toggleClass');\r\n    }\r\n\r\n    async toggleClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                } else {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleClassAs');\r\n    }\r\n\r\n    async setClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className)\r\n            }\r\n        }, 'setClass');\r\n    }\r\n\r\n    async setClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'setClassAs');\r\n    }\r\n\r\n    async removeClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.classList.contains(className)) {\r\n                element.classList.remove(className)\r\n            }\r\n        }, 'removeClass');\r\n    }\r\n\r\n    async removeClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n        }, 'removeClass');\r\n    }\r\n\r\n    getAttribute(attributeName: string): string[] {\r\n        if (!is(attributeName)) {\r\n            return null;\r\n        }\r\n        return this.#elements.reduce<string[]>((val: string[], current: Element) => {\r\n            if (current.hasAttribute(attributeName)) {\r\n                val.push(current.getAttribute(attributeName))\r\n            } else {\r\n                val.push(null);\r\n            }\r\n            return val;\r\n        }, []);\r\n    }\r\n\r\n    async setAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.setAttribute(attributeName, attributeValue ?? \"\")\r\n        }, 'setAttribute');\r\n    }\r\n\r\n    async setAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n        }, 'setAttributeAs');\r\n    }\r\n\r\n    async removeAttribute(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.removeAttribute(attributeName)\r\n        }, 'removeAttribute');\r\n    }\r\n\r\n    async removeAttributeAs(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n        }, 'removeAttributeAs');\r\n    }\r\n\r\n    async toggleAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.hasAttribute(attributeName)) {\r\n                element.removeAttribute(attributeName)\r\n            } else {\r\n                element.setAttribute(attributeName, attributeValue ?? \"\")\r\n            }\r\n        }, 'toggleAttribute');\r\n    }\r\n\r\n    async toggleAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.fetch(() => {\r\n                if (element.hasAttribute(attributeName)) {\r\n                    this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n                } else {\r\n                    this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleAttributeAs');\r\n    }\r\n\r\n    async click(onClick: (ev: MouseEvent) => void): Promise<boolean> {\r\n        if (!is(onClick)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener('click', onClick);\r\n        }, 'click');\r\n    }\r\n\r\n    async event(eventName: string, callback: any): Promise<boolean> {\r\n        if (!is(eventName) || !is(callback)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener(eventName, callback);\r\n        }, 'event');\r\n    }\r\n\r\n    async call(callback: (element: Element, index: Number) => void, functionName?: string): Promise<boolean> {\r\n        if (this.#isLocked) {\r\n            this.#logger.error(\"Element is locked\", functionName)\r\n        }\r\n        this.lock();\r\n        this.#elements.forEach((element, index) => {\r\n            callback(element, index)\r\n        })\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async animate(className: string, timeout?: number): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        return this.call((element) => {\r\n            this.change(() => {\r\n                element.classList.add(className);\r\n                element.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.change(() => {\r\n                        element.classList.remove(className);\r\n                        element.classList.remove(CLASSES.animProgress);\r\n                    })\r\n                }, delay)\r\n            })\r\n        });\r\n    }\r\n\r\n    async open(openClass: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!are(openClass, animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            this.#actionsHelper.performAction(element, action, delay).then(() => {\r\n                element.classList.add(openClass);\r\n            })\r\n        });\r\n    }\r\n\r\n    async close(closeClass: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!are(closeClass, animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            this.#actionsHelper.performAction(element, action, delay).then(() => {\r\n                element.classList.remove(closeClass);\r\n            })\r\n        });\r\n    }\r\n\r\n    emit(event: string, ...args: any[]): void {\r\n        if (!is(event)) {\r\n            this.#logger.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuid = (<CuiElement>(element as any)).$cuid;\r\n            if (is(cuid)) {\r\n                this.#logger.debug(`Emitting event ${event} to ${cuid}`)\r\n                this.#utils.bus.emit(event, cuid, ...args);\r\n            }\r\n        }, \"emit\")\r\n    }\r\n\r\n    on(event: string, callback: any): string[] {\r\n        let ids: string[] = []\r\n        if (!are(event, callback)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"on\")\r\n            return ids;\r\n        }\r\n\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                ids.push(this.#utils.bus.on(event, callback, cuiElement));\r\n            }\r\n        }, \"on\")\r\n        return ids;\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                this.#utils.bus.detach(event, id, cuiElement);\r\n            }\r\n        }, \"detach\")\r\n    }\r\n\r\n    read(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    change(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    count() {\r\n        return this.#elements.length;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false;\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return (Date.now() - this.#cDt) < 360000;\r\n    }\r\n}","import { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { is, sleep } from \"../../core/utils/functions\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToastHandler {\r\n    #interactions: IUIInteractionProvider;\r\n    #selector: string;\r\n    #className: string;\r\n    #activeCls: string;\r\n    #animationTime: number;\r\n    #lock: boolean;\r\n    #animClsIn: string;\r\n    #animClsOut: string;\r\n    constructor(interaction: IUIInteractionProvider, prefix: string, animationTime: number) {\r\n        this.#interactions = interaction;\r\n        this.#selector = `.${prefix}-toast`;\r\n        this.#className = `${prefix}-toast`;\r\n        this.#activeCls = `${prefix}-active`;\r\n        this.#animationTime = animationTime;\r\n        this.#lock = false;\r\n        this.#animClsIn = `${prefix}-toast-animation-in`;\r\n        this.#animClsOut = `${prefix}-toast-animation-out`\r\n    }\r\n\r\n    async show(message: string): Promise<boolean> {\r\n        if (this.#lock) {\r\n            return false;\r\n        }\r\n        this.#lock = true;\r\n        let toastElement = document.querySelector(this.#selector);\r\n        if (!is(toastElement)) {\r\n            toastElement = document.createElement('div');\r\n            toastElement.classList.add(this.#className);\r\n            document.body.appendChild(toastElement);\r\n            await sleep(10);\r\n        }\r\n\r\n        this.#interactions.mutate(() => {\r\n            toastElement.textContent = message;\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            toastElement.classList.add(this.#animClsIn);\r\n        }, this);\r\n\r\n        await sleep(this.#animationTime);\r\n        this.#interactions.mutate(() => {\r\n            toastElement.classList.remove(CLASSES.animProgress);\r\n            toastElement.classList.remove(this.#animClsIn);\r\n            toastElement.classList.add(this.#activeCls);\r\n        }, this)\r\n        await sleep(3000);\r\n        this.#interactions.mutate(() => {\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            toastElement.classList.add(this.#animClsOut);\r\n        }, this)\r\n\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(() => {\r\n                toastElement.classList.remove(CLASSES.animProgress);\r\n                toastElement.classList.remove(this.#animClsOut);\r\n                toastElement.classList.remove(this.#activeCls);\r\n            }, this)\r\n            this.#lock = false;\r\n        }, this.#animationTime);\r\n        return true;\r\n    }\r\n}","import { CLASSES } from \"../../core/utils/statics\";\r\nimport { ICuiLogger, IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CollectionManagerHelper {\r\n    #elements: Element[];\r\n    #log: ICuiLogger;\r\n    #isLocked: boolean;\r\n    #toggleClass: string;\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n        this.#log = CuiLoggerFactory.get('CollectionManager');\r\n    }\r\n\r\n    setElements(elements: Element[]) {\r\n        this.#elements = elements;\r\n    }\r\n\r\n    setToggle(className: string) {\r\n        this.#toggleClass = className;\r\n    }\r\n\r\n    addAnimationClass(currentElement: Element, nextElement: Element, animIn: string, animOut: string,): void {\r\n        nextElement.classList.add(CLASSES.animProgress);\r\n        currentElement.classList.add(animOut);\r\n        nextElement.classList.add(animIn);\r\n    }\r\n\r\n    setFinalClasses(currentElement: Element, nextElement: Element, animIn: string, animOut: string): void {\r\n        nextElement.classList.remove(CLASSES.animProgress);\r\n        currentElement.classList.remove(animOut);\r\n        nextElement.classList.remove(animIn);\r\n        currentElement.classList.remove(this.#toggleClass);\r\n        nextElement.classList.add(this.#toggleClass);\r\n    }\r\n\r\n    verifyIndex(index: number, current: number, count: number): boolean {\r\n        return index >= 0 && index !== current && index < count\r\n    }\r\n\r\n    async setCurrent(newIndex: number, current: number): Promise<boolean> {\r\n        this.lock();\r\n        this.#log.debug(`Switching index from: ${current} to ${newIndex}`)\r\n        if (current > -1)\r\n            this.#elements[current].classList.remove(this.#toggleClass);\r\n        this.#elements[newIndex].classList.add(this.#toggleClass);\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async setCurrentWithAnimation(newIndex: number, animClassIn: string, animClassOut: string, duration: number, current: number): Promise<boolean> {\r\n        this.lock()\r\n        this.#log.debug(`Switching index from: ${current} to ${newIndex}`)\r\n\r\n        const currentElement = this.#elements[current];\r\n        const nextElement = this.#elements[newIndex];\r\n        this.#interactions.mutate(this.addAnimationClass, this, currentElement, nextElement, animClassIn, animClassOut);\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(this.setFinalClasses, this, currentElement, nextElement, animClassIn, animClassOut)\r\n            this.unlock();\r\n        }, duration)\r\n        return true;\r\n    }\r\n\r\n    getCurrentIndex(): number {\r\n        if (!is(this.#toggleClass)) {\r\n            return -1;\r\n        }\r\n        let len = this.count();\r\n        for (let i = 0; i < len; i++) {\r\n            if (this.#elements[i].classList.contains(this.#toggleClass)) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    check(): boolean {\r\n        if (this.#isLocked) {\r\n            this.#log.warning(\"Object locked. Operation in progress\", \"Check\");\r\n            return false;\r\n        } else if (!is(this.#toggleClass)) {\r\n            this.#log.warning(\"Toggle is not set. Call setToggleClass\", \"Check\");\r\n            return false;\r\n        } else if (this.count() <= 0) {\r\n            this.#log.warning(\"Elements list is empty\", \"Check\");\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    count(): number {\r\n        return this.#elements ? this.#elements.length : -1;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false\r\n    }\r\n\r\n\r\n}","import { IUIInteractionProvider, ICuiLogger, CuiCachable } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CollectionManagerHelper } from \"../helpers/collection\";\r\n\r\nexport class CollectionManager implements CuiCachable {\r\n    #log: ICuiLogger;\r\n\r\n    #cDt: number;\r\n    #helper: CollectionManagerHelper;\r\n\r\n    constructor(elements: Element[], interactions: IUIInteractionProvider) {\r\n        this.#log = CuiLoggerFactory.get('CollectionManager');\r\n        this.#helper = new CollectionManagerHelper(interactions);\r\n        this.#helper.setElements(elements);\r\n        this.#cDt = Date.now();\r\n    }\r\n\r\n    setToggle(className: string) {\r\n        this.#helper.setToggle(className)\r\n    }\r\n\r\n    setElements(elements: Element[]) {\r\n        this.#helper.setElements(elements);\r\n    }\r\n\r\n    click(callback: (element: Element, index: number) => void): void {\r\n        this.#helper.elements().forEach((element, index) => {\r\n            element.addEventListener('click', () => {\r\n                this.set(index).then(() => {\r\n                    if (callback) {\r\n                        callback(element, index)\r\n                    }\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    async next(): Promise<boolean> {\r\n        if (!this.#helper.check()) {\r\n            return false;\r\n        }\r\n        let newIdx = this.#helper.getCurrentIndex() + 1;\r\n        return this.set(newIdx >= this.length() ? 0 : newIdx);\r\n    }\r\n\r\n    async previous(): Promise<boolean> {\r\n        if (!this.#helper.check()) {\r\n            return false;\r\n        }\r\n        let newIdx = this.#helper.getCurrentIndex() - 1;\r\n        return this.set(newIdx < 0 ? this.length() - 1 : newIdx)\r\n    }\r\n\r\n    async set(index: number): Promise<boolean> {\r\n        let current = this.#helper.getCurrentIndex();\r\n        if (!this.#helper.check() || !this.#helper.verifyIndex(index, current, this.length())) {\r\n            return false;\r\n        }\r\n        return this.#helper.setCurrent(index, current)\r\n    }\r\n\r\n    async setWithAnimation(index: number, animClassIn: string, animClassOut: string, duration: number): Promise<boolean> {\r\n        let current = this.#helper.getCurrentIndex();\r\n        if (!this.#helper.check() || !this.#helper.verifyIndex(index, current, this.length())) {\r\n            return false;\r\n        }\r\n        return this.#helper.setCurrentWithAnimation(index, animClassIn, animClassOut, duration, current)\r\n    }\r\n\r\n    getCurrentIndex(): number {\r\n        return this.#helper.getCurrentIndex();\r\n    }\r\n\r\n    length() {\r\n        return this.#helper.count();\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return this.length() > 0 && Date.now() - this.#cDt > 360000;\r\n    }\r\n}","import { ICuiPluginManager, ICuiPlugin, ICuiLogger, ICuiMutiationPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiPluginManager implements ICuiPluginManager {\r\n    #plugins: ICuiPlugin[];\r\n    #mutated: ICuiMutiationPlugin[];\r\n    #log: ICuiLogger;\r\n    constructor(plugins: ICuiPlugin[]) {\r\n        this.#plugins = plugins ?? [];\r\n        this.#log = CuiLoggerFactory.get(\"CuiPluginManager\")\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#log.debug(\"Plugins initialization started: \" + this.#plugins.length)\r\n        this.#mutated = this.#plugins.filter((plugin: any) => {\r\n            return is(plugin.mutation);\r\n        }) as any;\r\n        this.#plugins.forEach(plugin => {\r\n            plugin.init(utils);\r\n            utils.setup.plugins[plugin.description] = plugin.setup;\r\n        })\r\n        this.#log.debug(\"Plugins have been initialized\");\r\n    }\r\n\r\n    get(name: string): ICuiPlugin {\r\n        if (!is(name)) {\r\n            return undefined;\r\n        }\r\n        return this.#plugins.find(p => p.name === name);\r\n    }\r\n\r\n    async onMutation(mutation: MutationRecord): Promise<boolean> {\r\n        let tasks: Promise<boolean>[] = [];\r\n        this.#mutated.forEach((plugin: any) => {\r\n            tasks.push(plugin.mutation(mutation))\r\n        })\r\n        let result: boolean[] = await Promise.all(tasks);\r\n        return result.find(val => {\r\n            val === false\r\n        }) ? false : true;\r\n    }\r\n\r\n}","import { is, isTouchSupported, enumerateObject } from \"../../core/index\";\r\n\r\nexport interface ElementBuilderAttribute {\r\n    [name: string]: string;\r\n}\r\nexport class ElementBuilder {\r\n    #id: string;\r\n    #classes: string[];\r\n    #attributes: ElementBuilderAttribute;\r\n    #tag: string;\r\n    constructor(tag: string) {\r\n        this.#tag = tag;\r\n        this.#classes = [];\r\n        this.#attributes = null\r\n    }\r\n    setId(id: string): ElementBuilder {\r\n        this.#id = id;\r\n        return this;\r\n    }\r\n\r\n    setClasses(...classList: string[]): ElementBuilder {\r\n        this.#classes = classList;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: ElementBuilderAttribute): ElementBuilder {\r\n        this.#attributes = attributes;\r\n        return this;\r\n    }\r\n\r\n    build(innerHTML?: string): HTMLElement {\r\n        let element = document.createElement(this.#tag);\r\n        if (is(this.#id)) {\r\n            element.id = this.#id;\r\n        }\r\n        if (is(this.#classes)) {\r\n            element.classList.add(...this.#classes);\r\n        }\r\n        if (is(this.#attributes)) {\r\n            enumerateObject(this.#attributes, (attr: string, value: string) => {\r\n                element.setAttribute(attr, value);\r\n            })\r\n        }\r\n        if (is(innerHTML)) {\r\n            element.innerHTML = innerHTML;\r\n        }\r\n        return element;\r\n    }\r\n}","import { ElementBuilder } from \"./element\";\r\nimport { is } from \"../../core/index\";\r\n\r\nexport class DialogBuilder {\r\n    #header: Element;\r\n    #body: Element;\r\n    #footer: Element;\r\n    #prefix: string;\r\n    #switches: string;\r\n    #reverse: boolean;\r\n    constructor(prefix: string, reverse: boolean, switches?: string) {\r\n        this.#prefix = prefix;\r\n        this.#header = this.#footer = this.#body = null;\r\n        this.#switches = switches ?? \"\";\r\n        this.#reverse = reverse;\r\n    }\r\n\r\n    createHeader(title: string, classes: string[], elements?: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        let headerBuilder = new ElementBuilder('div');\r\n        headerBuilder.setClasses(`${this.#prefix}-dialog-header`, ...classes)\r\n        this.#header = headerBuilder.build();\r\n\r\n        let titleElement = new ElementBuilder('span').setClasses(this.getPrefixedString(\"-dialog-title\")).build(title)\r\n\r\n        this.#header.appendChild(titleElement);\r\n        this.appendChildrens(this.#header, ...elements);\r\n\r\n    }\r\n\r\n    createFooter(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#footer = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-footer\"), ...classes).build();\r\n        this.appendChildrens(this.#footer, ...elements);\r\n    }\r\n\r\n    createBody(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#body = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-body\"), ...classes).build();\r\n        this.appendChildrens(this.#body, ...elements);\r\n    }\r\n\r\n    build(id: string): HTMLElement {\r\n        let classes = [this.getPrefixedString(\"-dialog\")]\r\n        if (this.#reverse) {\r\n            classes.push(this.getPrefixedString('-reverse-auto'));\r\n        }\r\n        let dialog = new ElementBuilder('div').setId(id).setClasses(...classes).setAttributes({\r\n            [this.getPrefixedString('-dialog')]: this.#switches\r\n        }).build();\r\n        let container = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-container\")).build();\r\n        container.appendChild(this.#header);\r\n        container.appendChild(this.#body);\r\n        container.appendChild(this.#footer);\r\n        dialog.appendChild(container);\r\n        return dialog;\r\n    }\r\n\r\n    private appendChildrens(parent: Element, ...elements: Element[]) {\r\n        if (is(elements)) {\r\n            elements.forEach((element) => parent.appendChild(element));\r\n        }\r\n    }\r\n    private getPrefixedString(str: string) {\r\n        return this.#prefix + str\r\n    }\r\n}","import { is, CuiSetup, CuiUtils, CuiAlertType, CuiAlertData, CuiContext } from \"../../core/index\";\r\nimport { ElementManager } from \"../managers/element\";\r\nimport { DialogBuilder } from \"../builders/dialog\";\r\nimport { ElementBuilder } from \"../builders/element\";\r\n\r\nexport interface ICuiAlertHandler {\r\n    show(root: Element): void;\r\n}\r\n\r\ninterface AlertCallbacks {\r\n    [name: string]: () => void\r\n}\r\n\r\nabstract class CuiAlertHandlerBase implements ICuiAlertHandler, CuiContext {\r\n    #callbacks: AlertCallbacks;\r\n    #utils: CuiUtils;\r\n    #id: string;\r\n    #manager: ElementManager;\r\n    closeStr: string;\r\n    iconStr: string;\r\n    content: string;\r\n    title: string;\r\n    prefix: string;\r\n    reverse: boolean;\r\n    #attid: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        this.#callbacks = {\r\n            \"yes\": data.onYes,\r\n            \"no\": data.onNo,\r\n            \"cancel\": data.onCancel,\r\n            \"ok\": data.onOk\r\n        }\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.#utils = setup;\r\n        this.#id = id;\r\n        this.reverse = false;\r\n        this.#attid = null;\r\n        this.closeStr = `${this.#utils.setup.prefix}-close`;\r\n        this.iconStr = `${this.#utils.setup.prefix}-icon`;\r\n    }\r\n\r\n    getId(): string {\r\n        return this.#id;\r\n    }\r\n\r\n    show(root: Element): void {\r\n        let element = document.getElementById(this.#id);\r\n        if (!is(element)) {\r\n            element = this.createElement();\r\n            root.appendChild(element);\r\n        } else {\r\n            this.updateElement(element);\r\n        }\r\n        setTimeout(() => {\r\n            this.#manager = new ElementManager([element], this.#utils);\r\n            let ids = this.#manager.on('closed', this.onClose.bind(this));\r\n            this.#attid = ids.length > 0 ? ids[0] : null;\r\n            this.#manager.emit(\"open\");\r\n        }, 100);\r\n    }\r\n\r\n    updateElement(element: HTMLElement) {\r\n        let title = element.querySelector(`.${this.prefix}-dialog-title`);\r\n        let content = element.querySelector(`.${this.prefix}-dialog-body>p`);\r\n        this.#utils.interactions.mutate(() => {\r\n            if (title) {\r\n                title.innerHTML = this.title;\r\n            }\r\n            if (content) {\r\n                content.innerHTML = this.content;\r\n            }\r\n        }, null)\r\n    }\r\n\r\n    onClose(arg: any) {\r\n        try {\r\n            if (is(arg) && (arg.state)) {\r\n                if (is(this.#callbacks[arg.state])) {\r\n                    this.#callbacks[arg.state]();\r\n                }\r\n            }\r\n        } finally {\r\n            if (this.#attid != null) {\r\n                this.#manager.detach('closed', this.#attid);\r\n                this.#attid = null;\r\n            }\r\n\r\n            this.#manager = null;\r\n        }\r\n    }\r\n\r\n    abstract createElement(): HTMLElement;\r\n\r\n\r\n}\r\n\r\nexport class CuiAlertHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, null, [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: cancel\" }).build(\"Cancel\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiInfoAlertUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n        dialogBuilder.createHeader(this.title, null, null);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiYesNoPopUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, null, [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: no\" }).build(\"No\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: yes\" }).build(\"Yes\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiAlertFactory {\r\n    static get(id: string, type: CuiAlertType, data: CuiAlertData, utils: CuiUtils) {\r\n        if (type === \"Info\") {\r\n            return new CuiInfoAlertUpHandler(utils, id, data);\r\n        } else if (type === 'YesNoCancel') {\r\n            return new CuiYesNoPopUpHandler(utils, id, data);\r\n        } else if (type === 'OkCancel') {\r\n            return new CuiAlertHandler(utils, id, data);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is, joinAttributesForQuery, are, registerCuiElement } from \"../core/utils/functions\";\r\nimport { ElementManager } from \"./managers/element\";\r\nimport { STATICS, EVENTS, CSS_VARIABLES } from \"../core/utils/statics\";\r\nimport { ICuiLogger, ICuiPlugin, ICuiComponent, ICuiPluginManager, CuiContext, CuiElement, CuiAlertData } from \"../core/models/interfaces\";\r\nimport { ICuiMutionObserver, CuiMutationObserver } from \"./observers/mutations\";\r\nimport { CuiLoggerFactory } from \"../core/factories/logger\";\r\nimport { CuiToastHandler } from \"./managers/toast\";\r\nimport { CollectionManager } from \"./managers/collection\";\r\nimport { CuiUtils } from \"../core/models/utils\";\r\nimport { CuiInstanceInitError } from \"../core/models/errors\";\r\nimport { CuiPluginManager } from \"./managers/plugins\";\r\nimport { CuiAlertHandler, CuiAlertFactory } from \"./handlers/alert\";\r\nimport { CuiAlertType } from \"../core/index\";\r\n\r\n\r\nexport class CuiInstance {\r\n    #log: ICuiLogger;\r\n    #mutationObserver: ICuiMutionObserver;\r\n    #toastManager: CuiToastHandler;\r\n    #utils: CuiUtils;\r\n    plugins: ICuiPluginManager;\r\n    #components: ICuiComponent[];\r\n    #rootElement: HTMLElement;\r\n    constructor(setup: CuiSetupInit, plugins: ICuiPlugin[], components: ICuiComponent[]) {\r\n        STATICS.prefix = setup.prefix;\r\n        STATICS.logLevel = setup.logLevel;\r\n        this.plugins = new CuiPluginManager(plugins);\r\n        this.#components = components ?? [];\r\n        this.#utils = new CuiUtils(setup);\r\n        this.#log = CuiLoggerFactory.get('CuiInstance')\r\n        this.#rootElement = setup.root;\r\n    }\r\n\r\n    init(): CuiInstance {\r\n        this.#log.debug(\"Instance started\", \"init\")\r\n        // Init elements\r\n        if (!is(window.MutationObserver)) {\r\n            throw new CuiInstanceInitError(\"Mutation observer does not exists\");\r\n        }\r\n        this.#toastManager = new CuiToastHandler(this.#utils.interactions, this.#utils.setup.prefix, this.#utils.setup.animationTimeLong);\r\n        const mutatedAttributes: string[] = this.#components.map(x => { return x.attribute }); // MUTATED_ATTRIBUTES; \r\n        const initElements = is(mutatedAttributes) ? this.#rootElement.querySelectorAll(joinAttributesForQuery(mutatedAttributes)) : null\r\n        if (is(initElements)) {\r\n            this.#log.debug(`Initiating ${initElements.length} elements`)\r\n            try {\r\n                initElements.forEach((item: any) => {\r\n                    registerCuiElement(item, this.#components, mutatedAttributes, this.#utils);\r\n                })\r\n            } catch (e) {\r\n                this.#log.exception(e);\r\n            }\r\n        }\r\n        this.#log.debug(\"Init plugins\", \"init\")\r\n        // Init plugins\r\n        this.plugins.init(this.#utils);\r\n\r\n        if (are(this.#components, mutatedAttributes)) {\r\n            this.#log.debug(\"Init mutation observer\", \"init\")\r\n            this.#mutationObserver = new CuiMutationObserver(this.#rootElement, this.#utils)\r\n            this.#mutationObserver.setComponents(this.#components).setAttributes(mutatedAttributes)\r\n            this.#mutationObserver.setPlugins(this.plugins);\r\n            this.#mutationObserver.start();\r\n        }\r\n\r\n        this.#log.debug(\"Setting CSS globals\", 'init')\r\n        this.#utils.interactions.mutate(() => {\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeLong, `${this.#utils.setup.animationTimeLong}ms`)\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTime, `${this.#utils.setup.animationTime}ms`);\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeShort, `${this.#utils.setup.animationTimeShort}ms`);\r\n        }, null)\r\n\r\n\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_INITIALIZED, null)\r\n        return this;\r\n    }\r\n\r\n    finish(): void {\r\n        this.#mutationObserver.stop();\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_FINISHED, null)\r\n    }\r\n\r\n    get(selector: string): ElementManager {\r\n        // const existing = this.#utils.cache.get(selector);\r\n        // if (is(existing)) {\r\n        //     return existing as ElementManager;\r\n        // }\r\n        const elements = this.all(selector);\r\n        if (!elements) {\r\n            return undefined\r\n        }\r\n        const newElement = new ElementManager(elements, this.#utils);\r\n        //this.#utils.cache.put(selector, newElement)\r\n        return newElement\r\n    }\r\n\r\n    collection(selector: string): CollectionManager {\r\n        // const existing = this.#utils.cache.get(selector);\r\n        // if (is(existing)) {\r\n        //     return existing as CollectionManager;\r\n        // }\r\n        const elements = this.all(selector);\r\n        if (!is(elements)) {\r\n            return undefined;\r\n        }\r\n        let manager = new CollectionManager(elements, this.#utils.interactions);\r\n        //this.#utils.cache.put(selector, manager)\r\n        return manager;\r\n    }\r\n\r\n\r\n    async toast(message: string): Promise<boolean> {\r\n        if (!is(message)) {\r\n            return false;\r\n        }\r\n        return this.#toastManager.show(message)\r\n    }\r\n\r\n    select(selector: string): Element {\r\n        return document.querySelector(selector)\r\n    }\r\n\r\n    all(selector: string): Element[] {\r\n        const nodes: NodeListOf<Element> = document.querySelectorAll(selector);\r\n        if (!is(nodes)) {\r\n            return undefined;\r\n        }\r\n        return [...nodes];\r\n    }\r\n\r\n    getUtils(): CuiUtils {\r\n        return this.#utils;\r\n    }\r\n\r\n    on(event: string, callback: any, element?: CuiElement): void {\r\n        if (!are(event, callback)) {\r\n            this.#log.error(\"Incorrect arguments\", \"on\")\r\n        }\r\n        this.#utils.bus.on(event, callback, element);\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.#utils.bus.detach(event, id);\r\n    }\r\n\r\n    detachAll(event: string): void {\r\n        if (!is(event)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detachAll\")\r\n        }\r\n        this.#utils.bus.detachAll(event);\r\n    }\r\n\r\n    emit(event: string, element: Element | string, ...args: any[]): void {\r\n        if (!are(event, element)) {\r\n            this.#log.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        let el = typeof element === 'string' ? document.querySelector(element) : element;\r\n        let cuid = (<CuiElement>(el as any)).$cuid;\r\n        if (!is(cuid)) {\r\n            this.#log.warning(\"Element is not a cUI element\", \"emit\")\r\n            return\r\n        }\r\n        this.#utils.bus.emit(event, cuid, ...args);\r\n    }\r\n\r\n    alert(id: string, type: CuiAlertType, data: CuiAlertData): void {\r\n        let popup = CuiAlertFactory.get(id, type, data, this.#utils);\r\n        popup.show(this.#rootElement);\r\n    }\r\n}","import { ICuiLogger, IUIInteractionProvider, ICuiMutiationPlugin, ICuiComponent, ICuiPluginManager, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is, getMatchingAttribute, are, getMatchingAttributes, generateCUID, registerCuiElement, joinAttributesForQuery, parseAttribute } from \"../../core/utils/functions\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\n\r\nexport interface ICuiMutionObserver {\r\n    // setOptions(options: MutationObserverInit): ICuiMutionObserver;\r\n    setPlugins(plugins: ICuiPluginManager): ICuiMutionObserver;\r\n    setComponents(components: ICuiComponent[]): ICuiMutionObserver;\r\n    setAttributes(attributes: string[]): ICuiMutionObserver;\r\n    start(): ICuiMutionObserver;\r\n    stop(): ICuiMutionObserver;\r\n}\r\n\r\nexport interface ICuiComponentMutationObserver {\r\n    observe(): void;\r\n    unobserve(): void;\r\n    isObserving(): boolean;\r\n    onMutation(callback: (record: MutationRecord[]) => void): void;\r\n    disable(flag: boolean): void;\r\n}\r\n\r\n\r\nexport class CuiMutationObserver implements ICuiMutionObserver {\r\n    _log: ICuiLogger;\r\n    #observer: MutationObserver;\r\n    #options: MutationObserverInit;\r\n    #element: HTMLElement;\r\n    plugins: ICuiPluginManager;\r\n    #components: ICuiComponent[];\r\n    #attributes: string[];\r\n    #utils: CuiUtils;\r\n    #queryString: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils) {\r\n        this.#observer = null\r\n        this.#element = element\r\n        this._log = CuiLoggerFactory.get('CuiMutationObserver')\r\n        this.plugins = null;\r\n        this.#components = [];\r\n        this.#attributes = [];\r\n        this.#utils = utils;\r\n        this.#queryString = \"\";\r\n\r\n    }\r\n\r\n    setPlugins(plugins: ICuiPluginManager) {\r\n        this.plugins = plugins;\r\n        return this;\r\n    }\r\n\r\n    setComponents(components: ICuiComponent[]) {\r\n        this.#components = components;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: string[]) {\r\n        this.#options = {\r\n            attributes: true,\r\n            subtree: true,\r\n            childList: true,\r\n            attributeFilter: attributes\r\n        }\r\n        this.#attributes = attributes;\r\n        this.#queryString = joinAttributesForQuery(attributes);\r\n        return this;\r\n    }\r\n\r\n    start() {\r\n        this._log.debug(\"Starting\")\r\n        this.#observer = new MutationObserver(this.mutationCallback.bind(this));\r\n        this.#observer.observe(this.#element, this.#options)\r\n        this._log.debug(\"Started\")\r\n        return this;\r\n    }\r\n\r\n    stop() {\r\n        this._log.debug(\"Stopping\")\r\n        if (this.#observer !== null)\r\n            this._log.debug(\"Observer available\")\r\n        this.#observer.disconnect()\r\n        this.#observer = null;\r\n        this._log.debug(\"Stopped\")\r\n        return this\r\n    }\r\n\r\n    private mutationCallback(mutations: MutationRecord[], observer: MutationObserver) {\r\n        mutations.forEach((mutation: MutationRecord) => {\r\n            switch (mutation.type) {\r\n                case 'attributes':\r\n                    const item = mutation.target as any;\r\n                    if (are(item.$handlers, item.$handlers[mutation.attributeName])) {\r\n                        item.$handlers[mutation.attributeName].refresh(parseAttribute(item, mutation.attributeName));\r\n                    }\r\n                    break;\r\n\r\n                case 'childList':\r\n                    this.handleChildListMutation(mutation);\r\n                    break;\r\n            }\r\n            if (is(this.plugins)) {\r\n                this.plugins.onMutation(mutation).then(() => {\r\n                    //\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    private handleChildListMutation(mutation: MutationRecord) {\r\n        const addedLen = mutation.addedNodes.length;\r\n        const removedLen = mutation.removedNodes.length;\r\n        if (addedLen > 0) {\r\n            this._log.debug(\"Registering added nodes: \" + addedLen)\r\n            this.handleAddedNodes(mutation.addedNodes);\r\n        } else if (removedLen > 0) {\r\n            this._log.debug(\"Removing nodes: \" + removedLen);\r\n            this.handleRemovedNodes(mutation.removedNodes);\r\n        }\r\n    }\r\n\r\n    private handleAddedNodes(nodes: NodeList) {\r\n        nodes.forEach((node: any) => {\r\n            try {\r\n                registerCuiElement(node, this.#components, this.#attributes, this.#utils);\r\n                let childrens = node.hasChildNodes() ? node.querySelectorAll(this.#queryString) : null;\r\n                if (is(childrens)) {\r\n                    childrens.forEach((child: any) => {\r\n                        registerCuiElement(child, this.#components, this.#attributes, this.#utils);\r\n                    })\r\n                }\r\n            } catch (e) {\r\n                this._log.exception(e);\r\n            }\r\n        })\r\n    }\r\n\r\n    private handleRemovedNodes(nodes: NodeList) {\r\n        nodes.forEach((node: any) => {\r\n            this.destroySingleElement(node);\r\n            let childrens = node.hasChildNodes() ? node.querySelectorAll(this.#queryString) : null;\r\n            if (is(childrens)) {\r\n                childrens.forEach((child: any) => {\r\n                    this.destroySingleElement(child);\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    private destroySingleElement(node: any) {\r\n        let element = node as CuiElement;\r\n        if (element.$handlers) {\r\n            for (let name in element.$handlers) {\r\n                if (element.$handlers.hasOwnProperty(name)) {\r\n                    try {\r\n                        element.$handlers[name].destroy();\r\n                    } catch (e) {\r\n                        this._log.exception(e, 'remove - ' + name)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class CuiComponentMutationHandler implements ICuiComponentMutationObserver {\r\n    #isObserving: boolean;\r\n    #observer: MutationObserver;\r\n    #element: Element;\r\n    #disabled: boolean;\r\n    #options: MutationObserverInit = {\r\n        childList: true,\r\n        subtree: true\r\n    }\r\n    constructor(target: Element) {\r\n        this.#observer = null;\r\n        this.#isObserving = false;\r\n        this.#element = target;\r\n    }\r\n\r\n    observe(): void {\r\n        if (!this.#isObserving && !this.#disabled) {\r\n            this.#observer.observe(this.#element, this.#options);\r\n            this.#isObserving = true;\r\n        }\r\n    }\r\n    unobserve(): void {\r\n        if (this.#isObserving) {\r\n            this.#observer.disconnect();\r\n            this.#isObserving = false;\r\n        }\r\n    }\r\n\r\n    isObserving(): boolean {\r\n        return this.#isObserving;\r\n    }\r\n\r\n    disable(flag: boolean): void {\r\n        this.#disabled = flag;\r\n        if (this.#disabled) {\r\n            this.unobserve();\r\n        }\r\n    }\r\n\r\n    onMutation(callback: (record: MutationRecord[]) => void): void {\r\n        if (this.#isObserving)\r\n            this.unobserve();\r\n        this.#observer = new MutationObserver(callback)\r\n    }\r\n\r\n}","import { CuiInit } from './app/initializer';\r\n\r\nexport const CUI_LIGHT_VERSION = \"0.1.22\";\r\n\r\ndeclare global {\r\n    interface Window {\r\n        cuiInit: CuiInit;\r\n    }\r\n}\r\n\r\nexport * from \"./core/models/interfaces\";\r\nexport * from './core/models/events';\r\nexport * from './core/models/setup';\r\nexport * from './core/models/utils';\r\nexport * from './app/initializer'\r\nexport { CuiInstance } from './app/instance';\r\n\r\nwindow.cuiInit = new CuiInit();"],"sourceRoot":""}