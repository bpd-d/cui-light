{"version":3,"sources":["webpack://cui-light/webpack/universalModuleDefinition","webpack://cui-light/webpack/bootstrap","webpack://cui-light/./src/core/utils/functions.ts","webpack://cui-light/./src/core/index.ts","webpack://cui-light/./src/core/utils/statics.ts","webpack://cui-light/./src/core/models/errors.ts","webpack://cui-light/./src/core/factories/logger.ts","webpack://cui-light/./src/app/builders/element.ts","webpack://cui-light/./src/core/utils/actions.ts","webpack://cui-light/./src/core/utils/task.ts","webpack://cui-light/./src/core/models/setup.ts","webpack://cui-light/./src/core/models/elements.ts","webpack://cui-light/./src/app/managers/cache.ts","webpack://cui-light/./src/app/handlers/colors.ts","webpack://cui-light/./src/app/observers/resize.ts","webpack://cui-light/./src/app/managers/development.ts","webpack://cui-light/./src/core/models/utils.ts","webpack://cui-light/./src/core/listeners/media.ts","webpack://cui-light/./src/core/listeners/scroll.ts","webpack://cui-light/./src/core/listeners/move.ts","webpack://cui-light/./src/core/utils/interactions.ts","webpack://cui-light/./src/core/bus/handlers.ts","webpack://cui-light/./src/core/bus/executors.ts","webpack://cui-light/./src/core/models/colors.ts","webpack://cui-light/./src/core/utils/logger.ts","webpack://cui-light/./src/core/helpers/helpers.ts","webpack://cui-light/./src/core/factories/interactions.ts","webpack://cui-light/./src/core/utils/dictionary.ts","webpack://cui-light/./src/core/bus/bus.ts","webpack://cui-light/./src/core/styles/appender.ts","webpack://cui-light/./src/core/listeners/keys.ts","webpack://cui-light/./src/plugins/light/light.ts","webpack://cui-light/./src/core/utils/aria.ts","webpack://cui-light/./src/app/handlers/base.ts","webpack://cui-light/./src/app/builders/icon.ts","webpack://cui-light/./src/components/icon/icon.ts","webpack://cui-light/./src/components/circle/circle.ts","webpack://cui-light/./src/components/spinner/spinner.ts","webpack://cui-light/./src/components/dummy/dummy.ts","webpack://cui-light/./src/components/scroll/scroll.ts","webpack://cui-light/./src/core/intersection/intersection.ts","webpack://cui-light/./src/components/scrollspy/mode.ts","webpack://cui-light/./src/components/scrollspy/scrollspy.ts","webpack://cui-light/./src/plugins/print/print.ts","webpack://cui-light/./src/app/observers/intersection.ts","webpack://cui-light/./src/components/intersection/intersection.ts","webpack://cui-light/./src/components/open/open.ts","webpack://cui-light/./src/components/close/close.ts","webpack://cui-light/./src/components/toggle/toggle.ts","webpack://cui-light/./src/components/resize/resize.ts","webpack://cui-light/./src/plugins/keys/observer.ts","webpack://cui-light/./src/plugins/keys/keys.ts","webpack://cui-light/./src/components/dialog/dialog.ts","webpack://cui-light/./src/components/offcanvas/offcanvas.ts","webpack://cui-light/./src/components/accordion/accordion.ts","webpack://cui-light/./src/core/listeners/hover.ts","webpack://cui-light/./src/core/position/evaluator.ts","webpack://cui-light/./src/core/position/calculator.ts","webpack://cui-light/./src/components/drop/drop.ts","webpack://cui-light/./src/plugins/click/click.ts","webpack://cui-light/./src/components/offset/modes.ts","webpack://cui-light/./src/components/offset/offset.ts","webpack://cui-light/./src/components/switch/switch.ts","webpack://cui-light/./src/components/switch/switcher.ts","webpack://cui-light/./src/components/float/helpers.ts","webpack://cui-light/./src/components/float/float.ts","webpack://cui-light/./src/core/animation/animators.ts","webpack://cui-light/./src/core/animation/engine.ts","webpack://cui-light/./src/app/animation/definitions.ts","webpack://cui-light/./src/components/switch/slider.ts","webpack://cui-light/./src/components/banner/banner.ts","webpack://cui-light/./src/components/cover/cover.ts","webpack://cui-light/./src/app/handlers/drag/detectors.ts","webpack://cui-light/./src/app/handlers/drag/drag.ts","webpack://cui-light/./src/components/sortable/sortable.ts","webpack://cui-light/./src/plugins/properties/colors.ts","webpack://cui-light/./src/plugins/properties/setter.ts","webpack://cui-light/./src/plugins/properties/handler.ts","webpack://cui-light/./src/plugins/properties/properties.ts","webpack://cui-light/./src/components/tooltip/tooltip.ts","webpack://cui-light/./src/app/initializer.ts","webpack://cui-light/./src/app/managers/element.ts","webpack://cui-light/./src/app/managers/toast.ts","webpack://cui-light/./src/app/helpers/collection.ts","webpack://cui-light/./src/app/managers/collection.ts","webpack://cui-light/./src/app/managers/plugins.ts","webpack://cui-light/./src/app/builders/dialog.ts","webpack://cui-light/./src/app/handlers/alert.ts","webpack://cui-light/./src/app/observers/move.ts","webpack://cui-light/./src/app/instance.ts","webpack://cui-light/./src/app/observers/mutations.ts","webpack://cui-light/./src/index.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","is","val","typecheck","length","Array","isArray","isEmpty","getName","prefix","sleep","timeout","Promise","resolve","setTimeout","createElementFromString","htmlString","template","document","createElement","innerHTML","content","children","getRangeValue","min","max","getRangeValueOrDefault","def","isNaN","joinAttributesForQuery","attributes","join","getSystemLightMode","matchMedia","matches","getSystemPrintMode","are","calcWindowSize","width","parseAttributeString","attribute","ret","out","startsWith","endsWith","JSON","parse","jsonify","e","console","error","message","component","functionName","Date","toLocaleString","parseJsonString","trim","includes","split","forEach","sp","getOffsetTop","element","offsetTop","parseInt","getStyleValue","getIntOrDefault","integer","target","currentStyle","getComputedStyle","getPropertyValue","isInRange","getActiveClass","parseAttribute","getAttribute","isStringTrue","toLowerCase","boolStringOrDefault","prop","getStringOrDefault","isString","replacePrefix","replace","generateRandomString","rand","getRandomInt","rand2","Math","floor","random","ceil","registerCuiElement","node","components","utils","$handlers","matching","hasAttribute","filter","a","getMatchingAttributes","$cuid","next","generateCUID","tagName","setAttribute","match","find","styleAppender","append","getStyle","handler","handle","attr","addCuiArgument","cuiArg","args","argArr","enumerateObject","arg","push","counter","idx","getParentCuiElement","parent","parentElement","getChildrenHeight","height","from","child","offsetHeight","callback","calculateNextIndex","currentIndex","totalLength","getFirstMatching","array","count","CUID_ATTRIBUTE","CLASSES","dark","animProgress","print","active","swipingOn","selectionOff","ICONS","close","accordion","special_menu","special_fail","special_success","CSS_APP_BACKGROUND_COLORS","light","CSS_COMPONENT_BACKGROUND_COLORS","CSS_COMPONENT_BORDER_COLORS","CSS_THEMES","base","muted","accent","secondary","success","warning","SCOPE_SELECTOR","CSS_VARIABLES","fontSize","lineHeight","animationTime","animationTimeLong","animationTimeShort","colorLightAppBackground","colorLightBackground","colorLightBorder","colorLightBase","colorLightActive","colorLightMuted","colorDarkAppBackground","colorDarkBackground","colorDarkBorder","colorDarkBase","colorDarkActive","colorDarkMuted","colorAccent","colorAccentActive","colorAccentMuted","colorAccentShade","colorAccentShadeDark","colorSecondary","colorSecondaryActive","colorSecondaryMuted","colorSecondaryShade","colorSecondaryShadeDark","colorWarning","colorWarningActive","colorWarningMuted","colorWarningShade","colorWarningShadeDark","colorSuccess","colorSuccessActive","colorSuccessMuted","colorSuccessShade","colorSuccessShadeDark","colorError","colorErrorActive","colorErrorMuted","colorErrorShade","colorErrorShadeDark","inputBackground","colorShade","colorShadeDarker","colorShadeLight","colorShadeLighter","outline","borderRadius","padding","margin","scrollbarWidth","componentSpace","accordionIcon","STATICS","logLevel","EVENTS","INSTANCE_INITIALIZED","INSTANCE_FINISHED","RESIZE","OPEN","OPENED","CLOSE","CLOSED","TOGGLE","TOGGLED","SWITCH","SWITCHED","ON_SCROLL","TARGET_CHANGE","INTERSECTION","KEYDOWN","SCROLLBY","WINDOW_CLICK","OFFSET","PROGRESS_CHANGE","PROGRESS_CHANGED","CHANGE","CHANGED","GLOBAL_MOVE","MOVE_LOCK","PAUSE","PAUSED","SORTED","SORT_START","COMPONENTS_COUNTER","ErrorBase","Error","super","setPrototypeOf","this","ItemNotFoundError","ArgumentError","CuiInstanceInitError","RegisterElementError","AnimatorError","CSSVariableError","CuiColorError","CuiPositionError","CuiLoggerFactory","ElementBuilder","tag","id","classList","add","CuiClassAction","className","contains","remove","CuiInboundAction","setLightMode","setDarkMode","getLightMode","AttributeAction","removeAttribute","DummyAction","CuiActionsListFactory","map","single","substring","CuiTaskRunner","autoRenew","canRun","stop","start","clearTimeout","CuiSetup","autoLightMode","scrollThreshold","resizeThreshold","plugins","init","cacheSize","CuiSetupInit","app","interaction","body","busSetup","undefined","CuiElementBoxFactory","Window","WindowElementBox","HTMLElement","HTMLElementBox","ElementBox","getBoundingClientRect","top","left","scrollHeight","scrollWidth","scrollTop","scrollLeft","selector","querySelectorAll","offsetWidth","offsetLeft","innerHeight","innerWidth","pageYOffset","pageXOffset","maxSize","has","update","clean","item","refresh","containsKey","clear","keys","interactions","documentElement","setPropertyIn","toCssString","type","set","colors","baseColor","mutedColor","clone","lighten","activeColor","darken","mutate","setProperty","factor","propertyName","style","bus","threshold","findIndex","x","splice","addEventListener","listener","removeEventListener","ev","diff","abs","currentSize","resizeData","current","previous","timestamp","now","emit","resize","all","tool","cuid","pushState","registerElement","unregisterElement","initialSetup","setup","fromInit","cache","development","connect","classes","flag","CuiMediaQueryListener","mediaQuery","event","CuiScrollListener","onScrollFinish","detach","attach","initial","source","getScrollLeft","getScrollTop","passedThreshold","scrolling","CuiMoveEventListener","onMouseDown","onMouseUp","onMouseMove","onTouchStart","onTouchEnd","onTouchMove","passive","log","publishMouseEvent","publishTouchEvent","cancelable","preventDefault","clientX","y","clientY","moveX","movementX","moveY","movementY","touch","touches","changedTouches","FastDom","isScheduled","raf","requestAnimationFrame","writes","reads","ctx","createTask","schedule","tasks","task","shift","recursion","flush","rec","run","SyncInteractions","isRunning","EmitHandlerBase","queue","isBusy","emitId","handleId","SimpleEventEmitHandler","executor","events","perform","idMatches","execute","TaskedEventEmitHandler","promises","CuiEventEmitHandlerFactory","CuiCallbackExecutor","CuiColor","red","green","blue","alpha","colorStr","parser","HexColorParser","RgbColorParser","amount","shade","percent","self","shadeSingle","newVal","round","alphaHex","parseFloat","toFixed","len","CuiLogger","level","prepString","warn","stack","CuiActionsHelper","action","actions","inTarget","outTarget","inAction","outAction","onFinish","CuiInteractionsFactory","CuiDictionary","throwOnEmptyKey","index","indexOf","CuiEventBus","emitHandler","cui","isAttached","debug","getCuid","callbacks","evId","evValue","CuiEventExtBus","sort","first","second","priority","initBusInstance","mapEvents","eventsDef","on","detachAll","isSubscribing","detachByCuid","busName","handlerName","reduce","result","CuiEventBusFactory","CuiDocumentStyleAppender","head","getElementsByTagName","text","createTextNode","appendChild","CuiKeyPressListener","singleEmit","onKeyDown","onKeyUp","code","autoLightInit","description","autoLight","setCallback","onChange","autoLightSetup","AriaAttributes","label","cls","setClasses","removeClasses","attributeName","componentName","_log","isLocked","setId","activeClassName","helper","fetch","data","fName","exception","actionsHelper","prevArgs","isInitialized","logInfo","logWarning","registerInDebug","onHandle","pushDebugState","onRefresh","logError","onRemove","detachEmiitedEvents","removeFromDebug","CuiHandler","onInit","onUpdate","onDestroy","performActions","onEvent","openFromEvent","closeFromEvent","openAct","closeAct","detachEvent","checkLockAndWarn","isActive","escClose","keyClose","onKeyClose","onBeforeOpen","performAction","onActionFinish","onAfterOpen","setClass","setAria","onBeforeClose","onAfterClose","removeClass","open","emitEvent","state","onMutation","mutation","observe","unobserve","records","addedNodes","added","removedNodes","removed","svgString","IconScaleAppender","scale","created","toString","icon","CuiIconComponent","addIcon","svg","querySelector","iconStr","iconSvg","setScale","build","childNodes","insertBefore","iconElement","firstChild","progress","getTotalLength","readStyle","onSetProgress","strokeDashoffset","updateStyle","spinner","onPause","removeIfAnyExisists","svgIcon","addSpinner","existing","hasClass","setClassesAs","removeClassesAs","CuiDummyComponent","behavior","onClick","setTargets","to","by","scrollBy","options","onScroll","setThreshold","setTarget","isInProgress","prepareCallbackResult","currentTop","currentBottom","childBottom","ratio","currentLeft","currentRight","childRight","parentBottom","getHeight","parentRight","getWidth","items","verticalRatio","calcChildVerticalRatio","horizontalRatio","calcChildHorizontalRatio","CuiScrollSpyModeHandlerFactory","elements","forEachAction","links","linksActions","getMatching","last","changed","removeActions","lastElement","intersecting","addActions","link","linkAction","isRoot","CuiScrollspyComponent","onIntersection","updateAttributes","updateResult","targets","queryAll","setChildren","setParent","autoPrintInit","autoPrint","setPrintMode","CuiIntersectionObserver","observer","IntersectionObserver","rootMargin","disconnect","offset","CuiIntersectionComponent","parseArguments","el","entries","entry","isIntersecting","intersectionRatio","emitIntersection","prevent","CuiOpenComponent","onOpen","getTarget","then","activateTarget","catch","finally","cuiId","setActiveClass","setActiveClassAsync","shouldEmit","emitOpen","CuiCloseComponent","onClose","removeActiveClass","removeActiveClassAsync","emitClose","CuiToggleComponent","toggle","CuiResizeArgs","CuiResizeComponent","keySetup","defTimeout","outClose","CuiDialogComponent","isAnyActive","onWindowClick","scrollTo","container","position","getDefaultOpenClass","getDefaultCloseClass","CuiOffCanvasComponent","setPositionLeft","scrollY","animation","CuiAccordionComponent","isValid","initTargets","onSwitch","mutations","queryItems","closeAllExcept","currentTarget","switch","setListener","onMouseOver","onMouseOut","mouseEvent","force","invoke","isHovering","box","getTopPosition","getBottomPosition","getMiddlePosition","getLeftPosition","getRightPosition","getCenterPosition","number","getVerticalPosition","getHorizontalPosition","throwIfNotValid","method","validate","evaluator","setMargin","elementBox","targetWidth","targetHeight","setElementBox","vertical","horizontal","outVNum","outVPos","getAutoVerticalPosition","outHNum","outHPos","getAutoHorizontalPosition","trigger","autoClose","pos","CuiDropComponenet","onElementHover","onTriggerClick","setPreferred","setTriggerEvent","setStatic","findAndCloseOpenedDrop","toggleActions","calculate","runAutoCloseTask","opened","onHoverEvent","CuiOffsetStaticMode","offsetX","offsetY","CuiOffsetDynamicMode","fitsOffsetY","fitsOffsetX","diffX","diffY","CuiOffsetComponent","checkAndPerformActions","getRoot","matchesOffset","act","callEvent","calcaRatio","exceededThreshold","ratioX","ratioY","ratY","clientHeight","ratX","clientWidth","in","autoTimeout","CuiSwitchComponent","onPushSwitch","getTargets","getActiveIndex","getSwitches","setSwitchesActive","setLinkActive","setStyle","getElementHeight","startTask","record","nextIdx","nextItem","performSwitchAction","switches","sw","emitLinkSwitch","CuiSwitcherComponent","onClickEvent","setEvents","removeEvents","list","onListItemClick","BasePositionCalculator","BaseResizeCalculator","CuiFloatComponent","move","onMove","peform","newWidth","newHeight","fitsWindow","newX","newY","rtl","opacity","unit","createValue","props","cur","buildSingle","transform","cleanOnFinish","animators","animator","reportError","revert","animationProgress","shouldCalcRevert","animateAsync","initialProgress","pr","currProgress","callUpdate","endAnimation","reverted","shouldCleanOnFinish","setOnError","setElement","setAnimators","animate","SWIPE_ANIMATIONS_DEFINITIONS","translateX","right","fade","loop","CuiSliderComponent","setOnFinish","onAnimationFinish","getLinks","absRatio","back","finish","newRatio","adjustMoveRatio","setProps","errorOccured","swipe","CuiBanerComponent","onSwipeFinish","CuiCoverComponent","found","isInBounds","cancelTimeout","CuiSortableComponent","sutils","onDragStart","onDragOver","onDragEnd","stopMovementPrep","getTargetsAndTrggers","setLongPressTimeout","setElements","getPressedElementIdx","startMovementPrep","getFinishAnimation","createPreview","setPreviewPosition","setCurrentPosition","removePreview","detected","detect","insertElement","destination","baseColorSets","background","themeColors","shadeDark","CuiBaseColorsSetter","colorSet","setter","color","setColor","setProperties","CuiThemeColorsSetter","setBaseUnitValue","setAnimationTimeLong","setAnimationTimeShort","setCSSVariable","strVal","onCssChange","accentSetter","isArgNumber","setBaseFontSize","setBaseLineHeight","setAnimationTime","setBaseMargin","setBasePadding","setBaseBorderRadius","setComponentSpace","setScrollbarWidth","setAccordionIcon","setAppBackgroundColor","setDarkAppBackgroundColor","isArgColor","getBaseColorSetter","palette","setBackgroundColor","setBaseColor","setMutedColor","setActiveColor","getAccentColorSetter","setAutoColors","setShadeColor","setShadeDarkColor","pallete","getBaseColorsSetter","getDarkBaseColorsSetter","getAccentThemeColorsSetter","getSecondaryThemeColorsSetter","getErrorThemeColorsSetter","getWarningThemeColorsSetter","getSuccessThemeColorsSetter","CuiTooltipComponent","onHover","getDataFromArgs","removeTooltip","createTooltip","textContent","maxWidth","toolbox","settings","appPrefix","icons","swipeAnimations","initializer","pluginList","componentList","attributeValue","eventName","lock","unlock","delay","change","openClass","animationClass","closeClass","ids","cuiElement","toastElement","currentElement","nextElement","animIn","animOut","newIndex","animClassIn","animClassOut","duration","addAnimationClass","setFinalClasses","setToggle","check","newIdx","getCurrentIndex","verifyIndex","setCurrent","setCurrentWithAnimation","plugin","reverse","title","headerBuilder","titleElement","getPrefixedString","appendChildrens","dialog","setAttributes","str","onYes","onNo","onCancel","onOk","closeStr","getElementById","updateElement","dialogBuilder","createHeader","createBody","createFooter","onMoveLock","MutationObserver","initElements","setComponents","setPlugins","show","nodes","CuiMutationObserver","subtree","childList","attributeFilter","mutationCallback","handleChildListMutation","addedLen","removedLen","handleAddedNodes","handleRemovedNodes","childrens","hasChildNodes","destroySingleElement","destroy","CuiComponentMutationHandler","CUI_LIGHT_VERSION","cuiInit"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cui-light\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cui-light\"] = factory();\n\telse\n\t\troot[\"cui-light\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 31);\n","import { CuiLightMode, CuiWindowSize } from \"./types\";\r\nimport { ArgumentError, RegisterElementError } from \"../models/errors\";\r\nimport { ICuiComponent, CuiElement } from \"../models/interfaces\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { COMPONENTS_COUNTER, CUID_ATTRIBUTE } from \"./statics\";\r\n\r\n/**\r\n * Checks if value is defined an is not null\r\n * Additionally with type check it can check value if it is not empty string or collection or object\r\n * \r\n * @param val - value\r\n * @param typecheck - default true - additional check whether value is not empty (string, collection, object)\r\n * @returns whether value passed all conditions\r\n */\r\nexport function is(val: any, typecheck: boolean = true): boolean {\r\n    if (typeof val !== 'undefined' && val !== null) {\r\n        if (!typecheck) {\r\n            return true;\r\n        } else {\r\n            return !isEmpty(val)\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Checks if value is empty string, array or object\r\n *\r\n *\r\n * @param val - value\r\n * @returns whether value passed all conditions\r\n */\r\nexport function isEmpty(val: any): boolean {\r\n    if (typeof val === \"string\") {\r\n        return val.length === 0\r\n    }\r\n    if (typeof val === \"boolean\") {\r\n        return val;\r\n    }\r\n    else if (Array.isArray(val)) {\r\n        return val.length === 0\r\n    }\r\n    return false\r\n}\r\n\r\nexport function getName(prefix: string, name: string) {\r\n    if (!is(prefix) || !is(name)) {\r\n        throw new ArgumentError(\"Missing argument value\")\r\n    }\r\n    return `${prefix}-${name}`\r\n}\r\n\r\nexport function sleep(timeout: number): Promise<boolean> {\r\n    return new Promise(resolve => setTimeout(() => {\r\n        resolve(true)\r\n    }, timeout));\r\n}\r\n\r\n/**\r\n * Creates proper html element from given string\r\n * @param htmlString - string containing html\r\n */\r\nexport function createElementFromString(htmlString: string): Element {\r\n    if (!is(htmlString)) {\r\n        return null;\r\n    }\r\n    let template = document.createElement('template')\r\n    template.innerHTML = htmlString\r\n    return template.content.children.length > 0 ? template.content.children[0] : null;\r\n}\r\n\r\nexport function getMatchingAttribute(element: any, attributes: string[]): string {\r\n    let attr = null;\r\n    let len = attributes.length;\r\n    for (let i = 0; i < len; i++) {\r\n        let attribute = attributes[i];\r\n        if (element.hasAttribute(attribute)) {\r\n            attr = attribute\r\n            break;\r\n        }\r\n    }\r\n    return attr;\r\n}\r\n\r\nexport function getMatchingAttributes(element: any, attributes: string[]): string[] {\r\n    if (!element || !is(element.hasAttribute)) {\r\n        return null;\r\n    }\r\n    return attributes.filter(a => {\r\n        return element.hasAttribute(a);\r\n    });\r\n}\r\n\r\nexport function getRangeValue(value: number, min: number, max: number) {\r\n    if (value < min) {\r\n        return min;\r\n    } else if (value > max) {\r\n        return max;\r\n    }\r\n    return value;\r\n}\r\n\r\nexport function getRangeValueOrDefault(value: number, min: number, max: number, def: number) {\r\n    if (value === null || typeof value === 'undefined' || isNaN(value)) {\r\n        return def;\r\n    }\r\n    return getRangeValue(value, min, max)\r\n}\r\n\r\nexport function increaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value + (value * amount);\r\n}\r\n\r\nexport function decreaseValue(value: number, amount: number): number {\r\n    return amount < 0 || amount > 1 ? 0 : value - (value * amount);\r\n}\r\n\r\nexport function clone(object: any): any {\r\n    if (!is(object)) {\r\n        return null;\r\n    }\r\n    return Object.assign({}, object);\r\n}\r\n\r\nexport function getSingleColorRatio(first: number, second: number, max: number): number {\r\n    return Math.abs(((first - second) / max) * 100)\r\n}\r\n\r\n/**\r\n * Creates string containg css selector for array of attributes\r\n * @param attributes - attributes values\r\n */\r\nexport function joinAttributesForQuery(attributes: string[]): string {\r\n    if (!is(attributes)) {\r\n        return \"\"\r\n    }\r\n    return `[${attributes.join('],[')}]`\r\n}\r\n\r\n/**\r\n * Checks light system light mode\r\n * @returns Light Mode - dark/light\r\n */\r\nexport function getSystemLightMode(): CuiLightMode {\r\n    return window.matchMedia &&\r\n        window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\r\n}\r\n\r\n/**\r\n * Check print mode in the browser window\r\n * @returns true if window is displayed in print mode\r\n */\r\nexport function getSystemPrintMode(): boolean {\r\n    return window.matchMedia &&\r\n        window.matchMedia('print').matches;\r\n}\r\n\r\n/**\r\n * Verifies whether attributes exist and have some values\r\n * @param attributes attributes list\r\n */\r\nexport function are(...attributes: any[]): boolean {\r\n    if (!is(attributes)) {\r\n        return false\r\n    }\r\n    let c = attributes.length;\r\n    for (let i = 0; i < c; i++) {\r\n        if (!is(attributes[i])) {\r\n            return false;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function calcWindowSize(width: number): CuiWindowSize {\r\n    if (width <= 640) {\r\n        return 'small';\r\n    } else if (width > 640 && width <= 960) {\r\n        return \"medium\"\r\n    } else if (width > 960 && width <= 1200) {\r\n        return \"large\"\r\n    }\r\n    return 'xlarge';\r\n}\r\n\r\n/**\r\n * Creates object from string.\r\n * Supported syntaxes are:\r\n * - JSON\r\n * - single value\r\n * - key:value,value;key=value\r\n * \r\n * @param attribute - attribute value\r\n */\r\nexport function parseAttributeString(attribute: string): any {\r\n    let ret: any = {};\r\n    if (!is(attribute)) {\r\n        return ret;\r\n    }\r\n    ret = parseJsonString(attribute.trim())\r\n\r\n    if (!is(ret)) {\r\n        if (!attribute.includes(';') && !attribute.includes(':')) {\r\n            ret = attribute;\r\n        } else {\r\n            ret = {}\r\n            attribute.split(';').forEach(val => {\r\n                let sp = val.split(':')\r\n                if (sp.length === 2) {\r\n                    ret[sp[0].trim()] = sp[1].trim()\r\n                }\r\n            })\r\n        }\r\n    }\r\n    return ret\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n* String must start with { and end with }\r\n *\r\n * @param attribute - attribute value\r\n * @returns object if string passes test, null otherwise\r\n */\r\n\r\nexport function parseJsonString(attribute: string): any | null {\r\n    let out = null;\r\n    if (is(attribute) && attribute.startsWith('{') && attribute.endsWith('}')) {\r\n        try {\r\n            out = jsonify(attribute);\r\n        } catch (e) {\r\n            console.error(prepLogString(\"An exception occured\", 'Functions', 'parseJsonString'), e)\r\n        }\r\n        return out;\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Creates object from JSON string\r\n * @param attribute - JSON string\r\n */\r\nexport function jsonify(attribute: string): any {\r\n    return attribute && attribute.length > 0 ? JSON.parse(attribute) : {}\r\n}\r\n\r\nexport function getOffsetTop(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetTop - parseInt(getStyleValue(element, 'margin-top')) - parseInt(getStyleValue(element, 'padding-top')) - parseInt(getStyleValue(element, 'border-top-width'))\r\n    return val < 0 ? element.offsetTop : val;\r\n}\r\n\r\nexport function getOffsetLeft(element: HTMLElement) {\r\n    if (!is(element)) {\r\n        return -1;\r\n    }\r\n    let val = element.offsetLeft - parseInt(getStyleValue(element, 'margin-left')) - parseInt(getStyleValue(element, 'padding-left')) - parseInt(getStyleValue(element, 'border-left-width'))\r\n    return val < 0 ? element.offsetLeft : val;\r\n}\r\n\r\nexport function getIntOrDefault(value: any, def: number): number {\r\n    let integer = parseInt(value);\r\n    return isNaN(integer) ? def : integer;\r\n}\r\n\r\nexport function getStyleValue(target: any, property: string): any {\r\n    if (!is(target) || !is(property)) {\r\n        return null;\r\n    }\r\n    if (target.currentStyle) {\r\n        return target.currentStyle[property];\r\n    } else if (window.getComputedStyle) {\r\n        return window.getComputedStyle(target, null).getPropertyValue(property)\r\n    }\r\n    return null;\r\n}\r\n\r\nexport function prepLogString(message: string, component: string, functionName?: string) {\r\n    return `[${new Date().toLocaleString()}][${component ?? \"-\"}][${functionName ?? '-'}][${message}]`\r\n}\r\n\r\nexport function isInRange(value: number, min: number, max: number): boolean {\r\n    return is(value) && value >= min && value <= max;\r\n}\r\n\r\nexport function getActiveClass(prefix: string) {\r\n    return `${prefix ?? \"\"}-active`;\r\n}\r\n\r\nexport function parseAttribute(element: Element, attribute: string): any {\r\n    return are(element, attribute) ? parseAttributeString(element.getAttribute(attribute)) : null;\r\n}\r\n\r\n\r\n/**\r\n *  Checks whether string value contains synonym of true\r\n * @param value - string to check\r\n */\r\nexport function isStringTrue(value: string): boolean {\r\n    return is(value) ? ['y', 't', 'true', 'yes'].includes(value.toLowerCase()) : false\r\n}\r\n\r\nexport function boolStringOrDefault(prop: any, def: boolean): boolean {\r\n    return is(prop) ? isStringTrue(prop) : def;\r\n}\r\n\r\nexport function getStringOrDefault(value: any, def: string) {\r\n    return is(value) ? value.toLowerCase() : def;\r\n}\r\n\r\n/**\r\n * Checks whether device supports touch\r\n */\r\nexport function isTouchSupported(): boolean {\r\n    return ('ontouchstart' in window) ||\r\n        (navigator.maxTouchPoints > 0) ||\r\n        (navigator.msMaxTouchPoints > 0);\r\n}\r\n\r\n/**\r\n * Checks whether value is type of string\r\n * @param {any} value - value to be checked\r\n */\r\nexport function isString(value: any): boolean {\r\n    return typeof value === 'string';\r\n}\r\n\r\n\r\n/**\r\n * Replaces mask {prefix} with actual value in the string\r\n * @param {string} value - text containg a mask\r\n * @param {string} prefix - value to be put in place of mask\r\n */\r\nexport function replacePrefix(value: string, prefix: string): string {\r\n    return !is(value) ? value : value.replace(\"{prefix}\", prefix ?? \"\");\r\n}\r\n\r\n/**\r\n * Generates identifier for Cui element\r\n * \r\n * @param element - Cui element selector\r\n * @returns generated identifier\r\n */\r\nexport function generateCUID(element?: string) {\r\n    let starter = is(element) ? element : \"cui-element\"\r\n    return `${starter}-${COMPONENTS_COUNTER.next().value}`;\r\n}\r\n\r\n/**\r\n * Generates random string\r\n */\r\nexport function generateRandomString(): string {\r\n    let rand = getRandomInt(1, 1000)\r\n    let rand2 = getRandomInt(1, 100)\r\n    return `${Math.floor(Math.random() * rand2)}-${Math.floor(rand)}`;\r\n}\r\n/**\r\n * Generates random integer\r\n * @param min - min number\r\n * @param max - max number\r\n * @returns random integer\r\n */\r\nexport function getRandomInt(min: number, max: number): number {\r\n    min = Math.ceil(min);\r\n    max = Math.floor(max);\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n/**\r\n * Registers Element as Cui element, initializes handlers, sets component style to document header and sets $cuid\r\n * @param {any} node - document node\r\n * @param {ICuiComponent[]} components -supported components array\r\n * @param {string[]} attributes - supported attributes array\r\n * @param {CuiUtils} utils - Cui Utils instance\r\n */\r\nexport function registerCuiElement(node: any, components: ICuiComponent[], attributes: string[], utils: CuiUtils) {\r\n    let element = node as CuiElement;\r\n    element.$handlers = {};\r\n    let matching: string[] = getMatchingAttributes(node, attributes)\r\n    if (is(matching)) {\r\n        element.$cuid = node.hasAttribute(CUID_ATTRIBUTE) ? node.getAttribute(CUID_ATTRIBUTE) : generateCUID(node.tagName)\r\n        node.setAttribute(CUID_ATTRIBUTE, element.$cuid);\r\n        matching.forEach(match => {\r\n            let component = components.find(c => { return c.attribute === match });\r\n            if (is(component)) {\r\n                try {\r\n                    utils.styleAppender.append(component.getStyle());\r\n                    let handler = component.get(node, utils);\r\n                    element.$handlers[component.attribute] = handler;\r\n                    element.$handlers[component.attribute].handle(parseAttribute(node, component.attribute));\r\n                } catch (e) {\r\n                    let attr = matching ? matching.join(\", \") : \"\";\r\n                    throw new RegisterElementError(`An error occured during [${attr}] initialization: ${e.message}`);\r\n                }\r\n            }\r\n        })\r\n\r\n    }\r\n}\r\n\r\nexport function addCuiArgument<T>(element: HTMLElement, cuiArg: string, args: T): boolean {\r\n    if (!are(cuiArg, args, element)) {\r\n        return false;\r\n    }\r\n    if (element.hasAttribute(cuiArg)) {\r\n        return false;\r\n    }\r\n    let argArr: string[] = [];\r\n    enumerateObject(args, (arg: string, value: string) => {\r\n        argArr.push(`${arg}: ${value}`);\r\n    })\r\n    element.setAttribute(cuiArg, argArr.join(\"; \"));\r\n    return true;\r\n\r\n}\r\n\r\nexport function* counter() {\r\n    let idx = 0;\r\n    while (true) {\r\n        let reset = yield idx++;\r\n        if (reset || idx > 200000) {\r\n            idx = 0\r\n        }\r\n    }\r\n}\r\n\r\nexport function getHandlerExtendingOrNull<T>(target: CuiElement, fName: string): T {\r\n    if (!is(target.$handlers)) {\r\n        return null;\r\n    }\r\n\r\n    for (let handler in target.$handlers) {\r\n\r\n        if (target.$handlers.hasOwnProperty(handler)) {\r\n            let h: any = target.$handlers[handler];\r\n            if (hasFunction(h, fName))\r\n                return h;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\n/**\r\n * Checks whether property exists on the object and it is a function\r\n * @param obj - object\r\n * @param fName - property name\r\n */\r\nexport function hasFunction(obj: any, fName: string) {\r\n    return is(obj[fName]) && typeof obj[fName] === 'function'\r\n}\r\n\r\n/**\r\n * Gets closest parent element which is a cUI element\r\n * @param element \r\n */\r\nexport function getParentCuiElement(element: Element): Element {\r\n    if (!is(element)) {\r\n        return undefined;\r\n    }\r\n    let parent = element.parentElement as any;\r\n    return is(parent) && is(parent.$cuid) ? parent : getParentCuiElement(parent);\r\n}\r\n\r\n/**\r\n * Calculates element height by calculating childerns heights\r\n * @param element\r\n */\r\nexport function getChildrenHeight(element: Element): number {\r\n    let height: number = 0;\r\n    if (!element) {\r\n        return -1;\r\n    }\r\n    Array.from(element.children).forEach((child: HTMLElement) => {\r\n        height += child.offsetHeight;\r\n    })\r\n    return height > 0 ? height + 4 : height;\r\n}\r\n\r\nexport function enumerateObject<T>(object: T, callback: (property: string, value: any) => void) {\r\n    if (!are(object, callback)) {\r\n        return;\r\n    }\r\n    for (let prop in object) {\r\n        if (object.hasOwnProperty(prop)) {\r\n            callback(prop, object[prop]);\r\n        }\r\n    }\r\n}\r\n\r\nexport function round(value: number, decimalPlaces: number): number {\r\n    const multiplier = 10 ** decimalPlaces;\r\n    return Math.floor(value) / multiplier;\r\n}\r\n\r\nexport function calculateNextIndex(val: any, currentIndex: number, totalLength: number): number {\r\n    let idx = -1;\r\n    switch (val) {\r\n        case 'prev':\r\n            idx = currentIndex <= 0 ? totalLength - 1 : currentIndex - 1;\r\n            break;\r\n        case 'next':\r\n            idx = currentIndex < totalLength - 1 ? currentIndex + 1 : 0\r\n            break;\r\n        case 'first':\r\n            idx = 0;\r\n            break;\r\n        case 'last':\r\n            idx = totalLength - 1;\r\n        default:\r\n            idx = getIntOrDefault(val, -1);\r\n            break;\r\n    }\r\n    return idx;\r\n}\r\n\r\nexport function getFirstMatching<T>(array: T[], callback: (t: T, index: number) => boolean): T | undefined {\r\n    let count = array.length;\r\n    if (!array || count === 0) {\r\n        return undefined;\r\n    }\r\n\r\n    for (let idx = 0; idx < count; idx++) {\r\n        if (callback(array[idx], idx)) {\r\n            return array[idx];\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n\r\nexport function mapObject<T, V>(input: T, callback: (t: T) => V): V | undefined {\r\n    return input ? callback(input) : undefined;\r\n}\r\n\r\nexport function mapObjectArray<T, V>(input: T[], callback: (t: T) => V): V[] {\r\n    return input.map((item: T) => {\r\n        return mapObject(item, callback);\r\n    })\r\n}\r\n\r\n/**\r\n * Delays callback execution by specific time. Callback cannot be called again until previous execution finishes or was cancelled\r\n * @param callback - callback to execute\r\n * @param delayTime - time in ms that execution shall be delayed by\r\n * @returns Cancel callback\r\n */\r\nexport function delay(callback: (...args: any[]) => void, delayTime: number) {\r\n    if (!are(callback, delayTime)) {\r\n        throw new Error(\"[delay]: Input arguments are not correct\")\r\n    }\r\n    let id: any = null;\r\n    return function (...args: any[]) {\r\n        if (id === null) {\r\n            id = setTimeout(() => {\r\n                callback(...args);\r\n                id = null;\r\n            }, delayTime)\r\n        }\r\n        return function () {\r\n            if (id !== null) {\r\n                clearTimeout(id);\r\n                id = null;\r\n            }\r\n        }\r\n    }\r\n}","export * from \"./models/colors\";\r\nexport * from \"./models/errors\";\r\nexport * from \"./models/events\";\r\nexport * from \"./models/interfaces\";\r\nexport * from \"./models/setup\";\r\nexport * from \"./models/utils\";\r\n// Utils\r\nexport * from \"./utils/actions\";\r\nexport * from \"./utils/dictionary\";\r\nexport * from \"./utils/functions\";\r\nexport * from \"./utils/interactions\";\r\nexport * from \"./utils/logger\";\r\nexport * from \"./utils/types\";\r\nexport * from \"./utils/statics\";\r\n\r\nexport * from \"./styles/appender\";\r\n// Factories\r\nexport * from \"./factories/logger\";\r\nexport * from \"./factories/interactions\";\r\n//Helpers\r\nexport * from \"./helpers/helpers\";\r\n// BUS\r\nexport * from \"./bus/executors\";\r\nexport * from \"./bus/handlers\";\r\nexport * from \"./bus/bus\";\r\n// Listeners\r\nexport * from \"./listeners/keys\";\r\nexport * from \"./listeners/media\";\r\nexport * from \"./listeners/scroll\";\r\n","import { CuiLogLevel } from \"./types\";\r\nimport { CuiColorPair } from \"../models/colors\";\r\nimport { counter } from \"./functions\";\r\nexport const CUID_ATTRIBUTE = \"cuid\";\r\n\r\nexport const CLASSES = {\r\n    dark: 'dark',\r\n    animProgress: 'animation-progress',\r\n    print: 'print',\r\n    active: 'active',\r\n    swipingOn: \"swiping-on\",\r\n    selectionOff: \"selection-off\",\r\n}\r\n\r\nexport const ICONS: any = {\r\n    close: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 1.9999999,1.9999999 18,18\\\"></path><path d=\\\"M 18,1.9999999 1.9999999,18\\\"></path></svg>\",\r\n    accordion: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 5.0000475,7.4490018 10.000024,12.551028 15,7.4490018\\\"></path></svg>\",\r\n    special_menu: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path class=\\\"menu_handle_2\\\" d=\\\"M 1,10 H 19\\\"></path><path class=\\\"menu_handle_1\\\" d=\\\"M 1,4.8571429 H 19\\\"></path><path  class=\\\"menu_handle_3\\\" d=\\\"M 1,15.142857 H 19\\\"></path></svg>\",\r\n    special_fail: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-fail\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7.000001 A 43,43 0 0 1 92.999999,50 43,43 0 0 1 50,92.999999 43,43 0 0 1 7.0000011,50 43,43 0 0 1 50,7.000001 Z\\\"></path><path class=\\\"arm_1\\\" d=\\\"M 28.536809,28.536809 71.342023,71.342023\\\"></path><path class=\\\"arm_2\\\" d=\\\"M 71.342023,28.536809 28.536809,71.342023\\\"></path></svg>\",\r\n    special_success: \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"special-success\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle\\\" d=\\\"M 50,7 A 43,43 0 0 1 93,50 43,43 0 0 1 50,93 43,43 0 0 1 7,50 43,43 0 0 1 50,7 Z\\\"></path><path class=\\\"arm\\\" d=\\\"M 22.988405,48.234784 36.946233,72.410453 75.516456,33.84023\\\"></path></svg>\",\r\n};\r\n\r\nexport const COLORS = ['red', 'green', 'blue', 'alpha']\r\n\r\nexport const CSS_APP_BACKGROUND_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-app-background',\r\n    dark: '--cui-color-dark-app-background'\r\n}\r\n\r\nexport const CSS_COMPONENT_BACKGROUND_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-background',\r\n    dark: '--cui-color-dark-background '\r\n}\r\n\r\nexport const CSS_COMPONENT_BORDER_COLORS: CuiColorPair = {\r\n    light: '--cui-color-light-border',\r\n    dark: '--cui-color-dark-border'\r\n}\r\n\r\nexport const CSS_THEMES = {\r\n    light: {\r\n        base: '--cui-color-light-base',\r\n        muted: '--cui-color-light-muted',\r\n        active: '--cui-color-light-active'\r\n    },\r\n    dark: {\r\n        base: '--cui-color-dark-base',\r\n        muted: '--cui-color-dark-muted',\r\n        active: '--cui-color-dark-active'\r\n    },\r\n    accent: {\r\n        base: '--cui-color-primary',\r\n        muted: '--cui-color-primary-muted',\r\n        active: '--cui-color-primary-active'\r\n    },\r\n    secondary: {\r\n        base: '--cui-color-secondary',\r\n        muted: '--cui-color-secondary-muted',\r\n        active: '--cui-color-secondary-active'\r\n    },\r\n    success: {\r\n        base: '--cui-color-success',\r\n        muted: '--cui-color-success-muted',\r\n        active: '--cui-color-success-active'\r\n    },\r\n    warning: {\r\n        base: '--cui-color-warning',\r\n        muted: '--cui-color-warning-muted',\r\n        active: '--cui-color-warning-active'\r\n    },\r\n    error: {\r\n        base: '--cui-color-error',\r\n        muted: '--cui-color-error-muted',\r\n        active: '--cui-color-error-active'\r\n    }\r\n}\r\n\r\nexport const SCOPE_SELECTOR = \":scope \";\r\n\r\nexport const CSS_VARIABLES: any = {\r\n    fontSize: \"--{prefix}-font-size\",\r\n    lineHeight: \"--{prefix}-line-height\",\r\n    animationTime: \"--{prefix}-animation-time\",\r\n    animationTimeLong: \"--{prefix}-animation-time-long\",\r\n    animationTimeShort: \"--{prefix}-animation-time-short\",\r\n    colorLightAppBackground: \"--{prefix}-color-light-app-background\",\r\n    colorLightBackground: \"--{prefix}-color-light-background\",\r\n    colorLightBorder: \"--{prefix}-color-light-border\",\r\n    colorLightBase: \"--{prefix}-color-light-base\",\r\n    colorLightActive: \"--{prefix}-color-light-active\",\r\n    colorLightMuted: \"--{prefix}-color-light-muted\",\r\n    colorDarkAppBackground: \"--{prefix}-color-dark-app-background\",\r\n    colorDarkBackground: \"--{prefix}-color-dark-background\",\r\n    colorDarkBorder: \"--{prefix}-color-dark-border\",\r\n    colorDarkBase: \"--{prefix}-color-dark-base\",\r\n    colorDarkActive: \"--{prefix}-color-dark-active\",\r\n    colorDarkMuted: \"--{prefix}-color-dark-muted\",\r\n    colorAccent: \"--{prefix}-color-primary\",\r\n    colorAccentActive: \"--{prefix}-color-primary-active\",\r\n    colorAccentMuted: \"--{prefix}-color-primary-muted\",\r\n    colorAccentShade: \"--{prefix}-color-primary-shade\",\r\n    colorAccentShadeDark: \"--{prefix}-color-primary-shade-dark\",\r\n    colorSecondary: \"--{prefix}-color-secondary\",\r\n    colorSecondaryActive: \"--{prefix}-color-secondary-active\",\r\n    colorSecondaryMuted: \"--{prefix}-color-secondary-muted\",\r\n    colorSecondaryShade: \"--{prefix}-color-secondary-shade\",\r\n    colorSecondaryShadeDark: \"--{prefix}-color-secondary-shade-dark\",\r\n    colorWarning: \"--{prefix}-color-warning\",\r\n    colorWarningActive: \"--{prefix}-color-warning-active\",\r\n    colorWarningMuted: \"--{prefix}-color-warning-muted\",\r\n    colorWarningShade: \"--{prefix}-color-warning-shade\",\r\n    colorWarningShadeDark: \"--{prefix}-color-warning-shade-dark\",\r\n    colorSuccess: \"--{prefix}-color-success\",\r\n    colorSuccessActive: \"--{prefix}-color-success-active\",\r\n    colorSuccessMuted: \"--{prefix}-color-success-muted\",\r\n    colorSuccessShade: \"--{prefix}-color-success-shade\",\r\n    colorSuccessShadeDark: \"--{prefix}-color-success-shade-dark\",\r\n    colorError: \"--{prefix}-color-error\",\r\n    colorErrorActive: \"--{prefix}-color-error-active\",\r\n    colorErrorMuted: \"--{prefix}-color-error-muted\",\r\n    colorErrorShade: \"--{prefix}-color-error-shade\",\r\n    colorErrorShadeDark: \"--{prefix}-color-error-shade-dark\",\r\n    inputBackground: \"--{prefix}-input-background-color\",\r\n    colorShade: \"--{prefix}-color-shade\",\r\n    colorShadeDarker: \"--{prefix}-color-shade-darker\",\r\n    colorShadeLight: \"--{prefix}-color-shade-light\",\r\n    colorShadeLighter: \"--{prefix}-color-shade-light-lighter\",\r\n    outline: \"--{prefix}-outline\",\r\n    borderRadius: \"--{prefix}-border-radius\",\r\n    padding: \"--{prefix}-padding\",\r\n    margin: \"--{prefix}-margin\",\r\n    scrollbarWidth: \"--{prefix}-scrollbar-width\",\r\n    componentSpace: \"--{prefix}-component-space\",\r\n    accordionIcon: \"--{prefix}-accordion-icon\"\r\n}\r\n\r\n\r\nexport class STATICS {\r\n    static logLevel: CuiLogLevel = 'none';\r\n    static prefix: string = 'cui';\r\n}\r\n\r\nexport const EVENTS = {\r\n    INSTANCE_INITIALIZED: 'instance-initialized',\r\n    INSTANCE_FINISHED: 'instance-finished',\r\n    RESIZE: \"resize\",\r\n    OPEN: \"open\",\r\n    OPENED: \"opened\",\r\n    CLOSE: \"close\",\r\n    CLOSED: \"closed\",\r\n    TOGGLE: \"toggle\",\r\n    TOGGLED: 'toggled',\r\n    SWITCH: \"switch\",\r\n    SWITCHED: \"switched\",\r\n    ON_SCROLL: \"scroll\",\r\n    TARGET_CHANGE: 'targetchange',\r\n    INTERSECTION: 'intersection',\r\n    KEYDOWN: 'keydown',\r\n    SCROLLBY: 'scrollby',\r\n    WINDOW_CLICK: 'windowclick',\r\n    OFFSET: 'offset',\r\n    PROGRESS_CHANGE: \"progresschange\",\r\n    PROGRESS_CHANGED: \"progresschanged\",\r\n    CHANGE: \"change\",\r\n    CHANGED: \"changed\",\r\n    GLOBAL_MOVE: \"globalmove\",\r\n    MOVE_LOCK: \"movelock\",\r\n    PAUSE: \"pause\",\r\n    PAUSED: \"paused\",\r\n    SORTED: \"sorted\",\r\n    SORT_START: \"sortstart\"\r\n}\r\n\r\nexport const OBSERVABLE_SCROLL = \"SCROLL\";\r\nexport const OBSERVABLE_INTERSECTION = \"INTERSECTION\";\r\nexport const COMPONENTS_COUNTER = counter();","export class ErrorBase extends Error {\r\n    constructor(name: string, message?: string,) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport class ItemNotFoundError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ItemNotFoundError\", message);\r\n    }\r\n}\r\n\r\nexport class ArgumentError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiBusError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"ArgumentError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiInstanceInitError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiInstanceInitError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiScrollSpyOutOfRangeError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiScrollSpyOutOfRangeError\", message);\r\n    }\r\n}\r\n\r\n\r\nexport class RegisterElementError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"RegisterElementError\", message);\r\n    }\r\n}\r\n\r\nexport class AnimatorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"AnimatorError\", message);\r\n    }\r\n}\r\n\r\nexport class CSSVariableError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CSSVariableError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiColorError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiColorError\", message);\r\n    }\r\n}\r\n\r\nexport class CuiPositionError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CuiPositionError\", message);\r\n    }\r\n}","import { CuiLogger } from \"../utils/logger\";\r\nimport { CuiLogLevel } from \"../utils/types\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\nimport { STATICS } from \"../utils/statics\";\r\n\r\n/**\r\n * \r\n */\r\nexport class CuiLoggerFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param name - component name\r\n     */\r\n    public static get(name: string, logLevel?: CuiLogLevel): ICuiLogger {\r\n        return new CuiLogger(name, logLevel ?? STATICS.logLevel)\r\n    }\r\n}","import { is, isTouchSupported, enumerateObject } from \"../../core/index\";\r\n\r\nexport interface ElementBuilderAttribute {\r\n    [name: string]: string;\r\n}\r\nexport class ElementBuilder {\r\n    #id: string;\r\n    #classes: string[];\r\n    #attributes: ElementBuilderAttribute;\r\n    #tag: string;\r\n    constructor(tag: string) {\r\n        this.#tag = tag;\r\n        this.#classes = [];\r\n        this.#attributes = null\r\n    }\r\n    setId(id: string): ElementBuilder {\r\n        this.#id = id;\r\n        return this;\r\n    }\r\n\r\n    setClasses(...classList: string[]): ElementBuilder {\r\n        this.#classes = classList;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: ElementBuilderAttribute): ElementBuilder {\r\n        this.#attributes = attributes;\r\n        return this;\r\n    }\r\n\r\n    build(innerHTML?: string): HTMLElement {\r\n        let element = document.createElement(this.#tag);\r\n        if (is(this.#id)) {\r\n            element.id = this.#id;\r\n        }\r\n        if (is(this.#classes)) {\r\n            element.classList.add(...this.#classes);\r\n        }\r\n        if (is(this.#attributes)) {\r\n            enumerateObject(this.#attributes, (attr: string, value: string) => {\r\n                element.setAttribute(attr, value);\r\n            })\r\n        }\r\n        if (is(innerHTML)) {\r\n            element.innerHTML = innerHTML;\r\n        }\r\n        return element;\r\n    }\r\n}","import { is, are } from \"./functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\n\r\nexport interface ICuiComponentAction {\r\n    add(element: Element, utils?: CuiUtils): void;\r\n    remove(element: Element, utils?: CuiUtils): void;\r\n    toggle(element: Element, utils?: CuiUtils): void;\r\n}\r\n\r\nexport class CuiClassAction implements ICuiComponentAction {\r\n    #class: string;\r\n\r\n    constructor(className: string) {\r\n        this.#class = className;\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && !element.classList.contains(this.#class)) {\r\n            element.classList.add(this.#class);\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class) && element.classList.contains(this.#class)) {\r\n            element.classList.remove(this.#class);\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (are(element, this.#class)) {\r\n            if (element.classList.contains(this.#class)) {\r\n                element.classList.remove(this.#class);\r\n            } else {\r\n                element.classList.add(this.#class);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiInboundAction implements ICuiComponentAction {\r\n    #name: string;\r\n\r\n    constructor(name: string) {\r\n        this.#name = name;\r\n    }\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n        }\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                utils.setLightMode('light')\r\n                break;\r\n            case 'light-mode':\r\n                utils.setLightMode('dark')\r\n                break;\r\n        }\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        switch (this.#name) {\r\n            case 'dark-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n            case 'light-mode':\r\n                this.setDarkMode(utils)\r\n                break;\r\n        }\r\n    }\r\n\r\n    private setDarkMode(utils: CuiUtils) {\r\n        if (utils.getLightMode() === 'dark') {\r\n            utils.setLightMode('light')\r\n        } else {\r\n            utils.setLightMode('dark')\r\n        }\r\n    }\r\n}\r\n\r\nexport class AttributeAction implements ICuiComponentAction {\r\n    #attributeName: string;\r\n    #attributeValue: string;\r\n    constructor(attribute: string) {\r\n        [this.#attributeName, this.#attributeValue] = attribute.split(',')\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        element.setAttribute(this.#attributeName, this.#attributeValue)\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this.#attributeName)) {\r\n            element.removeAttribute(this.#attributeName)\r\n        }\r\n\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n        if (!are(element, this.#attributeName, this.#attributeValue)) {\r\n            return;\r\n        }\r\n        if (element.hasAttribute(this.#attributeName)) {\r\n            element.removeAttribute(this.#attributeName)\r\n        } else {\r\n            element.setAttribute(this.#attributeName, this.#attributeValue)\r\n        }\r\n    }\r\n}\r\n\r\nexport class DummyAction implements ICuiComponentAction {\r\n    constructor() {\r\n    }\r\n\r\n    add(element: Element, utils?: CuiUtils): void {\r\n\r\n    }\r\n\r\n    remove(element: Element, utils?: CuiUtils): void {\r\n    }\r\n\r\n    toggle(element: Element, utils?: CuiUtils): void {\r\n    }\r\n}\r\n\r\nexport class CuiActionsFatory {\r\n    public static get(value: string): ICuiComponentAction {\r\n        if (!is(value)) {\r\n            return new DummyAction();\r\n        }\r\n        let indicator = value[0];\r\n        switch (indicator) {\r\n            case '.':\r\n                return new CuiClassAction(value.substring(1));\r\n            case '~':\r\n                return new CuiInboundAction(value.substring(1));\r\n            case \"&\":\r\n                return new AttributeAction(value.substring(1));\r\n            default:\r\n                return new CuiClassAction(value);\r\n        }\r\n    }\r\n}\r\n\r\nexport class CuiActionsListFactory {\r\n    public static get(value: string): ICuiComponentAction[] {\r\n        if (!is(value)) {\r\n            return [];\r\n        }\r\n        const split = value.split(',');\r\n        return split.map(single => {\r\n            return CuiActionsFatory.get(single.trim());\r\n        })\r\n    }\r\n}","import { are, is } from \"./functions\";\r\n\r\nexport interface ICuiTask {\r\n    start(): void;\r\n    stop(): void;\r\n    getId(): any;\r\n    setCallback(callback: () => void): void;\r\n    setTimeout(timeout: number): void;\r\n}\r\n\r\nexport class CuiTaskRunner implements ICuiTask {\r\n    #taskId: any;\r\n    #autoRenew: boolean;\r\n    #timeout: number;\r\n    #callback: () => void;\r\n\r\n    constructor(timeout: number, autoRenew: boolean, callback?: () => void) {\r\n        this.#autoRenew = autoRenew;\r\n        this.#timeout = timeout;\r\n        this.#callback = callback;\r\n    }\r\n    start(): void {\r\n        if (!this.canRun()) {\r\n            return;\r\n        }\r\n        this.stop();\r\n        this.#taskId = setTimeout(() => {\r\n            this.#callback();\r\n            this.#taskId = null;\r\n            if (this.#autoRenew) {\r\n                this.start();\r\n            }\r\n        }, this.#timeout);\r\n    }\r\n\r\n    stop(): void {\r\n        if (this.#taskId) {\r\n            clearTimeout(this.#taskId);\r\n            this.#taskId = null\r\n        }\r\n    }\r\n\r\n    getId() {\r\n        return this.#taskId;\r\n    }\r\n\r\n    private canRun(): boolean {\r\n        return is(this.#callback) && this.#timeout > 0;\r\n    }\r\n\r\n    setCallback(callback: () => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n}","import { ICuiEventBusQueueSetup } from \"../bus/interfaces\";\r\nimport { CuiLogLevel, CuiInteractionsType } from \"../utils/types\";\r\nimport { ICuiDevelopmentTool } from \"./interfaces\";\r\n\r\ninterface CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n}\r\n\r\nexport class CuiSetup implements CuiSetupCommon {\r\n    prefix?: string;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold: number;\r\n    resizeThreshold: number;\r\n    plugins: any;\r\n\r\n    constructor() {\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.plugins = {};\r\n    }\r\n\r\n    fromInit(init: CuiSetupInit): CuiSetup {\r\n        this.prefix = init.prefix;\r\n        this.logLevel = init.logLevel;\r\n        this.cacheSize = init.cacheSize;\r\n        this.autoLightMode = init.autoLightMode;\r\n        this.animationTime = init.animationTime;\r\n        this.animationTimeShort = init.animationTimeShort;\r\n        this.animationTimeLong = init.animationTimeLong;\r\n        this.scrollThreshold = init.scrollThreshold;\r\n        this.resizeThreshold = init.resizeThreshold;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiSetupInit implements CuiSetupCommon {\r\n    prefix?: string;\r\n    app?: string;\r\n    interaction?: CuiInteractionsType;\r\n    logLevel?: CuiLogLevel;\r\n    cacheSize?: number;\r\n    autoLightMode?: boolean;\r\n    animationTime?: number;\r\n    animationTimeShort?: number;\r\n    animationTimeLong?: number;\r\n    scrollThreshold?: number;\r\n    resizeThreshold?: number;\r\n    busSetup?: ICuiEventBusQueueSetup[];\r\n    development: ICuiDevelopmentTool;\r\n    root: HTMLElement;\r\n\r\n    constructor() {\r\n        this.prefix = 'cui';\r\n        this.app = '$cui';\r\n        this.logLevel = 'warning';\r\n        this.interaction = 'async';\r\n        this.animationTime = 300;\r\n        this.animationTimeShort = 150;\r\n        this.animationTimeLong = 500;\r\n        this.cacheSize = 500;\r\n        this.autoLightMode = false;\r\n        this.scrollThreshold = 20;\r\n        this.resizeThreshold = 20;\r\n        this.root = document.body;\r\n        this.busSetup = undefined;\r\n    }\r\n}","\r\nexport type CuiElementBoxType = Element | HTMLElement | Window;\r\n\r\nexport interface ICuiElementBox {\r\n    getHeight(): number;\r\n    getWidth(): number;\r\n    getTop(): number;\r\n    getLeft(): number;\r\n    getScrollHeight(): number;\r\n    getScrollWidth(): number;\r\n    getScrollTop(): number;\r\n    getScrollLeft(): number;\r\n    queryAll(selector: string): HTMLElement[];\r\n}\r\n\r\nexport class CuiElementBoxFactory {\r\n    static get(element: CuiElementBoxType): ICuiElementBox {\r\n        if (element instanceof Window) {\r\n            return new WindowElementBox();\r\n        } else if (element instanceof HTMLElement) {\r\n            return new HTMLElementBox(element);\r\n        }\r\n        return new ElementBox(element);\r\n    }\r\n}\r\n\r\nexport class ElementBox implements ICuiElementBox {\r\n    #box: DOMRect;\r\n    #element: Element;\r\n    constructor(element: Element) {\r\n        this.#element = element;\r\n        this.#box = element.getBoundingClientRect();\r\n    }\r\n\r\n    getHeight(): number {\r\n        return this.#box.height;\r\n    }\r\n    getWidth(): number {\r\n        return this.#box.width;\r\n    }\r\n    getTop(): number {\r\n        return this.#box.top;\r\n    }\r\n    getLeft(): number {\r\n        return this.#box.left;\r\n    }\r\n    getScrollHeight(): number {\r\n        return this.#element.scrollHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return this.#element.scrollWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return this.#element.scrollTop;\r\n    }\r\n\r\n    getScrollLeft(): number {\r\n        return this.#element.scrollLeft;\r\n    }\r\n\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...this.#element.querySelectorAll<HTMLElement>(selector)];\r\n    }\r\n}\r\n\r\nexport class HTMLElementBox implements ICuiElementBox {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n\r\n    getHeight(): number {\r\n        return this.#element.offsetHeight;\r\n    }\r\n    getWidth(): number {\r\n        return this.#element.offsetWidth;\r\n    }\r\n    getTop(): number {\r\n        return this.#element.offsetTop;\r\n    }\r\n    getLeft(): number {\r\n        return this.#element.offsetLeft;\r\n    }\r\n\r\n    getScrollHeight(): number {\r\n        return this.#element.scrollHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return this.#element.scrollWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return this.#element.scrollTop;\r\n    }\r\n\r\n    getScrollLeft(): number {\r\n        return this.#element.scrollLeft;\r\n    }\r\n\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...this.#element.querySelectorAll<HTMLElement>(selector)];\r\n    }\r\n}\r\n\r\nexport class WindowElementBox implements ICuiElementBox {\r\n    getHeight(): number {\r\n        return window.innerHeight;\r\n    }\r\n    getWidth(): number {\r\n        return window.innerWidth;\r\n    }\r\n    getTop(): number {\r\n        return 0;\r\n    }\r\n    getLeft(): number {\r\n        return 0;\r\n    }\r\n\r\n    getScrollHeight(): number {\r\n        return window.innerHeight;\r\n    }\r\n\r\n    getScrollWidth(): number {\r\n        return window.innerWidth;\r\n    }\r\n\r\n    getScrollTop(): number {\r\n        return window.pageYOffset;\r\n    }\r\n    getScrollLeft(): number {\r\n        return window.pageXOffset;\r\n    }\r\n    queryAll(selector: string): HTMLElement[] {\r\n        return [...document.querySelectorAll(selector)] as any[];\r\n    }\r\n\r\n}","import { ICuiDictionary, CuiCachable, ICuiManager } from \"../../core/models/interfaces\";\r\nimport { CuiDictionary } from \"../../core/utils/dictionary\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiCacheManager implements ICuiManager<CuiCachable> {\r\n    #cache: ICuiDictionary<CuiCachable>;\r\n    #maxSize: number;\r\n    constructor(maxSize?: number) {\r\n        this.#cache = new CuiDictionary<CuiCachable>();\r\n        this.#maxSize = maxSize ?? 500;\r\n    }\r\n    put(key: string, element: CuiCachable): void {\r\n        if (!is(key)) return;\r\n        if (this.has(key)) {\r\n            this.#cache.update(key, element);\r\n            return;\r\n        }\r\n        this.clean();\r\n        this.#cache.add(key, element);\r\n    }\r\n\r\n    get(key: string): CuiCachable {\r\n        if (!is(key)) return null;\r\n        if (this.has(key)) {\r\n            let item = this.#cache.get(key);\r\n            if (item.refresh()) {\r\n                return item;\r\n            }\r\n            this.#cache.remove(key);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    has(key: string): boolean {\r\n        return is(key) ? this.#cache.containsKey(key) : false;\r\n    }\r\n\r\n    remove(key: string): boolean {\r\n        if (!is(key)) return false;\r\n        if (this.has(key)) {\r\n            this.#cache.remove(key);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    clear(): void {\r\n        this.#cache.clear();\r\n    }\r\n\r\n    private clean() {\r\n        if (this.#cache.keys().length >= this.#maxSize) {\r\n            this.#cache.remove(this.#cache.keys()[0]);\r\n        }\r\n    }\r\n}\r\n\r\n","import { CuiColorSetType } from \"../../core/utils/types\";\r\nimport { is, getRangeValue, are } from \"../../core/utils/functions\";\r\nimport { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { CuiColor, CuiColorSet } from \"../../core/models/colors\";\r\nimport { CSS_APP_BACKGROUND_COLORS, CSS_COMPONENT_BACKGROUND_COLORS, CSS_COMPONENT_BORDER_COLORS, CSS_THEMES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiInstanceColorHandler {\r\n    #root: HTMLElement;\r\n    #interactions: IUIInteractionProvider;\r\n    #LIGHTEN_FACTOR: number = 15;\r\n    #DARKEN_FACTOR: number = 15;\r\n\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#root = document.documentElement;\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    setAppBackground(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_APP_BACKGROUND_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_APP_BACKGROUND_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setComponentBackground(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_COMPONENT_BACKGROUND_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_COMPONENT_BACKGROUND_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setBordersColors(light: CuiColor, dark: CuiColor) {\r\n        this.setPropertyIn(CSS_COMPONENT_BORDER_COLORS.light, light.toCssString());\r\n        this.setPropertyIn(CSS_COMPONENT_BORDER_COLORS.dark, dark.toCssString());\r\n    }\r\n\r\n    setColor(type: CuiColorSetType, set: CuiColorSet) {\r\n        const colors = CSS_THEMES[type];\r\n        const baseColor = set.base;\r\n        if (!is(colors) || !is(baseColor)) {\r\n            return\r\n        }\r\n        const mutedColor = set.muted ?? baseColor.clone().lighten(this.#LIGHTEN_FACTOR);\r\n        const activeColor = set.active ?? baseColor.clone().darken(this.#DARKEN_FACTOR);\r\n\r\n        this.#interactions.mutate(() => {\r\n            this.setProperty(colors.base, baseColor.toCssString());\r\n            this.setProperty(colors.active, activeColor.toCssString());\r\n            this.setProperty(colors.muted, mutedColor.toCssString());\r\n        }, this)\r\n\r\n    }\r\n\r\n    setLightenFactor(factor: number) {\r\n        this.#LIGHTEN_FACTOR = getRangeValue(factor, 0, 100);\r\n    }\r\n\r\n    setDarkenFactor(factor: number) {\r\n        this.#DARKEN_FACTOR = getRangeValue(factor, 0, 100);\r\n    }\r\n\r\n    setProperty(propertyName: string, value: string) {\r\n        this.#root.style.setProperty(propertyName, value);\r\n    }\r\n\r\n    setPropertyIn(propertyName: string, value: string) {\r\n        if (!are(value, propertyName)) {\r\n            return;\r\n        }\r\n        this.#interactions.mutate(this.setProperty, this, propertyName, value)\r\n    }\r\n}","import { CuiWindowSize } from \"../../core/utils/types\";\r\nimport { calcWindowSize } from \"../../core/utils/functions\";\r\nimport { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport interface ICuiResizable {\r\n    resize(data: CuiResizeData): Promise<boolean>;\r\n}\r\n\r\nexport interface ICuiResizableObserver {\r\n    observe(target: ICuiResizable): void;\r\n    unobserve(target: ICuiResizable): void;\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport interface CuiResizeData {\r\n    current: CuiWindowSize;\r\n    previous: CuiWindowSize;\r\n    width: number;\r\n    height: number;\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiResizeObserver implements ICuiResizableObserver {\r\n\r\n    #items: ICuiResizable[];\r\n    #promises: Promise<boolean>[];\r\n    #prevYValue: number;\r\n    #inProgress: boolean;\r\n    #previousSize: CuiWindowSize;\r\n    #threshold: number;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus, threshold?: number) {\r\n        this.#items = [];\r\n        this.#promises = [];\r\n        this.#prevYValue = window.innerWidth;\r\n        this.#inProgress = false;\r\n        this.#previousSize = calcWindowSize(window.innerWidth)\r\n        this.#threshold = threshold ?? 0;\r\n        this.#bus = bus;\r\n    }\r\n\r\n    observe(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx < 0) {\r\n            this.#items.push(target);\r\n        }\r\n    }\r\n\r\n    unobserve(target: ICuiResizable): void {\r\n        let idx = this.#items.findIndex(x => x === target)\r\n        if (idx >= 0) {\r\n            this.#items.splice(idx, 1)\r\n        }\r\n    }\r\n    connect(): void {\r\n        window.addEventListener('resize', this.listener.bind(this))\r\n    }\r\n\r\n    disconnect(): void {\r\n        window.removeEventListener('resize', this.listener.bind(this))\r\n    }\r\n\r\n    private listener(ev: UIEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true\r\n        const diff = window.innerWidth - this.#prevYValue;\r\n\r\n        if (Math.abs(diff) >= this.#threshold) {\r\n            const currentSize = calcWindowSize(window.innerWidth);\r\n            if (currentSize !== this.#previousSize) {\r\n                const resizeData: CuiResizeData = {\r\n                    current: currentSize,\r\n                    previous: this.#previousSize,\r\n                    width: window.innerWidth,\r\n                    height: window.innerHeight,\r\n                    timestamp: Date.now()\r\n                };\r\n                this.#bus.emit(EVENTS.RESIZE, null, resizeData)\r\n                if (this.#items.length > 0) {\r\n                    this.#promises = [];\r\n                    this.#items.forEach(x => {\r\n                        this.#promises.push(x.resize(resizeData))\r\n                    })\r\n                    Promise.all(this.#promises)\r\n                    this.#promises = [];\r\n                }\r\n\r\n                this.#previousSize = currentSize;\r\n            }\r\n        }\r\n        this.#inProgress = false\r\n    }\r\n\r\n\r\n}","import { CuiDevelopmentStateType, is } from \"../../core/index\";\r\nimport { CuiDevelopmentElement, ICuiDevelopmentTool } from \"../../core/models/interfaces\";\r\n\r\nexport class CuiDevelopmentToolManager implements ICuiDevelopmentTool {\r\n\r\n    #tool: ICuiDevelopmentTool;\r\n    constructor(tool?: ICuiDevelopmentTool) {\r\n        this.#tool = tool;\r\n    }\r\n\r\n    pushState(cuid: string, component: string, type: CuiDevelopmentStateType, message: string, functionName?: string): void {\r\n        if (!is(this.#tool)) {\r\n            return;\r\n        }\r\n        this.#tool.pushState(cuid, component, type, message, functionName);\r\n    }\r\n\r\n    registerElement(element: HTMLElement, cuid: string, component: string): void {\r\n        if (!is(this.#tool)) {\r\n            return;\r\n        }\r\n        this.#tool.registerElement(element, cuid, component);\r\n    }\r\n    unregisterElement(cuid: string, component: string): void {\r\n        if (!is(this.#tool)) {\r\n            return;\r\n        }\r\n        this.#tool.unregisterElement(cuid, component);\r\n    }\r\n\r\n    setProperty<T>(cuid: string, component: string, name: string, t: T): void {\r\n        if (!is(this.#tool)) {\r\n            return;\r\n        }\r\n        this.#tool.setProperty(cuid, component, name, t);\r\n    }\r\n}","import { IUIInteractionProvider, ICuiEventBus, ICuiManager, CuiCachable } from \"./interfaces\";\r\nimport { CuiSetup, CuiSetupInit } from \"./setup\";\r\nimport { CuiLightMode } from \"../utils/types\";\r\nimport { CuiInteractionsFactory } from \"../factories/interactions\";\r\nimport { CuiCacheManager } from \"../../app/managers/cache\";\r\nimport { CuiEventBusFactory } from \"../bus/bus\";\r\nimport { are, getName, replacePrefix } from \"../utils/functions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { ICuiDocumentStyleAppender, CuiDocumentStyleAppender } from \"../styles/appender\";\r\nimport { CuiInstanceColorHandler } from \"../../app/handlers/colors\";\r\nimport { ICuiResizableObserver, CuiResizeObserver } from \"../../app/observers/resize\";\r\nimport { CSSVariableError } from \"./errors\";\r\nimport { CuiDevelopmentToolManager } from \"../../app/managers/development\";\r\n\r\nexport class CuiUtils {\r\n    interactions: IUIInteractionProvider;\r\n    bus: ICuiEventBus;\r\n    setup: CuiSetup;\r\n    cache: ICuiManager<CuiCachable>;\r\n    colors: CuiInstanceColorHandler;\r\n    styleAppender: ICuiDocumentStyleAppender;\r\n    #resizeObserver: ICuiResizableObserver;\r\n    development: CuiDevelopmentToolManager;\r\n    constructor(initialSetup: CuiSetupInit) {\r\n        this.setup = new CuiSetup().fromInit(initialSetup);\r\n        this.interactions = CuiInteractionsFactory.get(initialSetup.interaction)\r\n        this.cache = new CuiCacheManager(this.setup.cacheSize);\r\n        this.bus = CuiEventBusFactory.get(initialSetup.busSetup);\r\n        this.colors = new CuiInstanceColorHandler(this.interactions);\r\n        this.development = new CuiDevelopmentToolManager(initialSetup.development);\r\n        this.styleAppender = new CuiDocumentStyleAppender(this.interactions);\r\n        this.#resizeObserver = new CuiResizeObserver(this.bus, this.setup.resizeThreshold);\r\n        this.#resizeObserver.connect();\r\n    }\r\n\r\n    setLightMode(mode: CuiLightMode) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        const classes = document.body.classList;\r\n        if (mode === 'dark' && !classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.add(name);\r\n            }, this)\r\n\r\n        } else if (mode === 'light' && classes.contains(name)) {\r\n            this.interactions.mutate(() => {\r\n                classes.remove(name);\r\n            }, this)\r\n        }\r\n    }\r\n\r\n    getLightMode(): CuiLightMode {\r\n        const name: string = getName(this.setup.prefix, CLASSES.dark);\r\n        return document.body.classList.contains(name) ? 'dark' : 'light';\r\n    }\r\n\r\n    setPrintMode(flag: boolean) {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        const classes = document.body.classList;\r\n        if (flag && !classes.contains(name)) {\r\n            classes.add(name);\r\n\r\n        } else if (!flag && classes.contains(name)) {\r\n            classes.remove(name);\r\n        }\r\n    }\r\n\r\n    isPrintMode(): boolean {\r\n        const name: string = getName(this.setup.prefix, CLASSES.print);\r\n        return document.body.classList.contains(name);\r\n    }\r\n\r\n    setProperty(name: string, value: string) {\r\n        if (!are(name, value)) {\r\n            throw new CSSVariableError(\"Property or value was not provided\");\r\n        }\r\n        let prop = replacePrefix(name, this.setup.prefix);\r\n        document.documentElement.style.setProperty(prop, value);\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\n\r\nexport class CuiMediaQueryListener implements ICuiEventListener<MediaQueryListEvent> {\r\n\r\n    #mediaQuery: string;\r\n    #callback: (t: MediaQueryListEvent) => void;\r\n    #isInitialized: boolean;\r\n    #inProgress: boolean;\r\n    constructor(mediaQuery: string) {\r\n        this.#mediaQuery = mediaQuery;\r\n        this.#isInitialized = false;\r\n    }\r\n    setCallback(callback: (t: MediaQueryListEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        if (!window.matchMedia || this.#isInitialized || !this.#mediaQuery) {\r\n            return;\r\n        }\r\n        window.matchMedia(this.#mediaQuery)\r\n            .addEventListener('change', this.event.bind(this))\r\n        this.#isInitialized = true\r\n    }\r\n\r\n    detach(): void {\r\n        if (this.#isInitialized) {\r\n            window.matchMedia(this.#mediaQuery).removeEventListener('change', this.event.bind(this));\r\n            this.#isInitialized = false\r\n        }\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isInitialized;\r\n    }\r\n\r\n    private event(ev: MediaQueryListEvent): void {\r\n        if (this.#inProgress) {\r\n            return\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            this.#callback(ev);\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            this.#inProgress = false;\r\n        }\r\n    }\r\n}","import { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../models/elements\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { getRangeValueOrDefault, is } from \"../utils/functions\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../utils/task\";\r\n\r\nconst DEFAULT_SCROLL_END_TIMEOUT: number = 50;\r\n\r\nexport interface CuiScrollEvent {\r\n    base: Event;\r\n    top: number;\r\n    left: number;\r\n    initial: boolean;\r\n    scrolling: boolean;\r\n    source: string;\r\n}\r\n\r\nexport class CuiScrollListener implements ICuiEventListener<CuiScrollEvent> {\r\n    #target: CuiElementBoxType;\r\n    #inProgress: boolean;\r\n    #threshold: number;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #callback: (ev: CuiScrollEvent) => void;\r\n    #isAttached: boolean;\r\n    #box: ICuiElementBox;\r\n    #task: ICuiTask;\r\n    #listener: (ev: Event) => void;\r\n    constructor(target: CuiElementBoxType, threshold?: number) {\r\n        this.#target = target;\r\n        this.#box = CuiElementBoxFactory.get(target);\r\n        this.#inProgress = false;\r\n        this.#threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n        this.#prevX = this.#prevY = 0;\r\n        this.#isAttached = false;\r\n        this.#task = new CuiTaskRunner(DEFAULT_SCROLL_END_TIMEOUT, false, this.onScrollFinish.bind(this));\r\n        this.#listener = this.listener.bind(this);\r\n    }\r\n\r\n    setCallback(callback: (ev: CuiScrollEvent) => void) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#target.addEventListener('scroll', this.#listener)\r\n        this.#isAttached = true;\r\n        this.listener(undefined, true, \"init\");\r\n    }\r\n\r\n    detach() {\r\n        this.#target.removeEventListener('scroll', this.#listener)\r\n        this.#task.stop();\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    setTarget(target: CuiElementBoxType) {\r\n        if (target !== this.#target) {\r\n            this.detach();\r\n            this.#target = target;\r\n            this.attach();\r\n        }\r\n    }\r\n\r\n    setThreshold(threshold: number) {\r\n        this.#threshold = getRangeValueOrDefault(threshold, 0, 100, 0);\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    private listener(ev: Event, initial?: boolean, source?: string) {\r\n        if (!is(this.#callback)) {\r\n            return;\r\n        }\r\n        let left = this.#box.getScrollLeft();\r\n        let top = this.#box.getScrollTop();\r\n        this.#prevX += left;\r\n        this.#prevY += top;\r\n        if (this.#inProgress || (!this.passedThreshold() && is(ev))) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        this.#callback({\r\n            base: ev,\r\n            top: top,\r\n            left: left,\r\n            initial: initial ?? false,\r\n            scrolling: is(ev),\r\n            source: source ?? \"event\"\r\n        })\r\n        if (is(ev))\r\n            this.#task.start();\r\n        this.#inProgress = false\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n    }\r\n\r\n    private passedThreshold() {\r\n        return this.#threshold <= 0 || (this.#prevX >= this.#threshold || this.#prevY >= this.#threshold);\r\n    }\r\n\r\n    private onScrollFinish() {\r\n        this.listener(undefined, false, \"task\");\r\n    }\r\n}","import { TaskedEventEmitHandler } from \"../bus/handlers\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is, round } from \"../utils/functions\";\r\n\r\ninterface OnMoveCallback {\r\n    (ev: ICuiMoveEvent): void;\r\n}\r\n\r\ninterface IMoveListener {\r\n    onMove(data: OnMoveCallback): void\r\n    start(): void;\r\n    stop(): void;\r\n}\r\n\r\nexport type CuiMoveEventState = \"down\" | \"up\" | \"move\";\r\nexport interface ICuiMoveEvent {\r\n    x: number;\r\n    y: number;\r\n    moveX: number;\r\n    moveY: number;\r\n    type: CuiMoveEventState;\r\n    target: EventTarget;\r\n    event: MouseEvent | TouchEvent;\r\n}\r\n\r\nexport class CuiMoveEventListener implements ICuiEventListener<ICuiMoveEvent> {\r\n    #element: HTMLElement | Document;\r\n    #onEvent: (t: ICuiMoveEvent) => void;\r\n    #isLocked: boolean;\r\n    #isAttached: boolean;\r\n    #preventDefault: boolean;\r\n    #target: Element;\r\n    constructor(element?: HTMLElement) {\r\n        this.#isLocked = false;\r\n        this.#element = element ?? document.body;\r\n        this.#isAttached = false;\r\n        this.#preventDefault = false;\r\n        this.onMouseDown = this.onMouseDown.bind(this);\r\n        this.onMouseUp = this.onMouseUp.bind(this)\r\n        this.onMouseMove = this.onMouseMove.bind(this)\r\n        this.onTouchStart = this.onTouchStart.bind(this)\r\n        this.onTouchEnd = this.onTouchEnd.bind(this)\r\n        this.onTouchMove = this.onTouchMove.bind(this)\r\n    }\r\n\r\n    setCallback(callback: (t: ICuiMoveEvent) => void): void {\r\n        this.#onEvent = callback;\r\n    }\r\n\r\n    setTarget(element: Element) {\r\n        this.#target = element;\r\n    }\r\n    isInProgress(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n    preventDefault(flag: boolean) {\r\n        this.#preventDefault = flag;\r\n    }\r\n    attach(): void {\r\n        if (this.#isAttached) {\r\n            return;\r\n        }\r\n        this.#element.addEventListener('mousedown', this.onMouseDown, { passive: false } as any)\r\n        this.#element.addEventListener('mouseup', this.onMouseUp, { passive: false } as any)\r\n        this.#element.addEventListener('mousemove', this.onMouseMove, { passive: false } as any)\r\n        this.#element.addEventListener('touchstart', this.onTouchStart, { passive: false } as any)\r\n        this.#element.addEventListener('touchend', this.onTouchEnd, { passive: false } as any)\r\n        this.#element.addEventListener('touchmove', this.onTouchMove, { passive: false } as any)\r\n        this.#isAttached = true;\r\n    }\r\n    detach(): void {\r\n        console.log(\"On detach\")\r\n        if (!this.#isAttached) {\r\n            return;\r\n        }\r\n\r\n        this.#element.removeEventListener('mousedown', this.onMouseDown, { passive: false } as any)\r\n        this.#element.removeEventListener('mouseup', this.onMouseUp, { passive: false } as any)\r\n        this.#element.removeEventListener('mousemove', this.onMouseMove, { passive: false } as any)\r\n        this.#element.removeEventListener('touchstart', this.onTouchStart, { passive: false } as any)\r\n        this.#element.removeEventListener('touchend', this.onTouchEnd, { passive: false } as any)\r\n        this.#element.removeEventListener('touchmove', this.onTouchMove, { passive: false } as any)\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached\r\n    }\r\n\r\n    onMouseDown(ev: MouseEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        if (this.#target && !this.#target.contains(ev.target as Node)) {\r\n            return;\r\n        }\r\n\r\n        this.#isLocked = true;\r\n        this.publishMouseEvent(\"down\", ev)\r\n\r\n    }\r\n\r\n    onMouseUp(ev: MouseEvent) {\r\n        if (!this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = false;\r\n        this.publishMouseEvent(\"up\", ev)\r\n\r\n    }\r\n\r\n    onMouseMove(ev: MouseEvent) {\r\n        if (this.#isLocked) {\r\n            this.publishMouseEvent(\"move\", ev)\r\n        }\r\n    }\r\n\r\n    onTouchStart(ev: TouchEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        if (this.#target && !this.#target.contains(ev.target as Node)) {\r\n            return;\r\n        }\r\n        this.#isLocked = true;\r\n        this.publishTouchEvent('down', ev);\r\n    }\r\n\r\n    onTouchEnd(ev: TouchEvent) {\r\n        if (!this.#isLocked) {\r\n            return;\r\n        }\r\n        this.#isLocked = false;\r\n        this.publishTouchEvent('up', ev);\r\n    }\r\n\r\n    onTouchMove(ev: TouchEvent) {\r\n        if (this.#isLocked) {\r\n            this.publishTouchEvent('move', ev);\r\n            // if (this.#preventDefault) {\r\n            //     ev.preventDefault();\r\n            // }\r\n        }\r\n    }\r\n\r\n    private publishMouseEvent(type: CuiMoveEventState, ev: MouseEvent) {\r\n        if (this.#preventDefault && ev.cancelable) {\r\n            ev.preventDefault();\r\n        }\r\n        if (is(this.#onEvent)) {\r\n            this.#onEvent({\r\n                type: type,\r\n                x: ev.clientX,\r\n                y: ev.clientY,\r\n                moveX: ev.movementX,\r\n                moveY: ev.movementY,\r\n                target: ev.target,\r\n                event: ev\r\n            })\r\n        }\r\n    }\r\n\r\n    private publishTouchEvent(type: CuiMoveEventState, ev: TouchEvent) {\r\n        if (this.#preventDefault && ev.cancelable)\r\n            ev.preventDefault();\r\n        if (is(this.#onEvent)) {\r\n            let touch = null;\r\n            if (ev.touches.length > 0) {\r\n                touch = ev.touches[0]\r\n            } else if (ev.changedTouches.length > 0) {\r\n                touch = ev.changedTouches[0]\r\n            }\r\n            this.#onEvent({\r\n                event: ev,\r\n                type: type,\r\n                target: ev.target,\r\n                x: is(touch) ? touch.clientX : -1,\r\n                y: is(touch) ? touch.clientY : -1,\r\n                moveX: -1,\r\n                moveY: -1\r\n            })\r\n        }\r\n    }\r\n\r\n}\r\n","import { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport class FastDom implements IUIInteractionProvider {\r\n    private writes: any[];\r\n    private reads: any[];\r\n    private raf: any;\r\n    private isScheduled: boolean = false;\r\n    #limit: number;\r\n\r\n    constructor() {\r\n        this.raf = window.requestAnimationFrame.bind(window)\r\n        this.writes = []\r\n        this.reads = []\r\n        this.#limit = 5;\r\n    }\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.reads.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.writes.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n    private run(tasks: any[]) {\r\n        let task = null\r\n        while (task = tasks.shift()) {\r\n            task()\r\n        }\r\n    }\r\n\r\n    private schedule(recursion?: number) {\r\n        if (!this.isScheduled) {\r\n            this.isScheduled = true;\r\n            if (recursion >= this.#limit) {\r\n                throw new Error(\"Fast Dom limit reached\")\r\n            } else {\r\n                this.raf(this.flush.bind(this, recursion));\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    private flush(recursion?: number) {\r\n        let rec: number = recursion ?? 0;\r\n        let error = null;\r\n        let writes = this.writes;\r\n        let reads = this.reads;\r\n\r\n        try {\r\n            this.run(reads);\r\n            this.run(writes);\r\n        } catch (e) {\r\n            error = e\r\n            console.error(e)\r\n        }\r\n        this.isScheduled = false;\r\n\r\n        if (error) {\r\n            this.schedule(rec + 1)\r\n        }\r\n        if (this.writes.length || this.reads.length) {\r\n            this.schedule(recursion + 1);\r\n        }\r\n    }\r\n}\r\n\r\nexport class SyncInteractions implements IUIInteractionProvider {\r\n    tasks: any[];\r\n    raf: any;\r\n    isRunning: boolean = false;\r\n    constructor() {\r\n        this.tasks = [];\r\n        this.raf = window.requestAnimationFrame.bind(window)\r\n    }\r\n\r\n    mutate(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    fetch(callback: any, ctx: any, ...args: any[]): void {\r\n        this.tasks.push(this.createTask(callback, ctx, ...args))\r\n        this.schedule()\r\n    }\r\n\r\n    private schedule() {\r\n        if (!this.isRunning) {\r\n            this.isRunning = true;\r\n            this.raf(this.flush.bind(this))\r\n        }\r\n    }\r\n\r\n    private flush() {\r\n        let task = null\r\n        while (task = this.tasks.shift()) {\r\n            try {\r\n                task()\r\n            }\r\n            catch (e) {\r\n            }\r\n        }\r\n        this.isRunning = false\r\n    }\r\n\r\n    private createTask(callback: any, ctx: any, ...args: any[]): any {\r\n        return ctx || args ? callback.bind(ctx, ...args) : callback;\r\n    }\r\n\r\n}","import { ICuiEventEmitHandler, ICuiLogger, ICuiCallbackExecutor, CuiEventReceiver } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\n\r\ninterface EmitHandlerData {\r\n    events: CuiEventReceiver;\r\n    cuid: string;\r\n    args: any[];\r\n}\r\n\r\nclass EmitHandlerBase {\r\n    isBusy: boolean;\r\n    queue: EmitHandlerData[];\r\n    constructor() {\r\n        this.queue = [];\r\n        this.isBusy = false;\r\n    }\r\n    idMatches(emitId: string, handleId: string) {\r\n        return !is(emitId) || (is(emitId) && emitId == handleId);\r\n    }\r\n}\r\n\r\nexport class SimpleEventEmitHandler extends EmitHandlerBase implements ICuiEventEmitHandler {\r\n    #log: ICuiLogger;\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        super();\r\n        this.#executor = executor;\r\n        this.#log = CuiLoggerFactory.get(\"SimpleEventEmitHandler\");\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args: any[]): Promise<void> {\r\n        if (!is(events)) {\r\n            this.#log.warning(\"No events provided\")\r\n            return\r\n        }\r\n        this.queue.push({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        if (!this.isBusy) {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.perform();\r\n                if (this.queue.length > 0) {\r\n                    await this.perform();\r\n                }\r\n                this.isBusy = false;\r\n            }\r\n        }\r\n        return;\r\n    }\r\n\r\n    private async perform() {\r\n        let task = this.queue.shift();\r\n        for (let id in task.events) {\r\n            let event = task.events[id]\r\n            try {\r\n                if (this.idMatches(task.cuid, event.$cuid))\r\n                    await this.#executor.execute(event.callback, task.args)\r\n            }\r\n            catch (e) {\r\n                this.#log.error(e)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport class TaskedEventEmitHandler extends EmitHandlerBase implements ICuiEventEmitHandler {\r\n    #executor: ICuiCallbackExecutor;\r\n    constructor(executor: ICuiCallbackExecutor) {\r\n        super();\r\n        this.#executor = executor;\r\n    }\r\n\r\n    async handle(events: CuiEventReceiver, cuid: string, args: any[]): Promise<void> {\r\n        if (!is(events)) {\r\n            return\r\n        }\r\n        this.queue.push({\r\n            events: events,\r\n            cuid: cuid,\r\n            args: args\r\n        })\r\n        if (!this.isBusy) {\r\n            this.isBusy = true;\r\n            this.perform();\r\n            if (this.queue.length > 0) {\r\n                this.perform();\r\n            }\r\n            this.isBusy = false;\r\n        }\r\n        return;\r\n    }\r\n\r\n    private async perform(): Promise<void[]> {\r\n        let task = this.queue.shift();\r\n        let promises: Promise<void>[] = []\r\n        for (let id in task.events) {\r\n            let event = task.events[id]\r\n            if (this.idMatches(task.cuid, event.$cuid))\r\n                promises.push(this.#executor.execute(event.callback, task.args))\r\n        }\r\n        return Promise.all(promises)\r\n    }\r\n}\r\n\r\n\r\nexport class CuiEventEmitHandlerFactory {\r\n    static get(name: string, executor: ICuiCallbackExecutor): ICuiEventEmitHandler {\r\n        switch (name) {\r\n            case \"tasked\":\r\n                return new TaskedEventEmitHandler(executor);\r\n            default:\r\n                return new SimpleEventEmitHandler(executor);\r\n        }\r\n    }\r\n}","import { ICuiCallbackExecutor } from \"../models/interfaces\"\r\n\r\nexport class CuiCallbackExecutor implements ICuiCallbackExecutor {\r\n    async execute(callback: any, args: any[]): Promise<void> {\r\n        args = args ?? []\r\n\r\n        callback(...args)\r\n        return;\r\n    }\r\n}","import { getRangeValue, is, isInRange, } from \"../utils/functions\";\r\nimport { CuiColorError } from \"./errors\";\r\n\r\nexport class CuiColor {\r\n    #red: number;\r\n    #green: number;\r\n    #blue: number;\r\n    #alpha: number;\r\n    constructor(red: number, green: number, blue: number, alpha?: number) {\r\n        this.set(red, green, blue, alpha);\r\n    }\r\n\r\n    static create(colorStr: string): CuiColor {\r\n        if (!is(colorStr)) {\r\n            throw new CuiColorError(`Given color value is not in a valid format`)\r\n        }\r\n        let trimmed = colorStr.trim();\r\n        let parser: ColorParser = null;\r\n        if (colorStr.startsWith(\"#\")) {\r\n            parser = new HexColorParser(colorStr);\r\n        } else if (colorStr.startsWith(\"rgb\")) {\r\n            parser = new RgbColorParser(colorStr);\r\n        } else {\r\n            throw new CuiColorError(\"Unknown color string format\");\r\n        }\r\n\r\n        return parser.parse();\r\n    }\r\n\r\n    set(red: number, green: number, blue: number, alpha?: number) {\r\n        this.#alpha = getRangeValue(alpha ?? 1, 0, 1);\r\n        this.#blue = getRangeValue(blue, 0, 255);\r\n        this.#red = getRangeValue(red, 0, 255);\r\n        this.#green = getRangeValue(green, 0, 255);\r\n    }\r\n\r\n    setRed(red: number) {\r\n        this.#red = getRangeValue(red, 0, 255);\r\n    }\r\n\r\n    setGreen(green: number) {\r\n        this.#green = getRangeValue(green, 0, 255);\r\n    }\r\n\r\n    setBlue(blue: number) {\r\n        this.#blue = getRangeValue(blue, 0, 255);\r\n    }\r\n\r\n    opacity(val: number): CuiColor {\r\n        this.#alpha = getRangeValue(val, 0, 1);\r\n        return this;\r\n    }\r\n\r\n    lighten(amount: number): CuiColor {\r\n        this.shade(amount)\r\n        return this;\r\n    }\r\n\r\n    darken(amount: number): CuiColor {\r\n        this.shade(-amount);\r\n        return this;\r\n    }\r\n\r\n    invert(): CuiColor {\r\n        this.#blue = 255 - this.#blue;\r\n        this.#red = 255 - this.#red;\r\n        this.#green = 255 - this.#green;\r\n        return this;\r\n    }\r\n\r\n    getColorValue(type: string): number {\r\n        const t = type ? type.toLowerCase() : '#'\r\n        switch (type) {\r\n            case 'red':\r\n                return this.#red;\r\n            case 'green':\r\n                return this.#green;\r\n            case 'blue':\r\n                return this.#blue;\r\n            case 'alpha':\r\n                return this.#alpha;\r\n        }\r\n        return -1\r\n    }\r\n\r\n    toCssString(): string {\r\n        return `rgba(${this.#red}, ${this.#green}, ${this.#blue}, ${this.#alpha})`;\r\n    }\r\n\r\n    private shade(percent: number, self: boolean = true) {\r\n        this.#red = this.shadeSingle(this.#red, percent, self);\r\n        this.#green = this.shadeSingle(this.#green, percent, self);\r\n        this.#blue = this.shadeSingle(this.#blue, percent, self);\r\n    }\r\n\r\n    private shadeSingle(val: number, percent: number, self: boolean = true) {\r\n        let rel = self ? val : 255;\r\n        let prop = (rel * percent) / 100\r\n        let newVal = val + Math.round(prop);\r\n        return getRangeValue(newVal, 0, 255);\r\n    }\r\n\r\n    clone() {\r\n        return new CuiColor(this.#red, this.#green, this.#blue, this.#alpha)\r\n    }\r\n}\r\n\r\nexport interface CuiColorSet {\r\n    base: CuiColor,\r\n    muted?: CuiColor,\r\n    active?: CuiColor\r\n}\r\n\r\nexport interface CuiColorTheme {\r\n    base: string,\r\n    muted: string,\r\n    active: string\r\n}\r\n\r\nexport interface CuiColorPair {\r\n    light: string,\r\n    dark: string\r\n}\r\n\r\n\r\ninterface ColorParser {\r\n    trim(): void;\r\n    isValid(): boolean;\r\n    parse(): CuiColor;\r\n}\r\n\r\nexport class HexColorParser implements ColorParser {\r\n    #colorStr: string;\r\n    constructor(colorStr: string) {\r\n        this.#colorStr = colorStr;\r\n    }\r\n\r\n    trim(): void {\r\n        this.#colorStr = this.#colorStr ? this.#colorStr.trim() : undefined;\r\n        return\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return is(this.#colorStr) && this.#colorStr.startsWith(\"#\")\r\n    }\r\n    parse(): CuiColor {\r\n        let red: number = 0;\r\n        let blue: number = 0;\r\n        let green: number = 0;\r\n        let alpha: number = 1;\r\n        let length = this.#colorStr.length;\r\n        if (this.#colorStr.length === 4) {\r\n            red = parseInt(this.#colorStr[1] + this.#colorStr[1], 16);\r\n            green = parseInt(this.#colorStr[2] + this.#colorStr[2], 16);\r\n            blue = parseInt(this.#colorStr[3] + this.#colorStr[3], 16);\r\n        } else {\r\n            red = parseInt(this.#colorStr[1] + this.#colorStr[2], 16);\r\n            green = parseInt(this.#colorStr[3] + this.#colorStr[4], 16);\r\n            blue = parseInt(this.#colorStr[5] + this.#colorStr[6], 16);\r\n\r\n            if (length > 7) {\r\n                let alphaHex = parseInt(this.#colorStr[7] + this.#colorStr[8], 16);\r\n                alpha = parseFloat((alphaHex / 255).toFixed(2));\r\n            }\r\n        }\r\n        return new CuiColor(red, green, blue, alpha);\r\n    }\r\n}\r\n\r\nexport class RgbColorParser implements ColorParser {\r\n    #colorStr: string;\r\n\r\n    constructor(colorStr: string) {\r\n        this.#colorStr = colorStr;\r\n    }\r\n\r\n    trim(): void {\r\n        this.#colorStr = is(this.#colorStr) ? this.#colorStr.trim() : undefined;\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return is(this.#colorStr) && this.#colorStr.startsWith(\"rgb\");\r\n    }\r\n\r\n    parse(): CuiColor {\r\n        let len = this.#colorStr.length;\r\n        let str = this.#colorStr.startsWith(\"rgba\") ? this.#colorStr.substring(5, len - 1) : this.#colorStr.substring(4, len - 1);\r\n        let split = str.split(\",\");\r\n        if (!isInRange(split.length, 3, 4)) {\r\n            return undefined;\r\n        }\r\n        let red: number = parseInt(split[0]);\r\n        let green: number = parseInt(split[1]);\r\n        let blue: number = parseInt(split[2]);\r\n        let alpha: number = split.length === 4 ? parseFloat(split[3]) : 1\r\n        return new CuiColor(red, green, blue, alpha);\r\n    }\r\n}","import { CuiLogLevel } from \"./types\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\n\r\nexport class CuiLogger implements ICuiLogger {\r\n    level: CuiLogLevel\r\n    component: string;\r\n    id: string;\r\n    constructor(name: string, level: CuiLogLevel) {\r\n        this.level = level\r\n        this.component = name\r\n        this.id = \"-\";\r\n    }\r\n\r\n    setLevel(level: CuiLogLevel) {\r\n        this.level = level\r\n    }\r\n\r\n    setId(id: string) {\r\n        this.id = id\r\n    }\r\n    debug(message: string, functionName?: string): void {\r\n        if (this.level === 'debug') {\r\n            console.log(this.prepString(message, \"debug\", functionName))\r\n        }\r\n    }\r\n    error(message: string, functionName?: string): void {\r\n        if (this.level === 'error' || this.level === 'debug' || this.level === 'warning')\r\n            console.error(this.prepString(message, \"error\", functionName))\r\n    }\r\n\r\n    warning(message: string, functionName?: string): void {\r\n        if (this.level === 'warning' || this.level === 'debug')\r\n            console.warn(this.prepString(message, \"warning\", functionName))\r\n    }\r\n\r\n    exception(e: Error, functionName?: string): void {\r\n        console.error(this.prepString(`An exception occured: ${e.name}: ${e.message}`, \"exception\", functionName))\r\n        if (this.level === 'debug')\r\n            console.error(e.stack)\r\n    }\r\n\r\n    performance(callback: () => void, functionName?: string): void {\r\n        if (this.level !== 'debug') {\r\n            return;\r\n        }\r\n        let start = Date.now();\r\n        callback();\r\n        console.log(this.prepString(`Performance measure: ${Date.now() - start}ms`, \"performance\", functionName))\r\n    }\r\n\r\n    private prepString(message: string, level: string, functionName?: string) {\r\n        return `[${new Date().toLocaleString()}][${level}][${this.component}][${functionName ?? '-'}][${this.id}][${message}]`\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { ICuiComponentAction } from \"../utils/actions\";\r\nimport { CLASSES } from \"../utils/statics\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiActionsHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    async performAction(target: Element, action: ICuiComponentAction, timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                action.add(target);\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        action.remove(target);\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performActions(target: Element, actions: ICuiComponentAction[], timeout: number, callback?: () => void): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                actions.forEach(x => x.add(target));\r\n                target.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        actions.forEach(x => x.remove(target));\r\n                        target.classList.remove(CLASSES.animProgress);\r\n                        if (callback)\r\n                            callback();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n\r\n    async performSwitchAction(inTarget: Element, outTarget: Element, inAction: ICuiComponentAction[], outAction: ICuiComponentAction[], onFinish: () => void, timeout: number): Promise<boolean> {\r\n        return new Promise((resolve) => {\r\n            this.#interactions.mutate(() => {\r\n                inAction.forEach(x => x.add(inTarget));\r\n                inTarget.classList.add(CLASSES.animProgress);\r\n                if (is(outTarget)) {\r\n                    outAction.forEach(x => x.add(outTarget));\r\n                    outTarget.classList.add(CLASSES.animProgress);\r\n                }\r\n                setTimeout(() => {\r\n                    this.#interactions.mutate(() => {\r\n                        inAction.forEach(x => x.remove(inTarget));\r\n                        outAction.forEach(x => x.remove(outTarget));\r\n                        inTarget.classList.remove(CLASSES.animProgress);\r\n                        outTarget.classList.remove(CLASSES.animProgress);\r\n                        onFinish();\r\n                        resolve(true)\r\n                    }, null)\r\n                }, timeout)\r\n            }, null)\r\n        })\r\n    }\r\n}","import { IUIInteractionProvider } from \"../models/interfaces\";\r\nimport { CuiInteractionsType } from \"../utils/types\";\r\nimport { FastDom, SyncInteractions } from \"../utils/interactions\";\r\n\r\nexport class CuiInteractionsFactory {\r\n    /**\r\n     * Gets new instance of component focused logger\r\n     * @param type - Interactions type\r\n     */\r\n    public static get(type: CuiInteractionsType): IUIInteractionProvider {\r\n        const interactionType = type;\r\n        switch (interactionType) {\r\n            case 'async':\r\n                return new FastDom();\r\n            default:\r\n                return new SyncInteractions();\r\n        }\r\n    }\r\n}","import { ICuiDictionary, ICuiDictionaryItem } from \"../models/interfaces\";\r\nimport { ItemNotFoundError, ArgumentError } from \"../models/errors\";\r\nimport { is } from \"./functions\";\r\n\r\nexport class CuiDictionary<T> implements ICuiDictionary<T> {\r\n\r\n    #keys: string[];\r\n    #values: T[];\r\n\r\n    constructor(init?: ICuiDictionaryItem<T>[]) {\r\n        this.#keys = []\r\n        this.#values = []\r\n\r\n        if (init) {\r\n            init.forEach(x => {\r\n                if (!is(x.key)) {\r\n                    this.#keys = []\r\n                    this.#values = []\r\n                    throw new ArgumentError(\"Key is empty\");\r\n                }\r\n                this.add(x.key, x.value)\r\n            })\r\n        }\r\n    }\r\n\r\n    add(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        if (this.containsKey(key))\r\n            throw new Error(\"Key already exists\");\r\n        this.#keys.push(key)\r\n        this.#values.push(value)\r\n    }\r\n\r\n    remove(key: string): void {\r\n        if (!is(key)) {\r\n            return\r\n        }\r\n        let index = this.#keys.indexOf(key);\r\n        if (index >= 0) {\r\n            this.#keys.splice(index, 1)\r\n            this.#values.splice(index, 1)\r\n        }\r\n    }\r\n    get(key: string): T {\r\n        this.throwOnEmptyKey(key)\r\n        let index = this.indexOf(key)\r\n        if (index < 0) {\r\n            return undefined;\r\n        }\r\n        return this.#values[index];\r\n    }\r\n    containsKey(key: string): boolean {\r\n        return is(key) && this.indexOf(key) >= 0\r\n    }\r\n    keys(): string[] {\r\n        return this.#keys\r\n    }\r\n    values(): T[] {\r\n        return this.#values;\r\n    }\r\n\r\n    indexOf(key: string): number {\r\n        return is(key) ? this.#keys.indexOf(key) : -1;\r\n    }\r\n\r\n    update(key: string, value: T): void {\r\n        this.throwOnEmptyKey(key)\r\n        let index = this.indexOf(key)\r\n        if (index < 0) {\r\n            throw new ItemNotFoundError(`Item with key [${key}] not found`)\r\n        }\r\n        this.#values[index] = value\r\n    }\r\n\r\n    clear() {\r\n        this.#values = [];\r\n        this.#keys = [];\r\n    }\r\n\r\n    private throwOnEmptyKey(key: string) {\r\n        if (!is(key)) {\r\n            throw new ArgumentError(\"Key is empty\");\r\n        }\r\n    }\r\n}","import { ICuiEventBus, CuiEventReceiver, ICuiLogger, ICuiEventEmitHandler, CuiContext, CuiElement, CuiEventObj } from \"../models/interfaces\";\r\nimport { is, are, generateRandomString, enumerateObject, mapObject } from \"../utils/functions\";\r\nimport { ArgumentError } from \"../models/errors\";\r\nimport { CuiLoggerFactory } from \"../factories/logger\";\r\nimport { CuiEventEmitHandlerFactory, TaskedEventEmitHandler } from \"./handlers\";\r\nimport { CuiCallbackExecutor } from \"./executors\";\r\nimport { CuiBusExtStatistics, ICuiEventBusQueueSetup } from \"./interfaces\";\r\n\r\ninterface ICuiBusMapping {\r\n    [name: string]: number;\r\n}\r\n\r\n\r\n\r\n\r\nexport class CuiEventBus implements ICuiEventBus {\r\n    #events: { [event: string]: CuiEventReceiver }\r\n    #log: ICuiLogger;\r\n    #eventHandler: ICuiEventEmitHandler;\r\n    #name: string;\r\n    constructor(emitHandler: ICuiEventEmitHandler, name?: string) {\r\n        this.#events = {};\r\n        this.#eventHandler = emitHandler;\r\n        this.#name = name ?? \"CuiEventBus\"\r\n        this.#log = CuiLoggerFactory.get(this.#name);\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on(name: string, callback: any, cui?: CuiElement): string {\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        // When context is not provided (e.g. anonymous function) then generate random\r\n        let id = this.#name + \"-\" + generateRandomString();\r\n\r\n\r\n        if (!this.#events[name]) {\r\n            this.#events[name] = {}\r\n        }\r\n        if (this.isAttached(this.#events[name], id, cui)) {\r\n            return null;\r\n        }\r\n        this.#log.debug(`Attaching new event: [${name}] for: [${id}]`)\r\n\r\n        this.#events[name][id] = { callback: callback, $cuid: this.getCuid(cui) }\r\n        return id;\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        let ev = this.#events[name]\r\n        this.#log.debug(`Detaching item: [${id}] from [${name}]`)\r\n        if (this.isAttached(ev, id)) {\r\n            delete ev[id];\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        if (is(name) && this.#events[name]) {\r\n            delete this.#events[name]\r\n        } else {\r\n            this.#log.error(`Event name is missing or incorrect`, \"detachAll\")\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit(event: string, cuid: string, ...args: any[]): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n\r\n        let callbacks = this.#events[event];\r\n        if (is(callbacks)) {\r\n            this.#log.debug(`Emit: [${event}]`)\r\n            await this.#eventHandler.handle(this.#events[event], cuid, args)\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        let ev = this.#events[name]\r\n        return this.isAttached(ev, id, cui)\r\n    }\r\n\r\n    /**\r\n     * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n     * @param {string} event - event name\r\n     * @param {string} cuid - cuid of the component\r\n     */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return;\r\n        }\r\n        let ev = this.#events[event];\r\n        if (!is(ev)) {\r\n            return;\r\n        }\r\n        enumerateObject({ ...ev }, (evId: string, evValue: CuiEventObj) => {\r\n            if (evValue.$cuid === cuid) {\r\n                delete ev[evId]\r\n            }\r\n        })\r\n    }\r\n\r\n    private isAttached(ev: CuiEventReceiver, id: string, cui?: CuiElement): boolean {\r\n        if (is(cui)) {\r\n            return is(ev) && is(id) && is(ev[id]) && ev[id].$cuid == cui.$cuid;\r\n        }\r\n        return is(ev) && is(id) && is(ev[id]);\r\n    }\r\n\r\n    private getCuid(cui: CuiElement) {\r\n        return is(cui) ? cui.$cuid : null;\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\nexport class CuiEventExtBus implements ICuiEventBus {\r\n    #events: { [event: string]: number };\r\n    #log: ICuiLogger;\r\n    #buses: ICuiEventBus[];\r\n    #last: number;\r\n    constructor(setup: ICuiEventBusQueueSetup[]) {\r\n        this.#log = CuiLoggerFactory.get(\"CuiEventBus\");\r\n        this.#buses = [];\r\n        if (is(setup)) {\r\n            this.#log.debug(\"Initiating buses\")\r\n            let sorted = setup.length === 1 ? setup : setup.sort((first, second) => {\r\n                return first.priority - second.priority\r\n            })\r\n            sorted.forEach((item, index) => {\r\n                this.#buses.push(this.initBusInstance(item.name, item.handler))\r\n                this.#events = {\r\n                    ...this.#events,\r\n                    ...this.mapEvents(item.eventsDef, index),\r\n                }\r\n                this.#log.debug(`Bus ${item.name} has been initialized with number: ${index}`)\r\n            })\r\n\r\n            this.#buses.push(this.initBusInstance(\"DefaultEventBus\", 'tasked'))\r\n            this.#last = this.#buses.length - 1;\r\n            this.#log.debug(`Bus initialization finished`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Attaches event to event bus\r\n     * \r\n     * @param {string} name - Event name\r\n     * @param {any} callback - callback function\r\n     * @param {CuiContext} ctx - callback context with id\r\n     * @param {CuiElement} cui - optional - cui element which event shall be attached to \r\n     */\r\n    on(name: string, callback: any, cui?: CuiElement): string {\r\n\r\n        if (!are(name, callback)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        return this.get(name).on(name, callback, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches specific event from event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    detach(name: string, id: string, cui?: CuiElement): void {\r\n        if (!are(name, id)) {\r\n            throw new ArgumentError(\"Missing argument\")\r\n        }\r\n        this.get(name).detach(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches all callbacks from event\r\n    *\r\n    * @param {string} name - Event name\r\n    */\r\n    detachAll(name: string): void {\r\n        this.get(name).detachAll(name);\r\n    }\r\n\r\n    /**\r\n    * Emits event call to event bus\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {string} cuid - id of component which emits the event\r\n    * @param {any[]} args  - event arguments\r\n    */\r\n    async emit(event: string, cuid: string, ...args: any[]): Promise<boolean> {\r\n        if (!is(event)) {\r\n            throw new ArgumentError(\"Event name is incorrect\");\r\n        }\r\n        return this.get(event).emit(event, cuid, ...args);\r\n    }\r\n\r\n    /**\r\n    * Checks whether given context is already attached to specific event\r\n    *\r\n    * @param {string} name - Event name\r\n    * @param {CuiContext} ctx - callback context with id\r\n    * @param {CuiElement} cui - optional - cui element which event shall be attached to\r\n    */\r\n    isSubscribing(name: string, id: string, cui?: CuiElement) {\r\n        return this.get(name).isSubscribing(name, id, cui);\r\n    }\r\n\r\n    /**\r\n    * Detaches callbacks by component cuid - this is used to clean up attachments on component deletion\r\n    * @param {string} event - event name\r\n    * @param {string} cuid - cuid of the component\r\n    */\r\n    detachByCuid(event: string, cuid: string): void {\r\n        if (!are(event, cuid)) {\r\n            return\r\n        }\r\n        this.get(event).detachByCuid(event, cuid);\r\n    }\r\n\r\n\r\n    /**\r\n     * Creates and initializes event bus instance\r\n     * @param busName Event bus name for logger\r\n     * @param handlerName handler name to create proper handler instance\r\n     */\r\n    private initBusInstance(busName: string, handlerName: string): ICuiEventBus {\r\n        if (!are(busName, handlerName)) {\r\n            throw new ArgumentError(\"Bus name or handler name is incorrect\");\r\n        }\r\n        let executor = new CuiCallbackExecutor();\r\n        let handler = CuiEventEmitHandlerFactory.get(handlerName, executor);\r\n        return new CuiEventBus(handler, busName);\r\n    }\r\n\r\n    /**\r\n     * Creates mapping object from events array\r\n     * @param events events array\r\n     * @param index queue number\r\n     */\r\n    private mapEvents(events: string[], index: number): ICuiBusMapping {\r\n        return events.reduce((result: ICuiBusMapping, current: string) => {\r\n            if (!result[current]) {\r\n                return {\r\n                    ...result,\r\n                    [current]: index\r\n                }\r\n            }\r\n            return result;\r\n        }, {})\r\n    }\r\n\r\n    /**\r\n     * Retrives porper event bus based on event name\r\n     * @param event \r\n     */\r\n    private get(event: string): ICuiEventBus {\r\n        let idx = this.#events[event];\r\n        return this.#buses[idx ?? this.#last];\r\n    }\r\n}\r\n\r\nexport class CuiEventBusFactory {\r\n    static get(setup: ICuiEventBusQueueSetup[]): ICuiEventBus {\r\n        return is(setup) ? new CuiEventExtBus(setup) : new CuiEventBus(new TaskedEventEmitHandler(new CuiCallbackExecutor));\r\n    }\r\n}\r\n\r\nexport class CuiBusExtStatisticsHandler {\r\n    #isOn: boolean;\r\n    #statistics: CuiBusExtStatistics;\r\n    constructor(gather: boolean, queueCount: number) {\r\n        this.#isOn = gather;\r\n        this.#statistics = {\r\n            queueCount: queueCount,\r\n            events: {}\r\n        }\r\n    }\r\n\r\n    addEvent(event: string, queueNumber: number, emitCount?: number) {\r\n        this.#statistics.events[event] = {\r\n            name: event,\r\n            queueNumber: queueNumber,\r\n            emits: emitCount ?? 0\r\n        }\r\n    }\r\n\r\n    addQueue() {\r\n        this.#statistics.queueCount += 1;\r\n    }\r\n\r\n    addEmit(event: string, queueNumber?: number) {\r\n        if (!this.#isOn) {\r\n            return;\r\n        }\r\n\r\n        if (this.#statistics.events[event]) {\r\n            this.#statistics.events[event].emits += 1;\r\n        } else {\r\n            this.addEvent(event, queueNumber ?? -1, 1);\r\n        }\r\n\r\n    }\r\n\r\n    getStatistics(): CuiBusExtStatistics {\r\n        return this.#statistics;\r\n    }\r\n\r\n}","import { is } from \"../utils/functions\";\r\nimport { CuiUtils } from \"../models/utils\";\r\nimport { IUIInteractionProvider } from \"../models/interfaces\";\r\n\r\nexport interface ICuiDocumentStyleAppender {\r\n    append(style: string): boolean;\r\n}\r\n\r\nexport class CuiDocumentStyleAppender implements ICuiDocumentStyleAppender {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    append(style: string): boolean {\r\n        if (is(style)) {\r\n            const head = document.head || document.getElementsByTagName('head')[0]\r\n            const node = document.createElement('style');\r\n            const text = document.createTextNode(style);\r\n            node.type = 'text/css';\r\n            node.appendChild(text);\r\n            head.appendChild(node);\r\n        }\r\n        return true;\r\n    }\r\n\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\n\r\nexport class CuiKeyPressListener implements ICuiEventListener<KeyboardEvent> {\r\n    #callback: (t: KeyboardEvent) => void;\r\n    #keys: string[];\r\n    #inProgress: boolean;\r\n    #singleEmit: boolean;\r\n    #isAttached: boolean;\r\n    constructor(singleEmit: boolean, keys?: string[]) {\r\n        this.#keys = keys;\r\n        this.#inProgress = false;\r\n        this.#singleEmit = true;\r\n    }\r\n\r\n    setCallback(callback: (t: KeyboardEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n\r\n    attach(): void {\r\n        document.addEventListener('keydown', this.onKeyDown.bind(this))\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.onKeyUp.bind(this))\r\n        }\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        document.removeEventListener('keydown', this.onKeyDown.bind(this))\r\n        if (this.#singleEmit) {\r\n            document.addEventListener('keyup', this.onKeyUp.bind(this))\r\n        }\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#isAttached;\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        if (this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        try {\r\n            if (!is(this.#keys) || this.#keys.includes(ev.code)) {\r\n                this.#callback(ev);\r\n            }\r\n\r\n        } catch (e) {\r\n            console.error(e)\r\n        } finally {\r\n            if (!this.#singleEmit)\r\n                this.#inProgress = false;\r\n        }\r\n    }\r\n\r\n    onKeyUp(ev: KeyboardEvent) {\r\n        this.#inProgress = false;\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemLightMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoLightPluginSetup {\r\n    autoLight: boolean;\r\n}\r\n\r\nexport class CuiAutoLightModePlugin implements ICuiPlugin {\r\n    description: string = 'Dark vs Light mode auto switcher';\r\n    name: string = 'auto-light';\r\n    setup: AutoLightPluginSetup;\r\n    #listener: CuiMediaQueryListener;\r\n    #utils: CuiUtils;\r\n    constructor(autoLightInit: AutoLightPluginSetup) {\r\n        this.description = \"CuiAutoLightModePlugin\";\r\n        this.setup = autoLightInit;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils\r\n        if (this.setup.autoLight && getSystemLightMode() === 'dark') {\r\n            this.#utils.setLightMode('dark')\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('(prefers-color-scheme: dark)')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        let autoLightSetup = this.#utils.setup.plugins[this.description] as AutoLightPluginSetup;\r\n        let autoLight = autoLightSetup?.autoLight ?? false;\r\n        if (autoLight) {\r\n            if (ev.matches) {\r\n                this.#utils.setLightMode('dark')\r\n            } else {\r\n                this.#utils.setLightMode('light')\r\n            }\r\n        }\r\n    }\r\n\r\n}","export class AriaAttributes {\r\n    public static setLabel(element: Element, label: string): void {\r\n        if (!element.hasAttribute('aria-label')) {\r\n            element.setAttribute('aria-label', label);\r\n        }\r\n    }\r\n\r\n    public static setAria(element: Element, attr: string, value: string) {\r\n        if (!element.hasAttribute(attr)) {\r\n            element.setAttribute(attr, value);\r\n        }\r\n    }\r\n\r\n    public static removeAria(element: Element, attr: string) {\r\n        if (element.hasAttribute(attr)) {\r\n            element.removeAttribute(attr);\r\n        }\r\n    }\r\n}","import { ICuiLogger, IUIInteractionProvider, CuiContext, ICuiComponentHandler, ICuiParsable, ICuiOpenable, ICuiClosable } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getActiveClass, CuiActionsHelper, ICuiComponentAction, is, EVENTS, CuiActionsFatory, CuiActionsListFactory, CuiDevelopmentStateType } from \"../../core/index\";\r\nimport { ICuiComponentMutationObserver, CuiComponentMutationHandler } from \"../observers/mutations\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { KeyDownEvent } from \"../../plugins/keys/observer\";\r\n\r\nexport interface CuiChildMutation {\r\n    removed: Node[];\r\n    added: Node[];\r\n}\r\n\r\nexport class ComponentHelper {\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n    }\r\n\r\n    hasClass(cls: string, element: Element) {\r\n        return cls && element.classList.contains(cls)\r\n    }\r\n\r\n    setClass(cls: string, element: Element) {\r\n        this.setClasses([cls], element);\r\n    }\r\n\r\n    setClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.add(...classes)\r\n        }\r\n    }\r\n\r\n    setClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.setClasses, this, classes, element);\r\n    }\r\n\r\n    removeClass(cls: string, element: Element) {\r\n        this.removeClasses([cls], element);\r\n    }\r\n\r\n    removeClasses(classes: string[], element?: Element) {\r\n        if (element) {\r\n            element.classList.remove(...classes)\r\n        }\r\n    }\r\n\r\n    removeClassesAs(element: Element, ...classes: string[]) {\r\n        this.#interactions.mutate(this.removeClasses, this, classes, element);\r\n    }\r\n\r\n    removeAttribute(attributeName: string, element: Element) {\r\n        if (element && element.hasAttribute(attributeName))\r\n            element.removeAttribute(attributeName);\r\n    }\r\n\r\n    setStyle(element: any, property: string, value: string) {\r\n        if (element && element[\"style\"] && is(value)) {\r\n            element.style[property] = value\r\n        }\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiComponentBase implements CuiContext {\r\n    _log: ICuiLogger;\r\n    utils: CuiUtils;\r\n    element: HTMLElement;\r\n    cuid: string;\r\n    isLocked: boolean;\r\n    activeClassName: string;\r\n    helper: ComponentHelper;\r\n    #emittedEvents: string[];\r\n    componentName: string;\r\n    constructor(componentName: string, element: HTMLElement, utils: CuiUtils) {\r\n        this._log = CuiLoggerFactory.get(componentName);\r\n        this.utils = utils;\r\n        this.element = element;\r\n        this.cuid = (<any>element).$cuid;\r\n        this.isLocked = false;\r\n        this._log.setId(this.cuid);\r\n        this.activeClassName = getActiveClass(utils.setup.prefix);\r\n        this.helper = new ComponentHelper(utils.interactions);\r\n        this.#emittedEvents = [];\r\n        this.componentName = componentName;\r\n    }\r\n\r\n\r\n    mutate(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    fetch(callback: any, ...args: any[]): void {\r\n        this.utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    getEventName(name: string) {\r\n        return [name, this.cuid].join('-');\r\n    }\r\n\r\n    emitEvent(event: string, ...data: any[]) {\r\n        if (!this.#emittedEvents.includes(event))\r\n            this.#emittedEvents.push(event);\r\n        this.utils.bus.emit(event, this.cuid, ...data)\r\n    }\r\n\r\n    onEvent(event: string, callback: any): string {\r\n        return this.utils.bus.on(event, callback, this.element as any)\r\n    }\r\n\r\n    detachEvent(event: string, id: string) {\r\n        if (id != null) {\r\n            this.utils.bus.detach(event, id);\r\n            id = null;\r\n        }\r\n    }\r\n\r\n    getId(): string {\r\n        return this.cuid;\r\n    }\r\n\r\n    checkLockAndWarn(fName?: string): boolean {\r\n        if (this.isLocked) {\r\n            this._log.warning(\"Component is locked\", fName)\r\n            return true\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Helper which checks whether element has an active flag set\r\n     */\r\n    isActive(): boolean {\r\n        return this.element.classList.contains(this.activeClassName);\r\n    }\r\n\r\n    detachEmiitedEvents() {\r\n        this.#emittedEvents.forEach(event => {\r\n            this.utils.bus.detachByCuid(event, this.cuid);\r\n            this._log.debug(\"Detaching event: \" + event + \" on component delete\");\r\n        })\r\n    }\r\n\r\n    registerInDebug(): void {\r\n        this.utils.development.registerElement(this.element, this.cuid, this.componentName);\r\n    }\r\n\r\n    removeFromDebug(): void {\r\n        this.utils.development.unregisterElement(this.cuid, this.componentName);\r\n    }\r\n\r\n    setDebugProperty<T>(name: string, value: T): void {\r\n        this.utils.development.setProperty(this.cuid, this.componentName, name, value);\r\n    }\r\n\r\n    logInfo(message: string, functionName?: string) {\r\n        this._log.debug(message, functionName);\r\n        this.utils.development.pushState(this.cuid, this.componentName, \"info\", message, functionName);\r\n    }\r\n\r\n    logWarning(message: string, functionName?: string) {\r\n        this._log.warning(message, functionName);\r\n        this.utils.development.pushState(this.cuid, this.componentName, \"warning\", message, functionName);\r\n    }\r\n\r\n    pushDebugState(type: CuiDevelopmentStateType, message: string, functionName?: string) {\r\n        this.utils.development.pushState(this.cuid, this.componentName, type, message, functionName);\r\n    }\r\n\r\n\r\n    logError(message: string, functionName?: string, error?: Error) {\r\n        this._log.error(message, functionName);\r\n        if (error) {\r\n            this._log.exception(error, functionName)\r\n        }\r\n        this.utils.development.pushState(this.cuid, this.componentName, \"error\", message, functionName);\r\n    }\r\n\r\n}\r\n\r\nabstract class CuiHandlerBase<T extends ICuiParsable> extends CuiComponentBase implements ICuiComponentHandler {\r\n    args: T;\r\n    prevArgs: T;\r\n    isInitialized: boolean;\r\n    activeClassName: string;\r\n    actionsHelper: CuiActionsHelper;\r\n    #attribute: string;\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, utils);\r\n        this.args = args;\r\n\r\n        this.actionsHelper = new CuiActionsHelper(utils.interactions)\r\n        this.prevArgs = null;\r\n        this.isInitialized = false;\r\n        this.#attribute = attribute;\r\n    }\r\n\r\n    handle(args: any): void {\r\n        this.logInfo(\"Init\", 'handle');\r\n        if (this.isInitialized) {\r\n            this.logWarning(\"Trying to initialize component again\", 'handle');\r\n            return;\r\n        }\r\n        this.args.parse(args);\r\n        if (!this.element.classList.contains(this.#attribute)) {\r\n            this.element.classList.add(this.#attribute);\r\n        }\r\n        this.registerInDebug();\r\n        this.onHandle();\r\n        this.isInitialized = true;\r\n    }\r\n\r\n    refresh(args: any): void {\r\n        this.logInfo(\"Update\", 'refresh')\r\n        if (!this.isInitialized) {\r\n            this.logError(\"Cannot update not initialized component\", 'refresh');\r\n            return;\r\n        }\r\n        this.prevArgs = { ...this.args };\r\n        this.args.parse(args);\r\n        this.pushDebugState(\"info\", \"Component update\", 'refresh');\r\n        this.onRefresh();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.logInfo(\"Destroy\", \"destroy\");\r\n        this.onRemove();\r\n        this.detachEmiitedEvents();\r\n        this.removeFromDebug();\r\n        this.isInitialized = false;\r\n    }\r\n\r\n    // Abstract\r\n    abstract onHandle(): void;\r\n    abstract onRefresh(): void;\r\n    abstract onRemove(): void;\r\n}\r\n\r\n\r\nexport abstract class CuiHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    args: T;\r\n    prevArgs: T;\r\n    isInitialized: boolean;\r\n\r\n    actionsHelper: CuiActionsHelper;\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n    }\r\n\r\n    onHandle() {\r\n        this.onInit();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        this.onUpdate();\r\n    }\r\n\r\n    onRemove() {\r\n        this.onDestroy();\r\n    }\r\n\r\n    /**\r\n     * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n     * \r\n     * @param action - action to perfrom\r\n     * @param timeout - timeout specified for action removal\r\n     * @param onFinish - callback to be performed after action is finished after removal\r\n     * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n     */\r\n    async performAction(actions: ICuiComponentAction[], timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performActions(this.element, actions, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Abstract\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n\r\n}\r\nexport interface CuiInteractableArgs {\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    escClose: boolean;\r\n    keyClose: string;\r\n}\r\n\r\nexport abstract class CuiInteractableHandler<T extends ICuiParsable & CuiInteractableArgs> extends CuiHandlerBase<T> implements ICuiOpenable, ICuiClosable {\r\n    args: T;\r\n    prevArgs: T;\r\n    isInitialized: boolean;\r\n\r\n    actionsHelper: CuiActionsHelper;\r\n    #openEventId: string;\r\n    #closeEventId: string;\r\n    #keyCloseEventId: string;\r\n    #openAct: ICuiComponentAction[];\r\n    #closeAct: ICuiComponentAction[];\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n    }\r\n\r\n\r\n    onHandle() {\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.openFromEvent.bind(this))\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.closeFromEvent.bind(this))\r\n        this.#openAct = CuiActionsListFactory.get(this.args.openAct)\r\n        this.#closeAct = CuiActionsListFactory.get(this.args.closeAct)\r\n        this.onInit();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        if (this.args.openAct !== this.prevArgs.openAct) {\r\n            this.#openAct = CuiActionsListFactory.get(this.args.openAct)\r\n        }\r\n        if (this.args.closeAct !== this.prevArgs.closeAct) {\r\n            this.#closeAct = CuiActionsListFactory.get(this.args.closeAct)\r\n        }\r\n        this.onUpdate();\r\n    }\r\n\r\n    onRemove() {\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId)\r\n        this.onDestroy();\r\n    }\r\n\r\n    async open(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"open\")) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            this.logWarning(\"Component is already opened\");\r\n            return false;\r\n        }\r\n        if (this.args.escClose || is(this.args.keyClose)) {\r\n            this.#keyCloseEventId = this.onEvent(EVENTS.KEYDOWN, this.onKeyClose.bind(this))\r\n        }\r\n\r\n        if (!this.onBeforeOpen()) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        return this.performAction(this.#openAct, this.args.timeout, this.onActionFinish.bind(this, this.onAfterOpen.bind(this), EVENTS.OPENED, args), () => {\r\n            this.helper.setClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'true');\r\n        });;\r\n    }\r\n\r\n    async close(args?: any): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\")) {\r\n            return false;\r\n        }\r\n        if (!this.isActive()) {\r\n            this.logWarning(\"Component is already closed\");\r\n            return false;\r\n        }\r\n\r\n        this.detachEvent(EVENTS.KEYDOWN, this.#keyCloseEventId);\r\n        if (!this.onBeforeClose()) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        return this.performAction(this.#closeAct, this.args.timeout, this.onActionFinish.bind(this, this.onAfterClose.bind(this), EVENTS.CLOSED, args), () => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        });;\r\n    }\r\n\r\n\r\n    /**\r\n     * Helper created for elements that animate - perfroms an action *add*, after timeout it performs *remove*.\r\n     * \r\n     * @param action - action to perfrom\r\n     * @param timeout - timeout specified for action removal\r\n     * @param onFinish - callback to be performed after action is finished after removal\r\n     * @param callback - optional - callback to be executed in mutation on action removal, e.g. additional DOM changes on element\r\n     */\r\n    async performAction(actions: ICuiComponentAction[], timeout: number, onFinish: () => void, callback?: () => void): Promise<boolean> {\r\n        if (await this.actionsHelper.performActions(this.element, actions, timeout, callback)) {\r\n            onFinish();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    private openFromEvent(args: any) {\r\n        this.open(args);\r\n    }\r\n\r\n    private closeFromEvent(args: any) {\r\n        this.close(args);\r\n    }\r\n\r\n    private onActionFinish(callback: () => void, event: string, args: any) {\r\n        callback();\r\n        this.emitEvent(event, {\r\n            timestamp: Date.now(),\r\n            state: args\r\n        })\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private async onKeyClose(ev: KeyDownEvent) {\r\n        if (this.args.escClose && ev.event.key === \"Escape\" || is(this.args.keyClose) && ev.event.key === this.args.keyClose) {\r\n            await this.close('Closed by key');\r\n        }\r\n    }\r\n    // Abstract\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n    abstract onBeforeOpen(): boolean;\r\n    abstract onAfterOpen(): void;\r\n    abstract onAfterClose(): void;\r\n    abstract onBeforeClose(): boolean;\r\n\r\n}\r\n\r\nexport abstract class CuiMutableHandler<T extends ICuiParsable> extends CuiHandlerBase<T> {\r\n    #mutionHandler: ICuiComponentMutationObserver;\r\n    constructor(componentName: string, element: HTMLElement, attribute: string, args: T, utils: CuiUtils) {\r\n        super(componentName, element, attribute, args, utils);\r\n        this.#mutionHandler = new CuiComponentMutationHandler(element);\r\n        this.#mutionHandler.onMutation(this.mutation.bind(this))\r\n    }\r\n\r\n    onHandle() {\r\n        this.onInit();\r\n        this.#mutionHandler.observe();\r\n    }\r\n\r\n\r\n    onRefresh() {\r\n        this.#mutionHandler.unobserve();\r\n        this.onUpdate();\r\n        this.#mutionHandler.observe();\r\n    }\r\n\r\n    onRemove() {\r\n        this.#mutionHandler.unobserve();\r\n        this.onDestroy();\r\n    }\r\n\r\n    /**\r\n     * Callback attached to mutation observer set on root element\r\n     * \r\n     * @param record - mutation records\r\n     */\r\n    mutation(records: MutationRecord[]): void {\r\n        this._log.debug(\"Element mutation\", \"mutation\")\r\n        this.onMutation(records.reduce<CuiChildMutation>((result: CuiChildMutation, item: MutationRecord) => {\r\n            if (item.type !== \"childList\") {\r\n                return result;\r\n            }\r\n            if (item.addedNodes.length > 0) {\r\n                result.added.push(...item.addedNodes)\r\n            }\r\n            if (item.removedNodes.length > 0) {\r\n                result.removed.push(...item.removedNodes)\r\n            }\r\n            return result;\r\n        }, {\r\n            added: [],\r\n            removed: []\r\n        }));\r\n    }\r\n\r\n    abstract onMutation(record: CuiChildMutation): void;\r\n    abstract onInit(): void;\r\n    abstract onUpdate(): void;\r\n    abstract onDestroy(): void;\r\n}","import { createElementFromString, is } from \"../../core/index\";\r\n\r\nexport class IconBuilder {\r\n    #element: string;\r\n    #scale: number;\r\n    #appender: IconScaleAppender;\r\n\r\n    constructor(svgString: string) {\r\n        this.#element = svgString;\r\n        this.#scale = 1;\r\n        this.#appender = new IconScaleAppender();\r\n    }\r\n\r\n    setScale(scale: number): IconBuilder {\r\n        this.#scale = scale\r\n        return this\r\n    }\r\n\r\n    build(): Element {\r\n        let created = createElementFromString(this.#element)\r\n        if (is(created) && this.#scale) {\r\n            this.#appender.append(created, this.#scale)\r\n        }\r\n        return created\r\n    }\r\n}\r\n\r\nexport class IconScaleAppender {\r\n    append(element: Element, value: number): void {\r\n        let width = element.hasAttribute(\"width\") ? parseInt(element.getAttribute(\"width\")) : 20;\r\n        let height = element.hasAttribute(\"height\") ? parseInt(element.getAttribute(\"height\")) : 20;\r\n        element.setAttribute(\"width\", (width * value).toString())\r\n        element.setAttribute(\"height\", (height * value).toString())\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICONS } from \"../../core/utils/statics\";\r\nimport { is, isString, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../app/builders/icon\";\r\n\r\nexport class CuiIconArgs implements ICuiParsable {\r\n    icon: string;\r\n    scale: number;\r\n\r\n    constructor() {\r\n        this.icon = null;\r\n        this.scale = 1;\r\n    }\r\n    parse(val: any) {\r\n        if (isString(val)) {\r\n            this.icon = getStringOrDefault(val, \"\");\r\n        } else {\r\n            this.icon = getStringOrDefault(val.icon, \"\");\r\n            this.scale = getIntOrDefault(val.scale, 1);\r\n        }\r\n\r\n    }\r\n}\r\n\r\nexport class CuiIconComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-icon`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIconHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiIconHandler extends CuiHandler<CuiIconArgs> {\r\n\r\n    #currentIcon: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIconHandler\", element, attribute, new CuiIconArgs(), utils);\r\n        this.#currentIcon = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        if (this.#currentIcon !== null) {\r\n            this._log.debug(\"Icon already initialized\")\r\n            return;\r\n        }\r\n        this.addIcon(this.args.icon)\r\n        this.#currentIcon = this.args.icon;\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.args.icon === this.#currentIcon) {\r\n            return;\r\n        }\r\n        this.addIcon(this.args.icon);\r\n        this.#currentIcon = this.args.icon;\r\n    }\r\n\r\n    onDestroy(): void {\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n        this.#currentIcon = null;\r\n    }\r\n\r\n    private addIcon(icon: string) {\r\n        const iconStr = icon ? ICONS[icon] : null;\r\n        if (!iconStr) {\r\n            return;\r\n        }\r\n        const iconSvg = new IconBuilder(iconStr).setScale(this.args.scale).build();\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n\r\n        if (this.element.childNodes.length > 0) {\r\n            this.mutate(this.insertBefore, iconSvg)\r\n        } else {\r\n            this.mutate(this.appendChild, iconSvg)\r\n        }\r\n    }\r\n\r\n    private insertBefore(iconElement: Element) {\r\n        this.element.insertBefore(iconElement, this.element.firstChild);\r\n    }\r\n\r\n    private appendChild(iconElement: Element) {\r\n        this.element.appendChild(iconElement);\r\n    }\r\n}\r\n","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { is, getRangeValue, isString, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { ICONS, EVENTS } from \"../../core/utils/statics\";\r\nimport { IconBuilder } from \"../../app/builders/icon\";\r\n\r\nexport interface CuiCircleProgressChnaged {\r\n    timestamp: number;\r\n    progress: number;\r\n}\r\n\r\nexport class CuiCircleArgs implements ICuiParsable {\r\n    progress: number;\r\n    constructor() {\r\n        this.progress = 0;\r\n    }\r\n\r\n    parse(val: any): void {\r\n        if (!is(val)) {\r\n            this.progress = 0;\r\n        }\r\n        else if (isString(val)) {\r\n            this.progress = getIntOrDefault(val, 0);\r\n        } else {\r\n            this.progress = getIntOrDefault(val.progress, 0);\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nexport class CuiCircleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = (prefix ?? 'cui') + '-circle-progress';\r\n        ICONS['special_circle_progress'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"  class=\\\"circle-progress\\\" viewBox=\\\"0 0 100 100\\\" width=\\\"100\\\" height=\\\"100\\\"><path class=\\\"circle-progress-path\\\" d=\\\"M 50,5.3660047 A 44.867708,44.633994 0 0 1 94.867709,49.999997 44.867708,44.633994 0 0 1 50,94.633995 44.867708,44.633994 0 0 1 5.1322908,50.000001 44.867708,44.633994 0 0 1 50,5.3660047\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCircleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiCircleHandler extends CuiHandler<CuiCircleArgs> {\r\n    #factor: number;\r\n    #full: number;\r\n    #path: any;\r\n    #attr: string;\r\n    #progressEventId: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiCircleHandler\", element, attribute, new CuiCircleArgs(), utils);\r\n        this.#factor = this.#full = 0;\r\n        this.#path = null\r\n        this.#attr = attribute;\r\n        this.#progressEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        const iconSvg = new IconBuilder(ICONS['special_circle_progress']).build();\r\n        const svg = this.element.querySelector('svg')\r\n        if (is(svg)) {\r\n            svg.remove();\r\n        }\r\n        this.element.appendChild(iconSvg);\r\n        this.#path = this.element.querySelector('.circle-progress-path');\r\n        this.#full = this.#path.getTotalLength();\r\n        this.#factor = this.#full / 100;\r\n        this.fetch(this.readStyle)\r\n        this.#progressEventId = this.onEvent(EVENTS.PROGRESS_CHANGE, this.onSetProgress.bind(this))\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.fetch(this.readStyle)\r\n        this.emitEvent(EVENTS.PROGRESS_CHANGED, {\r\n            timestamp: Date.now(),\r\n            progress: this.args.progress\r\n        })\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.PROGRESS_CHANGE, this.#progressEventId);\r\n    }\r\n\r\n    onSetProgress(val: any) {\r\n        if (is(val)) {\r\n            this.element.setAttribute(this.#attr, val);\r\n        }\r\n    }\r\n\r\n    private updateStyle(value: number) {\r\n        this.#path.style.strokeDashoffset = value;\r\n    }\r\n\r\n    private readStyle(): void {\r\n        if (this.prevArgs && this.args.progress === this.prevArgs.progress) {\r\n            return;\r\n        }\r\n        const progress = getRangeValue(this.args.progress, 0, 100);\r\n\r\n        this.mutate(this.updateStyle, this.#full - this.#factor * progress);\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CLASSES, EVENTS, ICONS } from \"../../core/utils/statics\";\r\nimport { is, isString, getStringOrDefault, getIntOrDefault, replacePrefix } from \"../../core/utils/functions\";\r\nimport { IconBuilder } from \"../../app/builders/icon\";\r\n\r\nexport class CuiSpinnerArgs implements ICuiParsable {\r\n    spinner: string;\r\n    scale: number;\r\n    constructor() {\r\n        this.spinner = \"circle\";\r\n        this.scale = 1;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (isString(args)) {\r\n            this.spinner = getStringOrDefault(args, \"circle\");\r\n        } else {\r\n            this.spinner = getStringOrDefault(args.spinner, \"circle\");\r\n            this.scale = getIntOrDefault(args.scale, 1);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSpinnerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-spinner`;\r\n        ICONS['spinner_circle'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 7.800378,1.7908996 A 8.4986862,8.4986862 0 0 1 18.2091,7.8003784 8.4986862,8.4986862 0 0 1 12.199621,18.209101 8.4986862,8.4986862 0 0 1 1.7908995,12.199622 8.4986862,8.4986862 0 0 1 7.800378,1.7908996 Z\\\"></path></svg>\";\r\n        ICONS['spinner_circle_double'] = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 20 20\\\" width=\\\"20\\\" height=\\\"20\\\"><path d=\\\"M 10,1.5000006 A 8.4999997,8.4999997 0 0 1 18.5,10 8.4999997,8.4999997 0 0 1 10,18.499999 8.4999997,8.4999997 0 0 1 1.5000005,10 8.4999997,8.4999997 0 0 1 10,1.5000006 Z\\\"></path><path d=\\\"M 10,3.4999997 A 6.5000002,6.5000002 0 0 1 16.5,10 6.5000002,6.5000002 0 0 1 10,16.5 6.5000002,6.5000002 0 0 1 3.5,9.9999993 6.5000002,6.5000002 0 0 1 10,3.4999997 Z\\\"></path></svg>\";\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSpinnerHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiSpinnerHandler extends CuiHandler<CuiSpinnerArgs> {\r\n    #pauseEventId: string;\r\n    #animationPauseClass: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiSpinnerHandler\", element, attribute, new CuiSpinnerArgs(), utils);\r\n        this.#pauseEventId = null;\r\n        this.#animationPauseClass = replacePrefix(\"{prefix}-animation-pause\", prefix);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#pauseEventId = this.onEvent(EVENTS.PAUSE, this.onPause.bind(this));\r\n        this.add()\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.args.spinner !== this.prevArgs.spinner) {\r\n            this.add();\r\n        }\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.removeIfAnyExisists();\r\n        this.detachEvent(EVENTS.PAUSE, this.#animationPauseClass);\r\n    }\r\n\r\n    private addSpinner(iconElement: Element, name: string) {\r\n        this.element.appendChild(iconElement);\r\n        this.element.classList.add(`animation-spinner-${name}`);\r\n    }\r\n\r\n    private add() {\r\n        const svgIcon = is(this.args.spinner) ? ICONS[`spinner_${this.args.spinner}`] : null;\r\n        if (!is(svgIcon)) {\r\n            this._log.warning(\"Incorrect spinner name: \" + this.args.spinner);\r\n            return;\r\n        }\r\n        this.removeIfAnyExisists();\r\n        const iconElement = new IconBuilder(svgIcon).setScale(this.args.scale).build();\r\n        this.mutate(this.addSpinner, iconElement, this.args.spinner);\r\n    }\r\n\r\n    private removeIfAnyExisists() {\r\n        let existing = this.element.querySelector(\"svg\");\r\n        if (existing) {\r\n            existing.remove();\r\n        }\r\n    }\r\n\r\n\r\n    private onPause(flag: boolean) {\r\n        this.fetch(() => {\r\n            if (flag && !this.helper.hasClass(this.#animationPauseClass, this.element)) {\r\n                this.helper.setClassesAs(this.element, this.#animationPauseClass);\r\n            } else {\r\n                this.helper.removeClassesAs(this.element, this.#animationPauseClass);\r\n            }\r\n        })\r\n        this.emitEvent(EVENTS.PAUSED, flag);\r\n    }\r\n\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase } from \"../../app/handlers/base\";\r\n\r\nexport class CuiDummyComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor() {\r\n        this.attribute = 'cui-dummy';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDummyHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiDummyHandler extends CuiComponentBase implements ICuiComponentHandler {\r\n\r\n    #attribute: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiDummyHandler\", element, utils);\r\n\r\n        this.#attribute = attribute\r\n    }\r\n\r\n    handle(args: any): void {\r\n\r\n    }\r\n\r\n    refresh(args: any): void {\r\n\r\n    }\r\n\r\n    destroy(): void {\r\n\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { is, getOffsetTop, getStringOrDefault } from \"../../core/utils/functions\";\r\n\r\n/**\r\n * Component scrolls to specified target in the document\r\n * Arguments: \r\n * target - selector to target element where page should be scrolled to.\r\n * parent - set parent selector if parent should be different than html parent\r\n * behavior - auto/smooth - choose between step and smooth scrolling\r\n * \r\n */\r\n\r\nexport class CuiScrollComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = is(prefix) ? prefix + 'scroll' : 'cui-scroll';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport interface CuiScrollAttribute {\r\n    target?: string;\r\n    parent?: string;\r\n    behavior?: 'auto' | 'smooth';\r\n}\r\n\r\nexport class CuiScrollArgs implements ICuiParsable {\r\n    target?: string;\r\n    parent?: string;\r\n    behavior?: 'auto' | 'smooth';\r\n\r\n    constructor() {\r\n        this.target = null;\r\n        this.parent = null;\r\n        this.behavior = 'auto';\r\n    }\r\n\r\n    parse(val: any): void {\r\n        this.target = getStringOrDefault(val.target, \"\");\r\n        this.parent = getStringOrDefault(val.parent, \"\");\r\n        this.behavior = is(val.behavior) && val.behavior.toLowerCase() === 'smooth' ? 'smooth' : 'auto';\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiScrollHandler extends CuiHandler<CuiScrollArgs> {\r\n    #parent: HTMLElement;\r\n    #target: HTMLElement;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollHandler\", element, attribute, new CuiScrollArgs(), utils);\r\n        this.element = element;\r\n        this.#parent = null;\r\n        this.#target = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick.bind(this));\r\n        this.setTargets();\r\n    }\r\n    onUpdate(): void {\r\n        this.setTargets();\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick.bind(this));\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        if (!is(this.#target)) {\r\n            return;\r\n        }\r\n        let to = getOffsetTop(this.#target) - this.#parent.offsetTop;\r\n        let from = this.#parent.scrollTop;\r\n        let by = to - from;\r\n        this.#parent.scrollBy({\r\n            top: by,\r\n            behavior: this.args.behavior\r\n        });\r\n        this.emitEvent(EVENTS.ON_SCROLL, {\r\n            to: to,\r\n            by: by,\r\n            target: this.#target,\r\n            parent: this.#parent,\r\n            timestamp: Date.now(),\r\n        })\r\n        ev.preventDefault();\r\n    }\r\n\r\n    private setTargets(): void {\r\n        this.#target = document.querySelector(this.args.target) as HTMLElement;\r\n        if (is(this.#target)) {\r\n            this.#parent = is(this.args.parent) ? document.querySelector(this.args.parent) : this.#target.parentElement;\r\n        }\r\n    }\r\n}\r\n\r\n","import { CuiScrollEvent, CuiScrollListener } from \"../listeners/scroll\";\r\nimport { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../models/elements\";\r\nimport { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are, getRangeValue, is } from \"../utils/functions\";\r\nimport { CuiIntersectionCallback, CuiIntersectionListenerOptions, CuiIntersectionResult } from \"./interfaces\";\r\n\r\nconst DEFAULT_OPTION_THRESHOLD: number = 0;\r\n\r\nexport class CuiIntersectionListener implements ICuiEventListener<CuiIntersectionResult> {\r\n    #scrollListener: CuiScrollListener;\r\n    #callback: CuiIntersectionCallback;\r\n    #children: HTMLElement[];\r\n    #box: ICuiElementBox;\r\n    constructor(element: CuiElementBoxType, options?: CuiIntersectionListenerOptions) {\r\n        this.#box = CuiElementBoxFactory.get(element);\r\n        this.#scrollListener = new CuiScrollListener(element as Element, options?.threshold ?? DEFAULT_OPTION_THRESHOLD);\r\n        this.#scrollListener.setCallback(this.onScroll.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Sets child elements - ratio is calcutalated based on them\r\n     * @param children \r\n     */\r\n    setChildren(children: HTMLElement[]) {\r\n        this.#children = children;\r\n    }\r\n\r\n    setThreshold(threshold: number) {\r\n        this.#scrollListener.setThreshold(threshold)\r\n    }\r\n\r\n    setCallback(callback: (t: CuiIntersectionResult) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    setParent(target: CuiElementBoxType) {\r\n        this.#box = CuiElementBoxFactory.get(target);\r\n        this.#scrollListener.setTarget(target);\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#scrollListener.isInProgress();\r\n    }\r\n\r\n    attach(): void {\r\n        if (this.isAttached()) {\r\n            return;\r\n        }\r\n        this.#scrollListener.attach();\r\n    }\r\n\r\n    detach(): void {\r\n        if (!this.isAttached()) {\r\n            return;\r\n        }\r\n        this.#scrollListener.detach();\r\n    }\r\n\r\n    isAttached(): boolean {\r\n        return this.#scrollListener && this.#scrollListener.isAttached();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        if (!are(this.#children, this.#callback)) {\r\n            return;\r\n        }\r\n        this.#callback(this.prepareCallbackResult(ev))\r\n    }\r\n\r\n    private calcChildVerticalRatio(child: HTMLElement, currentTop: number, currentBottom: number): number {\r\n        let childBottom = child.offsetTop + child.offsetHeight;\r\n        // Simulated top if view top is outside of parent then takes parent top\r\n        let symTop = currentTop > child.offsetTop ? currentTop : child.offsetTop;\r\n        // Simulated bottom if view bottom is outside of parent then takes parent bottom\r\n        let symBottom = currentBottom < childBottom ? currentBottom : childBottom;\r\n        // Calculates amount of pixels that are in view\r\n        let diff = symBottom - symTop;\r\n        // Calculates ratio - how much of a child is in parent view\r\n        let ratio = diff / child.offsetHeight;\r\n        return getRangeValue(ratio, 0, 1);\r\n    }\r\n\r\n    private calcChildHorizontalRatio(child: HTMLElement, currentLeft: number, currentRight: number): number {\r\n        let childRight = child.offsetLeft + child.offsetWidth;\r\n        // Simulated top if view left is outside of parent then takes parent left\r\n        let symLeft = currentLeft > child.offsetLeft ? currentLeft : child.offsetLeft;\r\n        // Simulated bottom if view right is outside of parent then takes parent right\r\n        let symRight = currentRight < childRight ? currentRight : childRight;\r\n        // Calculates amount of pixels that are in view\r\n        let diff = symRight - symLeft;\r\n        // Calculates ratio - how much of a child is in parent view\r\n        let ratio = diff / child.offsetWidth;\r\n        return getRangeValue(ratio, 0, 1);\r\n    }\r\n\r\n    private prepareCallbackResult(ev: CuiScrollEvent): CuiIntersectionResult {\r\n        let parentBottom = ev.top + this.#box.getHeight();\r\n        let parentRight = ev.left + this.#box.getWidth();\r\n        let result: CuiIntersectionResult = {\r\n            ev: ev.base,\r\n            top: ev.top,\r\n            left: ev.left,\r\n            scrolling: ev.scrolling ?? false,\r\n            initial: ev.initial ?? false,\r\n            source: ev.source,\r\n            items: this.#children.map((child: HTMLElement, index: number) => {\r\n                let verticalRatio = this.calcChildVerticalRatio(child, ev.top, parentBottom)\r\n                let horizontalRatio = this.calcChildHorizontalRatio(child, ev.left, parentRight);\r\n                return {\r\n                    verticalRatio: verticalRatio,\r\n                    horizontalRatio: horizontalRatio,\r\n                    element: child\r\n                }\r\n            })\r\n        };\r\n\r\n        return result;\r\n    }\r\n}","import { are, ICui, ICuiComponentAction, is } from \"../../core/index\";\r\nimport { CuiIntersectionResultItem } from \"../../core/intersection/interfaces\";\r\n\r\nexport interface CuiScrollspyUpdateResult {\r\n    intersecting?: HTMLElement[];\r\n    changed: boolean;\r\n}\r\n\r\nexport interface ICuiScrollspyModeHandler {\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult;\r\n}\r\n\r\nexport class CuiScrollSpyModeHandlerFactory {\r\n    static get(mode: string) {\r\n        if (mode === \"multi\") {\r\n            return new CuiMultiModeHandler();\r\n        }\r\n        return new CuiSingleModeHandler();\r\n    }\r\n}\r\n\r\nabstract class CuiModeHandlerBase<T> {\r\n    previous: T;\r\n\r\n    getMatching(ratio: number, items: CuiIntersectionResultItem[]): number[] {\r\n        return items.reduce((result: number[], item: CuiIntersectionResultItem, index: number) => {\r\n            if (item.verticalRatio > ratio) {\r\n                result.push(index);\r\n            }\r\n            return result;\r\n        }, [])\r\n    }\r\n\r\n    addActions(actions: ICuiComponentAction[], ...elements: HTMLElement[]) {\r\n        this.forEachAction(actions, elements, (action, element) => {\r\n            action.add(element);\r\n        })\r\n    }\r\n\r\n    removeActions(actions: ICuiComponentAction[], ...elements: HTMLElement[]) {\r\n        this.forEachAction(actions, elements, (action, element) => {\r\n            action.remove(element);\r\n        })\r\n    }\r\n\r\n    private forEachAction(actions: ICuiComponentAction[], elements: HTMLElement[], callback: (action: ICuiComponentAction, element: HTMLElement) => void): void {\r\n        if (!are(actions, elements, callback)) {\r\n            return;\r\n        }\r\n        actions.forEach(action => {\r\n            elements.forEach(element => {\r\n                if (is(element))\r\n                    callback(action, element);\r\n            })\r\n        })\r\n    }\r\n\r\n    abstract matches(item: T): boolean;\r\n\r\n}\r\n\r\nexport class CuiSingleModeHandler extends CuiModeHandlerBase<number> implements ICuiScrollspyModeHandler {\r\n\r\n    constructor() {\r\n        super();\r\n        this.previous = -1;\r\n    }\r\n\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult {\r\n        let matching = this.getMatching(ratio, items);\r\n        let len = matching.length;\r\n        let last = len > 0 ? matching[len - 1] : -1;\r\n        let result: CuiScrollspyUpdateResult = {\r\n            changed: false\r\n        }\r\n        if (!this.matches(last)) {\r\n            if (this.previous > -1)\r\n                this.removeActions(actions, items[this.previous].element);\r\n            if (last > -1) {\r\n                let lastElement = items[last].element;\r\n                result.intersecting = [lastElement]\r\n                this.addActions(actions, lastElement)\r\n            }\r\n            if (are(links, linksActions)) {\r\n                if (this.previous > -1)\r\n                    this.removeActions(linksActions, links[this.previous]);\r\n                if (last > -1)\r\n                    this.addActions(linksActions, links[last])\r\n            }\r\n            this.previous = last;\r\n            result.changed = true;\r\n            result.intersecting = []\r\n            return result;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    matches(item: number): boolean {\r\n        return item === this.previous;\r\n    }\r\n}\r\n\r\nexport class CuiMultiModeHandler extends CuiModeHandlerBase<number[]> implements ICuiScrollspyModeHandler {\r\n    constructor() {\r\n        super();\r\n        this.previous = [];\r\n    }\r\n    update(items: CuiIntersectionResultItem[], ratio: number, actions: ICuiComponentAction[], links: HTMLElement[], linksActions: ICuiComponentAction[]): CuiScrollspyUpdateResult {\r\n        let matching = this.getMatching(ratio, items);\r\n        let result: CuiScrollspyUpdateResult = {\r\n            changed: false\r\n        }\r\n        if (!this.matches(matching)) {\r\n            let intersecting = matching.map(idx => { return items[idx].element })\r\n            this.removeActions(actions, ...this.previous.map(idx => { return items[idx].element }));\r\n            this.addActions(actions, ...intersecting)\r\n            result.intersecting = intersecting;\r\n            if (are(links, linksActions)) {\r\n                this.removeActions(linksActions, ...this.previous.map(idx => { return links[idx] }));\r\n                this.addActions(linksActions, ...matching.map(idx => { return links[idx] }))\r\n            }\r\n            this.previous = matching;\r\n            result.changed = true;\r\n            return result;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    matches(item: number[]): boolean {\r\n        let len = item.length;\r\n        if (len !== this.previous.length) {\r\n            return false;\r\n        }\r\n        let i = 0;\r\n        for (i = 0; i < len; i++) {\r\n            if (!this.previous.includes(item[i])) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { getRangeValueOrDefault, getStringOrDefault, isStringTrue, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\nimport { CuiIntersectionListener } from \"../../core/intersection/intersection\";\r\nimport { CuiIntersectionResult } from \"../../core/intersection/interfaces\";\r\nimport { CuiElementBoxFactory, CuiElementBoxType, ICuiElementBox } from \"../../core/models/elements\";\r\nimport { CuiScrollSpyModeHandlerFactory, CuiScrollspyUpdateResult, ICuiScrollspyModeHandler } from \"./mode\";\r\n\r\nconst DEFAULT_SELECTOR = \"> *\";\r\n\r\nexport interface CuiScrollspyScrollEvent {\r\n    top: number;\r\n    left: number;\r\n    scrolling: boolean;\r\n    initial: boolean;\r\n    source: string;\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiScrollspyTargetChangeEvent {\r\n    intersecting: HTMLElement[];\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiScrollSpyAttribute {\r\n    selector?: string;\r\n    action?: string;\r\n    link?: string;\r\n    linkAction?: string;\r\n    ratio: number;\r\n    threshold: number;\r\n}\r\n\r\n\r\nexport class CuiScrollSpyArgs {\r\n    selector: string; // Child selector\r\n    action: string; // Action to be performed on intersecting elements\r\n    link?: string; // Link selector\r\n    linkAction?: string; //Actions to be triggered on link\r\n    ratio: number; // Value 0..1 telling how much of a child view must be in view to be added to intersecting items\r\n    isRoot: boolean; // Attach to window or element\r\n    mode: \"single\" | \"multi\"; // Action is triggered on single (last) intersecting item or all intersecting items\r\n    threshold: number; // Threshold value (in px) for scroll listener\r\n\r\n    constructor() {\r\n        this.ratio = 0;\r\n        this.mode = \"single\";\r\n        this.threshold = -1\r\n    }\r\n    parse(args: any) {\r\n        this.selector = `${SCOPE_SELECTOR}${args.selector ?? DEFAULT_SELECTOR}`;\r\n        this.action = getStringOrDefault(args.action, null);\r\n        this.link = getStringOrDefault(args.link, null);\r\n        this.linkAction = getStringOrDefault(args.linkAction, null);\r\n        this.ratio = getRangeValueOrDefault(parseFloat(args.ratio), 0, 1, 0);\r\n        this.isRoot = isStringTrue(args.isRoot);\r\n        this.mode = args?.mode === 'multi' ? \"multi\" : \"single\";\r\n        this.threshold = getIntOrDefault(args.threshold, -1);\r\n    }\r\n}\r\nexport class CuiScrollspyComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-scrollspy`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiScrollspyHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiScrollspyHandler extends CuiHandler<CuiScrollSpyArgs> {\r\n    #listener: CuiIntersectionListener;\r\n    #links: HTMLElement[];\r\n    #actions: ICuiComponentAction[];\r\n    #linkActions: ICuiComponentAction[];\r\n    #root: CuiElementBoxType;\r\n    #rootBox: ICuiElementBox;\r\n    #modeHandler: ICuiScrollspyModeHandler;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiScrollspyHandler\", element, attribute, new CuiScrollSpyArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n        this.#listener = new CuiIntersectionListener(this.element, { threshold: this.utils.setup.scrollThreshold });\r\n        this.#links = [];\r\n        this.#actions = [];\r\n        this.#linkActions = [];\r\n        this.#root = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseAttribute();\r\n        this.#listener.setCallback(this.onIntersection.bind(this));\r\n        this.#listener.attach();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.updateAttributes();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    private onIntersection(ev: CuiIntersectionResult): void {\r\n        let timestamp = Date.now();\r\n        this.mutate(() => {\r\n            let updateResult: CuiScrollspyUpdateResult = this.#modeHandler.update(ev.items, this.args.ratio, this.#actions, this.#links, this.#linkActions)\r\n            if (updateResult.changed) {\r\n                this.emitEvent(EVENTS.TARGET_CHANGE, {\r\n                    intersecting: updateResult.intersecting,\r\n                    timestamp: timestamp\r\n                })\r\n            }\r\n        })\r\n        this.emitEvent(EVENTS.ON_SCROLL, {\r\n            top: ev.top,\r\n            left: ev.left,\r\n            scrolling: ev.scrolling,\r\n            initial: ev.initial,\r\n            source: ev.source,\r\n            timestamp: timestamp,\r\n        })\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#root = this.args.isRoot ? window : this.element;\r\n        this.#rootBox = CuiElementBoxFactory.get(this.#root);\r\n        let targets = this.args.selector ? this.#rootBox.queryAll(this.args.selector) : [];\r\n        this.#listener.setChildren(targets);\r\n        this.#listener.setThreshold(this.args.threshold);\r\n        this.#links = this.args.link ? [...document.querySelectorAll<HTMLElement>(this.args.link)] : [];\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#linkActions = CuiActionsListFactory.get(this.args.linkAction);\r\n        this.#modeHandler = CuiScrollSpyModeHandlerFactory.get(this.args.mode);\r\n\r\n    }\r\n\r\n    private updateAttributes() {\r\n        if (this.args.isRoot !== this.prevArgs.isRoot) {\r\n            this.#root = this.args.isRoot ? window : this.element;\r\n            this.#rootBox = CuiElementBoxFactory.get(this.#root);\r\n            this.#listener.setParent(this.#root);\r\n        }\r\n        if (this.args.selector !== this.prevArgs.selector) {\r\n            let targets = this.args.selector ? this.#rootBox.queryAll(this.args.selector) : [];\r\n            this.#listener.setChildren(targets);\r\n        }\r\n        this.#listener.setThreshold(this.args.threshold);\r\n        this.#links = this.args.link ? [...document.querySelectorAll<HTMLElement>(this.args.link)] : [];\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#linkActions = CuiActionsListFactory.get(this.args.linkAction);\r\n        this.#modeHandler = CuiScrollSpyModeHandlerFactory.get(this.args.mode);\r\n\r\n    }\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { getSystemPrintMode } from \"../../core/utils/functions\";\r\nimport { CuiMediaQueryListener } from \"../../core/listeners/media\";\r\n\r\nexport interface AutoPrintPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport class CuiAutoPrintModePlugin implements ICuiPlugin {\r\n    description: string = 'Auto print mode';\r\n    name: string = 'auto-print';\r\n    setup: AutoPrintPluginSetup;\r\n    #listener: CuiMediaQueryListener;\r\n    #utils: CuiUtils;\r\n    constructor(autoPrintInit: AutoPrintPluginSetup) {\r\n        this.description = \"CuiAutoPrintModePlugin\";\r\n        this.setup = autoPrintInit;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#utils = utils\r\n        if (this.setup.autoPrint && getSystemPrintMode()) {\r\n            this.#utils.setPrintMode(true)\r\n        }\r\n        this.#listener = new CuiMediaQueryListener('print')\r\n        this.#listener.setCallback(this.onChange.bind(this))\r\n        this.#listener.attach();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onChange(ev: MediaQueryListEvent) {\r\n        this.setup = this.#utils.setup.plugins[this.description] as AutoPrintPluginSetup;\r\n        let autoPrint = this.setup?.autoPrint ?? false;\r\n        if (autoPrint) {\r\n            console.log(ev.matches)\r\n            if (ev.matches) {\r\n                this.#utils.setPrintMode(true)\r\n            } else {\r\n                this.#utils.setPrintMode(false)\r\n            }\r\n        }\r\n    }\r\n\r\n}","import { ICuiObserver } from \"../../core/models/interfaces\";\r\n\r\nexport interface ICuiIntersectionObserver {\r\n    observe(target: Element): void;\r\n    unobserve(target: Element): void;\r\n    disconnect(): void;\r\n}\r\n\r\nexport class CuiIntersectionEntry {\r\n    isInView: boolean;\r\n    ratio: number;\r\n}\r\n\r\nexport interface ICuiIntersectionHandler {\r\n    onIntersection(entry: CuiIntersectionEntry): Promise<boolean>;\r\n}\r\n\r\n/**\r\n * Creates a wrapper for intersection observer\r\n * Constructor gets a root element for observer and optional array of threshold values [0...1]\r\n */\r\nexport class CuiIntersectionObserver implements ICuiObserver {\r\n    private observer: IntersectionObserver\r\n    #root: Element;\r\n    #threshold: number[];\r\n    #callback: IntersectionObserverCallback;\r\n    constructor(root: Element, threshold?: number[]) {\r\n        this.#root = root;\r\n        this.#threshold = threshold ?? [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1];\r\n    }\r\n\r\n    setCallback(callback: IntersectionObserverCallback) {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    connect(): void {\r\n        this.observer = new IntersectionObserver(this.#callback, {\r\n            root: this.#root,\r\n            rootMargin: '0px',\r\n            threshold: this.#threshold\r\n        })\r\n    }\r\n\r\n    observe(target: Element): void {\r\n        this.observer.observe(target)\r\n    }\r\n\r\n    unobserve(target: Element): void {\r\n        this.observer.unobserve(target)\r\n    }\r\n\r\n    disconnect() {\r\n        this.observer.disconnect()\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiIntersectionObserver } from \"../../app/observers/intersection\";\r\nimport { CuiActionsFatory, CuiActionsListFactory, ICuiComponentAction } from \"../../core/utils/actions\";\r\nimport { is, getRangeValueOrDefault, clone, getStringOrDefault, isStringTrue } from \"../../core/utils/functions\";\r\nimport { EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\n\r\nconst DEFAULT_SELCTOR = \"> *\";\r\n\r\n/**\r\n * Intersection\r\n * Toggles action in/out when target is intersecting with the screen\r\n * \r\n * Set this on scrollable element\r\n * target - children selector\r\n * offset - 0...1 - tells how much target must intersecting with the screen\r\n * action - action to trigger\r\n */\r\n\r\nexport class CuiIntersectionAttributes {\r\n    target: string;\r\n    action: string;\r\n    offset: number;\r\n    isRoot: boolean;\r\n    constructor() {\r\n        this.target = \"div\";\r\n        this.action = null;\r\n        this.offset = 0;\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.target = is(args.target) ? SCOPE_SELECTOR + args.target : SCOPE_SELECTOR + DEFAULT_SELCTOR;\r\n        this.action = getStringOrDefault(args.action, null);\r\n        this.offset = getRangeValueOrDefault(parseFloat(args.offset), 0, 1, 0);\r\n        this.isRoot = isStringTrue(args.isRoot);\r\n    }\r\n}\r\n\r\nexport class CuiIntersectionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-intersection`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiIntersectionHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiIntersectionHandler extends CuiHandler<CuiIntersectionAttributes> {\r\n\r\n    #observer: CuiIntersectionObserver;\r\n    #targets: Element[];\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiIntersectionHandler\", element, attribute, new CuiIntersectionAttributes(), utils);\r\n        this.#observer = new CuiIntersectionObserver(this.element);\r\n        this.#targets = []\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseArguments();\r\n        this.#observer.setCallback(this.onIntersection.bind(this))\r\n        this.#observer.connect();\r\n        this.#targets.forEach(target => {\r\n            this.#observer.observe(target);\r\n        })\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.parseArguments();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#observer.disconnect();\r\n    }\r\n\r\n    parseArguments() {\r\n        if (this.prevArgs === null || this.prevArgs.target !== this.args.target) {\r\n            let el = this.args.isRoot ? document.body : this.element;\r\n            this.#targets = [...el.querySelectorAll(this.args.target)];\r\n        }\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n\r\n    onIntersection(entries: IntersectionObserverEntry[], observer: IntersectionObserver): void {\r\n        if (!is(this.#targets)) {\r\n            return;\r\n        }\r\n        entries.forEach(entry => {\r\n            if (entry.isIntersecting && entry.intersectionRatio >= this.args.offset) {\r\n                this.addActions(entry.target);\r\n            } else {\r\n                this.removeActions(entry.target);\r\n            }\r\n            this.emitIntersection(entry)\r\n        })\r\n    }\r\n\r\n    emitIntersection(entry: IntersectionObserverEntry) {\r\n        this.emitEvent(EVENTS.INTERSECTION, {\r\n            entry: entry,\r\n            offset: this.args.offset,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private addActions(element: Element) {\r\n        this.#actions.forEach(action => action.add(element));\r\n    }\r\n\r\n    private removeActions(element: Element) {\r\n        this.#actions.forEach(action => action.remove(element));\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { getStringOrDefault, getIntOrDefault, is, getActiveClass, isString, getHandlerExtendingOrNull, isStringTrue, are, getFirstMatching } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiActionsFatory, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { CUID_ATTRIBUTE, EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiOpenArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n\r\n    #defTimeout: number;\r\n    constructor(timeout: number) {\r\n        this.target = \"\";\r\n        this.action = undefined;\r\n        this.timeout = 0;\r\n        this.prevent = false;\r\n        this.state = \"\";\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.target = args;\r\n            this.action = args.actions;\r\n            this.timeout = this.#defTimeout;\r\n            this.prevent = false;\r\n            this.state = \"\";\r\n            return;\r\n        }\r\n        this.target = getStringOrDefault(args.target, null);\r\n        this.action = args.action;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.prevent = isStringTrue(args.prevent)\r\n        this.state = args.state;\r\n    }\r\n}\r\n\r\nexport class CuiOpenComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-open`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOpenHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOpenHandler extends CuiHandler<CuiOpenArgs> {\r\n    #eventId: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOpenHandler\", element, attribute, new CuiOpenArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick)\r\n        this.#eventId = this.onEvent(EVENTS.OPEN, this.onOpen.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        //\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick)\r\n        this.detachEvent(EVENTS.OPEN, this.#eventId);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.onOpen(ev);\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n\r\n    onOpen(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget(this.args.target);\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.run(target).then((result) => {\r\n            this.activateTarget(ev, target, result);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n    /**\r\n     * Emits open event or performs an opening action\r\n     * @param target target element\r\n     * @returns whether event opened shall be emitted\r\n     */\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            this._log.debug(\"Open cUI component\")\r\n            await this.utils.bus.emit(EVENTS.OPEN, cuiId, this.args.state);\r\n            return false;\r\n        } else {\r\n            this._log.debug(\"Open html component\")\r\n            if (are(this.args.timeout, this.args.action)) {\r\n                this._log.debug(\"Perfrom an action\")\r\n                let actions = CuiActionsListFactory.get(this.args.action)\r\n                await this.actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                    this.setActiveClass(target)\r\n                });\r\n                return true;\r\n            }\r\n            this.setActiveClassAsync(target);\r\n            return true;\r\n        }\r\n    }\r\n\r\n    private setActiveClass(target: Element) {\r\n        if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.setClass(this.activeClassName, target);\r\n        }\r\n    }\r\n\r\n    private setActiveClassAsync(target: Element) {\r\n        this.fetch(() => {\r\n            if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n                this.helper.setClassesAs(target, this.activeClassName);\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    private activateTarget(ev: MouseEvent, target: Element, shouldEmit: boolean): void {\r\n        if (is(target) && !this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.setClassesAs(target, this.activeClassName);\r\n        }\r\n        if (shouldEmit)\r\n            this.emitOpen(ev);\r\n    }\r\n\r\n    private emitOpen(ev: MouseEvent) {\r\n        this.emitEvent(EVENTS.OPENED, {\r\n            event: ev,\r\n            state: this.args.state,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private getTarget(target: string) {\r\n        if (is(target)) {\r\n            return document.querySelector(target);\r\n        }\r\n        let parent = this.element.parentElement;\r\n        let result = is(parent) ? parent.querySelectorAll(`[${CUID_ATTRIBUTE}]`) : undefined;\r\n        if (!result || result.length < 2) {\r\n            return undefined;\r\n        }\r\n\r\n        return getFirstMatching([...result], (el: Element) => {\r\n            return el !== this.element;\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiClosable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation } from \"../../app/handlers/base\";\r\nimport { getStringOrDefault, getIntOrDefault, parseAttribute, is, getActiveClass, isString, isStringTrue, getHandlerExtendingOrNull, getParentCuiElement, are } from \"../../core/utils/functions\";\r\nimport { ICuiComponentAction, CuiActionsFatory, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { CLASSES, EVENTS } from \"../../core/utils/statics\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\n\r\nexport class CuiCloseArgs {\r\n    target: string;\r\n    action: string;\r\n    timeout: number;\r\n    prevent: boolean;\r\n    state: string;\r\n    #defTimeout: number;\r\n\r\n    constructor(timeout: number) {\r\n        this.target = \"\";\r\n        this.action = null;\r\n        this.timeout = timeout;\r\n        this.prevent = false;\r\n        this.state = null;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.target = args\r\n            this.action = null\r\n            this.timeout = this.#defTimeout;\r\n            this.prevent = false\r\n            this.state = null;\r\n            return;\r\n        }\r\n        this.target = getStringOrDefault(args.target, null);\r\n        this.action = args.action;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.prevent = args.prevent && isStringTrue(args.prevent)\r\n        this.state = args.state;\r\n    }\r\n}\r\n\r\nexport class CuiCloseComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-close`;\r\n\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCloseHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCloseHandler extends CuiHandler<CuiCloseArgs> {\r\n    #eventId: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiCloseHandler\", element, attribute, new CuiCloseArgs(utils.setup.animationTime), utils);\r\n        this.#eventId = null;\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.element.addEventListener('click', this.onClick)\r\n        this.#eventId = this.onEvent(EVENTS.CLOSE, this.onClose.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        //\r\n    }\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick)\r\n        this.detachEvent(EVENTS.CLOSE, this.#eventId);\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.onClose(ev);\r\n        if (this.args.prevent)\r\n            ev.preventDefault();\r\n    }\r\n\r\n    onClose(ev: MouseEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        const target = this.getTarget();\r\n        if (!is(target)) {\r\n            this._log.warning(`Target ${this.args.target} not found`, 'onClick')\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.run(target).then((result) => {\r\n            this.onActionFinish(ev, result);\r\n        }).catch((e) => {\r\n            this._log.exception(e);\r\n        }).finally(() => {\r\n            this.isLocked = false;\r\n        })\r\n    }\r\n\r\n    private async run(target: Element): Promise<boolean> {\r\n        let cuiId = (target as any).$cuid;\r\n        if (is(cuiId)) {\r\n            await this.utils.bus.emit(EVENTS.CLOSE, cuiId, this.args.state);\r\n            return false;\r\n        } else if (are(this.args.action, this.args.timeout)) {\r\n            let actions = CuiActionsListFactory.get(this.args.action);\r\n            return this.actionsHelper.performActions(target, actions, this.args.timeout, () => {\r\n                this.removeActiveClass(target);\r\n            });\r\n        } else {\r\n            this.removeActiveClassAsync(target);\r\n            return true;\r\n        }\r\n    }\r\n    private removeActiveClass(target: Element) {\r\n        if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n            this.helper.removeClass(this.activeClassName, target);\r\n        }\r\n    }\r\n\r\n    private removeActiveClassAsync(target: Element) {\r\n        this.fetch(() => {\r\n            if (is(target) && this.helper.hasClass(this.activeClassName, target)) {\r\n                this.helper.removeClassesAs(target, this.activeClassName);\r\n            }\r\n        })\r\n\r\n    }\r\n    private onActionFinish(ev: MouseEvent, shouldEmit: boolean) {\r\n\r\n        if (shouldEmit)\r\n            this.emitClose(ev);\r\n    }\r\n\r\n    private getTarget(): Element {\r\n        return is(this.args.target) ? document.querySelector(this.args.target) : getParentCuiElement(this.element);\r\n    }\r\n\r\n    private emitClose(ev: MouseEvent) {\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now(),\r\n            state: this.args.state,\r\n            event: ev\r\n        })\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICuiComponentAction, CuiActionsFatory, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { is, isString, getStringOrDefault, getName, parseAttribute } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToggleArgs {\r\n    target: string;\r\n    action: string;\r\n    constructor() {\r\n        this.action = null;\r\n        this.target = null;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args) && isString(args)) {\r\n            this.action = args;\r\n        } else {\r\n            this.target = getStringOrDefault(args.target, null);\r\n            this.action = args.action;\r\n        }\r\n    }\r\n}\r\nexport class CuiToggleComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? \"cui\"}-toggle`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiToggleHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiToggleHandler extends CuiHandler<CuiToggleArgs> {\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #toggleEventId: string;\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiToggleHandler\", element, attribute, new CuiToggleArgs(), utils);\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#toggleEventId = null;\r\n        this.#actions = [];\r\n        this.onClick = this.onClick.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#target = this.getTarget();\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.element.addEventListener('click', this.onClick);\r\n        this.#toggleEventId = this.onEvent(EVENTS.TOGGLE, this.toggle.bind(this));\r\n\r\n    }\r\n    onUpdate(): void {\r\n        this.#target = this.getTarget();\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.element.removeEventListener('click', this.onClick);\r\n        this.detachEvent(EVENTS.TOGGLE, this.#toggleEventId);\r\n    }\r\n\r\n    toggle() {\r\n        this.#actions.forEach(action => action.toggle(this.#target, this.#utils));\r\n        this.emitEvent(EVENTS.TOGGLED, {\r\n            action: this.args.action,\r\n            target: this.#target,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    onClick(ev: MouseEvent) {\r\n        this.toggle();\r\n        ev.preventDefault();\r\n    }\r\n\r\n    getTarget(): Element {\r\n        return is(this.args.target) ? document.querySelector(this.args.target) : this.element;\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, CuiContext, ICuiEventBus, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler } from \"../../app/handlers/base\";\r\nimport { ICuiResizable, CuiResizeData } from \"../../app/observers/resize\";\r\nimport { generateCUID } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\n\r\nexport class CuiResizeArgs implements ICuiParsable {\r\n    constructor() {\r\n\r\n    }\r\n\r\n    parse(args: any) {\r\n\r\n    }\r\n}\r\n\r\nexport class CuiResizeComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor() {\r\n        this.attribute = 'cui-resize';\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiResizeHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiResizeHandler extends CuiHandler<CuiResizeArgs> {\r\n    #eventId: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiResizeHandler\", element, attribute, new CuiResizeArgs(), utils);\r\n        this.#eventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#eventId = this.utils.bus.on(EVENTS.RESIZE, this.resize.bind(this));\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n    onDestroy(): void {\r\n        if (this.#eventId !== null) {\r\n            this.utils.bus.detach(EVENTS.RESIZE, this.#eventId);\r\n            this.#eventId = null\r\n        }\r\n    }\r\n\r\n    resize(data: CuiResizeData) {\r\n        console.log(data);\r\n    }\r\n}","import { ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { CuiKeyPressListener } from \"../../core/listeners/keys\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nexport interface KeyDownEvent {\r\n    timestamp: number;\r\n    event: KeyboardEvent;\r\n}\r\nexport interface ICuiKeysObserver {\r\n    connect(): void;\r\n    disconnect(): void;\r\n}\r\nexport class CuiKeysObserver {\r\n    #listener: CuiKeyPressListener;\r\n    #bus: ICuiEventBus\r\n    constructor(bus: ICuiEventBus) {\r\n        this.#bus = bus;\r\n        this.#listener = new CuiKeyPressListener(true);\r\n        this.#listener.setCallback(this.onKeyDown.bind(this))\r\n    }\r\n    connect(): void {\r\n        this.#listener.attach();\r\n    }\r\n    disconnect(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    onKeyDown(ev: KeyboardEvent) {\r\n        this.#bus.emit(EVENTS.KEYDOWN, null, {\r\n            timestamp: Date.now(),\r\n            event: ev\r\n        })\r\n    }\r\n\r\n}","import { ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { ICuiKeysObserver, CuiKeysObserver } from \"./observer\";\r\n\r\n\r\nexport interface CuiKeysObserverPluginSetup {\r\n    autoPrint: boolean;\r\n}\r\n\r\nexport class CuiKeysObserverPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'keys-observer';\r\n    setup: CuiKeysObserverPluginSetup;\r\n    #keysObserver: ICuiKeysObserver;\r\n    constructor(keySetup: CuiKeysObserverPluginSetup) {\r\n        this.description = \"CuiKeysObserverPlugin\";\r\n        this.setup = keySetup;\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#keysObserver = new CuiKeysObserver(utils.bus);\r\n        this.#keysObserver.connect();\r\n    }\r\n\r\n    destroy(): void {\r\n        this.#keysObserver.disconnect();\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/utils/statics\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\n\r\nconst DIALOG_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst DIALOG_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-dialog-open';\r\nconst CONTAINER = '.{prefix}-dialog-container';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDialogArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout: number) {\r\n        this.escClose = false;\r\n        this.outClose = false;\r\n\r\n        this.#defTimeout = defTimeout;\r\n        this.#prefix = prefix;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.outClose = isStringTrue(args.outClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(DIALOG_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(DIALOG_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiDialogComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-dialog`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDialogHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDialogHandler extends CuiInteractableHandler<CuiDialogArgs> {\r\n\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #windowClickEventId: string;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiDialogArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#scrollY = 0;\r\n        this.#windowClickEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        document.body.style.top = `-${this.#scrollY}px`;\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, (this.#scrollY || 0) * -1);\r\n        this.#scrollY = 0;\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        let container = this.element.querySelector(replacePrefix(CONTAINER, this.#prefix));\r\n        if (container && !container.contains((ev.target as Node))) {\r\n            this.close('out').then(() => {\r\n                this._log.debug(\"Closed by click outside\")\r\n            });\r\n        }\r\n    }\r\n}","import { isStringTrue, replacePrefix, EVENTS, is, getStringOrDefault, getIntOrDefault, getName, ICuiParsable } from \"../../core/index\";\r\nimport { ICuiComponent, CuiUtils, ICuiComponentHandler } from \"../../index\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\n\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-right-in\";\r\nconst OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-right-out\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_IN = \".{prefix}-offcanvas-default-left-in\";\r\nconst OFFCANVAS_LEFT_ANIM_DEFAULT_OUT = \".{prefix}-offcanvas-default-left-out\";\r\n\r\nconst OFFCANVAS_BODY = \"{prefix}-off-canvas-open\";\r\nconst OFFCANVAS_CONTAINER_CLS = '.{prefix}-off-canvas-container';\r\n\r\nexport class CuiOffCanvasArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    outClose: boolean;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n    position: 'left' | 'right';\r\n    timeout: number;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.escClose = false;\r\n        this.position = 'right';\r\n        this.openAct = this.getDefaultOpenClass();\r\n        this.closeAct = this.getDefaultCloseClass();\r\n        this.#defTimeout = timeout;\r\n        this.timeout = timeout;\r\n        this.outClose = false;\r\n        this.keyClose = undefined;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        if (is(args)) {\r\n            this.escClose = isStringTrue(args.escClose);\r\n            this.outClose = isStringTrue(args.outClose);\r\n            this.position = getStringOrDefault(args.position, 'right');\r\n            this.openAct = getStringOrDefault(args.openAct, this.getDefaultOpenClass())\r\n            this.closeAct = getStringOrDefault(args.closeAct, this.getDefaultCloseClass());\r\n            this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n            this.keyClose = args.keyClose;\r\n        }\r\n    }\r\n\r\n    getDefaultOpenClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_IN : OFFCANVAS_LEFT_ANIM_DEFAULT_IN, this.#prefix);\r\n    }\r\n\r\n    getDefaultCloseClass(): string {\r\n        return replacePrefix(this.position === 'right' ? OFFCANVAS_RIGHT_ANIM_DEFAULT_OUT : OFFCANVAS_LEFT_ANIM_DEFAULT_OUT, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-off-canvas`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffCanvasHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiOffCanvasHandler extends CuiInteractableHandler<CuiOffCanvasArgs>  {\r\n\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n    #windowClickEventId: string;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiOffCanvasHandler\", element, attribute, new CuiOffCanvasArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#prefix = prefix;\r\n        this.#bodyClass = replacePrefix(OFFCANVAS_BODY, prefix);\r\n        this.#windowClickEventId = null;\r\n        this.#scrollY = 0;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.mutate(() => {\r\n            this.setPositionLeft();\r\n            AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        })\r\n    }\r\n    onUpdate(): void {\r\n        this.setPositionLeft();\r\n    }\r\n    onDestroy(): void {\r\n\r\n    }\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        if (this.args.outClose) {\r\n            this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n        }\r\n        this.helper.setClass(this.#bodyClass, document.body);\r\n        document.body.style.top = `-${scrollY}px`;\r\n    }\r\n    onAfterClose(): void {\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, this.#scrollY * -1);\r\n    }\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        const container = this.element.querySelector(replacePrefix(OFFCANVAS_CONTAINER_CLS, this.#prefix));\r\n        if (container && !container.contains((ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    setPositionLeft() {\r\n        let cls = getName(this.#prefix, 'left');\r\n        if (this.args.position === 'left' && !this.helper.hasClass(cls, this.element)) {\r\n            this.helper.setClass(cls, this.element)\r\n        } else if (this.args.position == 'right' && this.helper.hasClass(cls, this.element)) {\r\n            this.helper.removeClass(cls, this.element)\r\n        }\r\n    }\r\n\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiComponentBase, CuiHandler, CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { getIntOrDefault, is, getActiveClass, isStringTrue, replacePrefix, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { SCOPE_SELECTOR, EVENTS } from \"../../core/index\";\r\n\r\n/**\r\n * \r\n */\r\n\r\nexport interface CuiAccordionEvent {\r\n    index: number;\r\n    previous: number;\r\n    currentTarget: Element;\r\n    previousTarget: Element;\r\n    timestamp: number;\r\n}\r\n\r\ninterface CuiAccordionTarget {\r\n    element: Element,\r\n    listener?: any\r\n}\r\n\r\nconst ACCORDION_TITLE_CLS = '> * > .{prefix}-accordion-title';\r\nconst ACCORDION_ITEMS_CLS = '> *';\r\n\r\nexport class CuiAccordionArgs {\r\n    single: boolean;\r\n    selector: string;\r\n    items: string;\r\n    timeout: number;\r\n    animation: boolean;\r\n    content: string\r\n\r\n    #defTitleSelector: string;\r\n    #defItemsSelector: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#defTitleSelector = replacePrefix(ACCORDION_TITLE_CLS, prefix);\r\n        this.#defItemsSelector = replacePrefix(ACCORDION_ITEMS_CLS, prefix);\r\n        this.#defTimeout = timeout;\r\n        this.single = false;\r\n        this.selector = SCOPE_SELECTOR + this.#defTitleSelector;\r\n        this.items = SCOPE_SELECTOR + this.#defItemsSelector;\r\n        this.timeout = this.#defTimeout;\r\n    }\r\n\r\n    parse(args: any) {\r\n        if (is(args)) {\r\n            this.single = isStringTrue(args.single);\r\n            this.selector = SCOPE_SELECTOR + getStringOrDefault(args.selector, this.#defTitleSelector);\r\n            this.items = SCOPE_SELECTOR + getStringOrDefault(args.content, this.#defItemsSelector);\r\n            this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n            this.animation = isStringTrue(args.animation);\r\n            return;\r\n        }\r\n\r\n    }\r\n\r\n    isValid(): boolean {\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class CuiAccordionComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-accordion`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiAccordionHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiAccordionHandler extends CuiMutableHandler<CuiAccordionArgs> implements ICuiSwitchable {\r\n    #items: Element[];\r\n    #targets: CuiAccordionTarget[];\r\n    #switchEventId: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiAccordionHandler\", element, attribute, new CuiAccordionArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#switchEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        if (this.args.isValid()) {\r\n            try {\r\n                this.initTargets();\r\n                this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onSwitch.bind(this))\r\n            } catch (e) {\r\n                this._log.exception(e, 'handle')\r\n            }\r\n            this._log.debug(\"Initialized\", \"handle\")\r\n        }\r\n    }\r\n\r\n    onUpdate(): void {\r\n        try {\r\n            this.initTargets();\r\n        } catch (e) {\r\n            this._log.exception(e, 'handle')\r\n        }\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(mutations: CuiChildMutation) {\r\n        if (mutations.added.length > 0 || mutations.removed.length > 0)\r\n            this.initTargets();\r\n    }\r\n\r\n    async switch(index: number): Promise<boolean> {\r\n        this._log.debug(\"Switch to: \" + index);\r\n        if (index < 0 || this.isLocked || !this.isInitialized) {\r\n            return false;\r\n        }\r\n\r\n        this.#items = this.queryItems();\r\n        if (this.#items.length <= index) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        const current = this.#items[index]\r\n        if (this.helper.hasClass(this.activeClassName, current)) {\r\n            this.helper.removeClassesAs(current, this.activeClassName)\r\n        } else {\r\n            if (this.args.single) {\r\n                this.closeAllExcept(index)\r\n            }\r\n            this.helper.setClassesAs(current, this.activeClassName)\r\n\r\n        }\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            index: index,\r\n            currentTarget: current,\r\n            timestamp: Date.now()\r\n        })\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n    onSwitch(index: any): void {\r\n        this.switch(getIntOrDefault(index, -1)).then(() => {\r\n            this._log.debug(\"Switch from event to \" + index);\r\n        });\r\n    }\r\n\r\n    initTargets() {\r\n        this.#items = this.queryItems();\r\n        const t = this.element.querySelectorAll(this.args.selector);\r\n        this.#targets = [];\r\n        t.forEach((item: Element, index: number) => {\r\n            let target: CuiAccordionTarget = { element: item };\r\n            this.setListener(target, index)\r\n            this.#targets.push(target);\r\n        })\r\n    }\r\n\r\n    closeAllExcept(current: number) {\r\n        this.mutate(() => {\r\n            this.#items.forEach((item: Element, index: number) => {\r\n                if (current !== index && this.helper.hasClass(this.activeClassName, item)) {\r\n                    item.classList.remove(this.activeClassName)\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    setListener(target: CuiAccordionTarget, index: number) {\r\n        target.listener = () => {\r\n            this.switch(index);\r\n        }\r\n        target.element.addEventListener('click', target.listener)\r\n    }\r\n\r\n    removeListener(target: CuiAccordionTarget) {\r\n        if (target.listener) {\r\n            target.element.removeEventListener('click', target.listener);\r\n        }\r\n    }\r\n\r\n    queryItems(): Element[] {\r\n        return [...this.element.querySelectorAll(this.args.items)]\r\n    }\r\n}","import { ICuiEventListener } from \"../models/interfaces\";\r\nimport { are } from \"../utils/functions\";\r\n\r\nexport interface CuiHoverEvent {\r\n    isHovering: boolean;\r\n    event: MouseEvent;\r\n    timestamp: number;\r\n}\r\nexport class CuiHoverListener implements ICuiEventListener<CuiHoverEvent> {\r\n    #target: Element;\r\n    #callback: (t: CuiHoverEvent) => void = null;\r\n    #inProgress: boolean;\r\n    #isHovering: boolean;\r\n    #isAttached: boolean;\r\n    constructor(target: Element) {\r\n        this.#target = target;\r\n        this.#inProgress = false;\r\n        this.#isHovering = false;\r\n    }\r\n\r\n    setCallback(callback: (t: CuiHoverEvent) => void): void {\r\n        this.#callback = callback;\r\n    }\r\n\r\n    isInProgress(): boolean {\r\n        return this.#inProgress;\r\n    }\r\n    attach(): void {\r\n        this.#target.addEventListener(\"mouseover\", this.onMouseOver.bind(this));\r\n        this.#target.addEventListener(\"mousemove\", this.onMouseMove.bind(this));\r\n        this.#target.addEventListener(\"mouseout\", this.onMouseOut.bind(this));\r\n        this.#isAttached = true;\r\n    }\r\n\r\n    detach(): void {\r\n        this.#target.removeEventListener(\"mouseover\", this.onMouseOver.bind(this));\r\n        this.#target.removeEventListener(\"mousemove\", this.onMouseMove.bind(this));\r\n        this.#target.removeEventListener(\"mouseout\", this.onMouseOut.bind(this));\r\n        this.#isAttached = false;\r\n    }\r\n\r\n    private emit(mouseEvent: MouseEvent, force: boolean) {\r\n        if (!are(this.#callback)) {\r\n            return;\r\n        }\r\n        if (!force && this.#inProgress) {\r\n            return;\r\n        }\r\n        this.#inProgress = true;\r\n        window.requestAnimationFrame(this.invoke.bind(this, {\r\n            isHovering: this.#isHovering,\r\n            event: mouseEvent,\r\n            timestamp: Date.now()\r\n        }))\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#isAttached;\r\n    }\r\n    private invoke(ev: CuiHoverEvent) {\r\n        this.#callback(ev);\r\n        this.#inProgress = false;\r\n    }\r\n\r\n    private onMouseOver(ev: MouseEvent) {\r\n        this.#isHovering = true;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    private onMouseOut(ev: MouseEvent) {\r\n        this.#isHovering = false;\r\n        this.emit(ev, true);\r\n    }\r\n\r\n    private onMouseMove(ev: MouseEvent) {\r\n        this.emit(ev, false);\r\n    }\r\n}","import { CuiPositionError } from \"../models/errors\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ElementBox, ICuiPositionEvaluator } from \"./interfaces\";\r\n\r\nexport class CuiBasePositionEvaluator implements ICuiPositionEvaluator {\r\n    #box: ElementBox;\r\n    #targetWidth: number;\r\n    #targetHeight: number;\r\n    #margin: number;\r\n    constructor() {\r\n        this.#targetHeight = -1;\r\n        this.#targetWidth = -1;\r\n        this.#box = null;\r\n        this.#margin = 0;\r\n    }\r\n\r\n\r\n    setElementBox(box: ElementBox): void {\r\n        this.#box = box;\r\n    }\r\n\r\n    setTarget(width: number, height: number): void {\r\n        this.#targetWidth = width;\r\n        this.#targetHeight = height;\r\n    }\r\n\r\n    setMargin(value: number) {\r\n        this.#margin = value;\r\n    }\r\n\r\n    getVerticalPosition(value: string): number {\r\n        switch (value) {\r\n            case 'top':\r\n                return this.getTopPosition();\r\n            case \"bottom\":\r\n                return this.getBottomPosition();\r\n            case \"middle\":\r\n                return this.getMiddlePosition();\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    getHorizontalPosition(value: string): number {\r\n        switch (value) {\r\n            case 'left':\r\n                return this.getLeftPosition();\r\n            case \"right\":\r\n                return this.getRightPosition();\r\n            case \"center\":\r\n                return this.getCenterPosition();\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    getAutoVerticalPosition(initial: string): [number, string] {\r\n        let innerHeight = window.innerHeight;\r\n        let number = this.getVerticalPosition(initial);\r\n\r\n        if ((initial === 'top' || initial === \"middle\") && number < 0) {\r\n            return [this.getVerticalPosition(\"bottom\"), \"bottom\"]\r\n        } else if ((initial === \"bottom\" || initial === \"middle\") && number + this.#targetHeight > innerHeight) {\r\n            return [this.getVerticalPosition(\"top\"), \"top\"]\r\n        }\r\n        return [number, initial];\r\n    }\r\n\r\n    getAutoHorizontalPosition(initial: string): [number, string] {\r\n        let innerWidth = window.innerWidth;\r\n        let number = this.getHorizontalPosition(initial);\r\n\r\n        if ((initial === 'right' || initial === \"center\") && number < 0) {\r\n            return [this.getHorizontalPosition(\"left\"), \"left\"]\r\n        } else if ((initial === 'left' || initial === \"center\") && number + this.#targetWidth > innerWidth) {\r\n            return [this.getHorizontalPosition(\"right\"), \"right\"]\r\n        }\r\n        return [number, initial];\r\n    }\r\n\r\n    private getTopPosition(): number {\r\n        this.throwIfNotValid(\"getTopPosition\");\r\n        return this.#box.top - this.#margin - this.#targetHeight;\r\n    }\r\n\r\n    private getBottomPosition(): number {\r\n        this.throwIfNotValid(\"getBottomPosition\");\r\n        return this.#box.top + this.#box.height + this.#margin;\r\n    }\r\n\r\n    private getMiddlePosition(): number {\r\n        this.throwIfNotValid(\"getMiddlePosition\");\r\n        return (this.#box.top + this.#box.height / 2) - this.#targetHeight / 2;\r\n    }\r\n\r\n    private getLeftPosition(): number {\r\n        this.throwIfNotValid(\"getLeftPosition\");\r\n        return this.#box.left;\r\n    }\r\n\r\n    private getRightPosition(): number {\r\n        this.throwIfNotValid(\"getRightPosition\");\r\n        return this.#box.left + this.#box.width - this.#targetWidth;\r\n    }\r\n\r\n    private getCenterPosition(): number {\r\n        this.throwIfNotValid(\"getCenterPosition\");\r\n        return (this.#box.left + this.#box.width / 2) - this.#targetWidth / 2;\r\n    }\r\n\r\n\r\n\r\n    private validate(): boolean {\r\n        return is(this.#box) && this.#targetHeight > 0 && this.#targetWidth > 0;\r\n    }\r\n\r\n\r\n\r\n    private throwIfNotValid(method: string): void {\r\n        if (!this.validate()) {\r\n            throw new CuiPositionError(`[${method}] Position cannot be calculated: missing data [width: ${this.#targetWidth}][height: ${this.#targetHeight}]`)\r\n        }\r\n    }\r\n}","import { CuiLoggerFactory } from \"../factories/logger\";\r\nimport { ICuiLogger } from \"../models/interfaces\";\r\nimport { is } from \"../utils/functions\";\r\nimport { CuiBasePositionEvaluator } from \"./evaluator\";\r\nimport { ElementBox, ICuiPositionCalculator, ICuiPositionEvaluator } from \"./interfaces\";\r\n\r\nexport class CuiBasePositionCalculator implements ICuiPositionCalculator {\r\n    #margin: number;\r\n    #static: string;\r\n    #preferred: string;\r\n    #evaluator: ICuiPositionEvaluator;\r\n    #log: ICuiLogger;\r\n    constructor(evaluator?: ICuiPositionEvaluator) {\r\n        this.#preferred = \"top-center\";\r\n        this.#static = null;\r\n        this.#evaluator = evaluator ?? new CuiBasePositionEvaluator();\r\n        this.#log = CuiLoggerFactory.get(\"CuiBasePositionCalculator\");\r\n    }\r\n\r\n    setMargin(value: number): void {\r\n        this.#evaluator.setMargin(value);\r\n    }\r\n\r\n    setPreferred(position: string): void {\r\n        this.#preferred = position\r\n    }\r\n\r\n    setStatic(position: string): void {\r\n        this.#static = position;\r\n    }\r\n\r\n    calculate(elementBox: ElementBox, targetWidth: number, targetHeight: number): [number, number, string] {\r\n        this.#evaluator.setElementBox(elementBox)\r\n        this.#evaluator.setTarget(targetWidth, targetHeight);\r\n\r\n        if (is(this.#static)) {\r\n            this.#log.debug(\"Evaluating static position\")\r\n            const [vertical, horizontal] = this.parse(this.#static);\r\n            return [this.#evaluator.getHorizontalPosition(horizontal), this.#evaluator.getVerticalPosition(vertical), this.#static];\r\n        }\r\n\r\n        let [vertical, horizontal]: string[] = [null, null];\r\n        if (is(this.#preferred)) {\r\n            this.#log.debug(\"Evaluating auto position\");\r\n            [vertical, horizontal] = this.parse(this.#preferred);\r\n        }\r\n        vertical = vertical ?? \"top\";\r\n        horizontal = horizontal ?? \"center\";\r\n        const joined = [vertical, horizontal].join(\"-\")\r\n        this.#log.debug(\"Calculating position: \" + vertical + \"-\" + horizontal)\r\n        const [outVNum, outVPos] = this.#evaluator.getAutoVerticalPosition(vertical);\r\n        const [outHNum, outHPos] = this.#evaluator.getAutoHorizontalPosition(horizontal);\r\n        this.#log.debug(\"Calculated position: \" + outVPos + \"-\" + outHPos)\r\n        return [outHNum, outVNum, outVPos + \"-\" + outHPos];\r\n    }\r\n\r\n    private parse(position: string): string[] {\r\n        return position.split(\"-\");\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiOpenable, ICuiClosable, CuiElement, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler, CuiChildMutation, CuiInteractableHandler, CuiInteractableArgs } from \"../../app/handlers/base\";\r\nimport { is, replacePrefix, isStringTrue, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { EVENTS, SCOPE_SELECTOR } from \"../../core/utils/statics\";\r\nimport { KeyDownEvent } from \"../../plugins/keys/observer\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiHoverListener, CuiHoverEvent } from \"../../core/listeners/hover\";\r\nimport { ICuiPositionCalculator } from \"../../core/position/interfaces\";\r\nimport { CuiBasePositionCalculator } from \"../../core/position/calculator\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\nimport { CuiActionsListFactory, ICuiComponentAction } from \"../../core/index\";\r\n\r\nconst bodyClass = '{prefix}-drop-open';\r\nconst DROP_POSITION = \"{prefix}-drop-position-\";\r\nconst DROP_TRIGGER = \"{prefix}-drop-trigger\";\r\nconst DROP_DEFAULT_TRIGGER = \"> a, button\";\r\n\r\n\r\nexport interface CuiDropEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiDropArgs implements ICuiParsable {\r\n    mode: \"click\" | \"hover\";\r\n    trigger: string;\r\n    prevent: boolean;\r\n    autoClose: boolean;\r\n    outClose: boolean;\r\n    pos: string;\r\n    action: string;\r\n    timeout: number;\r\n    margin: number;\r\n\r\n    #defOpenAct: string\r\n    constructor(prefix: string) {\r\n        this.#defOpenAct = replacePrefix('{prefix}-drop-animation-in', prefix);\r\n        this.mode = \"click\";\r\n        this.trigger = DROP_DEFAULT_TRIGGER;\r\n        this.autoClose = false;\r\n        this.outClose = false;\r\n        this.prevent = false;\r\n        this.pos = null;\r\n        this.action = this.#defOpenAct;\r\n        this.timeout = 3000;\r\n        this.margin = 8;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.mode = getStringOrDefault(args.mode, 'click').toLowerCase();\r\n        this.trigger = SCOPE_SELECTOR + getStringOrDefault(args.trigger, DROP_DEFAULT_TRIGGER);\r\n        this.prevent = isStringTrue(args.prevent);\r\n        this.autoClose = isStringTrue(args.autoClose);\r\n        this.outClose = args.outClose ? isStringTrue(args.outClose) : true;\r\n        this.pos = getStringOrDefault(args.pos, null);\r\n        this.action = getStringOrDefault(args.action, this.#defOpenAct);\r\n        this.timeout = getIntOrDefault(args.timeout, 3000);\r\n        this.margin = getIntOrDefault(args.margin, 8);\r\n    }\r\n}\r\n\r\nexport class CuiDropComponenet implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-drop`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiDropHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiDropHandler extends CuiHandler<CuiDropArgs> implements ICuiOpenable, ICuiClosable {\r\n    #prefix: string;\r\n    #bodyClass: string;\r\n    #attribute: string;\r\n    #triggerHoverListener: CuiHoverListener;\r\n    #hoverListener: CuiHoverListener;\r\n    #trigger: Element;\r\n    #windowClickEventId: string;\r\n    #openEventId: string;\r\n    #closeEventId: string;\r\n    #positionCalculator: ICuiPositionCalculator;\r\n    #posClass: string;\r\n    #dropParentCls: string;\r\n    #autoTask: ICuiTask;\r\n    #actions: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuidropHandler\", element, attribute, new CuiDropArgs(prefix), utils);\r\n        this.#attribute = attribute;\r\n        this.#prefix = prefix;\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#hoverListener = new CuiHoverListener(this.element);\r\n        this.#hoverListener.setCallback(this.onElementHover.bind(this))\r\n        this.#windowClickEventId = null;\r\n        this.#openEventId = null;\r\n        this.#closeEventId = null;\r\n        this.onTriggerClick = this.onTriggerClick.bind(this)\r\n        this.#positionCalculator = new CuiBasePositionCalculator();\r\n        this.#positionCalculator.setMargin(8);\r\n        this.#positionCalculator.setPreferred(\"bottom-left\");\r\n        this.#posClass = \"\"\r\n        this.#dropParentCls = replacePrefix(DROP_TRIGGER, prefix)\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#trigger = this.element.parentElement.querySelector(this.args.trigger)\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.setTriggerEvent();\r\n        this.#openEventId = this.onEvent(EVENTS.OPEN, this.open.bind(this));\r\n        this.#closeEventId = this.onEvent(EVENTS.CLOSE, this.close.bind(this));\r\n        this.#positionCalculator.setStatic(this.args.pos);\r\n        this.#positionCalculator.setMargin(this.args.margin);\r\n        this.#autoTask = new CuiTaskRunner(this.args.timeout, false, this.close.bind(this));\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.mutate(() => {\r\n            AriaAttributes.setAria(this.element, 'aria-dropdown', \"\");\r\n            if (!this.helper.hasClass(this.#dropParentCls, this.element.parentElement)) {\r\n                this.helper.setClass(this.#dropParentCls, this.element.parentElement);\r\n            }\r\n        })\r\n\r\n        this._log.debug(\"Initialized\", \"handle\")\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.#triggerHoverListener.isAttached()) {\r\n            this.#triggerHoverListener.detach();\r\n        } else if (this.prevArgs.mode === 'click') {\r\n            this.#trigger.removeEventListener('click', this.onTriggerClick)\r\n        }\r\n\r\n        this.#trigger = this.element.parentElement.querySelector(this.args.trigger)\r\n        this.#triggerHoverListener = new CuiHoverListener(this.#trigger);\r\n        this.setTriggerEvent();\r\n        this.#positionCalculator.setStatic(this.args.pos);\r\n        this.#positionCalculator.setMargin(this.args.margin);\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n        this.#autoTask.setTimeout(this.args.timeout);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.OPEN, this.#openEventId);\r\n        this.detachEvent(EVENTS.CLOSE, this.#closeEventId);\r\n        this.mutate(() => {\r\n            this.helper.removeClass(this.#dropParentCls, this.element.parentElement);\r\n        })\r\n\r\n    }\r\n\r\n    /**\r\n    * Api Method open\r\n    */\r\n    async open(): Promise<boolean> {\r\n        if (this.checkLockAndWarn('open')) {\r\n            return false;\r\n        }\r\n        if (this.isActive()) {\r\n            return this.close();\r\n        }\r\n        if (this.isAnyActive()) {\r\n            await this.findAndCloseOpenedDrop();\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Drop ${this.cuid}`, 'open');\r\n        this.onOpen();\r\n        this.isLocked = false;\r\n        return true\r\n    }\r\n\r\n    /**\r\n     * Api Method close\r\n     */\r\n    async close(): Promise<boolean> {\r\n        if (this.checkLockAndWarn(\"close\") || !this.isActive()) {\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this._log.debug(`Drop ${this.cuid}`, 'close');\r\n        this.onClose();\r\n        this.detachEvent(EVENTS.WINDOW_CLICK, this.#windowClickEventId);\r\n        this.emitEvent(EVENTS.CLOSED, {\r\n            timestamp: Date.now()\r\n        })\r\n        this.#hoverListener.detach();\r\n        this.isLocked = false;\r\n        return true;\r\n    }\r\n\r\n\r\n    onClose() {\r\n        this.mutate(() => {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            this.helper.removeClass(this.#bodyClass, document.body)\r\n            this.toggleActions();\r\n            this.helper.removeClass(this.#posClass, this.element);\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false')\r\n        })\r\n    }\r\n\r\n    onOpen() {\r\n        this.helper.setClass(this.activeClassName, this.element);\r\n        this.mutate(() => {\r\n            const box = this.#trigger.getBoundingClientRect();\r\n            try {\r\n                const [x, y, pos] = this.#positionCalculator.calculate(box, this.element.offsetWidth, this.element.offsetHeight)\r\n                this.element.style.top = `${y - box.top}px`;\r\n                this.element.style.left = `${x - box.left}px`;\r\n                this.#posClass = replacePrefix(DROP_POSITION + pos, this.#prefix);\r\n                this.toggleActions();\r\n                this.helper.setClass(this.#posClass, this.element);\r\n                this.helper.setClass(this.#bodyClass, document.body)\r\n\r\n                this.emitEvent(EVENTS.OPENED, {\r\n                    timestamp: Date.now()\r\n                })\r\n                this.#hoverListener.attach();\r\n                this.runAutoCloseTask();\r\n\r\n                if (this.args.outClose) {\r\n                    this.#windowClickEventId = this.onEvent(EVENTS.WINDOW_CLICK, this.onWindowClick.bind(this));\r\n                }\r\n\r\n                AriaAttributes.setAria(this.element, 'aria-expanded', 'true')\r\n            } catch (e) {\r\n                this._log.exception(e)\r\n            }\r\n\r\n\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Event invoked when window is clicked\r\n     * @param ev \r\n     */\r\n    private onWindowClick(ev: MouseEvent) {\r\n        if (!this.element.contains((ev.target as Node))) {\r\n            this.close();\r\n        }\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n\r\n    /**\r\n     * Finds and opens other active drop element\r\n     */\r\n    async findAndCloseOpenedDrop(): Promise<boolean> {\r\n        const opened = document.querySelector(`[${this.#attribute}].${this.activeClassName}`);\r\n        if (!is(opened)) {\r\n            this._log.warning(\"Opened drop was not found\");\r\n            return false;\r\n        }\r\n        const handler = (<CuiElement>(opened as any)).$handlers[this.#attribute] as any;\r\n        if (!is(handler)) {\r\n            this._log.warning(\"Drop handler was not found in the element\");\r\n            return false;\r\n        }\r\n        return handler.close();\r\n    }\r\n\r\n    /**\r\n     * Invoked when trigger button is clicked\r\n     * @param ev \r\n     */\r\n    private onTriggerClick(ev: MouseEvent) {\r\n        if (this.isActive()) {\r\n            this.close();\r\n        } else {\r\n            this.open();\r\n        }\r\n        if (this.args.prevent) {\r\n            ev.preventDefault();\r\n        }\r\n    }\r\n\r\n    /**\r\n    * Invoked when trigger button is hovered on\r\n    * @param ev\r\n    */\r\n    private onHoverEvent(ev: CuiHoverEvent) {\r\n        if (ev.isHovering && !this.isActive()) {\r\n            this.open();\r\n        }\r\n        if (this.args.prevent) {\r\n            ev.event.preventDefault();\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Method triggered when opened element is hovered on\r\n     * @param ev \r\n     */\r\n    private onElementHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering) {\r\n            this.#autoTask.stop();\r\n        } else if (!ev.isHovering && this.args.autoClose) {\r\n            this.runAutoCloseTask();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets event on trigger button\r\n     */\r\n    private setTriggerEvent() {\r\n        if (this.args.mode === 'hover') {\r\n            this.#triggerHoverListener.setCallback(this.onHoverEvent.bind(this));\r\n            this.#triggerHoverListener.attach();\r\n        } else {\r\n            this.#trigger.addEventListener('click', this.onTriggerClick)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Runs auto-close task on opened element\r\n     */\r\n    private runAutoCloseTask() {\r\n        if (!this.args.autoClose) {\r\n            return\r\n        }\r\n        this.#autoTask.start();\r\n    }\r\n\r\n    private toggleActions() {\r\n        this.#actions.forEach(action => {\r\n            action.toggle(this.element);\r\n        })\r\n    }\r\n}","import { ICuiPlugin, ICuiEventBus } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { EVENTS } from \"../../core/index\";\r\n\r\nexport class CuiWindowClickPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'click-plugin';\r\n    setup: any;\r\n    #bus: ICuiEventBus;\r\n\r\n    constructor() {\r\n        this.description = \"CuiWindowClickPlugin\";\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#bus = utils.bus;\r\n        window.addEventListener('click', this.onWindowClick.bind(this))\r\n    }\r\n\r\n    destroy(): void {\r\n        window.removeEventListener('click', this.onWindowClick.bind(this));\r\n    }\r\n\r\n    onWindowClick(ev: MouseEvent) {\r\n        this.#bus.emit(EVENTS.WINDOW_CLICK, null, ev)\r\n    }\r\n}","export interface ICuiOffsetMode {\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean;\r\n}\r\n\r\nexport class CuiOffsetStaticMode implements ICuiOffsetMode {\r\n\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return (offsetX > 0 && left >= offsetX) ||\r\n            (offsetY > 0 && top >= offsetY)\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Dynamically calculates whether to trigger or untrigger an action.\r\n * If current value exceedes offset and threshold action is triggered.\r\n * If action was triggered and current move is lower than threshold action is untriggered\r\n * \r\n * Example: If offsetY is 100, then first after 100 action is set on. It is kept when scrolling down.\r\n * If user decides to scroll up and difference between turning point and current is bigger than threshold then action is set off.\r\n *  \r\n * Example usage is with navbar - it shall disappear after offset and return back when user scrolls up. \r\n */\r\nexport class CuiOffsetDynamicMode implements ICuiOffsetMode {\r\n    #pointLeft: number;\r\n    #pointTop: number;\r\n    #prevDiffY: number;\r\n    #prevDiffX: number;\r\n    #wasTriggeredX: boolean;\r\n    #wasTriggeredY: boolean;\r\n    #threshold: number;\r\n    constructor() {\r\n        this.#pointLeft = 0;\r\n        this.#pointTop = 0;\r\n        this.#prevDiffX = 0;\r\n        this.#prevDiffY = 0;\r\n        this.#threshold = 100;\r\n    }\r\n    matches(top: number, left: number, offsetX: number, offsetY: number): boolean {\r\n        return this.fitsOffsetY(top, offsetY) || this.fitsOffsetX(left, offsetX);\r\n    }\r\n\r\n\r\n    private fitsOffsetX(left: number, offsetX: number) {\r\n        if (offsetX <= 0)\r\n            return false;\r\n        let diffX = left - this.#pointLeft;\r\n        if (left >= offsetX && diffX > this.#threshold) {\r\n            this.#wasTriggeredX = true;\r\n        } else if (this.#wasTriggeredX && diffX < -this.#threshold) {\r\n            this.#wasTriggeredX = false;\r\n        }\r\n        if (diffX < 0 && this.#prevDiffX < diffX || diffX >= 0 && this.#prevDiffX > diffX) {\r\n            this.#pointLeft = left;\r\n        }\r\n        this.#prevDiffX = diffX;\r\n        return this.#wasTriggeredX;\r\n    }\r\n\r\n    private fitsOffsetY(top: number, offsetY: number) {\r\n        if (offsetY <= 0) {\r\n            return false;\r\n        }\r\n        let diffY = top - this.#pointTop;\r\n        if (top >= offsetY && diffY > this.#threshold) {\r\n            this.#wasTriggeredY = true;\r\n        } else if (this.#wasTriggeredY && diffY < -this.#threshold) {\r\n            this.#wasTriggeredY = false;\r\n        }\r\n        if (diffY < 0 && this.#prevDiffY < diffY || diffY >= 0 && this.#prevDiffY > diffY) {\r\n            this.#pointTop = top;\r\n        }\r\n        this.#prevDiffY = diffY;\r\n        return this.#wasTriggeredY;\r\n    }\r\n}\r\n\r\n\r\nexport class CuiOffsetModeFactory {\r\n    static get(mode: string) {\r\n        if (mode === 'dynamic') {\r\n            return new CuiOffsetDynamicMode();\r\n        }\r\n        return new CuiOffsetStaticMode();\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiScrollListener, CuiScrollEvent } from \"../../core/listeners/scroll\";\r\nimport { ICuiComponentAction, CuiActionsListFactory } from \"../../core/utils/actions\";\r\nimport { are, getIntOrDefault, getRangeValue, getStringOrDefault, isStringTrue } from \"../../core/utils/functions\";\r\nimport { EVENTS } from \"../../core/index\";\r\nimport { CuiOffsetModeFactory, ICuiOffsetMode } from \"./modes\";\r\n\r\n/**\r\n * Toggles an action after specified offset is reached in relation to the element or document\r\n * \r\n * target?: string - target which action shall be triggered on\r\n * action?: string - action to trigger\r\n * offsetY?: number - vertical offset\r\n * offsetX?: number - horizontal offset\r\n * root?: boolean - set true if scroll listener shall be set on document element\r\n * mode?: string - static/dynamic \r\n */\r\n\r\nexport interface CuiOffsetEvent {\r\n    matches: boolean;\r\n    offsetX: number;\r\n    offsetY: number;\r\n    ratioY: number;\r\n    ratioX: number;\r\n    scrolling: boolean;\r\n\r\n    timestamp: number;\r\n}\r\n\r\nexport interface CuiOffsetAttribute {\r\n    target?: string;\r\n    action?: string;\r\n    offsetY?: number;\r\n    offsetX?: number;\r\n    root?: boolean;\r\n}\r\n\r\nexport class CuiOffsetArgs {\r\n    target: string;\r\n    action: string;\r\n    offsetY?: number;\r\n    offsetX?: number\r\n    root: boolean;\r\n    mode: \"static\" | \"dynamic\";\r\n    constructor() {\r\n        this.offsetX = 0;\r\n        this.offsetY = 0;\r\n        this.target = null;\r\n        this.root = false;\r\n        this.action = null;\r\n        this.mode = 'static';\r\n    }\r\n\r\n    parse(args: any) {\r\n        this.target = args.target;\r\n        this.action = args.action;\r\n        this.offsetX = getIntOrDefault(args.offsetX, -1);\r\n        this.offsetY = getIntOrDefault(args.offsetY, -1);\r\n        this.root = isStringTrue(args.root);\r\n        this.mode = getStringOrDefault(args.mode, 'static');\r\n    }\r\n}\r\nexport class CuiOffsetComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-offset`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiOffsetHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiOffsetHandler extends CuiHandler<CuiOffsetArgs> {\r\n\r\n    #listener: CuiScrollListener;\r\n    #target: Element;\r\n    #utils: CuiUtils;\r\n    #matched: boolean;\r\n    #action: ICuiComponentAction[];\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #threshold: number;\r\n    #root: Element;\r\n    #modeHandler: ICuiOffsetMode;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiOffsetHandler\", element, attribute, new CuiOffsetArgs(), utils);\r\n        this.element = element as HTMLElement;\r\n\r\n        this.#target = this.element;\r\n        this.#utils = utils;\r\n        this.#matched = false;\r\n        this.#action = null;\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#threshold = 20;\r\n        this.#root = null;\r\n        this.#modeHandler = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        this.parseAttribute();\r\n        this.#listener = new CuiScrollListener(this.args.root ? (window as any) : this.element, this.utils.setup.scrollThreshold);\r\n        this.#listener.setCallback(this.onScroll.bind(this));\r\n        this.#listener.attach();\r\n    }\r\n    onUpdate(): void {\r\n        this.parseAttribute();\r\n    }\r\n    onDestroy(): void {\r\n        this.#listener.detach();\r\n    }\r\n\r\n    private onScroll(ev: CuiScrollEvent): void {\r\n        this.checkAndPerformActions(ev);\r\n    }\r\n\r\n    private parseAttribute() {\r\n        this.#root = this.getRoot();\r\n        this.#target = this.args.target ? this.#root.querySelector(this.args.target) : this.element;\r\n        this.#action = CuiActionsListFactory.get(this.args.action);\r\n        this.#modeHandler = CuiOffsetModeFactory.get(this.args.mode);\r\n        // this.checkAndPerformActions(this.element.scrollTop, this.element.scrollLeft);\r\n\r\n    }\r\n\r\n    private checkAndPerformActions(ev: CuiScrollEvent) {\r\n        let matchesOffset = this.#modeHandler.matches(ev.top, ev.left, this.args.offsetX, this.args.offsetY);\r\n        /**\r\n         * Act and emit event when offset has been reached\r\n         */\r\n        if (matchesOffset !== this.#matched) {\r\n            this.act(matchesOffset);\r\n            this.#matched = matchesOffset;\r\n            this.callEvent(this.#matched, ev.left, ev.top, ev.scrolling, ev.source, ...this.calcaRatio(ev.left, ev.top));\r\n            return;\r\n        }\r\n        /**\r\n         * Emit event periodically\r\n         */\r\n        if (this.exceededThreshold(ev.left, ev.top)) {\r\n            this.callEvent(this.#matched, ev.left, ev.top, ev.scrolling, ev.source, ...this.calcaRatio(ev.left, ev.top));\r\n            this.#prevX = ev.left;\r\n            this.#prevY = ev.top;\r\n        }\r\n    }\r\n\r\n\r\n    private act(matching: boolean) {\r\n        if (!are(this.#action, this.#target)) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        this.#action.forEach(action => {\r\n            if (matching) {\r\n                action.add(this.#target, this.#utils)\r\n            } else {\r\n                action.remove(this.#target, this.#utils)\r\n            }\r\n        });\r\n        this.isLocked = false;\r\n    }\r\n\r\n    private callEvent(matches: boolean, x: number, y: number, scrolling: boolean, source: string, ratioX: number, ratioY: number) {\r\n        this.emitEvent(EVENTS.OFFSET, {\r\n            matches: this.#matched,\r\n            offsetX: x,\r\n            offsetY: y,\r\n            ratioX: ratioX,\r\n            ratioY: ratioY,\r\n            scrolling: scrolling,\r\n            source: source,\r\n            timestamp: Date.now()\r\n        })\r\n    }\r\n\r\n    private getRoot(): Element {\r\n        return this.args.root ? document.body : this.element;\r\n    }\r\n\r\n    private exceededThreshold(x: number, y: number): boolean {\r\n        return Math.abs(x - this.#prevX) > this.#threshold || Math.abs(y - this.#prevY) > this.#threshold;\r\n    }\r\n\r\n    private calcaRatio(x: number, y: number): [number, number] {\r\n        let ratY = parseFloat(((this.#root.clientHeight + y) / this.#root.scrollHeight).toFixed(2))\r\n        let ratX = parseFloat(((this.#root.clientWidth + x) / this.#root.scrollWidth).toFixed(2))\r\n        return [getRangeValue(ratX, 0, 1), getRangeValue(ratY, 0, 1)];\r\n    }\r\n\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { ICuiComponentAction, is, getStringOrDefault, replacePrefix, getIntOrDefault, isInRange, EVENTS, getChildrenHeight, SCOPE_SELECTOR, calculateNextIndex, CuiActionsListFactory } from \"../../core/index\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\n\r\nconst SWITCH_DEFAULT_ACTION_IN = \".{prefix}-switch-animation-default-in\";\r\nconst SWITCH_DEFAULT_ACTION_OUT = \".{prefix}-switch-animation-default-out\";\r\nconst SWITCH_DEFAULT_TARGETS = \" > *\";\r\n\r\nexport class CuiSwitchArgs implements ICuiParsable {\r\n    targets: string;\r\n    in: string;\r\n    out: string;\r\n    timeout: number;\r\n    links: string;\r\n    switch: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.targets = is(args.targets) ? SCOPE_SELECTOR + args.targets : SCOPE_SELECTOR + SWITCH_DEFAULT_TARGETS\r\n        this.in = getStringOrDefault(args.in, replacePrefix(SWITCH_DEFAULT_ACTION_IN, this.#prefix));\r\n        this.out = getStringOrDefault(args.out, replacePrefix(SWITCH_DEFAULT_ACTION_OUT, this.#prefix));\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.links = getStringOrDefault(args.links, null);\r\n        this.switch = getStringOrDefault(args.switch, null);\r\n        this.autoTimeout = getIntOrDefault(args.autoTimeout, -1);\r\n        this.height = getStringOrDefault(args.height, 'auto')\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSwitchComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switch`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitchHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitchHandler extends CuiMutableHandler<CuiSwitchArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #switches: CuiElement[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string;\r\n    #actionsIn: ICuiComponentAction[];\r\n    #actionsOut: ICuiComponentAction[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitchHandler\", element, attribute, new CuiSwitchArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#links = [];\r\n        this.#switches = [];\r\n        this.#switchEventId = null;\r\n        this.#actionsIn = this.#actionsOut = null;\r\n\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.parseArguments();\r\n        this.getTargets();\r\n        this.getActiveIndex();\r\n        this.getSwitches();\r\n        this.setSwitchesActive(this.#currentIdx);\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.parseArguments();\r\n        this.getTargets();\r\n        this.getSwitches();\r\n        this.setSwitchesActive(this.#currentIdx);\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n        this.getTargets();\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n\r\n    }\r\n\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.getSwitches();\r\n        this.getActiveIndex();\r\n        let nextIdx = calculateNextIndex(index, this.#currentIdx, this.#targets.length);\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this.logWarning(`Index ${index} is not within the suitable range`, \"switch\");\r\n            return false;\r\n        }\r\n        this.isLocked = true;\r\n        this.setSwitchesActive(nextIdx);\r\n        let nextItem = this.#targets[nextIdx];\r\n\r\n        await this.actionsHelper.performSwitchAction(nextItem,\r\n            this.#currentIdx > -1 ? this.#targets[this.#currentIdx] : null,\r\n            this.#actionsIn,\r\n            this.#actionsOut,\r\n            () => {\r\n                // Set next element active\r\n                nextItem.classList.add(this.activeClassName);\r\n                // Remove active from current element (if current exists)\r\n                if (this.#currentIdx > -1)\r\n                    this.#targets[this.#currentIdx].classList.remove(this.activeClassName);\r\n                // Update linked items\r\n                this.setLinkActive(this.#currentIdx, nextIdx);\r\n                // Update element height - it must be done a parent get height based on current child\r\n                this.helper.setStyle(this.element, 'height', this.getElementHeight(nextItem))\r\n                this.startTask();\r\n                this.isLocked = false;\r\n            },\r\n            this.args.timeout,\r\n        )\r\n        this.emitEvent(EVENTS.SWITCHED, {\r\n            timestamp: Date.now(),\r\n            index: nextIdx\r\n        })\r\n        return true;\r\n    }\r\n\r\n\r\n    private onPushSwitch(index: string) {\r\n        this.switch(index);\r\n    }\r\n\r\n    private getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    private getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets attributes value and prepares properties\r\n     */\r\n    private parseArguments() {\r\n        this.#actionsIn = CuiActionsListFactory.get(this.args.in);\r\n        this.#actionsOut = CuiActionsListFactory.get(this.args.out);\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    /**\r\n     * Query target elements\r\n     */\r\n    private getTargets() {\r\n        console.log(this.args.targets);\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n    }\r\n\r\n    private getSwitches() {\r\n        let switches = is(this.args.switch) ? document.querySelectorAll(this.args.switch) : null;\r\n        this.#switches = [];\r\n        if (switches) {\r\n            switches.forEach(sw => {\r\n                this.#switches.push(<CuiElement>(sw as any))\r\n            })\r\n        }\r\n    }\r\n\r\n    private setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        if (isInRange(current, 0, this.#links.length - 1)) {\r\n            this.helper.removeClass(this.activeClassName, this.#links[current])\r\n        }\r\n        if (isInRange(next, 0, this.#links.length - 1)) {\r\n            this.helper.setClass(this.activeClassName, this.#links[next])\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets propers active state on attached switches\r\n     * @param index \r\n     */\r\n\r\n    private setSwitchesActive(index: number) {\r\n        this.#switches.forEach(sw => {\r\n            this.emitLinkSwitch(sw.$cuid, index)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Emits push event to attached switch to set proper index\r\n     * @param id - cuid of element\r\n     * @param index - index to be set on element\r\n     */\r\n    private emitLinkSwitch(id: string, index: number) {\r\n        if (is(id))\r\n            this.utils.bus.emit(EVENTS.SWITCH, id, index);\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    private startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { EVENTS, is } from \"../../core/index\";\r\n\r\nconst SWITCHER_LIST_ITEM_SELECTOR = \"li > a\";\r\n\r\nexport class CuiSwitcherArgs implements ICuiParsable {\r\n\r\n    target: string;\r\n    index: string;\r\n\r\n    constructor() {\r\n\r\n    }\r\n\r\n    parse(args: any): void {\r\n        if (!is(args)) {\r\n            return;\r\n        }\r\n        this.target = args.target;\r\n        this.index = args.index;\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSwitcherComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-switcher`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSwitcherHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSwitcherHandler extends CuiHandler<CuiSwitcherArgs>  {\r\n    #targetId: string;\r\n    #isList: boolean;\r\n    #swtichEventID: string;\r\n    #listeners: ((ev: MouseEvent) => void)[];\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSwitcherHandler\", element, attribute, new CuiSwitcherArgs(), utils);\r\n        this.#targetId = null;\r\n        this.#isList = element.tagName === 'UL';\r\n        this.#swtichEventID = undefined;\r\n        this.onClickEvent = this.onClickEvent.bind(this);\r\n        this.#listeners = [];\r\n    }\r\n\r\n    onInit(): void {\r\n        this.setEvents();\r\n        this.getTarget();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.getTarget();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.removeEvents();\r\n    }\r\n\r\n    getTarget() {\r\n        if (!is(this.args.target)) {\r\n            this.#targetId = null;\r\n        }\r\n\r\n        let target = <CuiElement>(document.querySelector(this.args.target) as any);\r\n        if (is(target)) {\r\n            this.#targetId = target.$cuid;\r\n        }\r\n    }\r\n\r\n    setEvents() {\r\n        if (this.#isList) {\r\n            let elements = this.element.querySelectorAll(SWITCHER_LIST_ITEM_SELECTOR);\r\n            elements.forEach((el: Element, index: number) => {\r\n                let list = this.onListItemClick.bind(this, index)\r\n                this.#listeners.push(list)\r\n                el.addEventListener('click', list)\r\n            })\r\n        } else {\r\n            this.element.addEventListener('click', this.onClickEvent)\r\n        }\r\n    }\r\n\r\n    removeEvents() {\r\n        if (this.#isList) {\r\n            let elements = this.element.querySelectorAll(SWITCHER_LIST_ITEM_SELECTOR);\r\n            elements.forEach((el: Element, index: number) => {\r\n                if (this.#listeners.length > index)\r\n                    el.removeEventListener('click', this.#listeners[index])\r\n            })\r\n            this.#listeners = [];\r\n        } else {\r\n            this.element.removeEventListener('click', this.onClickEvent);\r\n        }\r\n    }\r\n\r\n    onClickEvent(ev: MouseEvent) {\r\n        this.getTarget();\r\n        if (!is(this.args.index)) {\r\n            return;\r\n        }\r\n        this.onClick(this.args.index.trim());\r\n    }\r\n\r\n    onListItemClick(index: number, ev: MouseEvent) {\r\n        this.getTarget();\r\n        this.onClick(index);\r\n    }\r\n\r\n    onClick(index: any) {\r\n        if (!is(this.#targetId)) {\r\n            return;\r\n        }\r\n        this.utils.bus.emit(EVENTS.SWITCH, this.#targetId, index);\r\n    }\r\n\r\n}","export interface ICuiFloatPositionCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport interface ICuiFloatResizeCalculator {\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number];\r\n}\r\n\r\nexport class BasePositionCalculator implements ICuiFloatPositionCalculator {\r\n\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        return [x, y];\r\n    }\r\n\r\n}\r\n\r\nexport class OptionalPositionCalculator implements ICuiFloatPositionCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let newX = this.#element.offsetLeft + diffX;\r\n        let newY = this.#element.offsetTop + diffY;\r\n        return [newX, newY];\r\n    }\r\n\r\n}\r\n\r\nexport class BaseResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = x - this.#element.offsetLeft;\r\n        let height = y - this.#element.offsetTop;\r\n        return [width, height];\r\n    }\r\n}\r\n\r\nexport class OptionalResizeCalculator implements ICuiFloatResizeCalculator {\r\n    #element: HTMLElement;\r\n    constructor(element: HTMLElement) {\r\n        this.#element = element;\r\n    }\r\n    calculate(x: number, y: number, diffX: number, diffY: number): [number, number] {\r\n        let width = this.#element.offsetWidth + diffX;\r\n        let height = this.#element.offsetHeight + diffY;\r\n        return [width, height];\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, is, getIntOrDefault, getStringOrDefault } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { BasePositionCalculator, BaseResizeCalculator, ICuiFloatPositionCalculator, ICuiFloatResizeCalculator } from \"./helpers\";\r\nimport { CLASSES, EVENTS } from \"../../core/index\";\r\nimport { ElementBuilder } from \"../../app/builders/element\";\r\n\r\nconst FLOAT_OPEN_ANIMATION_CLASS = '.{prefix}-float-default-in';\r\nconst FLOAT_CLOSE_ANIMATION_CLASS = '.{prefix}-float-default-out';\r\nconst MOVE = '.{prefix}-float-move';\r\nconst RESIZE = '.{prefix}-float-resize';\r\n\r\n\r\nexport class CuiFloatArgs implements CuiInteractableArgs, ICuiParsable {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout: number) {\r\n        this.escClose = false;\r\n        this.keyClose = undefined;\r\n        this.openAct = \"\";\r\n        this.closeAct = \"\";\r\n        this.timeout = defTimeout;\r\n\r\n        this.#defTimeout = defTimeout;\r\n        this.#prefix = prefix;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(FLOAT_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(FLOAT_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiFloatComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-float`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiFloatHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiFloatHandler extends CuiInteractableHandler<CuiFloatArgs> {\r\n    #isMoving: boolean;\r\n    #isResizing: boolean;\r\n    #prevX: number;\r\n    #prevY: number;\r\n    #prefix: string;\r\n    #moveListener: CuiMoveEventListener;\r\n    #positionCalculator: ICuiFloatPositionCalculator;\r\n    #resizeCalculator: ICuiFloatResizeCalculator;\r\n    #resizeBtn: HTMLElement;\r\n    #moveBtn: HTMLElement;\r\n    #shadow: HTMLElement;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiFloatHandler\", element, attribute, new CuiFloatArgs(prefix, utils.setup.animationTime), utils);\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.#prevX = 0;\r\n        this.#prevY = 0;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.preventDefault(false);\r\n        this.#positionCalculator = new BasePositionCalculator();\r\n        this.#resizeCalculator = new BaseResizeCalculator(element as HTMLElement)\r\n        this.#prefix = prefix;\r\n        this.#shadow = undefined;\r\n        this.move = this.move.bind(this);\r\n        this.resize = this.resize.bind(this);\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n        this.#moveBtn = this.element.querySelector(replacePrefix(MOVE, this.#prefix))\r\n        this.#resizeBtn = this.element.querySelector(replacePrefix(RESIZE, this.#prefix))\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n\r\n    }\r\n\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        return true\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this.#moveListener.attach();\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        this.#moveListener.detach();\r\n    }\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onMove(ev: ICuiMoveEvent) {\r\n        switch (ev.type) {\r\n            case 'down':\r\n                this.onMouseDown(ev);\r\n                break;\r\n            case 'up':\r\n                this.onMouseUp(ev)\r\n                break;\r\n            case 'move':\r\n                this.onMouseMove(ev);\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n    onMouseDown(ev: ICuiMoveEvent) {\r\n        if (ev.target === this.#moveBtn) {\r\n            this.#isMoving = true;\r\n            ev.event.preventDefault();\r\n        } else if (ev.target === this.#resizeBtn) {\r\n            this.#isResizing = true;\r\n            ev.event.preventDefault();\r\n            //this.helper.setClass(\"cui-float-resize-shadow\")\r\n        }\r\n        this.#prevX = ev.x;\r\n        this.#prevY = ev.y;\r\n        this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n        // Lock global move handler\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n    }\r\n\r\n    onMouseMove(ev: ICuiMoveEvent) {\r\n        if (this.#isMoving) {\r\n            this.peform(ev, this.move)\r\n        } else if (this.#isResizing) {\r\n            this.peform(ev, this.resize)\r\n        }\r\n    }\r\n\r\n\r\n    onMouseUp(ev: ICuiMoveEvent) {\r\n        this.#isMoving = false;\r\n        this.#isResizing = false;\r\n        this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n        // Unlock global handler\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n\r\n    }\r\n\r\n    peform(ev: ICuiMoveEvent, callback: (element: HTMLElement, x: number, y: number, diffX: number, diffY: number) => void) {\r\n        this.mutate(() => {\r\n            if (is(callback))\r\n                callback(this.element as HTMLElement, ev.x, ev.y, (ev.x - this.#prevX), (ev.y - this.#prevY));\r\n            this.#prevX = ev.x;\r\n            this.#prevY = ev.y;\r\n        })\r\n        ev.event.preventDefault();\r\n    }\r\n\r\n    resize(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newWidth, newHeight] = this.#resizeCalculator.calculate(x, y, diffX, diffY);\r\n        if (this.fitsWindow(element.offsetTop, element.offsetLeft, newWidth, newHeight)) {\r\n            this.mutate(() => {\r\n                element.style.width = newWidth + \"px\";\r\n                element.style.height = newHeight + \"px\";\r\n            })\r\n        }\r\n    }\r\n\r\n    move(element: HTMLElement, x: number, y: number, diffX: number, diffY: number): void {\r\n        let [newX, newY] = this.#positionCalculator.calculate(x, y, diffX, diffY)\r\n        if (this.fitsWindow(newY, newX, element.offsetWidth, element.offsetHeight)) {\r\n            this.mutate(() => {\r\n                element.style.left = newX + \"px\";\r\n                element.style.top = newY + \"px\";\r\n            })\r\n        }\r\n    }\r\n\r\n    fitsWindow(top: number, left: number, width: number, height: number) {\r\n        return (top + height < window.innerHeight - 10) &&\r\n            (top > 10) && (left > 10) &&\r\n            (left + width < window.innerWidth - 10);\r\n    }\r\n}","import { AnimatorError } from \"../models/errors\";\r\nimport { is } from \"../utils/functions\";\r\nimport { ICuiPropertyAnimator, AnimatorPropertyValue, TransformAnimatorProperty } from \"./interfaces\";\r\n\r\n/**\r\n * Changes the opacity of the element from 0 to 1\r\n */\r\nexport class OpacityAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    length: number;\r\n    from: number;\r\n    to: number;\r\n    rtl: boolean;\r\n    constructor() {\r\n        this.length = this.to = this.from = -1;\r\n        this.rtl = false;\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue): void {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[OpacityAnimator] Property has incorrect format\");\r\n        }\r\n        this.from = prop.from;\r\n        this.to = prop.to;\r\n        this.length = Math.abs(this.to - this.from);\r\n        this.rtl = this.from > this.to;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (this.to < 0) {\r\n            return;\r\n        }\r\n        let current = this.length * progress\r\n        if (element[\"style\"]) {\r\n            element.style.opacity = this.rtl ? Math.max(this.from - current, 0) : Math.min(this.from + current, 1);\r\n        }\r\n\r\n    }\r\n}\r\n\r\n/**\r\n * Changes any style property of the element\r\n */\r\nexport class PropertyAnimator implements ICuiPropertyAnimator<AnimatorPropertyValue> {\r\n    length: number;\r\n    from: number;\r\n    to: number;\r\n    rtl: boolean;\r\n    property: string;\r\n    #unit: string;\r\n    constructor(property: string) {\r\n        if (!is(property)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Valid property is required\");\r\n        }\r\n        this.property = property;\r\n        this.length = this.to = this.from = -1;\r\n        this.rtl = false;\r\n        this.#unit = \"\";\r\n    }\r\n\r\n    setProperty(prop: AnimatorPropertyValue) {\r\n        if (!prop || !is(prop.from) || !is(prop.to)) {\r\n            throw new AnimatorError(\"[PropertyAnimator] Property has incorrect format\");\r\n        }\r\n        this.from = prop.from;\r\n        this.to = prop.to;\r\n        this.length = Math.abs(this.to - this.from);\r\n        this.rtl = this.from > this.to;\r\n        this.#unit = prop.unit;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (!this.property) {\r\n            return;\r\n        }\r\n        let current = this.length * progress\r\n        if (element[\"style\"]) {\r\n            element.style[this.property] = this.createValue(this.rtl ? this.from - current : this.from + current, this.#unit);\r\n        }\r\n    }\r\n\r\n    private createValue(value: number, unit: string) {\r\n        return `${value}${unit ?? \"\"}`;\r\n    }\r\n}\r\n\r\n/**\r\n * Changes transform property of the element. Supports mulitple properties at the time\r\n */\r\nexport class TransformAnimator implements ICuiPropertyAnimator<TransformAnimatorProperty> {\r\n    prop: TransformAnimatorProperty;\r\n    constructor() {\r\n        this.prop = undefined;\r\n    }\r\n\r\n    setProperty(prop: TransformAnimatorProperty) {\r\n        if (!prop) {\r\n            throw new AnimatorError(\"[TransformAnimator] Property has incorrect format\");\r\n        }\r\n        this.prop = prop;\r\n    }\r\n\r\n    build(progress: number) {\r\n        let props: string[] = [];\r\n        for (let name in this.prop) {\r\n            let cur = this.prop[name];\r\n            let diff = Math.abs(cur.to - cur.from);\r\n            let rtl = cur.from > cur.to;\r\n            let val = rtl ? cur.from - (diff * progress) : cur.from + (diff * progress)\r\n            props.push(this.buildSingle(name, val, cur.unit))\r\n        }\r\n\r\n        return props.join(\" \");\r\n    }\r\n\r\n    buildSingle(name: string, value: number, unit: string) {\r\n        return `${name}(${value}${unit})`;\r\n    }\r\n\r\n    perform(element: any, progress: number, factor: number) {\r\n        if (!this.prop) {\r\n            return;\r\n        }\r\n        if (element[\"style\"]) {\r\n            element.style.transform = this.build(progress);\r\n        }\r\n\r\n    }\r\n}\r\n","import { is } from \"../utils/functions\";\r\nimport { OpacityAnimator, TransformAnimator, PropertyAnimator } from \"./animators\";\r\nimport { ICuiPropertyAnimator, AnimationProperty, AnimatorPropertyValue, TransformAnimatorProperty, OnAnimationFinishCallback } from \"./interfaces\";\r\n\r\nexport type PropsTypes = AnimatorPropertyValue | TransformAnimatorProperty;\r\n\r\nexport class CuiAnimation {\r\n    #engine: CuiAnimationEngine;\r\n    #timeout: number;\r\n    #factory: AnimatorFactory;\r\n    #onError: (e: Error) => void;\r\n    constructor(element?: Element) {\r\n        this.#engine = new CuiAnimationEngine(true);\r\n        this.#engine.setElement(element);\r\n        this.#timeout = 0;\r\n        this.#factory = new AnimatorFactory();\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#engine.setElement(element);\r\n    }\r\n\r\n    setTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n    onError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n        this.#engine.setOnError(callback)\r\n    }\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#engine.onFinish(callback);\r\n    }\r\n\r\n    perform(props: AnimationProperty<PropsTypes>, timeout?: number, factor?: number) {\r\n        if (!is(props)) {\r\n            this.reportError(new Error(\"Animation property cannot be empty\"))\r\n            return;\r\n        }\r\n        let animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = this.#factory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                animators.push(animator);\r\n                this.#engine.setAnimators(animators);\r\n                this.#engine.animate(timeout ?? this.#timeout)\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n            return;\r\n        }\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e)\r\n        } else {\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nclass AnimatorFactory {\r\n    get(id: string): ICuiPropertyAnimator<AnimatorPropertyValue | TransformAnimatorProperty> {\r\n        if (!id) {\r\n            return undefined;\r\n        }\r\n        switch (id) {\r\n            case \"opacity\":\r\n                return new OpacityAnimator();\r\n            case \"transform\":\r\n                return new TransformAnimator();\r\n            default:\r\n                return new PropertyAnimator(id);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class CuiAnimationEngine {\r\n    #onFinishCallback: OnAnimationFinishCallback;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #lock: boolean;\r\n    #animStartStamp: number;\r\n    #element: Element;\r\n    #cleanOnFinish: boolean;\r\n    #errorOccured: boolean;\r\n    #factory: AnimatorFactory;\r\n    #onError: (e: Error) => void;\r\n    constructor(cleanOnFinish?: boolean) {\r\n        this.#animators = [];\r\n        this.#element = undefined;\r\n        this.#animStartStamp = undefined;\r\n        this.#cleanOnFinish = cleanOnFinish ?? false;\r\n        this.#factory = new AnimatorFactory();\r\n        this.#lock = false;\r\n    }\r\n\r\n    onFinish(callback: OnAnimationFinishCallback) {\r\n        this.#onFinishCallback = callback;\r\n    }\r\n\r\n    setAnimators(animators: ICuiPropertyAnimator<PropsTypes>[]) {\r\n        this.#animators = animators;\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        if (!is(props)) {\r\n            return;\r\n        }\r\n        this.#animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = this.#factory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                this.#animators.push(animator);\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n        }\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n    }\r\n\r\n    animate(timeout: number, progress?: number, revert?: boolean): void {\r\n        if (this.#lock) {\r\n            return;\r\n        }\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            this.reportError(new Error(\"Animation cannot be performed: element or animators are not set\"));\r\n            return;\r\n        }\r\n        let animationProgress = progress ?? 0;\r\n        let shouldCalcRevert = revert ? revert : false;\r\n        this.#lock = true;\r\n        requestAnimationFrame(this.animateAsync.bind(this, timeout, animationProgress, shouldCalcRevert))\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#lock;\r\n    }\r\n\r\n    private animateAsync(timeout: number, initialProgress: number, revert: boolean, timestamp: number) {\r\n        if (!this.#animStartStamp) {\r\n            this.#animStartStamp = timestamp;\r\n        }\r\n        let pr = timestamp - this.#animStartStamp;\r\n        let animationProgress = pr / timeout;\r\n        let currProgress = 0;\r\n        if (initialProgress === 0) {\r\n            currProgress = animationProgress;\r\n        } else {\r\n            currProgress = revert ? initialProgress - (animationProgress * initialProgress) : initialProgress + (animationProgress * initialProgress)\r\n        }\r\n        this.callUpdate(revert ? Math.max(currProgress, 0) : Math.min(currProgress, 1), 1);\r\n        if (pr < timeout && !this.#errorOccured) {\r\n            requestAnimationFrame(this.animateAsync.bind(this, timeout, initialProgress, revert))\r\n        } else {\r\n            this.endAnimation(revert);\r\n        }\r\n    }\r\n\r\n    private endAnimation(reverted: boolean) {\r\n        if (this.#cleanOnFinish && this.#element) {\r\n            this.#element.removeAttribute(\"style\");\r\n        }\r\n        if (this.#onFinishCallback) {\r\n            this.#onFinishCallback(this.#element, reverted, this.#errorOccured);\r\n        }\r\n        this.#errorOccured = false;\r\n        this.#animStartStamp = undefined;\r\n        this.#lock = false;\r\n    }\r\n\r\n    private callUpdate(progress: number, factor: number) {\r\n        try {\r\n            this.#animators.forEach(animator => animator.perform(this.#element, progress, factor));\r\n        } catch (e) {\r\n            this.reportError(e);\r\n            this.#errorOccured = true;\r\n        }\r\n\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e);\r\n        } else {\r\n            console.error(\"An error occured in CuiAnimtionEngine\");\r\n            console.error(e);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class CuiSwipeAnimationEngine {\r\n    #element: Element;\r\n    #animators: ICuiPropertyAnimator<PropsTypes>[];\r\n    #animationEngine: CuiAnimationEngine;\r\n    #factory: AnimatorFactory;\r\n    #onError: (e: Error) => void;\r\n    constructor(shouldCleanOnFinish?: boolean) {\r\n        this.#element = undefined;\r\n        this.#animators = [];\r\n        this.#animationEngine = new CuiAnimationEngine(shouldCleanOnFinish);\r\n        this.#factory = new AnimatorFactory();\r\n    }\r\n\r\n    setElement(element: Element) {\r\n        this.#element = element;\r\n    }\r\n\r\n    setOnFinish(callback: OnAnimationFinishCallback) {\r\n        this.#animationEngine.onFinish(callback);\r\n    }\r\n\r\n    setOnError(callback: (e: Error) => void) {\r\n        this.#onError = callback;\r\n        this.#animationEngine.setOnError(callback);\r\n    }\r\n\r\n    setProps(props: AnimationProperty<PropsTypes>) {\r\n        if (!is(props)) {\r\n            return;\r\n        }\r\n        this.#animators = [];\r\n        try {\r\n            for (let prop in props) {\r\n                let animator = this.#factory.get(prop);\r\n                if (!animator) return;\r\n                animator.setProperty(props[prop]);\r\n                this.#animators.push(animator);\r\n            }\r\n        } catch (e) {\r\n            this.reportError(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    update(progress: number) {\r\n        if (!this.#element || this.#animators.length === 0) {\r\n            return;\r\n        }\r\n        this.#animators.forEach(animator => animator.perform(this.#element, Math.min(progress, 1), 1))\r\n    }\r\n\r\n    /**\r\n     * Perform single update on animators in RAF\r\n     * @param progress - progress value to be set to animators 0..1\r\n     */\r\n    updateAsync(progress: number) {\r\n        requestAnimationFrame(this.update.bind(this, progress));\r\n    }\r\n\r\n    /**\r\n     * Finish swipe animation using animation engine\r\n     * @param progress - initial progress value 0..1\r\n     * @param timeout - time for animation to perform\r\n     * @param revert - whether animation should return back to 0 or progress to the end\r\n     */\r\n    finish(progress: number, timeout: number, revert: boolean) {\r\n        this.#animationEngine.setElement(this.#element);\r\n        this.#animationEngine.setAnimators(this.#animators);\r\n        this.#animationEngine.animate(timeout, progress, revert);\r\n    }\r\n\r\n    private reportError(e: Error) {\r\n        if (this.#onError) {\r\n            this.#onError(e);\r\n        } else {\r\n            console.log(e)\r\n        }\r\n    }\r\n\r\n}","import { PropsTypes } from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\n\r\nexport interface AnimationDefinition {\r\n    previous: DefinitionItem;\r\n    current: DefinitionItem;\r\n}\r\n\r\nexport interface DefinitionItem {\r\n    left: AnimationProperty<PropsTypes>;\r\n    right: AnimationProperty<PropsTypes>\r\n}\r\n\r\nexport interface CuiAnimationsDefinition {\r\n    [id: string]: AnimationDefinition;\r\n}\r\n\r\nexport const SWIPE_ANIMATIONS_DEFINITIONS: CuiAnimationsDefinition = {\r\n    \"slide\": {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 100,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    },\r\n    fade: {\r\n        current: {\r\n            left: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 1,\r\n                    to: 0\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            },\r\n            right: {\r\n                opacity: {\r\n                    from: 0,\r\n                    to: 1\r\n                }\r\n            }\r\n        }\r\n    },\r\n    push: {\r\n        current: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: -10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 0,\r\n                        to: 10,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        },\r\n        previous: {\r\n            left: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: 100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            },\r\n            right: {\r\n                transform: {\r\n                    translateX: {\r\n                        from: -100,\r\n                        to: 0,\r\n                        unit: \"%\"\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import { ICuiComponent, ICuiComponentHandler, ICuiParsable, ICuiSwitchable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiChildMutation, CuiMutableHandler } from \"../../app/handlers/base\";\r\nimport { is, getStringOrDefault, getIntOrDefault, isInRange, EVENTS, getChildrenHeight, SCOPE_SELECTOR, CLASSES, boolStringOrDefault, calculateNextIndex } from \"../../core/index\";\r\nimport { ICuiTask, CuiTaskRunner } from \"../../core/utils/task\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../app/animation/definitions\";\r\n\r\n/**\r\n * \r\n *   targets: string - slider elements\r\n *   timeout: number - animation timeout\r\n *   links: string; - link to switcher (indicator, tab, etc)\r\n *   autoTimeout: number - if defined, slider will switch item automatically\r\n *   height: 'auto' | string - element height\r\n *   animation: string - animation name\r\n *   loop: boolean - allows to slide elements in loop\r\n */\r\nconst SWITCH_DEFAULT_TARGETS = \"> li\";\r\n\r\nexport class CuiSliderArgs implements ICuiParsable {\r\n    targets: string;\r\n    timeout: number;\r\n    links: string;\r\n    autoTimeout: number;\r\n    height: 'auto' | string;\r\n    animation: string;\r\n    loop: boolean;\r\n\r\n    #prefix: string;\r\n    #defTimeout: number;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#prefix = prefix;\r\n        this.#defTimeout = timeout;\r\n    }\r\n\r\n    parse(args: any): void {\r\n        this.targets = SCOPE_SELECTOR + getStringOrDefault(args.targets, SWITCH_DEFAULT_TARGETS)\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.links = args.links;\r\n        this.autoTimeout = getIntOrDefault(args.autoTimeout, -1);\r\n        this.height = getStringOrDefault(args.height, 'auto')\r\n        this.animation = getStringOrDefault(args.animation, 'slide');\r\n        this.loop = boolStringOrDefault(args.loop, false);\r\n    }\r\n\r\n}\r\n\r\nexport class CuiSliderComponent implements ICuiComponent {\r\n    attribute: string;\r\n    constructor(prefix?: string) {\r\n        this.attribute = `${prefix ?? 'cui'}-slider`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSliderHandler(element, utils, this.attribute);\r\n    }\r\n}\r\n\r\nexport class CuiSliderHandler extends CuiMutableHandler<CuiSliderArgs> implements ICuiSwitchable {\r\n    #targets: Element[];\r\n    #currentIdx: number;\r\n    #links: Element[];\r\n    #task: ICuiTask;\r\n    #switchEventId: string;\r\n    //  #moveListener: CuiMoveEventListener;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #swipeRatio: number;\r\n    #nextIdx: number;\r\n    #nextElement: HTMLElement;\r\n    #ratioThreshold: number;\r\n    #currSlider: CuiSwipeAnimationEngine;\r\n    #nextSlider: CuiSwipeAnimationEngine;\r\n    #animationDef: AnimationDefinition;\r\n    #targetsCount: number;\r\n    #moveEventId: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string) {\r\n        super(\"CuiSliderHandler\", element, attribute, new CuiSliderArgs(utils.setup.prefix, utils.setup.animationTime), utils);\r\n        this.#targets = [];\r\n        this.#currentIdx = -1;\r\n        this.#nextIdx = -1;\r\n        this.#links = [];\r\n        this.#switchEventId = null;\r\n        this.#isTracking = false;\r\n        this.#startX = -1;\r\n        this.#swipeRatio = 0;\r\n        this.#nextElement = null;\r\n        this.#ratioThreshold = 0.5;\r\n        this.#currSlider = new CuiSwipeAnimationEngine();\r\n        this.#nextSlider = new CuiSwipeAnimationEngine();\r\n        this.#currSlider.setOnFinish(this.onAnimationFinish.bind(this));\r\n        this.#targetsCount = 0;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#switchEventId = this.onEvent(EVENTS.SWITCH, this.onPushSwitch.bind(this))\r\n        this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this))\r\n        this.getTargets();\r\n        this.getLinks();\r\n        this.getActiveIndex();\r\n        this.setLinkActive(-1, this.#currentIdx);\r\n\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#task = new CuiTaskRunner(this.args.autoTimeout, true, this.switch.bind(this, 'next'));\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n        this.startTask();\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.mutate(() => {\r\n            this.helper.setStyle(this.element, 'height', this.getElementHeight(this.#targets[this.#currentIdx]))\r\n        })\r\n        this.#animationDef = SWIPE_ANIMATIONS_DEFINITIONS[this.args.animation];\r\n\r\n        this.startTask();\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#task.stop();\r\n        this.detachEvent(EVENTS.SWITCH, this.#switchEventId)\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId)\r\n    }\r\n\r\n    onMutation(record: CuiChildMutation): void {\r\n\r\n    }\r\n    /**\r\n     * Move listener callback\r\n     * @param data move listener data\r\n     */\r\n    onMove(data: ICuiMoveEvent) {\r\n        if (this.isLocked || !this.#animationDef) {\r\n            return;\r\n        }\r\n        let current = this.#targets[this.#currentIdx] as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking || !current.contains((data.target as Node))) {\r\n                    return;\r\n                }\r\n                this.#isTracking = true;\r\n                this.#startX = data.x;\r\n                this.#currSlider.setElement(current);\r\n                this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n                if (data.event.cancelable)\r\n                    data.event.preventDefault();\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                // Lock component until animation is finished\r\n                this.isLocked = true;\r\n                let absRatio = Math.abs(this.#swipeRatio);\r\n                let timeout = absRatio * this.args.timeout;\r\n                let back = absRatio <= this.#ratioThreshold;\r\n                this.#currSlider.finish(absRatio, timeout, back);\r\n                this.#nextSlider.finish(absRatio, timeout, back);\r\n                this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (!this.#isTracking) {\r\n                    break;\r\n                }\r\n                let newRatio = (data.x - this.#startX) / current.offsetWidth;\r\n                if (Math.abs(newRatio - this.#swipeRatio) < 0.02) {\r\n                    break;\r\n                }\r\n                let nextIdx = calculateNextIndex(this.#swipeRatio > 0 ? \"next\" : \"prev\", this.#currentIdx, this.#targetsCount);\r\n                this.#swipeRatio = this.adjustMoveRatio(newRatio);\r\n\r\n                if (nextIdx !== this.#nextIdx) {\r\n                    this.#nextElement && this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n                    this.#nextElement = this.#targets[nextIdx] as HTMLElement;\r\n                    this.#nextIdx = nextIdx;\r\n\r\n                    this.#nextSlider.setElement(this.#nextElement)\r\n                    this.#nextSlider.setProps(this.#swipeRatio > 0 ? this.#animationDef.previous.right : this.#animationDef.previous.left);\r\n                    this.#currSlider.setProps(this.#swipeRatio > 0 ? this.#animationDef.current.right : this.#animationDef.current.left);\r\n                    this.mutate(() => {\r\n                        this.helper.setClass(CLASSES.animProgress, this.#nextElement);\r\n                    })\r\n                }\r\n                this.mutate(() => {\r\n                    this.#currSlider.update(Math.abs(this.#swipeRatio));\r\n                    this.#nextSlider.update(Math.abs(this.#swipeRatio));\r\n                })\r\n                if (data.event.cancelable)\r\n                    data.event.preventDefault();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n    }\r\n\r\n    adjustMoveRatio(ratio: number): number {\r\n        if (this.args.loop) {\r\n            return ratio;\r\n        }\r\n        if (this.#currentIdx === this.#targetsCount - 1 && ratio > 0) {\r\n            return 0;\r\n        }\r\n        if (this.#currentIdx === 0 && ratio < 0) {\r\n            return 0;\r\n        }\r\n        return ratio;\r\n    }\r\n\r\n    /**\r\n     * Api method to switch childrens\r\n     * @param index - index to switch to\r\n     */\r\n    async switch(index: any): Promise<boolean> {\r\n        if (this.isLocked) {\r\n            return false;\r\n        }\r\n        this.onPushSwitch(index);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @param element element this animation was perfromed on\r\n     * @param reverted - flag inidicating whether animation was performed to the end or reverted back to start\r\n     * @param errorOccured - tells whether animation was finished with error\r\n     */\r\n    onAnimationFinish(element: Element, reverted: boolean, errorOccured: boolean) {\r\n        this.isLocked = false;\r\n        // If not go back or from push then switch, else was go back\r\n        let next = this.#targets[this.#nextIdx];\r\n        let current = this.#targets[this.#currentIdx];\r\n        if (!reverted) {\r\n            if (this.#nextIdx > -1) {\r\n                this.mutate(() => {\r\n                    this.helper.removeClass(CLASSES.animProgress, next);\r\n                    this.helper.setClass(this.activeClassName, next);\r\n                    this.helper.removeClass(this.activeClassName, current);\r\n                    this.helper.removeAttribute(\"style\", current);\r\n                    this.helper.removeAttribute(\"style\", next);\r\n                    this.setLinkActive(this.#currentIdx, this.#nextIdx);\r\n                    this.emitEvent(EVENTS.SWITCHED, {\r\n                        timestamp: Date.now(),\r\n                        index: this.#nextIdx\r\n                    })\r\n                    this.#currentIdx = this.#nextIdx;\r\n                    this.#nextIdx = -1;\r\n                    this.#nextElement = null;\r\n                    this.#startX = -1;\r\n                    this.#swipeRatio = 0;\r\n                })\r\n            }\r\n        } else {\r\n            this.helper.removeClass(CLASSES.animProgress, this.#nextElement);\r\n            this.helper.removeAttribute(\"style\", current);\r\n            this.helper.removeAttribute(\"style\", this.#nextElement);\r\n            this.#nextIdx = -1;\r\n            this.#nextElement = null;\r\n            this.#startX = -1;\r\n            this.#swipeRatio = 0;\r\n        }\r\n        this.startTask();\r\n    }\r\n\r\n    onPushSwitch(index: string) {\r\n        if (!is(index) ||\r\n            this.isLocked ||\r\n            !this.#animationDef ||\r\n            (!this.args.loop && this.#currentIdx === 0 && index === 'prev') ||\r\n            (!this.args.loop && this.#currentIdx === this.#targetsCount - 1 && index === 'next')) {\r\n            return;\r\n        }\r\n        this.isLocked = true;\r\n        let nextIdx = calculateNextIndex(index, this.#currentIdx, this.#targetsCount);\r\n        if (nextIdx == this.#currentIdx || nextIdx < 0 || nextIdx >= this.#targets.length) {\r\n            this._log.warning(`Index ${index} is not within the suitable range`);\r\n            return false;\r\n        }\r\n        this.#nextIdx = nextIdx;\r\n        let current = this.#targets[this.#currentIdx];\r\n        let next = this.#targets[this.#nextIdx];\r\n        this.#currSlider.setElement(current);\r\n        this.#nextSlider.setElement(next);\r\n        this.#currSlider.setProps(index === 'prev' ? this.#animationDef.current.left : this.#animationDef.current.right);\r\n        this.#nextSlider.setProps(index === 'prev' ? this.#animationDef.previous.left : this.#animationDef.previous.right);\r\n        this.mutate(() => {\r\n            this.#currSlider.finish(0, this.args.timeout, false);\r\n            this.#nextSlider.finish(0, this.args.timeout, false);\r\n            this.helper.setClass(CLASSES.animProgress, next);\r\n        })\r\n\r\n    }\r\n\r\n    getActiveIndex(): void {\r\n        this.#currentIdx = is(this.#targets) ? this.#targets.findIndex(target => this.helper.hasClass(this.activeClassName, target)) : -1;\r\n    }\r\n\r\n    getElementHeight(current: Element): string {\r\n        if (!is(this.args.height) || this.args.height === 'auto') {\r\n            return getChildrenHeight(current) + \"px\";\r\n        } else {\r\n            return this.args.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Queries targets\r\n     */\r\n    getTargets() {\r\n        let t = this.element.querySelectorAll(this.args.targets);\r\n        this.#targets = t.length > 0 ? [...t] : [];\r\n        this.#targetsCount = this.#targets.length;\r\n    }\r\n\r\n    /**\r\n     * Get linked switcher elements\r\n     */\r\n    getLinks() {\r\n        this.#links = is(this.args.links) ? [...document.querySelectorAll(this.args.links)] : []\r\n    }\r\n\r\n    /**\r\n     * Set active class on linked switcher if set\r\n     * @param current - current index (to remove active from)\r\n     * @param next - next index (to set action on)\r\n     */\r\n    setLinkActive(current: number, next: number) {\r\n        if (!is(this.#links)) {\r\n            return\r\n        }\r\n        this.mutate(() => {\r\n            if (isInRange(current, 0, this.#links.length - 1)) {\r\n                this.helper.removeClass(this.activeClassName, this.#links[current])\r\n            }\r\n            if (isInRange(next, 0, this.#links.length - 1)) {\r\n                this.helper.setClass(this.activeClassName, this.#links[next])\r\n            }\r\n        })\r\n\r\n    }\r\n\r\n    /**\r\n     * Runs task if arguments setup allows for it - auto flag must be set to true \r\n     */\r\n    startTask() {\r\n        this.#task.stop();\r\n        if (this.args.autoTimeout) {\r\n            this.#task.start();\r\n        }\r\n    }\r\n}\r\n","import { AnimationDefinition, SWIPE_ANIMATIONS_DEFINITIONS } from \"../../app/animation/definitions\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\nimport { CuiSwipeAnimationEngine } from \"../../core/animation/engine\";\r\nimport { boolStringOrDefault, CLASSES, EVENTS, getIntOrDefault, getStringOrDefault, ICuiParsable, replacePrefix } from \"../../core/index\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { ICuiComponent, CuiUtils, ICuiComponentHandler } from \"../../index\";\r\n\r\nconst BANNER_OPEN_ANIMATION: string = \".{prefix}-animation-fade-in\";\r\nconst BANNER_CLOSE_ANIMATION: string = \".{prefix}-animation-fade-out\";\r\n\r\nexport class CuiBannerArgs implements ICuiParsable, CuiInteractableArgs {\r\n    timeout: number;\r\n    swipe: boolean;\r\n\r\n    openAct: string;\r\n    closeAct: string;\r\n    // Not in use\r\n    escClose: boolean;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, timeout: number) {\r\n        this.#defTimeout = timeout;\r\n        this.#prefix = prefix;\r\n\r\n        this.escClose = false;\r\n        this.keyClose = undefined;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.swipe = boolStringOrDefault(args.swipe, false);\r\n        this.escClose = false;\r\n        this.keyClose = undefined;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(BANNER_OPEN_ANIMATION, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(BANNER_CLOSE_ANIMATION, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiBanerComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-banner`;\r\n\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiBannerHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiBannerHandler extends CuiInteractableHandler<CuiBannerArgs> {\r\n\r\n    //  #moveListener: CuiMoveEventListener;\r\n    #swipeEngine: CuiSwipeAnimationEngine;\r\n    #isTracking: boolean;\r\n    #startX: number;\r\n    #ratio: number;\r\n    #swipeAnimation: AnimationDefinition;\r\n    #moveEventId: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiBannerHandler\", element, attribute, new CuiBannerArgs(prefix, utils.setup.animationTime), utils);\r\n        // this.#moveListener = new CuiMoveEventListener();\r\n        // this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#swipeEngine = new CuiSwipeAnimationEngine(true);\r\n        this.#swipeEngine.setOnFinish(this.onSwipeFinish.bind(this));\r\n        this.#swipeEngine.setElement(this.element)\r\n        this.#startX = -1;\r\n        this.#ratio = 0;\r\n        this.#swipeAnimation = SWIPE_ANIMATIONS_DEFINITIONS[\"fade\"];\r\n        this.#moveEventId = null;\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this));\r\n        if (this.isActive) {\r\n            this.open();\r\n        }\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId);\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        return true;\r\n    }\r\n    onAfterOpen(): void {\r\n        if (this.args.swipe) {\r\n            this.#moveEventId = this.onEvent(EVENTS.GLOBAL_MOVE, this.onMove.bind(this));\r\n        }\r\n    }\r\n    onAfterClose(): void {\r\n        this.detachEvent(EVENTS.GLOBAL_MOVE, this.#moveEventId);\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    onMove(data: ICuiMoveEvent) {\r\n        if (this.isLocked) {\r\n            return;\r\n        }\r\n        let current = this.element as HTMLElement;\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking || !current.contains((data.target as Node))) {\r\n                    return;\r\n                }\r\n                this.#isTracking = true;\r\n                this.#startX = data.x;\r\n                this.helper.setClassesAs(document.body, CLASSES.swipingOn);\r\n                data.event.preventDefault();\r\n                break;\r\n            case \"up\":\r\n                if (!this.#isTracking && this.#ratio == 0) {\r\n                    break;\r\n                }\r\n\r\n                let absRatio = Math.abs(this.#ratio);\r\n                let timeout = absRatio * this.args.timeout;\r\n                let back = absRatio <= 0.4;\r\n                // Lock component until animation is finished\r\n                this.isLocked = true;\r\n                this.#swipeEngine.finish(absRatio, timeout, back);\r\n                this.helper.removeClassesAs(document.body, CLASSES.swipingOn);\r\n                this.#isTracking = false;\r\n                break;\r\n            case \"move\":\r\n                if (this.#isTracking) {\r\n                    let newRatio = (data.x - this.#startX) / current.offsetWidth;\r\n                    if (this.#ratio >= 0 && newRatio <= 0 || this.#ratio <= 0 && newRatio > 0) {\r\n                        this.#swipeEngine.setProps(newRatio > 0 ? this.#swipeAnimation.current.right : this.#swipeAnimation.current.left);\r\n                    }\r\n                    this.#ratio = newRatio;\r\n                    this.mutate(() => {\r\n                        this.#swipeEngine.update(Math.abs(this.#ratio));\r\n                    })\r\n                    data.event.preventDefault();\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    onSwipeFinish(element: Element, reverted: boolean, error: boolean) {\r\n        this.isLocked = false;\r\n        if (!reverted) {\r\n            this.helper.removeClass(this.activeClassName, this.element)\r\n            AriaAttributes.setAria(this.element, 'aria-expanded', 'false');\r\n        }\r\n        this.#ratio = 0;\r\n        this.#startX = 0;\r\n\r\n    }\r\n}","import { ICuiComponent, ICuiComponentHandler, ICuiParsable } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { replacePrefix, isStringTrue, getStringOrDefault, getIntOrDefault } from \"../../core/utils/functions\";\r\nimport { AriaAttributes } from \"../../core/utils/aria\";\r\nimport { CuiInteractableArgs, CuiInteractableHandler } from \"../../app/handlers/base\";\r\n\r\nconst COVER_OPEN_ANIMATION_CLASS = '.{prefix}-dialog-default-in';\r\nconst COVER_CLOSE_ANIMATION_CLASS = '.{prefix}-dialog-default-out';\r\nconst bodyClass = '{prefix}-cover-open';\r\n\r\nexport interface CuiDialogEvent {\r\n    timestamp: number;\r\n}\r\n\r\nexport class CuiCoverArgs implements ICuiParsable, CuiInteractableArgs {\r\n    escClose: boolean;\r\n    timeout: number;\r\n    openAct: string;\r\n    closeAct: string;\r\n    keyClose: string;\r\n\r\n    #defTimeout: number;\r\n    #prefix: string;\r\n    constructor(prefix: string, defTimeout: number) {\r\n        this.escClose = false;\r\n\r\n        this.#defTimeout = defTimeout;\r\n        this.#prefix = prefix;\r\n    }\r\n\r\n\r\n    parse(args: any) {\r\n        this.escClose = isStringTrue(args.escClose);\r\n        this.keyClose = args.keyClose;\r\n        this.timeout = getIntOrDefault(args.timeout, this.#defTimeout);\r\n        this.openAct = getStringOrDefault(args.openAct, replacePrefix(COVER_OPEN_ANIMATION_CLASS, this.#prefix))\r\n        this.closeAct = getStringOrDefault(args.closeAct, replacePrefix(COVER_CLOSE_ANIMATION_CLASS, this.#prefix))\r\n    }\r\n}\r\n\r\nexport class CuiCoverComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-cover`;\r\n    }\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, utils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiCoverHandler(element, utils, this.attribute, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiCoverHandler extends CuiInteractableHandler<CuiCoverArgs> {\r\n\r\n    #bodyClass: string;\r\n    #scrollY: number;\r\n\r\n    constructor(element: HTMLElement, utils: CuiUtils, attribute: string, prefix: string) {\r\n        super(\"CuiDialogHandler\", element, attribute, new CuiCoverArgs(prefix, utils.setup.animationTimeLong), utils);\r\n        this.#bodyClass = replacePrefix(bodyClass, prefix);\r\n        this.#scrollY = 0;\r\n    }\r\n\r\n    onInit(): void {\r\n        AriaAttributes.setAria(this.element, 'aria-modal', \"\");\r\n    }\r\n    onUpdate(): void {\r\n\r\n    }\r\n\r\n    onDestroy(): void {\r\n\r\n    }\r\n\r\n    onBeforeOpen(): boolean {\r\n        if (this.isAnyActive()) {\r\n            return false;\r\n        }\r\n        this.#scrollY = window.pageYOffset;\r\n        return true;\r\n    }\r\n\r\n    onAfterOpen(): void {\r\n        this.helper.setClass(this.#bodyClass, document.body)\r\n        document.body.style.top = `-${this.#scrollY}px`;\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"false\");\r\n    }\r\n\r\n    onAfterClose(): void {\r\n        document.body.style.top = '';\r\n        window.scrollTo(0, (this.#scrollY || 0) * -1);\r\n        this.#scrollY = 0;\r\n        this.helper.removeClass(this.#bodyClass, document.body);\r\n        AriaAttributes.setAria(this.element, 'aria-hidden', \"true\");\r\n    }\r\n\r\n    onBeforeClose(): boolean {\r\n        return true;\r\n    }\r\n\r\n    private isAnyActive(): boolean {\r\n        return this.helper.hasClass(this.#bodyClass, document.body);\r\n    }\r\n}","import { is } from \"../../../core/index\";\r\nimport { ICuiElementDetector } from \"./interfaces\";\r\n\r\n// export class CuiDragOverDetector implements ICuiElementDetector {\r\n//     #elements: Element[];\r\n//     constructor() {\r\n//         this.#elements = [];\r\n//     }\r\n\r\n//     setElements(elements: Element[]): void {\r\n//         this.#elements = elements;\r\n//     }\r\n\r\n//     detect(x: number, y: number): [number, Element] {\r\n//         let reduced = this.#elements ? this.#elements.reduce((closest, child, currentId) => {\r\n//             const box = child.getBoundingClientRect();\r\n//             let offset = y - box.top - box.height / 2;\r\n//             if (offset < 0 && offset > closest.offset) {\r\n//                 return { offset: offset, element: child, idx: currentId }\r\n//             } else {\r\n//                 return closest\r\n//             }\r\n//         }, { offset: Number.NEGATIVE_INFINITY, element: null, idx: -1 }) : undefined;\r\n//         return reduced ? [reduced.idx, reduced.element] : [-1, undefined];\r\n//     }\r\n// }\r\n\r\n// export class CuiComplexDragOverDetector implements ICuiElementDetector {\r\n//     #elements: Element[];\r\n//     constructor() {\r\n//         this.#elements = [];\r\n//     }\r\n\r\n//     setElements(elements: Element[]): void {\r\n//         this.#elements = elements;\r\n//     }\r\n\r\n//     detect(x: number, y: number): [number, Element] {\r\n//         let reduced = this.#elements ? this.#elements.reduce((closest, child, currentId) => {\r\n//             const box = child.getBoundingClientRect();\r\n//             let offsetY = y - box.top - box.height / 2;\r\n//             let offsetX = x - box.left - box.width / 2;\r\n//             if (offsetY < 0 && offsetY > closest.offsetY && offsetX < 0 && offsetX > closest.offsetX) {\r\n//                 return { offsetX: offsetX, offsetY: offsetY, element: child, idx: currentId }\r\n//             } else {\r\n//                 return closest\r\n//             }\r\n//         }, { offsetX: Number.NEGATIVE_INFINITY, offsetY: Number.NEGATIVE_INFINITY, element: null, idx: -1 }) : undefined;\r\n//         return reduced ? [reduced.idx, reduced.element] : [-1, undefined];\r\n//     }\r\n// }\r\n\r\nexport class CuiSimpleDragOverDetector implements ICuiElementDetector {\r\n    #elements: Element[];\r\n    #count: number;\r\n    #threshold: number;\r\n    constructor() {\r\n        this.#elements = [];\r\n        this.#count = 0;\r\n        this.#threshold = 5;\r\n    }\r\n\r\n    setElements(elements: Element[]): void {\r\n        this.#elements = elements;\r\n        this.#count = this.#elements.length;\r\n    }\r\n\r\n    setThreshold(value: number) {\r\n        this.#threshold = value\r\n    }\r\n\r\n    detect(x: Number, y: Number): [number, Element] {\r\n        if (!is(this.#elements)) {\r\n            return [-1, undefined];\r\n        }\r\n\r\n        let idx: number = -1;\r\n        let found: Element = undefined;\r\n\r\n        for (let i = 0; i < this.#count; i++) {\r\n            if (this.isInBounds(this.#elements[i], x, y)) {\r\n                if (i === 0) {\r\n                    idx = i;\r\n                    found = this.#elements[i];\r\n                    //break;\r\n                } else if (i < this.#count - 1) {\r\n                    idx = i + 1;\r\n                    found = this.#elements[i + 1];\r\n                    //break;\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return [idx, found];\r\n    }\r\n\r\n    // private isInBounds(element: Element, x: Number, y: Number): boolean {\r\n    //     const box = element.getBoundingClientRect();\r\n    //     return x > box.left + this.#threshold && x < box.left + box.width - this.#threshold &&\r\n    //         y > box.top + this.#threshold && y < box.top + box.height - this.#threshold;\r\n    // }\r\n\r\n    private isInBounds(element: Element, x: Number, y: Number): boolean {\r\n        const box = element.getBoundingClientRect();\r\n        if (box.width === 0) {\r\n            console.log(element);\r\n        }\r\n        return x > box.left - this.#threshold && x < box.left + box.width + this.#threshold &&\r\n            y > box.top - this.#threshold && y < box.top + box.height + this.#threshold;\r\n    }\r\n\r\n}","import { CuiMoveEventListener, ICuiMoveEvent } from \"../../../core/listeners/move\";\r\n\r\nexport class CuiDragHandler {\r\n    #root: Element;\r\n    #moveHandler: CuiMoveEventListener;\r\n    #onDragStart: (data: ICuiMoveEvent) => boolean;\r\n    #onDragOver: (data: ICuiMoveEvent) => void;\r\n    #onDragEnd: (data: ICuiMoveEvent) => void;\r\n    #timeout: number;\r\n    #isTracking: boolean;\r\n    #timeoutId: any;\r\n    constructor(root: HTMLElement) {\r\n        this.#root = root;\r\n        this.#moveHandler = new CuiMoveEventListener();\r\n        this.#timeout = 150;\r\n        this.#isTracking = false;\r\n        this.#timeoutId = undefined;\r\n        this.#moveHandler.setTarget(this.#root);\r\n        this.#moveHandler.preventDefault(false);\r\n        this.#moveHandler.setCallback(this.onMove.bind(this));\r\n    }\r\n\r\n    setLongPressTimeout(timeout: number) {\r\n        this.#timeout = timeout;\r\n    }\r\n\r\n    onDragStart(callback: (data: ICuiMoveEvent) => boolean) {\r\n        this.#onDragStart = callback;\r\n    }\r\n\r\n    onDragOver(callback: (data: ICuiMoveEvent) => void) {\r\n        this.#onDragOver = callback;\r\n    }\r\n\r\n    onDragEnd(callback: (data: ICuiMoveEvent) => void) {\r\n        this.#onDragEnd = callback;\r\n    }\r\n\r\n    attach() {\r\n        this.#moveHandler.attach();\r\n    }\r\n\r\n    detach() {\r\n        this.#moveHandler.detach();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveEvent) {\r\n        switch (data.type) {\r\n            case \"down\":\r\n                if (this.#isTracking) {\r\n                    return;\r\n                }\r\n\r\n                this.#timeoutId = setTimeout(() => {\r\n                    if (this.#onDragStart && this.#onDragStart(data)) {\r\n                        this.#isTracking = true;\r\n                    }\r\n                }, this.#timeout);\r\n\r\n                break;\r\n            case \"move\":\r\n                this.cancelTimeout();\r\n                if (!this.#isTracking) {\r\n                    return;\r\n                }\r\n                if (this.#onDragOver) {\r\n                    this.#onDragOver(data);\r\n                }\r\n                break;\r\n            case \"up\":\r\n                this.cancelTimeout();\r\n                if (!this.#isTracking) {\r\n                    return;\r\n                }\r\n                if (this.#onDragEnd) {\r\n                    this.#onDragEnd(data);\r\n                }\r\n                this.#isTracking = false;\r\n                break;\r\n        }\r\n    }\r\n\r\n    private cancelTimeout() {\r\n        if (this.#timeoutId) {\r\n            clearTimeout(this.#timeoutId);\r\n            this.#timeoutId = undefined;\r\n        }\r\n    }\r\n}","import { ElementBuilder } from \"../../app/builders/element\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiSimpleDragOverDetector } from \"../../app/handlers/drag/detectors\";\r\nimport { CuiDragHandler } from \"../../app/handlers/drag/drag\";\r\nimport { ICuiElementDetector } from \"../../app/handlers/drag/interfaces\";\r\nimport { CuiSwipeAnimationEngine, PropsTypes } from \"../../core/animation/engine\";\r\nimport { AnimationProperty } from \"../../core/animation/interfaces\";\r\nimport { CLASSES, CuiUtils, delay, EVENTS, getIntOrDefault, ICuiComponent, ICuiComponentHandler, ICuiParsable, is, replacePrefix, SCOPE_SELECTOR } from \"../../core/index\";\r\nimport { ICuiMoveEvent } from \"../../core/listeners/move\";\r\n\r\nconst SORTABLE_IS_MOVING = \"{prefix}-moving\";\r\nconst DEFAULT_SELECTOR = \" > *\";\r\nconst SORTABLE_PREVIEW_CLS = \"{prefix}-sortable-preview\";\r\n\r\nexport class CuiSortableArgs implements ICuiParsable {\r\n    target: string;\r\n    trigger: string;\r\n    timeout: number;\r\n    threshold: number;\r\n    constructor() {\r\n        this.target = SCOPE_SELECTOR + DEFAULT_SELECTOR;;\r\n        this.trigger = SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.timeout = 150;\r\n        this.threshold = 5;\r\n    }\r\n    parse(val: any): void {\r\n        this.target = val.target ? SCOPE_SELECTOR + \" \" + val.target : SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.trigger = val.trigger ? SCOPE_SELECTOR + \" \" + val.trigger : SCOPE_SELECTOR + DEFAULT_SELECTOR;\r\n        this.timeout = getIntOrDefault(val.timeout, 150);\r\n        this.threshold = getIntOrDefault(val.threshold, 5);\r\n    }\r\n\r\n\r\n}\r\n\r\nexport class CuiSortableComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? \"cui\";\r\n        this.attribute = this.#prefix + \"-sortable\";\r\n    }\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n    get(element: HTMLElement, sutils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiSortableHandler(element, this.attribute, sutils, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiSortableHandler extends CuiHandler<CuiSortableArgs> {\r\n    #dragHandler: CuiDragHandler;\r\n    #triggers: Element[];\r\n    #targets: Element[];\r\n    #currentTarget: HTMLElement;\r\n    #currentIdx: number;\r\n    #preview: HTMLElement;\r\n    #movingCls: string;\r\n    #detector: ICuiElementDetector;\r\n    #currentBefore: HTMLElement;\r\n    #animation: CuiSwipeAnimationEngine;\r\n\r\n    #previewCls: string;\r\n    constructor(element: HTMLElement, attribute: string, utils: CuiUtils, prefix: string) {\r\n        super(\"CuiSortableHandler\", element, attribute, new CuiSortableArgs(), utils);\r\n        this.#dragHandler = new CuiDragHandler(element);\r\n        this.#dragHandler.onDragStart(this.onDragStart.bind(this));\r\n        this.#dragHandler.onDragOver(this.onDragOver.bind(this));\r\n        this.#dragHandler.onDragEnd(this.onDragEnd.bind(this));\r\n        this.#movingCls = replacePrefix(SORTABLE_IS_MOVING, prefix);\r\n        this.#previewCls = replacePrefix(SORTABLE_PREVIEW_CLS, prefix);\r\n        this.#detector = new CuiSimpleDragOverDetector();\r\n        this.#currentBefore = undefined;\r\n        this.#animation = new CuiSwipeAnimationEngine();\r\n        this.#animation.setOnFinish(() => {\r\n            let item = this.#currentTarget;\r\n            let idx = this.#currentIdx;\r\n            this.stopMovementPrep();\r\n\r\n            this.utils.bus.emit(EVENTS.MOVE_LOCK, null, false);\r\n            this.emitEvent(EVENTS.SORTED, {\r\n                item: item,\r\n                index: idx,\r\n                timestamp: new Date()\r\n            })\r\n        })\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#dragHandler.attach();\r\n        this.getTargetsAndTrggers();\r\n        this.#detector.setThreshold(this.args.threshold)\r\n    }\r\n\r\n    onUpdate(): void {\r\n        if (this.args.target !== this.prevArgs.target ||\r\n            this.args.trigger !== this.prevArgs.trigger) {\r\n            this.getTargetsAndTrggers();\r\n        }\r\n        this.#dragHandler.setLongPressTimeout(this.args.timeout);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#dragHandler.detach();\r\n    }\r\n\r\n    /**\r\n     * queries targets and triggers from the element\r\n     * If exception - lists are cleared\r\n     */\r\n    private getTargetsAndTrggers() {\r\n        try {\r\n            this.#targets = [...this.element.querySelectorAll(this.args.target)];\r\n            this.#triggers = [...this.element.querySelectorAll(this.args.trigger)];\r\n            if (this.#triggers.length !== this.#targets.length) {\r\n                throw new Error(`Triggers (count ${this.#triggers.length}) and targets (count ${this.#targets.length}) selector are not correct`)\r\n            }\r\n            this.#detector.setElements(this.#targets);\r\n        } catch (e) {\r\n            this._log.error(\"Incorrect trigger or target selector\")\r\n            this._log.exception(e, \"getTargetsAndTrggers\");\r\n            this.#targets = [];\r\n            this.#triggers = [];\r\n        }\r\n    }\r\n\r\n    private onDragStart(data: ICuiMoveEvent): boolean {\r\n        this.#currentIdx = this.getPressedElementIdx(data.target as Node);\r\n        this.#currentTarget = this.#currentIdx > -1 ? this.#targets[this.#currentIdx] as HTMLElement : undefined;\r\n        if (!this.#currentTarget) {\r\n            return false;\r\n        }\r\n        this.utils.bus.emit(EVENTS.MOVE_LOCK, null, true);\r\n        this.startMovementPrep(data);\r\n        this.emitEvent(EVENTS.SORT_START, {\r\n            item: this.#currentTarget,\r\n            index: this.#currentIdx,\r\n            timestamp: new Date()\r\n        })\r\n        return true;\r\n    }\r\n\r\n    private onDragOver(data: ICuiMoveEvent): void {\r\n        this.move(data);\r\n        data.event.preventDefault();\r\n    }\r\n\r\n    private onDragEnd(data: ICuiMoveEvent): void {\r\n        this.#animation.setElement(this.#preview);\r\n        this.#animation.setProps(this.getFinishAnimation());\r\n        this.#animation.finish(0, 100, false);\r\n    }\r\n\r\n    private getPressedElementIdx(target: Node) {\r\n        return this.#triggers.findIndex((trigger: Element) => {\r\n            return trigger.contains(target)\r\n        });\r\n    }\r\n\r\n    private startMovementPrep(data: ICuiMoveEvent) {\r\n        this.mutate(() => {\r\n            this.createPreview();\r\n            this.helper.setClass(this.#movingCls, this.#currentTarget);\r\n            this.helper.setClass(\"cui-locked\", this.element);\r\n            this.helper.setClass(CLASSES.swipingOn, document.body);\r\n            this.setPreviewPosition(data);\r\n            this.setCurrentPosition(data);\r\n        })\r\n    }\r\n\r\n    private stopMovementPrep() {\r\n        this.mutate(() => {\r\n            this.helper.removeClass(this.#movingCls, this.#currentTarget);\r\n            this.helper.removeClass(CLASSES.swipingOn, document.body);\r\n            this.helper.removeClass(\"cui-locked\", this.element);\r\n            this.removePreview();\r\n            this.#currentTarget = undefined;\r\n            this.#currentBefore = undefined;\r\n            this.getTargetsAndTrggers();\r\n        })\r\n    }\r\n\r\n    private move(data: ICuiMoveEvent) {\r\n        this.mutate(() => {\r\n            this.setPreviewPosition(data);\r\n            this.setCurrentPosition(data);\r\n        })\r\n    }\r\n\r\n    private createPreview() {\r\n        this.#preview = new ElementBuilder(\"div\").setClasses(this.#previewCls).build();\r\n        this.#preview.style.width = `${this.#currentTarget.offsetWidth}px`;\r\n        this.#preview.style.height = `${this.#currentTarget.offsetHeight}px`;\r\n        document.body.appendChild(this.#preview);\r\n    }\r\n\r\n    private removePreview() {\r\n        if (this.#preview) {\r\n            this.#preview.remove();\r\n            this.#preview = null;\r\n        }\r\n    }\r\n\r\n    private setPreviewPosition(data: ICuiMoveEvent) {\r\n        if (!this.#preview) {\r\n            return;\r\n        }\r\n\r\n        this.#preview.style.top = `${data.y}px`;\r\n        this.#preview.style.left = `${data.x}px`;\r\n    }\r\n\r\n    private setCurrentPosition(data: ICuiMoveEvent) {\r\n        if (!this.#currentTarget) {\r\n            return;\r\n        }\r\n        let [idx, detected] = this.#detector.detect(data.x, data.y);\r\n        if ((idx !== this.#currentIdx) && this.#currentBefore !== detected) {\r\n            let el = detected;\r\n            this.insertElement(this.#currentTarget, el);\r\n            this.#currentBefore = el as HTMLElement;\r\n            this.getTargetsAndTrggers();\r\n            this.#currentIdx = idx;\r\n        }\r\n    }\r\n\r\n    private insertElement(source: Element, destination: Element) {\r\n        if (is(destination)) {\r\n            this.element.insertBefore(source, destination);\r\n        } else {\r\n            this.element.appendChild(source);\r\n        }\r\n    }\r\n\r\n    private getFinishAnimation(): AnimationProperty<PropsTypes> {\r\n        const box = this.#currentTarget.getBoundingClientRect();\r\n        return {\r\n            opacity: {\r\n                from: 1,\r\n                to: 0,\r\n            },\r\n            top: {\r\n                from: this.#preview.offsetTop,\r\n                to: box.top > 0 ? box.top : this.#preview.offsetTop,\r\n                unit: \"px\"\r\n            },\r\n            left: {\r\n                from: this.#preview.offsetLeft,\r\n                to: box.left > 0 ? box.left : this.#preview.offsetLeft,\r\n                unit: \"px\"\r\n            }\r\n        }\r\n    }\r\n}","import { are, CSS_VARIABLES, CuiColor, CuiUtils } from \"../../core/index\";\r\nimport { PropertySet, PropertySetter } from \"./setter\";\r\n\r\ninterface BaseColorSet {\r\n    background: string;\r\n    base: string;\r\n    active: string;\r\n    muted: string;\r\n    // border: string;\r\n}\r\n\r\nexport interface BaseColors {\r\n    background: CuiColor;\r\n    base: CuiColor;\r\n    active: CuiColor;\r\n    muted: CuiColor;\r\n    // border: string;\r\n}\r\n\r\ninterface ThemeColorSet {\r\n    base: string;\r\n    muted: string;\r\n    active: string;\r\n    shade: string;\r\n    shadeDark: string;\r\n}\r\n\r\ninterface ThemeColors {\r\n    base: CuiColor;\r\n    muted: CuiColor;\r\n    active: CuiColor;\r\n    shade: CuiColor;\r\n    shadeDark: CuiColor;\r\n}\r\n\r\ninterface BaseColorSets {\r\n    [id: string]: BaseColorSet;\r\n}\r\n\r\ninterface ThemeColorSets {\r\n    [id: string]: ThemeColorSet;\r\n}\r\n\r\nconst baseColorSets: BaseColorSets = {\r\n    \"light\": {\r\n        background: CSS_VARIABLES.colorLightBackground,\r\n        base: CSS_VARIABLES.colorLightBase,\r\n        active: CSS_VARIABLES.colorLightActive,\r\n        muted: CSS_VARIABLES.colorLightMuted,\r\n        //  border: CSS_VARIABLES.colorLightBorder,\r\n    },\r\n    \"dark\": {\r\n        background: CSS_VARIABLES.colorDarkBackground,\r\n        base: CSS_VARIABLES.colorDarkBase,\r\n        active: CSS_VARIABLES.colorDarkActive,\r\n        muted: CSS_VARIABLES.colorDarkMuted,\r\n        // border: CSS_VARIABLES.colorLightBorder,\r\n    }\r\n}\r\n\r\nconst themeColors: ThemeColorSets = {\r\n    'accent': {\r\n        base: CSS_VARIABLES.colorAccent,\r\n        muted: CSS_VARIABLES.colorAccentMuted,\r\n        active: CSS_VARIABLES.colorAccentActive,\r\n        shade: CSS_VARIABLES.colorAccentShade,\r\n        shadeDark: CSS_VARIABLES.colorAccentShadeDark\r\n    },\r\n    'secondary': {\r\n        base: CSS_VARIABLES.colorSecondary,\r\n        muted: CSS_VARIABLES.colorSecondaryMuted,\r\n        active: CSS_VARIABLES.colorSecondaryActive,\r\n        shade: CSS_VARIABLES.colorSecondaryShade,\r\n        shadeDark: CSS_VARIABLES.colorSecondaryShadeDark\r\n    },\r\n    'error': {\r\n        base: CSS_VARIABLES.colorError,\r\n        muted: CSS_VARIABLES.colorErrorMuted,\r\n        active: CSS_VARIABLES.colorErrorActive,\r\n        shade: CSS_VARIABLES.colorErrorShade,\r\n        shadeDark: CSS_VARIABLES.colorErrorShadeDark\r\n    },\r\n    'warning': {\r\n        base: CSS_VARIABLES.colorWarning,\r\n        muted: CSS_VARIABLES.colorWarningMuted,\r\n        active: CSS_VARIABLES.colorWarningActive,\r\n        shade: CSS_VARIABLES.colorWarningShade,\r\n        shadeDark: CSS_VARIABLES.colorWarningShadeDark\r\n    },\r\n    'success': {\r\n        base: CSS_VARIABLES.colorSuccess,\r\n        muted: CSS_VARIABLES.colorSuccessMuted,\r\n        active: CSS_VARIABLES.colorSuccessActive,\r\n        shade: CSS_VARIABLES.colorSuccessShade,\r\n        shadeDark: CSS_VARIABLES.colorSuccessShadeDark\r\n    }\r\n}\r\n\r\n\r\nexport class CuiBaseColorsSetter {\r\n    #set: BaseColorSet;\r\n    #setter: PropertySetter;\r\n    constructor(colorSet: string, setter: PropertySetter) {\r\n        this.#set = baseColorSets[colorSet];\r\n        this.#setter = setter;\r\n    }\r\n\r\n    setBackgroundColor(color: CuiColor) {\r\n        this.setColor(this.#set.background, color);\r\n    }\r\n\r\n    setBaseColor(color: CuiColor) {\r\n        this.setColor(this.#set.base, color);\r\n    }\r\n\r\n    setActiveColor(color: CuiColor) {\r\n        this.setColor(this.#set.active, color);\r\n    }\r\n\r\n    setMutedColor(color: CuiColor) {\r\n        this.setColor(this.#set.muted, color);\r\n    }\r\n\r\n    setBaseColors(colors: BaseColors) {\r\n        let set: PropertySet = {}\r\n        set[this.#set.background] = colors.background ? colors.background.toCssString() : null;\r\n        set[this.#set.active] = colors.active ? colors.active.toCssString() : null;\r\n        set[this.#set.muted] = colors.muted ? colors.muted.toCssString() : null;\r\n        set[this.#set.base] = colors.base ? colors.base.toCssString() : null;\r\n\r\n        this.#setter.setProperties(set);\r\n    }\r\n\r\n    private setColor(color: string, value: CuiColor) {\r\n        this.#setter.setProperty(color, value.toCssString());\r\n    }\r\n}\r\n\r\n\r\nexport class CuiThemeColorsSetter {\r\n    #setter: PropertySetter;\r\n    #set: ThemeColorSet;\r\n    constructor(set: string, setter: PropertySetter) {\r\n        this.#setter = setter;\r\n        this.#set = themeColors[set];\r\n    }\r\n\r\n    setBaseColor(color: CuiColor) {\r\n        this.setColor(this.#set.base, color);\r\n    }\r\n\r\n    setMutedColor(color: CuiColor) {\r\n        this.setColor(this.#set.muted, color);\r\n    }\r\n\r\n    setActiveColor(color: CuiColor) {\r\n        this.setColor(this.#set.active, color);\r\n    }\r\n\r\n    setShadeColor(color: CuiColor) {\r\n        this.setColor(this.#set.shade, color);\r\n    }\r\n\r\n    setShadeDarkColor(color: CuiColor) {\r\n        this.setColor(this.#set.shadeDark, color);\r\n    }\r\n\r\n    setColors(colors: ThemeColors) {\r\n        let set: PropertySet = {}\r\n        set[this.#set.shade] = colors.shade ? colors.shade.toCssString() : null;\r\n        set[this.#set.shadeDark] = colors.shadeDark ? colors.shadeDark.toCssString() : null;\r\n        set[this.#set.active] = colors.active ? colors.active.toCssString() : null;\r\n        set[this.#set.muted] = colors.muted ? colors.muted.toCssString() : null;\r\n        set[this.#set.base] = colors.base ? colors.base.toCssString() : null;\r\n\r\n        this.#setter.setProperties(set);\r\n    }\r\n\r\n    setAutoColors(base: CuiColor) {\r\n        let set: PropertySet = {}\r\n        set[this.#set.base] = base.toCssString();\r\n        set[this.#set.shade] = base.lighten(30).toCssString();\r\n        set[this.#set.shadeDark] = base.darken(30).toCssString();\r\n        set[this.#set.active] = base.darken(10).toCssString();\r\n        set[this.#set.muted] = base.lighten(10).toCssString();\r\n        this.#setter.setProperties(set);\r\n    }\r\n\r\n    private setColor(color: string, value: CuiColor) {\r\n        this.#setter.setProperty(color, value.toCssString());\r\n    }\r\n\r\n}","import { are, CuiUtils, is } from \"../../core/index\";\r\nexport interface PropertySet {\r\n    [property: string]: string;\r\n}\r\nexport class PropertySetter {\r\n    #utils: CuiUtils;\r\n    constructor(utils: CuiUtils) {\r\n        this.#utils = utils;\r\n    }\r\n\r\n    setProperty(property: string, value: string) {\r\n        if (!are(property, value)) {\r\n            return;\r\n        }\r\n        this.#utils.interactions.mutate(() => {\r\n            this.#utils.setProperty(property, value)\r\n        }, null)\r\n    }\r\n\r\n    setProperties(set: PropertySet) {\r\n        if (!is(set)) {\r\n            return;\r\n        }\r\n        this.#utils.interactions.mutate(() => {\r\n            for (let property in set) {\r\n                if (is(set[property]))\r\n                    this.#utils.setProperty(property, set[property])\r\n            }\r\n        }, null)\r\n    }\r\n}","import { CSS_VARIABLES, CuiColor, CuiUtils, is } from \"../../core/index\";\r\nimport { CuiBaseColorsSetter, CuiThemeColorsSetter } from \"./colors\";\r\nimport { PropertySetter } from \"./setter\";\r\n\r\nexport class CuiPropertiesHandler {\r\n    #setter: PropertySetter;\r\n    constructor(utils: CuiUtils) {\r\n        this.#setter = new PropertySetter(utils);\r\n    }\r\n\r\n    /**\r\n     * Sets main font size\r\n     * @param {number} value numeric value\r\n     * @param {string} unit optional - size unit, px if not provided\r\n     */\r\n    setBaseFontSize(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.fontSize, value, unit);\r\n    }\r\n\r\n    /**\r\n     * Sets base animation time\r\n     * @param {number} value - time value\r\n     * @param {string} unit  - optional - ms is passed when no provided\r\n     */\r\n    setAnimationTime(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.animationTime, value, unit ?? 'ms');\r\n    }\r\n\r\n    /**\r\n    * Sets long animation time\r\n    * @param {number} value - time value\r\n    * @param {string} unit  - optional - ms is passed when no provided\r\n    */\r\n    setAnimationTimeLong(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.setAnimationTimeLong, value, unit ?? 'ms');\r\n    }\r\n\r\n    /**\r\n    * Sets short animation time\r\n    * @param {number} value - time value\r\n    * @param {string} unit  - optional - ms is passed when no provided\r\n    */\r\n    setAnimationTimeShort(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.setAnimationTimeShort, value, unit ?? 'ms');\r\n    }\r\n\r\n    /**\r\n    * Sets main line size\r\n    * @param {number} value numeric value\r\n    * @param {string} unit optional - size unit, px if not provided\r\n    */\r\n    setBaseLineHeight(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.lineHeight, value, unit);\r\n    }\r\n\r\n    /**\r\n     * Sets base margin value\r\n     * @param {number} value - margin value\r\n     * @param {string} unit - optional - margin unit (px default)\r\n     */\r\n    setBaseMargin(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.margin, value, unit)\r\n    }\r\n\r\n    /**\r\n    * Sets base padding value\r\n    * @param {number} value - padding value\r\n    * @param {string} unit - optional - padding unit (px default)\r\n    */\r\n    setBasePadding(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.padding, value, unit)\r\n    }\r\n\r\n    /**\r\n    * Sets base border radius\r\n    * @param {number} value - border value\r\n    * @param {string} unit - optional - border unit (px default)\r\n    */\r\n    setBaseBorderRadius(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.borderRadius, value, unit)\r\n    }\r\n\r\n    /**\r\n   * Sets component space\r\n   * @param {number} value - space value\r\n   * @param {string} unit - optional - space unit (px default)\r\n   */\r\n    setComponentSpace(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.componentSpace, value, unit)\r\n    }\r\n\r\n    /**\r\n     * Sets new accordion chevron icon\r\n     * @param value A SVG formatted to be replaced default value\r\n     */\r\n    setAccordionIcon(value: string) {\r\n        if (!is(value)) {\r\n            return;\r\n        }\r\n        this.setCSSVariable(CSS_VARIABLES.accordionIcon, value);\r\n    }\r\n\r\n    /**\r\n    * Sets a scrollbar width\r\n    * @param value A SVG formatted to be replaced default value\r\n    */\r\n    setScrollbarWidth(value: number, unit?: string) {\r\n        this.setBaseUnitValue(CSS_VARIABLES.scrollbarWidth, value, unit);\r\n    }\r\n\r\n    /**\r\n     * Sets app viewport light background color\r\n     * @param color color to be set\r\n     */\r\n    setAppBackgroundColor(color: CuiColor) {\r\n        if (!is(color)) {\r\n            return;\r\n        }\r\n        this.setCSSVariable(CSS_VARIABLES.colorLightAppBackground, color.toCssString());\r\n    }\r\n\r\n    /**\r\n    * Sets app viewport dark background color\r\n    * @param color color to be set\r\n    */\r\n    setDarkAppBackgroundColor(color: CuiColor) {\r\n        if (!is(color)) {\r\n            return;\r\n        }\r\n        this.setCSSVariable(CSS_VARIABLES.colorDarkAppBackground, color.toCssString());\r\n    }\r\n\r\n    getBaseColorsSetter(): CuiBaseColorsSetter {\r\n        return new CuiBaseColorsSetter(\"light\", this.#setter)\r\n    }\r\n\r\n    getDarkBaseColorsSetter(): CuiBaseColorsSetter {\r\n        return new CuiBaseColorsSetter(\"dark\", this.#setter)\r\n    }\r\n\r\n    getAccentThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"accent\", this.#setter);\r\n    }\r\n\r\n    getSecondaryThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"secondary\", this.#setter);\r\n    }\r\n\r\n    getErrorThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"error\", this.#setter);\r\n    }\r\n\r\n    getWarningThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"warning\", this.#setter);\r\n    }\r\n\r\n    getSuccessThemeColorsSetter(): CuiThemeColorsSetter {\r\n        return new CuiThemeColorsSetter(\"success\", this.#setter);\r\n    }\r\n\r\n    /**\r\n     * Sets property in interactive way\r\n     * @param {string} name property name - value of {prefix} is replaced by current prefix\r\n     * @param {string} value - property value\r\n     */\r\n    setCSSVariable(name: string, value: string) {\r\n        this.#setter.setProperty(name, value);\r\n    }\r\n\r\n    /**\r\n     * Sets unit type CSS variable property\r\n     * @param name Variable name\r\n     * @param value numeric value\r\n     * @param unit unit - optional - px is default value\r\n     */\r\n    private setBaseUnitValue(name: string, value: number, unit?: string) {\r\n        if (!is(value)) {\r\n            return;\r\n        }\r\n        let strVal = `${value}${unit ?? \"px\"}`;\r\n        this.setCSSVariable(name, strVal);\r\n    }\r\n}","import { CuiColor, CuiLoggerFactory, is } from \"../../core/index\";\r\nimport { ICuiLogger, ICuiPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiBaseColorsSetter } from \"./colors\";\r\nimport { CuiPropertiesHandler } from \"./handler\";\r\nexport interface CssChangeEvent {\r\n    method: string,\r\n    arg: any\r\n}\r\nexport interface CuiCSSVariablesPluginSetup {\r\n\r\n}\r\n\r\nexport class CuiCSSVariablesPlugin implements ICuiPlugin {\r\n    description: string;\r\n    name: string = 'css-variables-plugin';\r\n    setup: CuiCSSVariablesPluginSetup;\r\n    handler: CuiPropertiesHandler;\r\n    #log: ICuiLogger;\r\n    constructor(keySetup: CuiCSSVariablesPluginSetup) {\r\n        this.description = \"CuiCSSVariablesPlugin\";\r\n        this.setup = keySetup;\r\n        this.#log = CuiLoggerFactory.get(\"CuiCSSVariablesPlugin\");\r\n\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.handler = new CuiPropertiesHandler(utils);\r\n        utils.bus.on(\"csschange\", this.onCssChange.bind(this))\r\n    }\r\n\r\n    destroy(): void {\r\n\r\n    }\r\n\r\n    onCssChange(event: CssChangeEvent) {\r\n        let setter = null;\r\n        let accentSetter = null;\r\n        switch (event.method) {\r\n            case \"baseFontSize\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBaseFontSize(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"baseLineHeight\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBaseLineHeight(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"animationTime\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setAnimationTime(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"animationTimeLong\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setAnimationTimeLong(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"animationTimeShort\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setAnimationTimeShort(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"margin\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBaseMargin(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"padding\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBasePadding(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"borderRadius\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setBaseBorderRadius(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"componentSpace\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setComponentSpace(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"scrollbarWidth\":\r\n                if (!this.isArgNumber(event.arg)) return;\r\n                this.handler.setScrollbarWidth(event.arg.value, event.arg.unit);\r\n                break;\r\n            case \"accordionIcon\":\r\n                if (!is(event.arg)) return;\r\n                this.handler.setAccordionIcon(event.arg);\r\n                break;\r\n            case \"appLightBackground\":\r\n                if (!is(event.arg)) return;\r\n                this.handler.setAppBackgroundColor(CuiColor.create(event.arg));\r\n                break;\r\n            case \"appDarkBackground\":\r\n                if (!is(event.arg)) return;\r\n                this.handler.setDarkAppBackgroundColor(CuiColor.create(event.arg));\r\n                break;\r\n            case \"appDarkBackground\":\r\n                if (!is(event.arg)) return;\r\n                this.handler.setDarkAppBackgroundColor(CuiColor.create(event.arg));\r\n                break;\r\n            case \"mainColorBackground\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                setter = this.getBaseColorSetter(event.arg.palette);\r\n                setter.setBackgroundColor(CuiColor.create(event.arg.color))\r\n                break;\r\n            case \"mainColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                setter = this.getBaseColorSetter(event.arg.palette);\r\n                setter.setBaseColor(CuiColor.create(event.arg.color))\r\n                break;\r\n            case \"mainColorMuted\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                setter = this.getBaseColorSetter(event.arg.palette);\r\n                setter.setMutedColor(CuiColor.create(event.arg.color))\r\n                break;\r\n            case \"mainColorActive\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                setter = this.getBaseColorSetter(event.arg.palette);\r\n                setter.setActiveColor(CuiColor.create(event.arg.color))\r\n                break;\r\n            case \"themeAutoColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                accentSetter.setAutoColors(CuiColor.create(event.arg.color))\r\n            case \"themeBaseColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                accentSetter.setAutoColors(CuiColor.create(event.arg.color))\r\n            case \"themeMutedColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                accentSetter.setMutedColor(CuiColor.create(event.arg.color))\r\n            case \"themeActiveColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                accentSetter.setActiveColor(CuiColor.create(event.arg.color))\r\n\r\n            case \"themeShadeColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                accentSetter.setShadeColor(CuiColor.create(event.arg.color))\r\n            case \"themeShadeDarkColor\":\r\n                if (!this.isArgColor(event.arg)) return;\r\n                accentSetter = this.getAccentColorSetter(event.arg.palette);\r\n                accentSetter.setShadeDarkColor(CuiColor.create(event.arg.color))\r\n            default:\r\n                this.#log.warning(\"Unknown event method\", \"onCssChange\");\r\n        }\r\n    }\r\n\r\n    private isArgNumber(arg: any): boolean {\r\n        return is(arg) && is(arg.value);\r\n    }\r\n\r\n    private isArgColor(arg: any) {\r\n        return is(arg) && is(arg.palette) && is(arg.color);\r\n    }\r\n\r\n    private getBaseColorSetter(pallete: string) {\r\n        let prerp = pallete.trim().toLowerCase();\r\n        switch (prerp) {\r\n            case \"light\":\r\n                return this.handler.getBaseColorsSetter();\r\n            case \"dark\":\r\n                return this.handler.getDarkBaseColorsSetter();\r\n        }\r\n    }\r\n\r\n    private getAccentColorSetter(pallete: string) {\r\n        let prerp = pallete.trim().toLowerCase();\r\n        switch (prerp) {\r\n            case \"accent\":\r\n                return this.handler.getAccentThemeColorsSetter();\r\n            case \"secondary\":\r\n                return this.handler.getSecondaryThemeColorsSetter();\r\n            case \"error\":\r\n                return this.handler.getErrorThemeColorsSetter();\r\n            case \"warning\":\r\n                return this.handler.getWarningThemeColorsSetter();\r\n            case \"success\":\r\n                return this.handler.getSuccessThemeColorsSetter();\r\n        }\r\n    }\r\n}\r\n","import { ElementBuilder } from \"../../app/builders/element\";\r\nimport { CuiHandler } from \"../../app/handlers/base\";\r\nimport { CuiAnimationEngine } from \"../../core/animation/engine\";\r\nimport { CuiActionsListFactory, CuiUtils, getIntOrDefault, getStringOrDefault, ICuiComponent, ICuiComponentAction, ICuiComponentHandler, ICuiParsable, is, isString, replacePrefix, sleep } from \"../../core/index\";\r\nimport { CuiHoverEvent, CuiHoverListener } from \"../../core/listeners/hover\";\r\nimport { CuiBasePositionCalculator } from \"../../core/position/calculator\";\r\nimport { ICuiPositionCalculator } from \"../../core/position/interfaces\";\r\nimport { CuiTaskRunner, ICuiTask } from \"../../core/utils/task\";\r\n\r\nconst TOOLTIP_ACTION = \".{prefix}-animation-tooltip-in\";\r\nconst TOOLTIP_DATA = \"{prefix}-tooltip-data\";\r\n\r\nexport class CuiTooltipArgs implements ICuiParsable {\r\n    content: string;\r\n    width: number;\r\n    pos: string;\r\n    margin: number;\r\n    action: string;\r\n    timeout: number;\r\n    #defAct: string;\r\n    constructor(prefix: string) {\r\n        this.#defAct = replacePrefix(TOOLTIP_ACTION, prefix)\r\n        this.content = undefined;\r\n        this.width = 150;\r\n        this.margin = 8;\r\n        this.timeout = 3000;\r\n        this.pos = null;\r\n        this.action = this.#defAct;\r\n    }\r\n\r\n    parse(val: any): void {\r\n        if (isString(val)) {\r\n            this.content = getStringOrDefault(val, \"\");\r\n            return;\r\n        }\r\n        this.content = getStringOrDefault(val.content, \"\");\r\n        this.width = getIntOrDefault(val.width, 150);\r\n        this.margin = getIntOrDefault(val.margin, 8);\r\n        this.pos = getStringOrDefault(val.pos, null);\r\n        this.action = getStringOrDefault(val.action, this.#defAct);\r\n        this.timeout = getIntOrDefault(val.timeout, 3000);\r\n    }\r\n}\r\n\r\nexport class CuiTooltipComponent implements ICuiComponent {\r\n    attribute: string;\r\n    #prefix: string;\r\n\r\n    constructor(prefix?: string) {\r\n        this.#prefix = prefix ?? 'cui';\r\n        this.attribute = `${this.#prefix}-tooltip`;\r\n    }\r\n\r\n\r\n    getStyle(): string {\r\n        return null;\r\n    }\r\n\r\n    get(element: HTMLElement, sutils: CuiUtils): ICuiComponentHandler {\r\n        return new CuiTooltipHandler(element, this.attribute, sutils, this.#prefix);\r\n    }\r\n}\r\n\r\nexport class CuiTooltipHandler extends CuiHandler<CuiTooltipArgs> {\r\n    #hoverListener: CuiHoverListener;\r\n    #tooltip: HTMLElement;\r\n    #margin: number;\r\n    #positionCalculator: ICuiPositionCalculator;\r\n    #tooltipDataCls: string;\r\n    #actions: ICuiComponentAction[];\r\n    #task: ICuiTask;\r\n    constructor(element: HTMLElement, attribute: string, utils: CuiUtils, prefix: string) {\r\n        super(\"CuiTooltipHandler\", element, attribute, new CuiTooltipArgs(prefix), utils);\r\n        this.#tooltipDataCls = replacePrefix(TOOLTIP_DATA, prefix);\r\n        this.#hoverListener = new CuiHoverListener(element);\r\n        this.#hoverListener.setCallback(this.onHover.bind(this));\r\n        this.#margin = 8;\r\n        this.#positionCalculator = new CuiBasePositionCalculator();\r\n        this.#positionCalculator.setPreferred(\"top-center\");\r\n    }\r\n\r\n    onInit(): void {\r\n        this.#hoverListener.attach();\r\n        this.getDataFromArgs();\r\n        this.#task = new CuiTaskRunner(this.args.timeout, false, this.removeTooltip.bind(this));\r\n    }\r\n\r\n    onUpdate(): void {\r\n        this.getDataFromArgs();\r\n        this.#task.setTimeout(this.args.timeout);\r\n    }\r\n\r\n    onDestroy(): void {\r\n        this.#hoverListener.detach();\r\n    }\r\n\r\n    onHover(ev: CuiHoverEvent) {\r\n        if (ev.isHovering) {\r\n            this.createTooltip();\r\n        } else {\r\n            this.removeTooltip();\r\n        }\r\n    }\r\n\r\n    private createTooltip() {\r\n        if (is(this.#tooltip) || !is(this.args.content)) {\r\n            return;\r\n        }\r\n        const box = this.element.getBoundingClientRect();\r\n        this.#tooltip = new ElementBuilder(\"div\").setClasses(this.#tooltipDataCls).build();\r\n        this.#tooltip.textContent = this.args.content;\r\n        this.#tooltip.style.maxWidth = `${this.args.width}px`;\r\n        document.body.appendChild(this.#tooltip);\r\n        this.mutate(() => {\r\n            if (!this.#tooltip) {\r\n                return;\r\n            }\r\n            const toolbox = this.#tooltip.getBoundingClientRect();\r\n            this.#positionCalculator.setMargin(this.#margin);\r\n            try {\r\n                let [x, y] = this.#positionCalculator.calculate(box, toolbox.width, toolbox.height);\r\n                this.#tooltip.style.top = `${y}px`;\r\n                this.#tooltip.style.left = `${x}px`;\r\n                this.toggleActions();\r\n                this.#task.start();\r\n            } catch (e) {\r\n                this._log.exception(e);\r\n            }\r\n\r\n        })\r\n    }\r\n\r\n    private removeTooltip() {\r\n        if (!is(this.#tooltip)) {\r\n            return;\r\n        }\r\n        this.#task.stop();\r\n        this.mutate(() => {\r\n            this.#tooltip.remove();\r\n            this.#tooltip = null;\r\n        })\r\n    }\r\n\r\n    private getDataFromArgs() {\r\n        this.#positionCalculator.setMargin(this.args.margin);\r\n        this.#positionCalculator.setStatic(this.args.pos);\r\n        this.#actions = CuiActionsListFactory.get(this.args.action);\r\n    }\r\n\r\n    private toggleActions() {\r\n        this.#actions.forEach(action => {\r\n            action.toggle(this.#tooltip);\r\n        })\r\n    }\r\n}","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is } from \"../core/utils/functions\";\r\nimport { CuiInstance } from \"./instance\";\r\nimport { ICONS } from \"../core/utils/statics\";\r\nimport { ICuiPlugin, CuiInitData, CuiInitResult, ICuiComponent } from \"../core/models/interfaces\";\r\nimport { CuiAutoLightModePlugin } from \"../plugins/light/light\";\r\nimport { CuiIconComponent } from \"../components/icon/icon\";\r\nimport { CuiCircleComponent } from \"../components/circle/circle\";\r\nimport { CuiSpinnerComponent } from \"../components/spinner/spinner\";\r\nimport { CuiDummyComponent } from \"../components/dummy/dummy\";\r\nimport { CuiScrollComponent } from \"../components/scroll/scroll\";\r\nimport { CuiScrollspyComponent } from \"../components/scrollspy/scrollspy\";\r\nimport { CuiAutoPrintModePlugin } from \"../plugins/print/print\";\r\nimport { CuiIntersectionComponent } from \"../components/intersection/intersection\";\r\nimport { CuiOpenComponent } from \"../components/open/open\";\r\nimport { CuiCloseComponent } from \"../components/close/close\";\r\nimport { CuiToggleComponent } from \"../components/toggle/toggle\";\r\nimport { CuiResizeComponent } from \"../components/resize/resize\";\r\nimport { CuiKeysObserverPlugin } from \"../plugins/keys/keys\";\r\nimport { CuiDialogComponent } from \"../components/dialog/dialog\";\r\nimport { CuiOffCanvasArgs, CuiOffCanvasComponent } from \"../components/offcanvas/offcanvas\";\r\nimport { CuiAccordionComponent } from \"../components/accordion/accordion\";\r\nimport { CuiDropComponenet } from \"../components/drop/drop\";\r\nimport { CuiWindowClickPlugin } from \"../plugins/click/click\";\r\nimport { CuiOffsetComponent } from \"../components/offset/offset\";\r\nimport { CuiSwitchArgs, CuiSwitchComponent } from \"../components/switch/switch\";\r\nimport { CuiSwitcherComponent } from \"../components/switch/switcher\";\r\nimport { CuiFloatComponent } from \"../components/float/float\";\r\nimport { CuiSliderComponent } from \"../components/switch/slider\";\r\nimport { SWIPE_ANIMATIONS_DEFINITIONS } from \"./animation/definitions\";\r\nimport { CuiBanerComponent } from \"../components/banner/banner\";\r\nimport { CuiCoverComponent } from \"../components/cover/cover\";\r\nimport { CuiSortableComponent } from \"../components/sortable/sortable\";\r\nimport { CuiCSSVariablesPlugin } from \"../plugins/properties/properties\";\r\nimport { CuiTooltipComponent } from \"../components/tooltip/tooltip\";\r\n\r\nexport class CuiInitializer {\r\n    #window: any;\r\n    constructor() {\r\n        this.#window = window;\r\n    }\r\n\r\n    async init(setup: CuiInitData): Promise<CuiInitResult> {\r\n        let settings: CuiSetupInit = { ... new CuiSetupInit(), ...setup.setup }\r\n        const appPrefix: string = settings.app;\r\n        const result: CuiInitResult = {\r\n            result: false\r\n        }\r\n        if (is(this.#window[appPrefix])) {\r\n            result.message = \"Instance is already initialized\";\r\n            return result;\r\n        }\r\n        if (is(setup.icons)) {\r\n            for (let icon in setup.icons) {\r\n                ICONS[icon] = setup.icons[icon];\r\n            }\r\n        }\r\n        if (is(setup.swipeAnimations)) {\r\n            for (let animation in setup.swipeAnimations) {\r\n                SWIPE_ANIMATIONS_DEFINITIONS[animation] = setup.swipeAnimations[animation];\r\n            }\r\n\r\n        }\r\n        try {\r\n            this.#window[appPrefix] = new CuiInstance(settings, setup.plugins, setup.components)\r\n            this.#window[appPrefix].init();\r\n        } catch (e) {\r\n            console.error(e);\r\n            result.message = \"An error occured during initialization\";\r\n            return result;\r\n        }\r\n        result.result = true;\r\n        return result;\r\n    }\r\n}\r\n\r\nexport class CuiInit {\r\n    #isInitialized: boolean;\r\n    constructor() {\r\n        this.#isInitialized = false;\r\n    }\r\n\r\n    async init(data: CuiInitData): Promise<boolean> {\r\n        if (this.#isInitialized) {\r\n            console.log(\"Module is already initialized\")\r\n            return false;\r\n        }\r\n        const initializer = new CuiInitializer();\r\n        const pluginList: ICuiPlugin[] = [\r\n            new CuiAutoLightModePlugin({ autoLight: true }),\r\n            new CuiAutoPrintModePlugin({ autoPrint: true }),\r\n            new CuiKeysObserverPlugin(null),\r\n            new CuiWindowClickPlugin(),\r\n            new CuiCSSVariablesPlugin({})\r\n        ];\r\n\r\n        const componentList: ICuiComponent[] = [\r\n            new CuiIconComponent(),\r\n            new CuiTooltipComponent(),\r\n            new CuiCircleComponent(),\r\n            new CuiSpinnerComponent(),\r\n            new CuiDummyComponent(),\r\n            new CuiScrollComponent(),\r\n            new CuiScrollspyComponent(),\r\n            new CuiIntersectionComponent(),\r\n            new CuiOpenComponent(),\r\n            new CuiCloseComponent(),\r\n            new CuiToggleComponent(),\r\n            new CuiResizeComponent(),\r\n            new CuiDialogComponent(),\r\n            new CuiOffCanvasComponent(),\r\n            new CuiAccordionComponent(),\r\n            new CuiDropComponenet(),\r\n            new CuiOffsetComponent(),\r\n            new CuiSwitchComponent(),\r\n            new CuiSwitcherComponent(),\r\n            new CuiFloatComponent(),\r\n            new CuiSliderComponent(),\r\n            new CuiBanerComponent(),\r\n            new CuiCoverComponent(),\r\n            new CuiSortableComponent(),\r\n        ];\r\n\r\n        let result = await initializer.init({\r\n            setup: data.setup,\r\n            icons: data.icons,\r\n            plugins: is(data.plugins) ? [...pluginList, ...data.plugins] : pluginList,\r\n            components: is(data.components) ? [...componentList, ...data.components] : componentList,\r\n            swipeAnimations: data.swipeAnimations\r\n        })\r\n        if (result.result) {\r\n            this.#isInitialized = true;\r\n            return true;\r\n        } else {\r\n            console.error(`A cUI instance failed to initialize: [${result.message ?? \"#\"}]`);\r\n        }\r\n        console.log(\"Cui Light failed to init\")\r\n        return false;\r\n\r\n    }\r\n}","import { is, are } from \"../../core/utils/functions\";\r\nimport { ICuiLogger, IUIInteractionProvider, CuiCachable, CuiElement, CuiContext } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiActionsHelper } from \"../../core/helpers/helpers\";\r\nimport { CuiClassAction } from \"../../core/utils/actions\";\r\n\r\nexport class ElementManager implements CuiCachable {\r\n    #elements: Element[];\r\n    #isLocked: boolean;\r\n    #logger: ICuiLogger;\r\n    #cDt: number;\r\n    #utils: CuiUtils;\r\n    #actionsHelper: CuiActionsHelper;\r\n    constructor(elements: Element[], utils: CuiUtils) {\r\n        this.#elements = elements;\r\n        this.#isLocked = false;\r\n        this.#logger = CuiLoggerFactory.get(\"ElementManager\");\r\n        this.#utils = utils;\r\n        this.#cDt = Date.now();\r\n        this.#actionsHelper = new CuiActionsHelper(utils.interactions);\r\n    }\r\n\r\n    async toggleClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className);\r\n            } else {\r\n                element.classList.remove(className);\r\n            }\r\n        }, 'toggleClass');\r\n    }\r\n\r\n    async toggleClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                } else {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleClassAs');\r\n    }\r\n\r\n    async setClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (!element.classList.contains(className)) {\r\n                element.classList.add(className)\r\n            }\r\n        }, 'setClass');\r\n    }\r\n\r\n    async setClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (!classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.add, classes, className);\r\n                }\r\n            }, this)\r\n\r\n        }, 'setClassAs');\r\n    }\r\n\r\n    async removeClass(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.classList.contains(className)) {\r\n                element.classList.remove(className)\r\n            }\r\n        }, 'removeClass');\r\n    }\r\n\r\n    async removeClassAs(className: string): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            let classes = element.classList;\r\n            this.#utils.interactions.fetch(() => {\r\n                if (classes.contains(className)) {\r\n                    this.#utils.interactions.mutate(classes.remove, classes, className);\r\n                }\r\n            }, this)\r\n        }, 'removeClass');\r\n    }\r\n\r\n    getAttribute(attributeName: string): string[] {\r\n        if (!is(attributeName)) {\r\n            return null;\r\n        }\r\n        return this.#elements.reduce<string[]>((val: string[], current: Element) => {\r\n            if (current.hasAttribute(attributeName)) {\r\n                val.push(current.getAttribute(attributeName))\r\n            } else {\r\n                val.push(null);\r\n            }\r\n            return val;\r\n        }, []);\r\n    }\r\n\r\n    async setAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.setAttribute(attributeName, attributeValue ?? \"\")\r\n        }, 'setAttribute');\r\n    }\r\n\r\n    async setAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n        }, 'setAttributeAs');\r\n    }\r\n\r\n    async removeAttribute(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.removeAttribute(attributeName)\r\n        }, 'removeAttribute');\r\n    }\r\n\r\n    async removeAttributeAs(attributeName: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n        }, 'removeAttributeAs');\r\n    }\r\n\r\n    async toggleAttribute(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            if (element.hasAttribute(attributeName)) {\r\n                element.removeAttribute(attributeName)\r\n            } else {\r\n                element.setAttribute(attributeName, attributeValue ?? \"\")\r\n            }\r\n        }, 'toggleAttribute');\r\n    }\r\n\r\n    async toggleAttributeAs(attributeName: string, attributeValue?: string): Promise<boolean> {\r\n        if (!is(attributeName)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            this.#utils.interactions.fetch(() => {\r\n                if (element.hasAttribute(attributeName)) {\r\n                    this.#utils.interactions.mutate(element.removeAttribute, element, attributeName);\r\n                } else {\r\n                    this.#utils.interactions.mutate(element.setAttribute, element, attributeName, attributeValue ?? \"\")\r\n                }\r\n            }, this)\r\n\r\n        }, 'toggleAttributeAs');\r\n    }\r\n\r\n    async click(onClick: (ev: MouseEvent) => void): Promise<boolean> {\r\n        if (!is(onClick)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener('click', onClick);\r\n        }, 'click');\r\n    }\r\n\r\n    async event(eventName: string, callback: any): Promise<boolean> {\r\n        if (!is(eventName) || !is(callback)) {\r\n            return false;\r\n        }\r\n        return this.call((element) => {\r\n            element.addEventListener(eventName, callback);\r\n        }, 'event');\r\n    }\r\n\r\n    async call(callback: (element: Element, index: Number) => void, functionName?: string): Promise<boolean> {\r\n        if (this.#isLocked) {\r\n            this.#logger.error(\"Element is locked\", functionName)\r\n        }\r\n        this.lock();\r\n        this.#elements.forEach((element, index) => {\r\n            callback(element, index)\r\n        })\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async animate(className: string, timeout?: number): Promise<boolean> {\r\n        if (!is(className)) {\r\n            return false;\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        return this.call((element) => {\r\n            this.change(() => {\r\n                element.classList.add(className);\r\n                element.classList.add(CLASSES.animProgress);\r\n                setTimeout(() => {\r\n                    this.change(() => {\r\n                        element.classList.remove(className);\r\n                        element.classList.remove(CLASSES.animProgress);\r\n                    })\r\n                }, delay)\r\n            })\r\n        });\r\n    }\r\n\r\n    async open(openClass: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!are(openClass, animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            this.#actionsHelper.performAction(element, action, delay).then(() => {\r\n                element.classList.add(openClass);\r\n            })\r\n        });\r\n    }\r\n\r\n    async close(closeClass: string, animationClass: string, timeout?: number): Promise<boolean> {\r\n        if (!are(closeClass, animationClass)) {\r\n            return false\r\n        }\r\n        const delay = timeout ?? this.#utils.setup.animationTime;\r\n        const action = new CuiClassAction(animationClass);\r\n        return this.call((element) => {\r\n            this.#actionsHelper.performAction(element, action, delay).then(() => {\r\n                element.classList.remove(closeClass);\r\n            })\r\n        });\r\n    }\r\n\r\n    emit(event: string, ...args: any[]): void {\r\n        if (!is(event)) {\r\n            this.#logger.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuid = (<CuiElement>(element as any)).$cuid;\r\n            if (is(cuid)) {\r\n                this.#logger.debug(`Emitting event ${event} to ${cuid}`)\r\n                this.#utils.bus.emit(event, cuid, ...args);\r\n            }\r\n        }, \"emit\")\r\n    }\r\n\r\n    on(event: string, callback: any): string[] {\r\n        let ids: string[] = []\r\n        if (!are(event, callback)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"on\")\r\n            return ids;\r\n        }\r\n\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                ids.push(this.#utils.bus.on(event, callback, cuiElement));\r\n            }\r\n        }, \"on\")\r\n        return ids;\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#logger.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.call((element: Element) => {\r\n            let cuiElement = (<CuiElement>(element as any));\r\n            if (is(cuiElement)) {\r\n                this.#utils.bus.detach(event, id, cuiElement);\r\n            }\r\n        }, \"detach\")\r\n    }\r\n\r\n    read(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.fetch(callback, this, ...args)\r\n    }\r\n\r\n    change(callback: any, ...args: any[]): void {\r\n        this.#utils.interactions.mutate(callback, this, ...args)\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    count() {\r\n        return this.#elements.length;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false;\r\n    }\r\n\r\n    isLocked(): boolean {\r\n        return this.#isLocked;\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return (Date.now() - this.#cDt) < 360000;\r\n    }\r\n}","import { IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { is, sleep } from \"../../core/utils/functions\";\r\nimport { CLASSES } from \"../../core/utils/statics\";\r\n\r\nexport class CuiToastHandler {\r\n    #interactions: IUIInteractionProvider;\r\n    #selector: string;\r\n    #className: string;\r\n    #activeCls: string;\r\n    #animationTime: number;\r\n    #lock: boolean;\r\n    #animClsIn: string;\r\n    #animClsOut: string;\r\n    constructor(interaction: IUIInteractionProvider, prefix: string, animationTime: number) {\r\n        this.#interactions = interaction;\r\n        this.#selector = `.${prefix}-toast`;\r\n        this.#className = `${prefix}-toast`;\r\n        this.#activeCls = `${prefix}-active`;\r\n        this.#animationTime = animationTime;\r\n        this.#lock = false;\r\n        this.#animClsIn = `${prefix}-toast-animation-in`;\r\n        this.#animClsOut = `${prefix}-toast-animation-out`\r\n    }\r\n\r\n    async show(message: string): Promise<boolean> {\r\n        if (this.#lock) {\r\n            return false;\r\n        }\r\n        this.#lock = true;\r\n        let toastElement = document.querySelector(this.#selector);\r\n        if (!is(toastElement)) {\r\n            toastElement = document.createElement('div');\r\n            toastElement.classList.add(this.#className);\r\n            document.body.appendChild(toastElement);\r\n            await sleep(10);\r\n        }\r\n\r\n        this.#interactions.mutate(() => {\r\n            toastElement.textContent = message;\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            toastElement.classList.add(this.#animClsIn);\r\n        }, this);\r\n\r\n        await sleep(this.#animationTime);\r\n        this.#interactions.mutate(() => {\r\n            toastElement.classList.remove(CLASSES.animProgress);\r\n            toastElement.classList.remove(this.#animClsIn);\r\n            toastElement.classList.add(this.#activeCls);\r\n        }, this)\r\n        await sleep(3000);\r\n        this.#interactions.mutate(() => {\r\n            toastElement.classList.add(CLASSES.animProgress);\r\n            toastElement.classList.add(this.#animClsOut);\r\n        }, this)\r\n\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(() => {\r\n                toastElement.classList.remove(CLASSES.animProgress);\r\n                toastElement.classList.remove(this.#animClsOut);\r\n                toastElement.classList.remove(this.#activeCls);\r\n            }, this)\r\n            this.#lock = false;\r\n        }, this.#animationTime);\r\n        return true;\r\n    }\r\n}","import { CLASSES } from \"../../core/utils/statics\";\r\nimport { ICuiLogger, IUIInteractionProvider } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CollectionManagerHelper {\r\n    #elements: Element[];\r\n    #log: ICuiLogger;\r\n    #isLocked: boolean;\r\n    #toggleClass: string;\r\n    #interactions: IUIInteractionProvider;\r\n    constructor(interactions: IUIInteractionProvider) {\r\n        this.#interactions = interactions;\r\n        this.#log = CuiLoggerFactory.get('CollectionManager');\r\n    }\r\n\r\n    setElements(elements: Element[]) {\r\n        this.#elements = elements;\r\n    }\r\n\r\n    setToggle(className: string) {\r\n        this.#toggleClass = className;\r\n    }\r\n\r\n    addAnimationClass(currentElement: Element, nextElement: Element, animIn: string, animOut: string,): void {\r\n        nextElement.classList.add(CLASSES.animProgress);\r\n        currentElement.classList.add(animOut);\r\n        nextElement.classList.add(animIn);\r\n    }\r\n\r\n    setFinalClasses(currentElement: Element, nextElement: Element, animIn: string, animOut: string): void {\r\n        nextElement.classList.remove(CLASSES.animProgress);\r\n        currentElement.classList.remove(animOut);\r\n        nextElement.classList.remove(animIn);\r\n        currentElement.classList.remove(this.#toggleClass);\r\n        nextElement.classList.add(this.#toggleClass);\r\n    }\r\n\r\n    verifyIndex(index: number, current: number, count: number): boolean {\r\n        return index >= 0 && index !== current && index < count\r\n    }\r\n\r\n    async setCurrent(newIndex: number, current: number): Promise<boolean> {\r\n        this.lock();\r\n        this.#log.debug(`Switching index from: ${current} to ${newIndex}`)\r\n        if (current > -1)\r\n            this.#elements[current].classList.remove(this.#toggleClass);\r\n        this.#elements[newIndex].classList.add(this.#toggleClass);\r\n        this.unlock();\r\n        return true;\r\n    }\r\n\r\n    async setCurrentWithAnimation(newIndex: number, animClassIn: string, animClassOut: string, duration: number, current: number): Promise<boolean> {\r\n        this.lock()\r\n        this.#log.debug(`Switching index from: ${current} to ${newIndex}`)\r\n\r\n        const currentElement = this.#elements[current];\r\n        const nextElement = this.#elements[newIndex];\r\n        this.#interactions.mutate(this.addAnimationClass, this, currentElement, nextElement, animClassIn, animClassOut);\r\n        setTimeout(() => {\r\n            this.#interactions.mutate(this.setFinalClasses, this, currentElement, nextElement, animClassIn, animClassOut)\r\n            this.unlock();\r\n        }, duration)\r\n        return true;\r\n    }\r\n\r\n    getCurrentIndex(): number {\r\n        if (!is(this.#toggleClass)) {\r\n            return -1;\r\n        }\r\n        let len = this.count();\r\n        for (let i = 0; i < len; i++) {\r\n            if (this.#elements[i].classList.contains(this.#toggleClass)) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n\r\n    elements(): Element[] {\r\n        return this.#elements;\r\n    }\r\n\r\n    check(): boolean {\r\n        if (this.#isLocked) {\r\n            this.#log.warning(\"Object locked. Operation in progress\", \"Check\");\r\n            return false;\r\n        } else if (!is(this.#toggleClass)) {\r\n            this.#log.warning(\"Toggle is not set. Call setToggleClass\", \"Check\");\r\n            return false;\r\n        } else if (this.count() <= 0) {\r\n            this.#log.warning(\"Elements list is empty\", \"Check\");\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    count(): number {\r\n        return this.#elements ? this.#elements.length : -1;\r\n    }\r\n\r\n    lock() {\r\n        this.#isLocked = true;\r\n    }\r\n\r\n    unlock() {\r\n        this.#isLocked = false\r\n    }\r\n\r\n\r\n}","import { IUIInteractionProvider, ICuiLogger, CuiCachable } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { CollectionManagerHelper } from \"../helpers/collection\";\r\n\r\nexport class CollectionManager implements CuiCachable {\r\n    #log: ICuiLogger;\r\n\r\n    #cDt: number;\r\n    #helper: CollectionManagerHelper;\r\n\r\n    constructor(elements: Element[], interactions: IUIInteractionProvider) {\r\n        this.#log = CuiLoggerFactory.get('CollectionManager');\r\n        this.#helper = new CollectionManagerHelper(interactions);\r\n        this.#helper.setElements(elements);\r\n        this.#cDt = Date.now();\r\n    }\r\n\r\n    setToggle(className: string) {\r\n        this.#helper.setToggle(className)\r\n    }\r\n\r\n    setElements(elements: Element[]) {\r\n        this.#helper.setElements(elements);\r\n    }\r\n\r\n    click(callback: (element: Element, index: number) => void): void {\r\n        this.#helper.elements().forEach((element, index) => {\r\n            element.addEventListener('click', () => {\r\n                this.set(index).then(() => {\r\n                    if (callback) {\r\n                        callback(element, index)\r\n                    }\r\n                })\r\n            })\r\n        })\r\n    }\r\n\r\n    async next(): Promise<boolean> {\r\n        if (!this.#helper.check()) {\r\n            return false;\r\n        }\r\n        let newIdx = this.#helper.getCurrentIndex() + 1;\r\n        return this.set(newIdx >= this.length() ? 0 : newIdx);\r\n    }\r\n\r\n    async previous(): Promise<boolean> {\r\n        if (!this.#helper.check()) {\r\n            return false;\r\n        }\r\n        let newIdx = this.#helper.getCurrentIndex() - 1;\r\n        return this.set(newIdx < 0 ? this.length() - 1 : newIdx)\r\n    }\r\n\r\n    async set(index: number): Promise<boolean> {\r\n        let current = this.#helper.getCurrentIndex();\r\n        if (!this.#helper.check() || !this.#helper.verifyIndex(index, current, this.length())) {\r\n            return false;\r\n        }\r\n        return this.#helper.setCurrent(index, current)\r\n    }\r\n\r\n    async setWithAnimation(index: number, animClassIn: string, animClassOut: string, duration: number): Promise<boolean> {\r\n        let current = this.#helper.getCurrentIndex();\r\n        if (!this.#helper.check() || !this.#helper.verifyIndex(index, current, this.length())) {\r\n            return false;\r\n        }\r\n        return this.#helper.setCurrentWithAnimation(index, animClassIn, animClassOut, duration, current)\r\n    }\r\n\r\n    getCurrentIndex(): number {\r\n        return this.#helper.getCurrentIndex();\r\n    }\r\n\r\n    length() {\r\n        return this.#helper.count();\r\n    }\r\n\r\n    refresh(): boolean {\r\n        return this.length() > 0 && Date.now() - this.#cDt > 360000;\r\n    }\r\n}","import { ICuiPluginManager, ICuiPlugin, ICuiLogger, ICuiMutiationPlugin } from \"../../core/models/interfaces\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is } from \"../../core/utils/functions\";\r\n\r\nexport class CuiPluginManager implements ICuiPluginManager {\r\n    #plugins: ICuiPlugin[];\r\n    #mutated: ICuiMutiationPlugin[];\r\n    #log: ICuiLogger;\r\n    constructor(plugins: ICuiPlugin[]) {\r\n        this.#plugins = plugins ?? [];\r\n        this.#log = CuiLoggerFactory.get(\"CuiPluginManager\")\r\n    }\r\n\r\n    init(utils: CuiUtils): void {\r\n        this.#log.debug(\"Plugins initialization started: \" + this.#plugins.length)\r\n        this.#mutated = this.#plugins.filter((plugin: any) => {\r\n            return is(plugin.mutation);\r\n        }) as any;\r\n        this.#plugins.forEach(plugin => {\r\n            plugin.init(utils);\r\n            utils.setup.plugins[plugin.description] = plugin.setup;\r\n        })\r\n        this.#log.debug(\"Plugins have been initialized\");\r\n    }\r\n\r\n    get(name: string): ICuiPlugin {\r\n        if (!is(name)) {\r\n            return undefined;\r\n        }\r\n        return this.#plugins.find(p => p.name === name);\r\n    }\r\n\r\n    async onMutation(mutation: MutationRecord): Promise<boolean> {\r\n        let tasks: Promise<boolean>[] = [];\r\n        this.#mutated.forEach((plugin: any) => {\r\n            tasks.push(plugin.mutation(mutation))\r\n        })\r\n        let result: boolean[] = await Promise.all(tasks);\r\n        return result.find(val => {\r\n            val === false\r\n        }) ? false : true;\r\n    }\r\n\r\n}","import { ElementBuilder } from \"./element\";\r\nimport { is } from \"../../core/index\";\r\n\r\nexport class DialogBuilder {\r\n    #header: Element;\r\n    #body: Element;\r\n    #footer: Element;\r\n    #prefix: string;\r\n    #switches: string;\r\n    #reverse: boolean;\r\n    constructor(prefix: string, reverse: boolean, switches?: string) {\r\n        this.#prefix = prefix;\r\n        this.#header = this.#footer = this.#body = null;\r\n        this.#switches = switches ?? \"\";\r\n        this.#reverse = reverse;\r\n    }\r\n\r\n    createHeader(title: string, classes: string[], elements?: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        let headerBuilder = new ElementBuilder('div');\r\n        headerBuilder.setClasses(`${this.#prefix}-dialog-header`, ...classes)\r\n        this.#header = headerBuilder.build();\r\n\r\n        let titleElement = new ElementBuilder('span').setClasses(this.getPrefixedString(\"-dialog-title\")).build(title)\r\n\r\n        this.#header.appendChild(titleElement);\r\n        this.appendChildrens(this.#header, ...elements);\r\n\r\n    }\r\n\r\n    createFooter(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#footer = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-footer\"), ...classes).build();\r\n        this.appendChildrens(this.#footer, ...elements);\r\n    }\r\n\r\n    createBody(classes: string[], elements: Element[]) {\r\n        if (!is(classes)) {\r\n            classes = []\r\n        }\r\n        if (!is(elements)) {\r\n            elements = []\r\n        }\r\n        this.#body = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-body\"), ...classes).build();\r\n        this.appendChildrens(this.#body, ...elements);\r\n    }\r\n\r\n    build(id: string): HTMLElement {\r\n        let classes = [this.getPrefixedString(\"-dialog\")]\r\n        if (this.#reverse) {\r\n            classes.push(this.getPrefixedString('-reverse-auto'));\r\n        }\r\n        let dialog = new ElementBuilder('div').setId(id).setClasses(...classes).setAttributes({\r\n            [this.getPrefixedString('-dialog')]: this.#switches\r\n        }).build();\r\n        let container = new ElementBuilder('div').setClasses(this.getPrefixedString(\"-dialog-container\")).build();\r\n        container.appendChild(this.#header);\r\n        container.appendChild(this.#body);\r\n        container.appendChild(this.#footer);\r\n        dialog.appendChild(container);\r\n        return dialog;\r\n    }\r\n\r\n    private appendChildrens(parent: Element, ...elements: Element[]) {\r\n        if (is(elements)) {\r\n            elements.forEach((element) => parent.appendChild(element));\r\n        }\r\n    }\r\n    private getPrefixedString(str: string) {\r\n        return this.#prefix + str\r\n    }\r\n}","import { is, CuiSetup, CuiUtils, CuiAlertType, CuiAlertData, CuiContext } from \"../../core/index\";\r\nimport { ElementManager } from \"../managers/element\";\r\nimport { DialogBuilder } from \"../builders/dialog\";\r\nimport { ElementBuilder } from \"../builders/element\";\r\n\r\nexport interface ICuiAlertHandler {\r\n    show(root: Element): void;\r\n}\r\n\r\ninterface AlertCallbacks {\r\n    [name: string]: () => void\r\n}\r\n\r\nabstract class CuiAlertHandlerBase implements ICuiAlertHandler, CuiContext {\r\n    #callbacks: AlertCallbacks;\r\n    #utils: CuiUtils;\r\n    #id: string;\r\n    #manager: ElementManager;\r\n    closeStr: string;\r\n    iconStr: string;\r\n    content: string;\r\n    title: string;\r\n    prefix: string;\r\n    reverse: boolean;\r\n    #attid: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        this.#callbacks = {\r\n            \"yes\": data.onYes,\r\n            \"no\": data.onNo,\r\n            \"cancel\": data.onCancel,\r\n            \"ok\": data.onOk\r\n        }\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.#utils = setup;\r\n        this.#id = id;\r\n        this.reverse = false;\r\n        this.#attid = null;\r\n        this.closeStr = `${this.#utils.setup.prefix}-close`;\r\n        this.iconStr = `${this.#utils.setup.prefix}-icon`;\r\n    }\r\n\r\n    getId(): string {\r\n        return this.#id;\r\n    }\r\n\r\n    show(root: Element): void {\r\n        let element = document.getElementById(this.#id);\r\n        if (!is(element)) {\r\n            element = this.createElement();\r\n            root.appendChild(element);\r\n        } else {\r\n            this.updateElement(element);\r\n        }\r\n        setTimeout(() => {\r\n            this.#manager = new ElementManager([element], this.#utils);\r\n            let ids = this.#manager.on('closed', this.onClose.bind(this));\r\n            this.#attid = ids.length > 0 ? ids[0] : null;\r\n            this.#manager.emit(\"open\");\r\n        }, 100);\r\n    }\r\n\r\n    updateElement(element: HTMLElement) {\r\n        let title = element.querySelector(`.${this.prefix}-dialog-title`);\r\n        let content = element.querySelector(`.${this.prefix}-dialog-body>p`);\r\n        this.#utils.interactions.mutate(() => {\r\n            if (title) {\r\n                title.innerHTML = this.title;\r\n            }\r\n            if (content) {\r\n                content.innerHTML = this.content;\r\n            }\r\n        }, null)\r\n    }\r\n\r\n    onClose(arg: any) {\r\n        try {\r\n            if (is(arg) && (arg.state)) {\r\n                if (is(this.#callbacks[arg.state])) {\r\n                    this.#callbacks[arg.state]();\r\n                }\r\n            }\r\n        } finally {\r\n            if (this.#attid != null) {\r\n                this.#manager.detach('closed', this.#attid);\r\n                this.#attid = null;\r\n            }\r\n\r\n            this.#manager = null;\r\n        }\r\n    }\r\n\r\n    abstract createElement(): HTMLElement;\r\n\r\n\r\n}\r\n\r\nexport class CuiAlertHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, null, [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: cancel\" }).build(\"Cancel\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiInfoAlertUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n        dialogBuilder.createHeader(this.title, null, null);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: ok\" }).build(\"Ok\")\r\n        ])\r\n\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiYesNoPopUpHandler extends CuiAlertHandlerBase {\r\n    #id: string;\r\n    constructor(setup: CuiUtils, id: string, data: CuiAlertData) {\r\n        super(setup, id, data);\r\n        this.#id = id;\r\n        this.content = data.message;\r\n        this.title = data.title;\r\n        this.prefix = setup.setup.prefix;\r\n        this.reverse = data.reverse ?? false;\r\n    }\r\n\r\n    createElement() {\r\n        let dialogBuilder = new DialogBuilder(this.prefix, this.reverse);\r\n\r\n        dialogBuilder.createHeader(this.title, null, [\r\n            new ElementBuilder('a').setClasses(`${this.prefix}-icon`).setAttributes({\r\n                [this.closeStr]: \"state: cancel\",\r\n                [this.iconStr]: \"close\"\r\n            }).build()\r\n        ]);\r\n        dialogBuilder.createBody(null, [\r\n            new ElementBuilder('p').build(this.content)\r\n        ]);\r\n        dialogBuilder.createFooter([`${this.prefix}-flex`, `${this.prefix}-right`], [\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-margin-small-right`).setAttributes({ [this.closeStr]: \"state: no\" }).build(\"No\"),\r\n            new ElementBuilder('button').setClasses(`${this.prefix}-button`, `${this.prefix}-accent`).setAttributes({ [this.closeStr]: \"state: yes\" }).build(\"Yes\")\r\n        ])\r\n        return dialogBuilder.build(this.#id);\r\n    }\r\n}\r\n\r\nexport class CuiAlertFactory {\r\n    static get(id: string, type: CuiAlertType, data: CuiAlertData, utils: CuiUtils) {\r\n        if (type === \"Info\") {\r\n            return new CuiInfoAlertUpHandler(utils, id, data);\r\n        } else if (type === 'YesNoCancel') {\r\n            return new CuiYesNoPopUpHandler(utils, id, data);\r\n        } else if (type === 'OkCancel') {\r\n            return new CuiAlertHandler(utils, id, data);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n","import { EVENTS, ICuiEventBus } from \"../../core/index\";\r\nimport { CuiMoveEventListener, ICuiMoveEvent } from \"../../core/listeners/move\";\r\n\r\nexport class CuiMoveObserver {\r\n    #bus: ICuiEventBus;\r\n    #moveListener: CuiMoveEventListener;\r\n    #isLocked: boolean;\r\n    #eventId: string;\r\n    #firstEvent: ICuiMoveEvent;\r\n    constructor(bus: ICuiEventBus) {\r\n        this.#bus = bus;\r\n        this.#moveListener = new CuiMoveEventListener();\r\n        this.#moveListener.setCallback(this.onMove.bind(this));\r\n        this.#firstEvent = null;\r\n    }\r\n\r\n    attach() {\r\n        if (!this.#moveListener.isAttached()) {\r\n            this.#moveListener.attach();\r\n            this.#eventId = this.#bus.on(EVENTS.MOVE_LOCK, this.onMoveLock.bind(this))\r\n        }\r\n    }\r\n\r\n    detach() {\r\n        if (this.#moveListener.isAttached()) {\r\n            this.#moveListener.detach();\r\n            this.#eventId && this.#bus.detach(EVENTS.MOVE_LOCK, this.#eventId);\r\n        }\r\n\r\n    }\r\n\r\n    isAttached() {\r\n        return this.#moveListener.isAttached();\r\n    }\r\n\r\n    private onMove(data: ICuiMoveEvent) {\r\n        if (this.#isLocked) {\r\n            return;\r\n        }\r\n        switch (data.type) {\r\n            case \"down\":\r\n                this.#firstEvent = data;\r\n                break;\r\n            case \"move\":\r\n                if (this.#firstEvent) {\r\n                    this.#bus.emit(EVENTS.GLOBAL_MOVE, null, this.#firstEvent);\r\n                    this.#firstEvent = null;\r\n                }\r\n                this.#bus.emit(EVENTS.GLOBAL_MOVE, null, data);\r\n                break;\r\n            case \"up\":\r\n                if (this.#firstEvent) {\r\n                    this.#firstEvent = null;\r\n                    return;\r\n                }\r\n\r\n                this.#bus.emit(EVENTS.GLOBAL_MOVE, null, data);\r\n                break;\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n    }\r\n\r\n    private onMoveLock(flag: boolean) {\r\n        this.#isLocked = flag;\r\n    }\r\n}","import { CuiSetupInit } from \"../core/models/setup\";\r\nimport { is, joinAttributesForQuery, are, registerCuiElement, addCuiArgument } from \"../core/utils/functions\";\r\nimport { ElementManager } from \"./managers/element\";\r\nimport { STATICS, EVENTS, CSS_VARIABLES } from \"../core/utils/statics\";\r\nimport { ICuiLogger, ICuiPlugin, ICuiComponent, ICuiPluginManager, CuiContext, CuiElement, CuiAlertData } from \"../core/models/interfaces\";\r\nimport { ICuiMutionObserver, CuiMutationObserver } from \"./observers/mutations\";\r\nimport { CuiLoggerFactory } from \"../core/factories/logger\";\r\nimport { CuiToastHandler } from \"./managers/toast\";\r\nimport { CollectionManager } from \"./managers/collection\";\r\nimport { CuiUtils } from \"../core/models/utils\";\r\nimport { CuiInstanceInitError } from \"../core/models/errors\";\r\nimport { CuiPluginManager } from \"./managers/plugins\";\r\nimport { CuiAlertHandler, CuiAlertFactory } from \"./handlers/alert\";\r\nimport { CuiAlertType } from \"../core/index\";\r\nimport { CuiMoveObserver } from \"./observers/move\";\r\n\r\n\r\nexport class CuiInstance {\r\n    #log: ICuiLogger;\r\n    #mutationObserver: ICuiMutionObserver;\r\n    #toastManager: CuiToastHandler;\r\n    #utils: CuiUtils;\r\n    #plugins: ICuiPluginManager;\r\n    #components: ICuiComponent[];\r\n    #rootElement: HTMLElement;\r\n    #moveObserver: CuiMoveObserver;\r\n    #mutatedAttributes: string[];\r\n    constructor(setup: CuiSetupInit, plugins: ICuiPlugin[], components: ICuiComponent[]) {\r\n        STATICS.prefix = setup.prefix;\r\n        STATICS.logLevel = setup.logLevel;\r\n        this.#plugins = new CuiPluginManager(plugins);\r\n        this.#components = components ?? [];\r\n        this.#utils = new CuiUtils(setup);\r\n        this.#log = CuiLoggerFactory.get('CuiInstance')\r\n        this.#rootElement = setup.root;\r\n        this.#moveObserver = new CuiMoveObserver(this.#utils.bus);\r\n    }\r\n\r\n    init(): CuiInstance {\r\n        this.#log.debug(\"Instance started\", \"init\")\r\n        // Init elements\r\n        if (!is(window.MutationObserver)) {\r\n            throw new CuiInstanceInitError(\"Mutation observer does not exists\");\r\n        }\r\n        this.#toastManager = new CuiToastHandler(this.#utils.interactions, this.#utils.setup.prefix, this.#utils.setup.animationTimeLong);\r\n        this.#mutatedAttributes = this.#components.map(x => { return x.attribute }); // MUTATED_ATTRIBUTES; \r\n        const initElements = is(this.#mutatedAttributes) ? this.#rootElement.querySelectorAll(joinAttributesForQuery(this.#mutatedAttributes)) : null\r\n        if (is(initElements)) {\r\n            this.#log.debug(`Initiating ${initElements.length} elements`)\r\n            try {\r\n                initElements.forEach((item: any) => {\r\n                    registerCuiElement(item, this.#components, this.#mutatedAttributes, this.#utils);\r\n                })\r\n            } catch (e) {\r\n                this.#log.exception(e);\r\n            }\r\n        }\r\n        this.#log.debug(\"Init plugins\", \"init\")\r\n        // Init plugins\r\n        this.#plugins.init(this.#utils);\r\n\r\n        if (are(this.#components, this.#mutatedAttributes)) {\r\n            this.#log.debug(\"Init mutation observer\", \"init\")\r\n            this.#mutationObserver = new CuiMutationObserver(this.#rootElement, this.#utils)\r\n            this.#mutationObserver.setComponents(this.#components).setAttributes(this.#mutatedAttributes)\r\n            this.#mutationObserver.setPlugins(this.#plugins);\r\n            this.#mutationObserver.start();\r\n        }\r\n\r\n        this.#log.debug(\"Setting CSS globals\", 'init')\r\n        this.#utils.interactions.mutate(() => {\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeLong, `${this.#utils.setup.animationTimeLong}ms`)\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTime, `${this.#utils.setup.animationTime}ms`);\r\n            this.#utils.setProperty(CSS_VARIABLES.animationTimeShort, `${this.#utils.setup.animationTimeShort}ms`);\r\n        }, null)\r\n        this.#moveObserver.attach();\r\n\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_INITIALIZED, null)\r\n        return this;\r\n    }\r\n\r\n    finish(): void {\r\n        this.#mutationObserver.stop();\r\n        this.#moveObserver.detach();\r\n        this.#utils.bus.emit(EVENTS.INSTANCE_FINISHED, null)\r\n    }\r\n\r\n    get(selector: string): ElementManager {\r\n        const elements = this.all(selector);\r\n        if (!elements) {\r\n            return undefined\r\n        }\r\n        const newElement = new ElementManager(elements, this.#utils);\r\n        return newElement\r\n    }\r\n\r\n    collection(selector: string): CollectionManager {\r\n        const elements = this.all(selector);\r\n        if (!is(elements)) {\r\n            return undefined;\r\n        }\r\n        let manager = new CollectionManager(elements, this.#utils.interactions);\r\n        return manager;\r\n    }\r\n\r\n\r\n    async toast(message: string): Promise<boolean> {\r\n        if (!is(message)) {\r\n            return false;\r\n        }\r\n        return this.#toastManager.show(message)\r\n    }\r\n\r\n    select(selector: string): Element {\r\n        return document.querySelector(selector)\r\n    }\r\n\r\n    all(selector: string): Element[] {\r\n        const nodes: NodeListOf<Element> = document.querySelectorAll(selector);\r\n        if (!is(nodes)) {\r\n            return undefined;\r\n        }\r\n        return [...nodes];\r\n    }\r\n\r\n    getUtils(): CuiUtils {\r\n        return this.#utils;\r\n    }\r\n\r\n    on(event: string, callback: any, element?: CuiElement): void {\r\n        if (!are(event, callback)) {\r\n            this.#log.error(\"Incorrect arguments\", \"on\")\r\n        }\r\n        this.#utils.bus.on(event, callback, element);\r\n    }\r\n\r\n    detach(event: string, id: string): void {\r\n        if (!are(event, id)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detach\")\r\n        }\r\n        this.#utils.bus.detach(event, id);\r\n    }\r\n\r\n    detachAll(event: string): void {\r\n        if (!is(event)) {\r\n            this.#log.error(\"Incorrect arguments\", \"detachAll\")\r\n        }\r\n        this.#utils.bus.detachAll(event);\r\n    }\r\n\r\n    emit(event: string, element: Element | string, ...args: any[]): void {\r\n        if (!are(event, element)) {\r\n            this.#log.warning(\"Not enough data to emit event\", \"emit\")\r\n            return;\r\n        }\r\n        let el = typeof element === 'string' ? document.querySelector(element) : element;\r\n        let cuid = (<CuiElement>(el as any)).$cuid;\r\n        if (!is(cuid)) {\r\n            this.#log.warning(\"Element is not a cUI element\", \"emit\")\r\n            return\r\n        }\r\n        this.#utils.bus.emit(event, cuid, ...args);\r\n    }\r\n\r\n    alert(id: string, type: CuiAlertType, data: CuiAlertData): void {\r\n        let popup = CuiAlertFactory.get(id, type, data, this.#utils);\r\n        popup.show(this.#rootElement);\r\n    }\r\n\r\n    getPlugin(name: string): ICuiPlugin {\r\n        return this.#plugins.get(name);\r\n    }\r\n\r\n    createCuiElement<T>(element: HTMLElement, arg: string, data: T): boolean {\r\n        if (!is(arg) || !this.#mutatedAttributes.includes(arg)) {\r\n            this.#log.error(\"Element cannot be created: Unknown attribute\")\r\n            return false;\r\n        }\r\n        if (!addCuiArgument(element, arg, data)) {\r\n            this.#log.error(\"Element cannot be created: Missing data\")\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}","import { ICuiLogger, IUIInteractionProvider, ICuiMutiationPlugin, ICuiComponent, ICuiPluginManager, CuiElement } from \"../../core/models/interfaces\";\r\nimport { CuiLoggerFactory } from \"../../core/factories/logger\";\r\nimport { is, getMatchingAttribute, are, getMatchingAttributes, generateCUID, registerCuiElement, joinAttributesForQuery, parseAttribute } from \"../../core/utils/functions\";\r\nimport { CuiUtils } from \"../../core/models/utils\";\r\n\r\nexport interface ICuiMutionObserver {\r\n    // setOptions(options: MutationObserverInit): ICuiMutionObserver;\r\n    setPlugins(plugins: ICuiPluginManager): ICuiMutionObserver;\r\n    setComponents(components: ICuiComponent[]): ICuiMutionObserver;\r\n    setAttributes(attributes: string[]): ICuiMutionObserver;\r\n    start(): ICuiMutionObserver;\r\n    stop(): ICuiMutionObserver;\r\n}\r\n\r\nexport interface ICuiComponentMutationObserver {\r\n    observe(): void;\r\n    unobserve(): void;\r\n    isObserving(): boolean;\r\n    onMutation(callback: (record: MutationRecord[]) => void): void;\r\n    disable(flag: boolean): void;\r\n}\r\n\r\n\r\nexport class CuiMutationObserver implements ICuiMutionObserver {\r\n    _log: ICuiLogger;\r\n    #observer: MutationObserver;\r\n    #options: MutationObserverInit;\r\n    #element: HTMLElement;\r\n    plugins: ICuiPluginManager;\r\n    #components: ICuiComponent[];\r\n    #attributes: string[];\r\n    #utils: CuiUtils;\r\n    #queryString: string;\r\n    constructor(element: HTMLElement, utils: CuiUtils) {\r\n        this.#observer = null\r\n        this.#element = element\r\n        this._log = CuiLoggerFactory.get('CuiMutationObserver')\r\n        this.plugins = null;\r\n        this.#components = [];\r\n        this.#attributes = [];\r\n        this.#utils = utils;\r\n        this.#queryString = \"\";\r\n\r\n    }\r\n\r\n    setPlugins(plugins: ICuiPluginManager) {\r\n        this.plugins = plugins;\r\n        return this;\r\n    }\r\n\r\n    setComponents(components: ICuiComponent[]) {\r\n        this.#components = components;\r\n        return this;\r\n    }\r\n\r\n    setAttributes(attributes: string[]) {\r\n        this.#options = {\r\n            attributes: true,\r\n            subtree: true,\r\n            childList: true,\r\n            attributeFilter: attributes\r\n        }\r\n        this.#attributes = attributes;\r\n        this.#queryString = joinAttributesForQuery(attributes);\r\n        return this;\r\n    }\r\n\r\n    start() {\r\n        this._log.debug(\"Starting\")\r\n        this.#observer = new MutationObserver(this.mutationCallback.bind(this));\r\n        this.#observer.observe(this.#element, this.#options)\r\n        this._log.debug(\"Started\")\r\n        return this;\r\n    }\r\n\r\n    stop() {\r\n        this._log.debug(\"Stopping\")\r\n        if (this.#observer !== null)\r\n            this._log.debug(\"Observer available\")\r\n        this.#observer.disconnect()\r\n        this.#observer = null;\r\n        this._log.debug(\"Stopped\")\r\n        return this\r\n    }\r\n\r\n    private mutationCallback(mutations: MutationRecord[], observer: MutationObserver) {\r\n        mutations.forEach((mutation: MutationRecord) => {\r\n            switch (mutation.type) {\r\n                case 'attributes':\r\n                    const item = mutation.target as any;\r\n                    if (are(item.$handlers, item.$handlers[mutation.attributeName])) {\r\n                        item.$handlers[mutation.attributeName].refresh(parseAttribute(item, mutation.attributeName));\r\n                    }\r\n                    break;\r\n\r\n                case 'childList':\r\n                    this.handleChildListMutation(mutation);\r\n                    break;\r\n            }\r\n            if (is(this.plugins)) {\r\n                this.plugins.onMutation(mutation).then(() => {\r\n                    //\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    private handleChildListMutation(mutation: MutationRecord) {\r\n        const addedLen = mutation.addedNodes.length;\r\n        const removedLen = mutation.removedNodes.length;\r\n        if (addedLen > 0) {\r\n            this._log.debug(\"Registering added nodes: \" + addedLen)\r\n            this.handleAddedNodes(mutation.addedNodes);\r\n        } else if (removedLen > 0) {\r\n            this._log.debug(\"Removing nodes: \" + removedLen);\r\n            this.handleRemovedNodes(mutation.removedNodes);\r\n        }\r\n    }\r\n\r\n    private handleAddedNodes(nodes: NodeList) {\r\n        nodes.forEach((node: any) => {\r\n            try {\r\n                registerCuiElement(node, this.#components, this.#attributes, this.#utils);\r\n                let childrens = node.hasChildNodes() ? node.querySelectorAll(this.#queryString) : null;\r\n                if (is(childrens)) {\r\n                    childrens.forEach((child: any) => {\r\n                        registerCuiElement(child, this.#components, this.#attributes, this.#utils);\r\n                    })\r\n                }\r\n            } catch (e) {\r\n                this._log.exception(e);\r\n            }\r\n        })\r\n    }\r\n\r\n    private handleRemovedNodes(nodes: NodeList) {\r\n        nodes.forEach((node: any) => {\r\n            this.destroySingleElement(node);\r\n            let childrens = node.hasChildNodes() ? node.querySelectorAll(this.#queryString) : null;\r\n            if (is(childrens)) {\r\n                childrens.forEach((child: any) => {\r\n                    this.destroySingleElement(child);\r\n                })\r\n            }\r\n        })\r\n    }\r\n\r\n    private destroySingleElement(node: any) {\r\n        let element = node as CuiElement;\r\n        if (element.$handlers) {\r\n            for (let name in element.$handlers) {\r\n                if (element.$handlers.hasOwnProperty(name)) {\r\n                    try {\r\n                        element.$handlers[name].destroy();\r\n                    } catch (e) {\r\n                        this._log.exception(e, 'remove - ' + name)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\nexport class CuiComponentMutationHandler implements ICuiComponentMutationObserver {\r\n    #isObserving: boolean;\r\n    #observer: MutationObserver;\r\n    #element: Element;\r\n    #disabled: boolean;\r\n    #options: MutationObserverInit = {\r\n        childList: true,\r\n        subtree: true\r\n    }\r\n    constructor(target: Element) {\r\n        this.#observer = null;\r\n        this.#isObserving = false;\r\n        this.#element = target;\r\n    }\r\n\r\n    observe(): void {\r\n        if (!this.#isObserving && !this.#disabled) {\r\n            this.#observer.observe(this.#element, this.#options);\r\n            this.#isObserving = true;\r\n        }\r\n    }\r\n    unobserve(): void {\r\n        if (this.#isObserving) {\r\n            this.#observer.disconnect();\r\n            this.#isObserving = false;\r\n        }\r\n    }\r\n\r\n    isObserving(): boolean {\r\n        return this.#isObserving;\r\n    }\r\n\r\n    disable(flag: boolean): void {\r\n        this.#disabled = flag;\r\n        if (this.#disabled) {\r\n            this.unobserve();\r\n        }\r\n    }\r\n\r\n    onMutation(callback: (record: MutationRecord[]) => void): void {\r\n        if (this.#isObserving)\r\n            this.unobserve();\r\n        this.#observer = new MutationObserver(callback)\r\n    }\r\n\r\n}","import { CuiInit } from './app/initializer';\r\n\r\nexport const CUI_LIGHT_VERSION = \"0.1.38\";\r\n\r\ndeclare global {\r\n    interface Window {\r\n        cuiInit: CuiInit;\r\n    }\r\n}\r\n\r\nexport * from \"./core/models/interfaces\";\r\nexport * from './core/models/events';\r\nexport * from './core/models/setup';\r\nexport * from './core/models/utils';\r\nexport * from './core/models/colors';\r\nexport * from './app/initializer'\r\nexport { CuiInstance } from './app/instance';\r\n\r\nwindow.cuiInit = new CuiInit();"],"sourceRoot":""}